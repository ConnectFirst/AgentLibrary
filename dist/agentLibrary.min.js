/*! cf-agent-library - v1.0.0 - 2017-03-22 - Connect First */
!function(a){function b(a,b){var d=pa.getInstance(),e={};if(c(b.queue)){var f=[];if(a.generic_key_value_pairs){var g=qa.getText(a,"generic_key_value_pairs");g.length>0&&(f=util.parseKeyValuePairsFromString(g,"|","::"))}for(var h in f)e[h]=f[h]}e.ani=b.ani,e.dnis=b.dnis,e.uii=b.uii;try{b.queue.number?(e.sourceId=b.number||"",e.sourceName=b.name||"",e.sourceDesc=b.description||"","0"===b.queue.isCampaign?e.sourceType="INBOUND":e.sourceType="OUTBOUND"):(e.sourceId="0",e.sourceType="MANUAL",e.sourceName="",e.sourceDesc="")}catch(i){console.error("There was an error processing source tokenization",+i)}try{e.agentFirstName=d.agentSettings.firstName,e.agentLastName=d.agentSettings.lastName,e.agentExternalId=d.agentSettings.externalAgentId,e.agentType=d.agentSettings.agentType,e.agentEmail=d.agentSettings.email}catch(i){console.error("There was an error parsing tokens for agent info. ",i)}if(a.baggage)try{for(var j,k=0;k<Object.keys(b.baggage).length;k++)j=Object.keys(b.baggage)[k],"customLabels"!==j&&(e[j]=b.baggage[j])}catch(i){console.error("There was an error parsing baggage tokens. ",i)}return e}function c(a){return a&&a.isCampaign?"1"===a.isCampaign:!1}function d(a){var b={auxData1:a["@aux_data1"],auxData2:a["@aux_data2"],auxData3:a["@aux_data3"],auxData4:a["@aux_data4"],auxData5:a["@aux_data5"],destination:a["@destination"],dialGroupId:a["@dial_group_id"],dialGroupName:a["@dial_group_name"],dialTime:a["@dial_time"],externId:a["@extern_id"],leadId:a["@lead_id"],firstName:qa.getText(a,"first_name"),midName:qa.getText(a,"mid_name"),lastName:qa.getText(a,"last_name"),sufix:qa.getText(a,"suffix"),title:qa.getText(a,"title"),address1:qa.getText(a,"address1"),address2:qa.getText(a,"address2"),city:qa.getText(a,"city"),state:qa.getText(a,"state"),zip:qa.getText(a,"zip"),gateKeeper:qa.getText(a,"gate_keeper")};return b}function e(a){var b=pa.getInstance(),c=b.outboundSettings.availableOutdialGroups;b.outboundSettings.outdialGroup={};for(var d=0;d<c.length;d++){var e=c[d];e.dialGroupId===a.ui_response.outdial_group_id["#text"]&&(b.agentPermissions.allowLeadSearch=e.allowLeadSearch,b.agentPermissions.allowPreviewLeadFilters=e.allowPreviewLeadFilters,b.agentPermissions.progressiveEnabled=e.progressiveEnabled,b.outboundSettings.outdialGroup=JSON.parse(JSON.stringify(e)),b.agentPermissions.requireFetchedLeadsCalled=e.requireFetchedLeadsCalled)}}function f(a){var b=pa.getInstance();b.inboundSettings.skillProfile={};for(var c=b.inboundSettings.availableSkillProfiles,d=0;d<c.length;d++){var e=c[d],f=qa.getText(a.ui_response,"skill_profile_id");e.profileId===f&&(b.inboundSettings.skillProfile=JSON.parse(JSON.stringify(e)))}}function g(a){var b=pa.getInstance(),c=b.inboundSettings.availableQueues,d=[],e=[],f=a.ui_response.gates.gate_id;if(f)if(Array.isArray(f))for(var g=0;g<f.length;g++){var h=f[g];d.push(h["#text"])}else d.push(f["#text"]);for(var i=0;i<c.length;i++){var j=c[i];d.indexOf(j.gateId)>-1&&e.push(j)}b.inboundSettings.queues=JSON.parse(JSON.stringify(e))}function h(a){var b=pa.getInstance(),c=b.chatSettings.availableChatQueues,d=[],e=[],f=a.ui_response.chat_queues.chat_queue_id;if(f)if(Array.isArray(f))for(var g=0;g<f.length;g++){var h=f[g];d.push(h["#text"])}else d.push(f["#text"]);for(var i=0;i<c.length;i++){var j=c[i];d.indexOf(j.chatQueueId)>-1&&e.push(j)}b.chatSettings.chatQueues=JSON.parse(JSON.stringify(e))}function i(a){"use strict";var b=a.AgentLibrary=function(a){return a=a||{},this.callbacks={},this._requests=[],this._queuedMsgs=[],this._isReconnect=!1,pa.resetInstance(),pa.getInstance().libraryInstance=this,this.openLogger(),"undefined"!=typeof a.callbacks&&(this.callbacks=a.callbacks),"undefined"!=typeof a.socketDest&&(pa.getInstance().applicationSettings.socketDest=a.socketDest,this.openSocket()),this};b.prototype.setCallbacks=function(a){for(var b in a)this.callbacks[b]=a[b]},b.prototype.setCallback=function(a,b){this.callbacks[a]=b},b.prototype.getCallbacks=function(){return this.callbacks},b.prototype.getCallback=function(a){return this.callbacks[a]},b.prototype.getLoginRequest=function(){return pa.getInstance().loginRequest},b.prototype.getConfigRequest=function(){return pa.getInstance().configRequest},b.prototype.getLogoutRequest=function(){return pa.getInstance().logoutRequest},b.prototype.getAgentDailyStats=function(){return pa.getInstance().agentDailyStats},b.prototype.getCallTokens=function(){return pa.getInstance().callTokens},b.prototype.getAgentStateRequest=function(){return pa.getInstance().agentStateRequest},b.prototype.getOffhookInitRequest=function(){return pa.getInstance().offhookInitRequest},b.prototype.getOffhookTermRequest=function(){return pa.getInstance().offhookTermRequest},b.prototype.getHangupRequest=function(){return pa.getInstance().hangupRequest},b.prototype.getPreviewDialRequest=function(){return pa.getInstance().previewDialRequest},b.prototype.getTcpaSafeRequest=function(){return pa.getInstance().tcpaSafeRequest},b.prototype.getManualOutdialRequest=function(){return pa.getInstance().oneToOneOutdialRequest},b.prototype.getManualOutdialCancelRequest=function(){return pa.getInstance().oneToOneOutdialCancelRequest},b.prototype.getCallNotesRequest=function(){return pa.getInstance().callNotesRequest},b.prototype.getCampaignDispositionsRequest=function(){return pa.getInstance().campaignDispositionsRequest},b.prototype.getDispositionRequest=function(){return pa.getInstance().dispositionRequest},b.prototype.getDispositionManualPassRequest=function(){return pa.getInstance().dispositionManualPassRequest},b.prototype.getWarmTransferRequest=function(){return pa.getInstance().warmXferRequest},b.prototype.getColdTransferRequest=function(){return pa.getInstance().coldXferRequest},b.prototype.getWarmTransferCancelRequest=function(){return pa.getInstance().warmXferCancelRequest},b.prototype.getRequeueRequest=function(){return pa.getInstance().requeueRequest},b.prototype.getBargeInRequest=function(){return pa.getInstance().bargeInRequest},b.prototype.getHoldRequest=function(){return pa.getInstance().holdRequest},b.prototype.getPauseRecordRequest=function(){return pa.getInstance().pauseRecordRequest},b.prototype.getRecordRequest=function(){return pa.getInstance().recordRequest},b.prototype.getAgentStatsPacket=function(){return pa.getInstance().agentStatsPacket},b.prototype.getAgentDailyStatsPacket=function(){return pa.getInstance().agentDailyStatsPacket},b.prototype.getQueueStatsPacket=function(){return pa.getInstance().queueStatsPacket},b.prototype.getCampaignStatsPacket=function(){return pa.getInstance().campaignStatsPacket},b.prototype.getLoginPacket=function(){return pa.getInstance().loginPacket},b.prototype.getConfigPacket=function(){return pa.getInstance().configPacket},b.prototype.getAgentStatePacket=function(){return pa.getInstance().agentStatePacket},b.prototype.getCurrentCallPacket=function(){return pa.getInstance().currentCallPacket},b.prototype.getOffhookInitPacket=function(){return pa.getInstance().offhookInitPacket},b.prototype.getOffhookTermPacket=function(){return pa.getInstance().offhookTermPacket},b.prototype.getDialGroupChangeNotification=function(){return pa.getInstance().dialGroupChangeNotification},b.prototype.getDialGroupChangePendingNotification=function(){return pa.getInstance().dialGroupChangePendingNotification},b.prototype.getEndCallNotification=function(){return pa.getInstance().endCallNotification},b.prototype.getGatesChangeNotification=function(){return pa.getInstance().gatesChangeNotification},b.prototype.getGenericNotification=function(){return pa.getInstance().genericNotification},b.prototype.getNewCallNotification=function(){return pa.getInstance().newCallNotification},b.prototype.getCurrentCall=function(){return pa.getInstance().currentCall},b.prototype.getAddSessionNotification=function(){return pa.getInstance().addSessionNotification},b.prototype.getDropSessionNotification=function(){return pa.getInstance().dropSessionNotification},b.prototype.getEarlyUiiNotification=function(){return pa.getInstance().earlyUiiNotification},b.prototype.getApplicationSettings=function(){return pa.getInstance().applicationSettings},b.prototype.getChatSettings=function(){return pa.getInstance().chatSettings},b.prototype.getConnectionSettings=function(){return pa.getInstance().connectionSettings},b.prototype.getInboundSettings=function(){return pa.getInstance().inboundSettings},b.prototype.getOutboundSettings=function(){return pa.getInstance().outboundSettings},b.prototype.getAgentSettings=function(){return pa.getInstance().agentSettings},b.prototype.getTransferSessions=function(){return pa.getInstance().transferSessions},b.prototype.getAgentPermissions=function(){return pa.getInstance().agentPermissions},b.prototype.getAgentStats=function(){return pa.getInstance().agentStats},b.prototype.getAgentDailyStats=function(){return pa.getInstance().agentDailyStats},b.prototype.getQueueStats=function(){return pa.getInstance().queueStats},b.prototype.getCampaignStats=function(){return pa.getInstance().campaignStats}}function j(a){"use strict";var b=a.AgentLibrary;b.prototype.openSocket=function(b){var c=this;if(qa.setCallback(c,sa.OPEN_SOCKET,b),"WebSocket"in a){if(!c.socket){var d=pa.getInstance().applicationSettings.socketDest;qa.logMessage(ra.DEBUG,"Attempting to open socket connection to "+d,""),c.socket=new WebSocket(d),c.socket.onopen=function(){pa.getInstance().applicationSettings.socketConnected=!0,qa.fireCallback(c,sa.OPEN_SOCKET,{reconnect:c._isReconnect}),c.socketOpened()},c.socket.onmessage=function(a){var b=JSON.parse(a.data);b.ui_response?qa.processResponse(c,b):b.ui_notification?qa.processNotification(c,b):b.dialer_request?qa.processDialerResponse(c,b):b.ui_stats?qa.processStats(c,b):b.ui_request&&qa.processRequest(c,b)},c.socket.onclose=function(){qa.fireCallback(c,sa.CLOSE_SOCKET,""),pa.getInstance().applicationSettings.socketConnected=!1,c.socket=null,clearInterval(pa.getInstance().agentDailyIntervalId),pa.getInstance().agentDailyIntervalId=null,clearInterval(pa.getInstance().statsIntervalId),pa.getInstance().statsIntervalId=null,pa.getInstance().agentSettings.isLoggedIn&&setTimeout(function(){c.openSocket()},5e3)}}}else qa.logMessage(ra.WARN,"WebSocket NOT supported by your Browser","")},b.prototype.closeSocket=function(){this.socket.close()},b.prototype.socketOpened=function(){var a,b=this,c=new Date,d=18e4;if(b._isReconnect){b._isReconnect=!1;var e=JSON.parse(pa.getInstance().configRequest.formatJSON()),f=pa.getInstance().connectionSettings.hashCode;e.ui_request.hash_code={"#text":f},e.ui_request.update_login={"#text":"FALSE"},e.ui_request.reconnect={"#text":"TRUE"},b._queuedMsgs.unshift({dts:new Date,msg:JSON.stringify(e)});var g=JSON.parse(pa.getInstance().loginRequest.formatJSON()),h=pa.getInstance().agentSettings.agentId;g.ui_request.reconnect={"#text":"TRUE"},g.ui_request.agent_id={"#text":qa.toString(h)},b._queuedMsgs.unshift({dts:new Date,msg:JSON.stringify(g)})}for(var i=0;i<b._queuedMsgs.length;i++)a=b._queuedMsgs[i],c.getTime()-a.dts.getTime()<d?(qa.logMessage(ra.DEBUG,"Sending queued message to IntelliSocket.",a.msg),qa.sendMessage(b,a.msg)):qa.logMessage(ra.DEBUG,"Queued message expired, discarding.",a.msg);b._queuedMsgs=[]}}function k(a){"use strict";var b=a.AgentLibrary;b.prototype.loginAgent=function(a,b,c){pa.getInstance().loginRequest=new R(a,b);var d=pa.getInstance().loginRequest.formatJSON();qa.setCallback(this,sa.LOGIN,c),qa.sendMessage(this,d)},b.prototype.configureAgent=function(a,b,c,d,e,f,g){pa.getInstance().configRequest=new J(a,b,c,d,e,f);var h=pa.getInstance().configRequest.formatJSON();qa.setCallback(this,sa.CONFIG,g),qa.sendMessage(this,h)},b.prototype.logoutAgent=function(a,b){pa.getInstance().logoutRequest=new S(a),qa.setCallback(this,sa.LOGOUT,b),pa.getInstance().agentSettings.isLoggedIn=!1,qa.fireCallback(this,sa.LOGOUT,""),this.closeSocket()},b.prototype.requestLogoutAgent=function(a,b,c){var d="SUPERVISOR"===pa.getInstance().agentSettings.agentType;if(pa.getInstance().logoutRequest=new S(a,b,d),qa.setCallback(this,sa.LOGOUT,c),pa.getInstance().logoutRequest.isSupervisor){var e=pa.getInstance().logoutRequest.formatJSON();qa.sendMessage(this,e)}},b.prototype.setAgentState=function(a,b,c){pa.getInstance().agentStateRequest=new C(a,b);var d=pa.getInstance().agentStateRequest.formatJSON();qa.setCallback(this,sa.AGENT_STATE,c),qa.sendMessage(this,d)},b.prototype.offhookInit=function(a){pa.getInstance().offhookInitRequest=new T;var b=pa.getInstance().offhookInitRequest.formatJSON();qa.setCallback(this,sa.OFFHOOK_INIT,a),qa.sendMessage(this,b)},b.prototype.offhookTerm=function(){pa.getInstance().offhookTermRequest=new U;var a=pa.getInstance().offhookTermRequest.formatJSON();qa.sendMessage(this,a)},b.prototype.getPendingCallbacks=function(a,b){pa.getInstance().callbacksPendingRequest=new G(a);var c=pa.getInstance().callbacksPendingRequest.formatJSON();qa.setCallback(this,sa.CALLBACK_PENDING,b),qa.sendMessage(this,c)},b.prototype.cancelCallback=function(a,b,c){pa.getInstance().callbackCancelRequest=new F(a,b);var d=pa.getInstance().callbackCancelRequest.formatJSON();qa.setCallback(this,sa.CALLBACK_CANCEL,c),qa.sendMessage(this,d)},b.prototype.requestStats=function(){pa.getInstance().statsIntervalId=setInterval(qa.sendStatsRequestMessage,5e3)}}function l(a){"use strict";var b=a.AgentLibrary;b.prototype.bargeIn=function(a,b,c,d){pa.getInstance().bargeInRequest=new D("FULL",a,b,c);var e=pa.getInstance().bargeInRequest.formatJSON();qa.setCallback(this,sa.BARGE_IN,d),qa.sendMessage(this,e)},b.prototype.coach=function(a,b,c,d){pa.getInstance().bargeInRequest=new D("COACHING",a,b,c);var e=pa.getInstance().bargeInRequest.formatJSON();qa.setCallback(this,sa.COACH_CALL,d),qa.sendMessage(this,e)},b.prototype.coldXfer=function(a,b,c){pa.getInstance().coldXferRequest=new I(a,b);var d=pa.getInstance().coldXferRequest.formatJSON();qa.setCallback(this,sa.XFER_COLD,c),qa.sendMessage(this,d)},b.prototype.dispositionCall=function(a,b,c,d,e,f,g){pa.getInstance().dispositionRequest=new K(a,b,c,d,e,f,g);var h=pa.getInstance().dispositionRequest.formatJSON();qa.sendMessage(this,h),clearInterval(pa.getInstance().pingIntervalId),pa.getInstance().pingIntervalId=null},b.prototype.dispositionManualPass=function(a,b,c,d,e,f,g){pa.getInstance().dispositionManualPassRequest=new L(a,b,c,d,e,f,g);var h=pa.getInstance().dispositionManualPassRequest.formatJSON();qa.sendMessage(this,h)},b.prototype.getCampaignDispositions=function(a,b){pa.getInstance().campaignDispositionsRequest=new H(a);var c=pa.getInstance().campaignDispositionsRequest.formatJSON();qa.setCallback(this,sa.CAMPAIGN_DISPOSITIONS,b),qa.sendMessage(this,c)},b.prototype.hangup=function(a){pa.getInstance().hangupRequest=new M(a);var b=pa.getInstance().hangupRequest.formatJSON();qa.sendMessage(this,b)},b.prototype.hold=function(a,b){pa.getInstance().holdRequest=new N(a);var c=pa.getInstance().holdRequest.formatJSON();qa.setCallback(this,sa.HOLD,b),qa.sendMessage(this,c)},b.prototype.manualOutdial=function(a,b,c,d,e){pa.getInstance().oneToOneOutdialRequest=new V(a,b,c,d,e);var f=pa.getInstance().oneToOneOutdialRequest.formatJSON();qa.sendMessage(this,f)},b.prototype.manualOutdialCancel=function(a){pa.getInstance().oneToOneOutdialCancelRequest=new W(a);var b=pa.getInstance().oneToOneOutdialCancelRequest.formatJSON();qa.sendMessage(this,b)},b.prototype.pauseRecord=function(a,b){pa.getInstance().pauseRecordRequest=new X(a);var c=pa.getInstance().pauseRecordRequest.formatJSON();qa.setCallback(this,sa.PAUSE_RECORD,b),qa.sendMessage(this,c)},b.prototype.previewDial=function(a){pa.getInstance().previewDialRequest=new Z("",[],a);var b=pa.getInstance().previewDialRequest.formatJSON();qa.sendMessage(this,b)},b.prototype.previewFetch=function(a,b){pa.getInstance().previewDialRequest=new Z("",a,"");var c=pa.getInstance().previewDialRequest.formatJSON();qa.setCallback(this,sa.PREVIEW_FETCH,b),qa.sendMessage(this,c)},b.prototype.searchLeads=function(a,b){pa.getInstance().previewDialRequest=new Z("search",a,"");var c=pa.getInstance().previewDialRequest.formatJSON();qa.setCallback(this,sa.LEAD_SEARCH,b),qa.sendMessage(this,c)},b.prototype.setCallNotes=function(a,b){pa.getInstance().callNotesRequest=new E(a);var c=pa.getInstance().callNotesRequest.formatJSON();qa.setCallback(this,sa.CALL_NOTES,b),qa.sendMessage(this,c)},b.prototype.monitor=function(a,b,c,d){pa.getInstance().bargeInRequest=new D("MUTE",a,b,c);var e=pa.getInstance().bargeInRequest.formatJSON();qa.setCallback(this,sa.SILENT_MONITOR,d),qa.sendMessage(this,e)},b.prototype.record=function(a,b){pa.getInstance().recordRequest=new $(a);var c=pa.getInstance().recordRequest.formatJSON();qa.setCallback(this,sa.RECORD,b),qa.sendMessage(this,c)},b.prototype.requeueCall=function(a,b,c,d){pa.getInstance().requeueRequest=new _(a,b,c);var e=pa.getInstance().requeueRequest.formatJSON();qa.setCallback(this,sa.REQUEUE,d),qa.sendMessage(this,e)},b.prototype.safeModeCall=function(a){pa.getInstance().tcpaSafeRequest=new da("",[],a);var b=pa.getInstance().tcpaSafeRequest.formatJSON();qa.sendMessage(this,b)},b.prototype.safeModeFetch=function(a,b){pa.getInstance().tcpaSafeRequest=new da("",a,"");var c=pa.getInstance().tcpaSafeRequest.formatJSON();qa.setCallback(this,sa.SAFE_MODE_FETCH,b),qa.sendMessage(this,c)},b.prototype.safeSearchLeads=function(a,b){pa.getInstance().tcpaSafeRequest=new da("search",a,"");var c=pa.getInstance().tcpaSafeRequest.formatJSON();qa.setCallback(this,sa.SAFE_MODE_SEARCH,b),qa.sendMessage(this,c)},b.prototype.warmXfer=function(a,b,c){pa.getInstance().warmXferRequest=new ea(a,b);var d=pa.getInstance().warmXferRequest.formatJSON();qa.setCallback(this,sa.XFER_WARM,c),qa.sendMessage(this,d)},b.prototype.warmXferCancel=function(a){pa.getInstance().warmXferCancelRequest=new fa(a);var b=pa.getInstance().warmXferCancelRequest.formatJSON();qa.sendMessage(this,b)},b.prototype.getScript=function(a,b,c){var d=pa.getInstance(),e=d.scriptSettings.loadedScripts[a];if(qa.setCallback(this,sa.SCRIPT_CONFIG,c),e&&e.version===b){var f=pa.getInstance().scriptSettings.loadedScripts[a];c(f)}else{d.scriptConfigRequest=new aa(a);var g=pa.getInstance().scriptConfigRequest.formatJSON();qa.sendMessage(this,g)}},b.prototype.saveScriptResult=function(a,b,c){pa.getInstance().scriptResultRequest=new ba(a,b,c);var d=pa.getInstance().scriptResultRequest.formatJSON();qa.sendMessage(this,d)}}function m(a){"use strict";var b=a.AgentLibrary;b.prototype.leadHistory=function(a,b){pa.getInstance().leadHistoryRequest=new O(a);var c=pa.getInstance().leadHistoryRequest.formatJSON();qa.setCallback(this,sa.LEAD_HISTORY,b),qa.sendMessage(this,c)},b.prototype.leadInsert=function(a,b){pa.getInstance().leadInsertRequest=new P(a);var c=pa.getInstance().leadInsertRequest.formatJSON();qa.setCallback(this,sa.LEAD_INSERT,b),qa.sendMessage(this,c)},b.prototype.leadUpdate=function(a,b,c,d){pa.getInstance().leadUpdateRequest=new Q(a,b,c);var e=pa.getInstance().leadUpdateRequest.formatJSON();qa.setCallback(this,sa.LEAD_UPDATE,d),qa.sendMessage(this,e)}}function n(a){"use strict";var b=a.AgentLibrary;b.prototype.setChatAlias=function(a){pa.getInstance().chatAliasRequest=new ga(a);var b=pa.getInstance().chatAliasRequest.formatJSON();qa.sendMessage(this,b)},b.prototype.publicChatRoom=function(a,b){pa.getInstance().chatRoomRequest=new ha(a,"PUBLIC",b);var c=pa.getInstance().chatRoomRequest.formatJSON();qa.sendMessage(this,c)},b.prototype.privateChatRoom=function(a,b,c,d){pa.getInstance().chatRoomRequest=new ha(a,"PRIVATE",b,c,d);var e=pa.getInstance().chatRoomRequest.formatJSON();qa.sendMessage(this,e)},b.prototype.sendChat=function(a,b,c){pa.getInstance().chatSendRequest=new ja(a,b);var d=pa.getInstance().chatSendRequest.formatJSON();qa.setCallback(this,sa.CHAT,c),qa.sendMessage(this,d)},b.prototype.getSupervisors=function(a){pa.getInstance().supervisorListRequest=new ka;var b=pa.getInstance().supervisorListRequest.formatJSON();qa.setCallback(this,sa.SUPERVISOR_LIST,a),qa.sendMessage(this,b)}}function o(a){"use strict";var b=a.AgentLibrary;b.prototype.openLogger=function(){var b=this;if("indexedDB"in a){var c=indexedDB.open("AgentLibraryLogging",5);c.onerror=function(a){console.error("Error requesting DB access")},c.onsuccess=function(a){b._db=a.target.result,b.purgeLog(),b._db.onerror=function(a){console.error("AgentLibrary: Database error - "+a.target.errorCode)},b._db.onsuccess=function(a){console.log("AgentLibrary: Successful logging of record")}},c.onupgradeneeded=function(a){if(b._db=a.target.result,!b._db.objectStoreNames.contains("logger")){var c=b._db.createObjectStore("logger",{autoIncrement:!0});c.createIndex("logLevel","logLevel",{unique:!1}),c.createIndex("dts","dts",{unique:!1});var d="levelAndDate",e=["logLevel","dts"];c.createIndex(d,e,{unique:!1})}}}else console.warn("AgentLibrary: indexedDB NOT supported by your Browser.")},b.prototype.purgeLog=function(){var a=this;if(a._db){var b=a._db.transaction(["logger"],"readwrite"),c=b.objectStore("logger"),d=c.index("dts"),e=new Date;e.setDate(e.getDate()-2);var f=IDBKeyRange.upperBound(e);d.openCursor(f).onsuccess=function(a){var b=a.target.result;b&&(c["delete"](b.primaryKey),b["continue"]())}}},b.prototype.clearLog=function(){var a=this,b=a._db.transaction(["logger"],"readwrite"),c=b.objectStore("logger"),d=c.clear();d.onsuccess=function(a){console.log("AgentLibrary: logger database cleared")}},b.prototype.deleteDB=function(){var a=indexedDB.deleteDatabase("AgentLibraryLogging");a.onerror=function(a){console.log("Error deleting database.")},a.onsuccess=function(a){console.log("Database deleted successfully")}},b.prototype.getLogRecords=function(a,b,c,d,e){a=a||"";var f=this,g=f._db.transaction(["logger"],"readonly"),h=g.objectStore("logger"),i=null,j=null,k=null,l=d||100;if(qa.setCallback(f,sa.LOG_RESULTS,e),""!==a&&"ALL"!==a.toUpperCase()&&"NO-STATS"!==a.toUpperCase()){if(b&&c){var m=[a.toLowerCase(),b],n=[a.toLowerCase(),c];k=IDBKeyRange.bound(m,n)}else b?k=IDBKeyRange.lowerBound([a.toLowerCase(),b]):c&&(k=IDBKeyRange.upperBound([a.toLowerCase(),c]));if(null!==k){var o=[],p=0;i=h.index("levelAndDate"),i.openCursor(k,"prev").onsuccess=function(a){j=a.target.result,j&&l>p?(o.push(j.value),p+=1,j["continue"]()):qa.fireCallback(f,sa.LOG_RESULTS,o)}}else{var q=[],r=0;i=h.index("logLevel"),i.openCursor(a,"prev").onsuccess=function(a){j=a.target.result,j&&l>r?(q.push(j.value),r+=1,j["continue"]()):qa.fireCallback(f,sa.LOG_RESULTS,q)}}}else if("NO-STATS"===a.toUpperCase())if(b&&c?k=IDBKeyRange.bound(b,c):b?k=IDBKeyRange.lowerBound(b):c&&(k=IDBKeyRange.upperBound(c)),null!==k){var s=[],t=0;i=h.index("dts"),i.openCursor(k,"prev").onsuccess=function(a){j=a.target.result,j&&l>t?("stats"!==j.value.logLevel&&(s.push(j.value),t+=1),j["continue"]()):qa.fireCallback(f,sa.LOG_RESULTS,s)}}else{var u=[],v=0;h.openCursor().onsuccess=function(a){j=a.target.result,j&&l>v?("stats"!==j.value.logLevel&&(u.push(j.value),v+=1),j["continue"]()):qa.fireCallback(f,sa.LOG_RESULTS,u)}}else if(b&&c?k=IDBKeyRange.bound(b,c):b?k=IDBKeyRange.lowerBound(b):c&&(k=IDBKeyRange.upperBound(c)),null!==k){var w=[],x=0;i=h.index("dts"),i.openCursor(k,"prev").onsuccess=function(a){j=a.target.result,j&&l>x?(w.push(j.value),x+=1,j["continue"]()):qa.fireCallback(f,sa.LOG_RESULTS,w)}}else{var y=[],z=0;h.openCursor().onsuccess=function(a){j=a.target.result,j&&l>z?(y.push(j.value),z+=1,j["continue"]()):qa.fireCallback(f,sa.LOG_RESULTS,y)}}return null}}var p=function(){};p.prototype.processResponse=function(a){var b=qa.buildDefaultResponse(a),c=pa.getInstance(),d=a.ui_notification,e=qa.getText(d,"agent_id");return"AGENT"===qa.getText(d,"session_type")&&c.incrementTotalCalls(),e===c.agentSettings.agentId?c.currentCall.sessionId=qa.getText(d,"session_id"):""!=e&&(c.currentCall.monitorAgentId=e),"OUTBOUND"===qa.getText(d,"session_type")&&""===e&&qa.getText(d,"allow_control")===!0&&(c.transferSessions[qa.getText(d,"session_id")]={sessionId:qa.getText(d,"session_id"),destination:qa.getText(d,"phone"),uii:qa.getText(d,"uii")}),"2"===d.session_id&&(c.agentSettings.onCall=!0),b.status="OK",b.message="Received ADD-SESSION notification",b.sessionId=qa.getText(d,"session_id"),b.uii=qa.getText(d,"uii"),b.phone=qa.getText(d,"phone"),b.sessionType=qa.getText(d,"session_type"),b.sessionLabel=qa.getText(d,"session_label"),b.allowControl=qa.getText(d,"allow_control"),b.monitoring=qa.getText(d,"monitoring"),b.agentId=qa.getText(d,"agent_id"),b.transferSessions=c.transferSessions,b};var q=function(){};q.prototype.processResponse=function(a){var b=pa.getInstance(),c=a.ui_notification,d=b.configRequest.loginType,e=qa.getText(c,"dial_group_id");b.dialGroupChangeNotification=a,!e||""===e||"INBOUND"!==d&&"BLENDED"!==d?e&&""!==e?b.configRequest.loginType="OUTBOUND":"INBOUND"===d?b.configRequest.loginType="INBOUND":b.configRequest.loginType="NO-SELECTION":b.configRequest.loginType="BLENDED",pa.getInstance().configRequest.dialGroupId=e;var f={message:"Dial Group Updated Successfully.",detail:"Dial Group changed to ["+e+"].",dialGroupId:qa.getText(c,"dial_group_id"),dialGroupName:qa.getText(c,"dialGroupName"),dialGroupDesc:qa.getText(c,"dial_group_desc"),agentId:qa.getText(c,"agent_id")};return f};var r=function(){};r.prototype.processResponse=function(a){var b=pa.getInstance(),c=a.ui_notification;b.agentSettings.pendingDialGroupChange=parseInt(qa.getText(c,"dial_group_id"),10),c.update_from_adminui?b.agentSettings.updateDGFromAdminUI=qa.getText(c,"update_from_adminui")===!0:b.agentSettings.updateDGFromAdminUI=!1;var d={message:"Dial Group Change Pending notification received.",detail:"DialGroup switch for existing session pending until active call ends.",agentId:qa.getText(c,"agent_id"),dialGroupId:qa.getText(c,"dial_group_id"),updateFromAdminUI:qa.getText(c,"update_from_adminui")};return d};var s=function(){};s.prototype.processResponse=function(a){var b=qa.buildDefaultResponse(a),c=a.ui_notification,d=qa.getText(c,"session_id"),e=pa.getInstance().transferSessions[d];return e&&(qa.logMessage(ra.DEBUG,"Transfer to "+e.destination+" has terminated",""),delete pa.getInstance().transferSessions[d],b.transferEnd=e),b.message="Received DROP-SESSION Notification",b.status="OK",b.sessionId=qa.getText(c,"session_id"),b.uii=qa.getText(c,"uii"),b};var t=function(){};t.prototype.processResponse=function(a){var b=qa.buildDefaultResponse(a),c=a.ui_notification;return b.message="Received EARLY_UII notification",b.status="OK",b.agentId=qa.getText(c,"agent_id"),b.uii=qa.getText(c,"uii"),b};var u=function(a){this.libInstance=a};u.prototype.processResponse=function(a){var b=pa.getInstance(),c=a.ui_notification;b.endCallNotification=a,b.currentCall.duration=qa.getText(c,"call_duration"),b.currentCall.termParty=qa.getText(c,"term_party"),b.currentCall.termReason=qa.getText(c,"term_reason"),b.agentSettings.callState="CALL-ENDED",b.agentSettings.onCall=!1,b.agentSettings.onManualOutdial=!1,b.transferSessions={},(b.agentSettings.pendingDialGroupChange>0||-1==b.agentSettings.pendingDialGroupChange)&&(b.configRequest.dialGroupId=b.agentSettings.pendingDialGroupChange,this.libInstance.configureAgent(b.configRequest.queueIds,b.configRequest.chatIds,b.configRequest.skillProfileId,b.configRequest.dialGroupId,b.configRequest.dialDest,b.agentSettings.updateDGFromAdminUI),b.agentSettings.pendingDialGroupChange=0,b.agentSettings.updateDGFromAdminUI=!1);var d={message:"End Call Notification Received.",detail:"",uii:qa.getText(c,"uii"),sessionId:qa.getText(c,"session_id"),agentId:qa.getText(c,"agent_id"),callDts:qa.getText(c,"call_dts"),duration:b.currentCall.duration,termParty:b.currentCall.termParty,termReason:b.currentCall.termReason,recordingUrl:qa.getText(c,"recording_url"),dispositionTimeout:qa.getText(c,"disposition_timeout")};return d};var v=function(){};v.prototype.processResponse=function(a){var b=pa.getInstance(),c=a.ui_notification,d=[],e=b.inboundSettings.availableQueues,f=qa.getText(c,"gate_ids");""!==f&&(f=f.split(","));for(var g=0;g<f.length;g++){var h=f[g],i=qa.findObjById(e,h,"gateId");if(i)d.push(i);else{var j={gateId:h,gateName:"",gateDesc:"",defaultDestOverride:"",isAgentSelectable:!1};d.push(j)}}b.inboundSettings.queues=JSON.parse(JSON.stringify(d));var k={agentId:qa.getText(c,"agent_id"),message:"Gates Change notification received.",queues:d};return k};var w=function(){};w.prototype.processResponse=function(a){var b=qa.buildDefaultResponse(a);return b.messageCode=qa.getText(a.ui_notification,"message_code"),b};var x=function(){};x.prototype.processResponse=function(a){var c=pa.getInstance(),d=a.ui_notification,e={uii:qa.getText(d,"uii"),agentId:qa.getText(d,"agent_id"),dialDest:qa.getText(d,"dial_dest"),queueDts:qa.getText(d,"queue_dts"),queueTime:qa.getText(d,"queue_time"),ani:qa.getText(d,"ani"),dnis:qa.getText(d,"dnis"),callType:qa.getText(d,"call_type"),appUrl:qa.getText(d,"app_url"),isMonitoring:qa.getText(d,"is_monitoring"),allowHold:qa.getText(d,"allow_hold"),allowTransfer:qa.getText(d,"allow_transfer"),allowHangup:qa.getText(d,"allow_hangup"),allowRequeue:qa.getText(d,"allow_requeue"),allowEndCallForEveryone:qa.getText(d,"allow_endcallforeveryone"),scriptId:qa.getText(d,"script_id"),scriptVersion:qa.getText(d,"script_version"),surveyId:qa.getText(d,"survey_id"),surveyPopType:qa.getText(d,"survey_pop_type"),requeueType:qa.getText(d,"requeue_type")};e.queue=qa.processResponseCollection(a,"ui_notification","gate")[0],e.agentRecording=qa.processResponseCollection(a,"ui_notification","agent_recording","agentRecording")[0],e.outdialDispositions=qa.processResponseCollection(a,"ui_notification","outdial_dispositions","disposition")[0],e.requeueShortcuts=qa.processResponseCollection(a,"ui_notification","requeue_shortcuts","requeueShortcut")[0],e.baggage=qa.processResponseCollection(a,"ui_notification","baggage")[0],e.surveyResponse=qa.processResponseCollection(a,"ui_notification","survey_response","detail")[0],e.scriptResponse={},e.transferPhoneBook=qa.processResponseCollection(a,"ui_notification","transfer_phone_book")[0];try{for(var f=JSON.parse(d.script_result["#text"]).model,g={},h=Object.keys(f),i=0;i<h.length;i++){var j=h[i],k=f[j].value;g[j]=k}e.scriptResponse=g}catch(l){}if(e.transferPhoneBook&&e.transferPhoneBook.entrys&&(e.transferPhoneBook=e.transferPhoneBook.entrys),e.requeueShortcuts&&e.requeueShortcuts.requeueShortcuts&&(e.requeueShortcuts=e.requeueShortcuts.requeueShortcuts),e.outdialDispositions&&e.outdialDispositions.disposition&&(e.outdialDispositions.dispositions=[e.outdialDispositions]),e.queue.isCampaign="1"===e.queue.isCampaign,e.outdialDispositions&&e.outdialDispositions.dispositions)for(var m=0;m<e.outdialDispositions.dispositions.length;m++){var n=e.outdialDispositions.dispositions[m];n.isComplete="1"===n.isComplete,n.requireNote="1"===n.requireNote,n.saveSurvey="1"===n.saveSurvey,n.xfer="1"===n.xfer}return c.callTokens=b(d,e),e.isMonitoring?c.agentSettings.callState="ACTIVE-MONITORING":(c.agentSettings.callState="ACTIVE",e.baggage&&""!=e.baggage.auxPhone&&(c.transferNumber=e.baggage.auxPhone)),c.agentDailyStats.currCallTime=0,c.currentCall=e,e.outdialDispositions&&e.outdialDispositions.dispositions&&e.outdialDispositions.dispositions.length>0&&"SUPPRESS"!==e.surveyPopType&&(pa.getInstance().pingIntervalId=setInterval(qa.sendPingCallMessage,3e4)),e};var y=function(){};y.prototype.processResponse=function(a){var b={};return b.agentId=qa.getText(a.ui_notification,"agent_id"),b.status=qa.getText(a.ui_notification,"status"),b};var z=function(){};z.prototype.processResponse=function(a){var b=a.ui_notification;pa.getInstance().agentSettings.onManualOutdial=!0;var c={callType:b["@call_type"],messageId:b["@message_id"],requestId:qa.getText(b,"request_id"),leadState:qa.getText(b,"lead_state"),callback:qa.getText(b,"callback")};return c};var A=function(){};A.prototype.processResponse=function(a){var b=a.ui_notification,c=pa.getInstance();return c.tokens.first_name=qa.getText(b,"first_name"),c.tokens.mid_name=qa.getText(b,"mid_name"),c.tokens.last_name=qa.getText(b,"last_name"),c.tokens.address1=qa.getText(b,"address1"),
c.tokens.address2=qa.getText(b,"address2"),c.tokens.suffix=qa.getText(b,"suffix"),c.tokens.title=qa.getText(b,"title"),c.tokens.city=qa.getText(b,"city"),c.tokens.state=qa.getText(b,"state"),c.tokens.zip=qa.getText(b,"zip"),c.tokens.business_name=qa.getText(b,"business_name"),c.tokens};var B=function(){};B.prototype.processResponse=function(a){var b=a.ui_notification,c={callType:b["@call_type"],messageId:b["@message_id"],requestId:qa.getText(b,"request_id"),leadState:qa.getText(b,"lead_state"),callback:qa.getText(b,"callback")};return c};var C=function(a,b){"ON-BREAK"==a.toUpperCase()&&1==pa.getInstance().onCall?(this.agentState="BREAK-AFTER-CALL",this.agentAuxState=""):(this.agentState=a.toUpperCase()||"",this.agentAuxState=b||"")};C.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ta.AGENT_STATE,"@message_id":qa.getMessageId(),response_to:"",agent_id:{"#text":pa.getInstance().agentSettings.agentId},state:{"#text":this.agentState},agent_aux_state:{"#text":this.agentAuxState}}};return JSON.stringify(a)},C.prototype.processResponse=function(a){var b=a.ui_response,c=qa.getText(b,"status"),d=qa.getText(b,"prev_state"),e=qa.getText(b,"current_state"),f=qa.getText(b,"prev_aux_state"),g=qa.getText(b,"agent_aux_state"),h=pa.getInstance(),i=qa.buildDefaultResponse(a);if(i.agentId=a.ui_response.agent_id["#text"]||"",i.previousState=d,i.currentState=e,i.previousAuxState=f,i.currentAuxState=g,"OK"==c){var j=d,k=e;f.length>0&&(j=f),g.length>0&&(k=g),h.agentSettings.currentState=e,h.agentSettings.currentStateLabel=g,h.agentStatePacket=a}else{""===i.message&&(i.message="Unable to change agent state");var l="Unable to change agent state. "+i.detail;qa.logMessage(ra.WARN,l,a)}return i};var D=function(a,b,c,d){this.audioType=a||"FULL",this.agentId=b,this.uii=c,this.monitorAgentId=d};D.prototype.formatJSON=function(){var a=(pa.getInstance(),{ui_request:{"@destination":"IQ","@type":ta.BARGE_IN,"@message_id":qa.getMessageId(),"@response_to":"",agent_id:{"#text":qa.toString(this.agentId)},uii:{"#text":qa.toString(this.uii)},audio_state:{"#text":qa.toString(this.audioType)},monitor_agent_id:{"#text":qa.toString(this.monitorAgentId)}}});return JSON.stringify(a)},D.prototype.processResponse=function(a){var b=a.ui_response,c=qa.buildDefaultResponse(a);return c.agentId=qa.getText(b,"agent_id"),c.uii=qa.getText(b,"uii"),"OK"===c.status?qa.logMessage(ra.DEBUG,c.message,a):qa.logMessage(ra.WARN,"There was an error processing the Barge-In request. "+c.detail,a),c};var E=function(a){this.notes=a};E.prototype.formatJSON=function(){var a=pa.getInstance(),b={ui_request:{"@destination":"IQ","@message_id":qa.getMessageId(),response_to:"","@type":ta.CALL_NOTES,agent_id:{"#text":qa.toString(a.agentSettings.agentId)},uii:{"#text":qa.toString(a.currentCall.uii)},notes:{"#text":qa.toString(this.notes)}}};return JSON.stringify(b)},E.prototype.processResponse=function(a){var b=qa.buildDefaultResponse(a);return"OK"===b.status?(b.message="Call notes have been updated.",b.type="INFO_EVENT"):(b.type="ERROR_EVENT",b.message="Unable to update notes."),b};var F=function(a,b){this.agentId=b||pa.getInstance().agentSettings.agentId,this.leadId=a};F.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ta.CALLBACK_CANCEL,"@message_id":qa.getMessageId(),response_to:"",agent_id:{"#text":this.agentId},lead_id:{"#text":this.leadId}}};return JSON.stringify(a)};var G=function(a){this.agentId=a||pa.getInstance().agentSettings.agentId};G.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ta.CALLBACK_PENDING,"@message_id":qa.getMessageId(),response_to:"",agent_id:{"#text":this.agentId}}};return JSON.stringify(a)},G.prototype.processResponse=function(a){var b=a.ui_response.lead,c=[];if(Array.isArray(b))for(var e=0;e<b.length;e++){var f=b[e],g=d(f);c.push(g)}else b&&c.push(d(b));return pa.getInstance().agentSettings.pendingCallbacks=JSON.parse(JSON.stringify(c)),pa.getInstance().agentSettings.pendingCallbacks};var H=function(a){this.agentId=pa.getInstance().agentSettings.agentId,this.campaignId=a};H.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ta.CAMPAIGN_DISPOSITIONS,"@message_id":qa.getMessageId(),response_to:"",agent_id:{"#text":qa.toString(this.agentId)},campaign_id:{"#text":qa.toString(this.campaignId)}}};return JSON.stringify(a)},H.prototype.processResponse=function(a){var b=a.ui_response,c=pa.getInstance(),d=qa.processResponseCollection(b,"outdial_dispositions","disposition","disposition");return c.outboundSettings.campaignDispositions=d,d};var I=function(a,b){this.dialDest=a,this.callerId=b||""};I.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ta.XFER_COLD,"@message_id":qa.getMessageId(),"@response_to":"",agent_id:{"#text":pa.getInstance().agentSettings.agentId},uii:{"#text":pa.getInstance().currentCall.uii},dial_dest:{"#text":qa.toString(this.dialDest)},caller_id:{"#text":qa.toString(this.callerId)}}};return JSON.stringify(a)},I.prototype.processResponse=function(a){var b=a.ui_response,c=qa.buildDefaultResponse(a);if(c.agentId=qa.getText(b,"agent_id"),c.uii=qa.getText(b,"uii"),c.sessionId=qa.getText(b,"session_id"),c.dialDest=qa.getText(b,"dial_dest"),"OK"===c.status);else{var d="There was an error processing the Cold Xfer request. "+c.message+" : "+c.detail;qa.logMessage(ra.WARN,d,a)}return c};var J=function(a,b,c,d,e,f){this.queueIds=b||[],this.chatIds=c||[],this.skillProfileId=d||"",this.dialGroupId=e||"",this.dialDest=a||"",this.updateFromAdminUI=f||!1,this.loginType="NO-SELECTION",this.updateLogin=!1;var g=pa.getInstance();this.queueIds=qa.checkExistingIds(g.inboundSettings.availableQueues,this.queueIds,"gateId"),this.chatIds=qa.checkExistingIds(g.chatSettings.availableChatQueues,this.chatIds,"chatQueueId"),this.skillProfileId=qa.checkExistingIds(g.inboundSettings.availableSkillProfiles,[this.skillProfileId],"profileId")[0]||"",this.dialGroupId=qa.checkExistingIds(g.outboundSettings.availableOutdialGroups,[this.dialGroupId],"dialGroupId")[0]||"",this.queueIds.length>0&&""!==this.dialGroupId?this.loginType="BLENDED":this.queueIds.length>0?this.loginType="INBOUND":""!==this.dialGroupId?this.loginType="OUTBOUND":this.loginType="NO-SELECTION",g.agentSettings.isLoggedIn&&(this.updateLogin=!0),qa.validateDest(this.dialDest)||qa.logMessage(ra.WARN,"dialDest ["+this.dialDest+"] must be a valid sip or 10-digit DID","")};J.prototype.formatJSON=function(){for(var a={ui_request:{"@destination":"IQ","@type":ta.LOGIN,"@message_id":qa.getMessageId(),response_to:"",agent_id:{"#text":qa.toString(pa.getInstance().agentSettings.agentId)},agent_pwd:{"#text":pa.getInstance().loginRequest.password},dial_dest:{"#text":qa.toString(this.dialDest)},login_type:{"#text":this.loginType},update_login:{"#text":qa.toString(this.updateLogin)},outdial_group_id:{"#text":qa.toString(this.dialGroupId)},skill_profile_id:{"#text":qa.toString(this.skillProfileId)},update_from_adminui:{"#text":qa.toString(this.updateFromAdminUI)}}},b=[],c=0;c<this.queueIds.length;c++)""!==this.queueIds[c]&&b.push({"#text":qa.toString(this.queueIds[c])});b.length>0?a.ui_request.gates={gate_id:b}:a.ui_request.gates={};for(var d=[],c=0;c<this.chatIds.length;c++)""!==this.chatIds[c]&&d.push({"#text":qa.toString(this.chatIds[c])});return d.length>0?a.ui_request.chat_queues={chat_queue_id:d}:a.ui_request.chat_queues={},JSON.stringify(a)},J.prototype.processResponse=function(a){var b=a.ui_response,c=qa.getText(b,"status"),d=qa.getText(b,"detail"),i=pa.getInstance(),j="",k=qa.buildDefaultResponse(a);return"Logon Session Configuration Updated!"===d&&(i.agentSettings.updateLoginMode=!0,j="Logon Session Configuration Updated!",qa.logMessage(ra.INFO,j,a)),"SUCCESS"===c?(i.agentSettings.isLoggedIn?i.agentSettings.updateLoginMode?(i.agentSettings.dialDest=i.configRequest.dialDest,i.agentSettings.loginType=qa.getText(b,"login_type"),i.agentSettings.guid=qa.getText(b,"guid"),i.agentSettings.accountId=qa.getText(b,"account_id"),i.agentSettings.updateLoginMode=!1,i.agentPermissions.allowLeadSearch=!1,i.agentPermissions.requireFetchedLeadsCalled=!1,i.agentPermissions.allowPreviewLeadFilters=!1,e(a),g(a),h(a),f(a)):(j="Processed a Layer 2 Reconnect Successfully",qa.logMessage(ra.INFO,j,a)):(i.configPacket=a,i.connectionSettings.hashCode=qa.getText(b,"hash_code"),i.agentSettings.isLoggedIn=!0,i.agentSettings.loginDTS=new Date,i.connectionSettings.reconnect=!0,i.agentPermissions.allowLeadSearch=!1,i.agentSettings.dialDest=i.configRequest.dialDest,i.agentSettings.loginType=qa.getText(b,"login_type"),i.agentSettings.guid=qa.getText(b,"guid"),i.agentSettings.accountId=qa.getText(b,"account_id"),e(a),g(a),h(a),f(a)),k.agentSettings=i.agentSettings,k.agentPermissions=i.agentPermissions,k.applicationSettings=i.applicationSettings,k.chatSettings=i.chatSettings,k.connectionSettings=i.connectionSettings,k.inboundSettings=i.inboundSettings,k.outboundSettings=i.outboundSettings,k.scriptSettings=i.scriptSettings):(""===k.message&&(k.message="Agent configuration attempt failed (2nd layer login)"),qa.logMessage(ra.WARN,k.message,a)),k};var K=function(a,b,c,d,e,f,g){this.uii=a,this.dispId=b,this.notes=c,this.callback=d,this.callbackDTS=e||"",this.contactForwardNumber=f||null,this.survey=g||null};K.prototype.formatJSON=function(){var a=pa.getInstance(),b={ui_request:{"@destination":"IQ","@message_id":qa.getMessageId(),"@response_to":"","@type":ta.OUTDIAL_DISPOSITION,agent_id:{"#text":qa.toString(a.agentSettings.agentId)},session_id:{"#text":""},uii:{"#text":qa.toString(this.uii)},disposition_id:{"#text":qa.toString(this.dispId)},notes:{"#text":qa.toString(this.notes)},call_back:{"#text":this.callback===!0?"TRUE":"FALSE"},call_back_DTS:{"#text":qa.toString(this.callbackDTS)},contact_forwarding:{"#text":qa.toString(this.contactForwardNumber)}}};if(a.currentCall.outdialDispositions&&"GATE"===a.currentCall.outdialDispositions.type&&(b.ui_request["@type"]=ta.INBOUND_DISPOSITION),a.currentCall.sessionId&&(b.ui_request.session_id={"#text":a.currentCall.sessionId}),null!==this.survey){for(var c=[],d=Object.keys(this.survey),e=0;e<d.length;e++){var f=d[e],g={"@extern_id":f,"@lead_update_column":qa.toString(this.survey[f].leadField),"#text":qa.toString(this.survey[f].value)};c.push(g)}b.ui_request.survey={response:c}}return JSON.stringify(b)};var L=function(a,b,c,d,e,f,g){this.dispId=a,this.notes=b,this.callback=c,this.callbackDTS=d||"",this.leadId=e||null,this.requestKey=f||null,this.externId=g||null};L.prototype.formatJSON=function(){var a=pa.getInstance(),b={ui_request:{"@destination":"IQ","@message_id":qa.getMessageId(),"@response_to":"","@type":ta.OUTDIAL_DISPOSITION,manual_disp:{"#text":"TRUE"},agent_id:{"#text":qa.toString(a.agentSettings.agentId)},request_key:{"#text":qa.toString(this.requestKey)},disposition_id:{"#text":qa.toString(this.dispId)},notes:{"#text":qa.toString(this.notes)},call_back:{"#text":this.callback===!0?"TRUE":"FALSE"},call_back_DTS:{"#text":qa.toString(this.callbackDTS)},lead_id:{"#text":qa.toString(this.leadId)},extern_id:{"#text":qa.toString(this.externId)},contact_forwarding:{"#text":"null"},session_id:{},uii:{}}};return JSON.stringify(b)};var M=function(a){this.sessionId=a||null};M.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ta.HANGUP,"@message_id":qa.getMessageId(),response_to:"",agent_id:{"#text":qa.toString(pa.getInstance().agentSettings.agentId)},uii:{"#text":qa.toString(pa.getInstance().currentCall.uii)},session_id:{"#text":qa.toString(null===this.sessionId?pa.getInstance().currentCall.sessionId:this.sessionId)}}};return JSON.stringify(a)};var N=function(a){this.holdState=a};N.prototype.formatJSON=function(){var a=pa.getInstance(),b={ui_request:{"@destination":"IQ","@type":ta.HOLD,"@message_id":qa.getMessageId(),"@response_to":"",agent_id:{"#text":qa.toString(a.currentCall.agentId)},uii:{"#text":qa.toString(a.currentCall.uii)},session_id:{"#text":"1"},hold_state:{"#text":this.holdState===!0||"true"===this.holdState?"ON":"OFF"}}};return JSON.stringify(b)},N.prototype.processResponse=function(a){var b=a.ui_response,c=qa.buildDefaultResponse(a),d="";return pa.getInstance().currentCall.uii&&(d=pa.getInstance().currentCall.uii),c.holdState="ON"===qa.getText(b,"hold_state"),c.sessionId=qa.getText(b,"session_id"),c.uii=qa.getText(b,"uii"),"OK"===c.status?c.uii===d?(""===c.message&&(c.message="Broadcasting new hold state of "+c.holdState),qa.logMessage(ra.DEBUG,"Broadcasting new hold state of "+c.holdState,a)):qa.logMessage(ra.DEBUG,"Hold Response is for a different call...discarding",a):(""===c.message&&(c.message="Error processing HOLD request. "+ +c.message+"\n"+c.detail),qa.logMessage(ra.WARN,"Error processing HOLD request. "+c.detail,a)),c};var O=function(a){this.leadId=a};O.prototype.formatJSON=function(){var a=pa.getInstance(),b={ui_request:{"@destination":"IQ","@type":ta.LEAD_HISTORY,"@message_id":qa.getMessageId(),"@response_to":"",agent_id:{"#text":qa.toString(a.agentSettings.agentId)},lead_id:{"#text":qa.toString(this.leadId)}}};return JSON.stringify(b)},O.prototype.processResponse=function(a){var b=a.ui_response,c={leadId:b["@lead_id"]},d=qa.processResponseCollection(a,"ui_response","previous_dial");return Array.isArray(d)||(d=[d]),c.leadHistory=d,c};var P=function(a){a.agent_reserved&&a.agent_reserved===!0?a.agent_reserved="1":a.agent_reserved="0",a.dialable&&a.dialable===!0?a.dialable="1":a.dialable="0",this.dataObj=a};P.prototype.formatJSON=function(){var a=(pa.getInstance(),{ui_request:{"@destination":"IQ","@type":ta.LEAD_INSERT,"@message_id":qa.getMessageId(),"@response_to":"",agent_id:{"#text":qa.toString(this.dataObj.agent_id)},campaign_id:{"#text":qa.toString(this.dataObj.campaign_id)},lead_phone:{"#text":qa.toString(this.dataObj.lead_phone)},dialable:{"#text":qa.toString(this.dataObj.dialable)},agent_reserved:{"#text":qa.toString(this.dataObj.agent_reserved)},call_back_dts:{"#text":qa.toString(this.dataObj.callback_dts)},first_name:{"#text":qa.toString(this.dataObj.first_name)},mid_name:{"#text":qa.toString(this.dataObj.mid_name)},last_name:{"#text":qa.toString(this.dataObj.last_name)},suffix:{"#text":qa.toString(this.dataObj.suffix)},title:{"#text":qa.toString(this.dataObj.title)},address1:{"#text":qa.toString(this.dataObj.address1)},address2:{"#text":qa.toString(this.dataObj.address2)},city:{"#text":qa.toString(this.dataObj.city)},state:{"#text":qa.toString(this.dataObj.state)},zip:{"#text":qa.toString(this.dataObj.zip)},email:{"#text":qa.toString(this.dataObj.email)},gate_keeper:{"#text":qa.toString(this.dataObj.gate_keeper)},aux_data1:{"#text":qa.toString(this.dataObj.aux_data1)},aux_data2:{"#text":qa.toString(this.dataObj.aux_data2)},aux_data3:{"#text":qa.toString(this.dataObj.aux_data3)},aux_data4:{"#text":qa.toString(this.dataObj.aux_data4)},aux_data5:{"#text":qa.toString(this.dataObj.aux_data5)}}});return JSON.stringify(a)},P.prototype.processResponse=function(a){var b=a.ui_response,c=qa.buildDefaultResponse(a);return c.message=b.msg["#text"],c};var Q=function(a,b,c){this.leadId=a,this.leadPhone=b,this.baggage=c,this.agentId=qa.toString(pa.getInstance().agentSettings.agentId)};Q.prototype.formatJSON=function(){this.baggage=_formatBaggage(this.baggage);var a={ui_request:{"@destination":"IQ","@type":ta.LEAD_UPDATE,"@message_id":qa.getMessageId(),"@response_to":"",agent_id:{"#text":this.agentId},lead_id:{"#text":qa.toString(this.leadId)},lead_phone:{"#text":qa.toString(this.leadPhone)},baggage:this.baggage}};return JSON.stringify(a)},Q.prototype.processResponse=function(a){var b=a.ui_response,c=qa.buildDefaultResponse(a);return c.message=b.msg["#text"],c},_formatBaggage=function(a){var b={};return b.first_name={"#text":a.first_name||""},b.mid_name={"#text":a.mid_name||""},b.last_name={"#text":a.last_name||""},b.suffix={"#text":a.suffix||""},b.title={"#text":a.title||""},b.address1={"#text":a.address1||""},b.address2={"#text":a.address2||""},b.city={"#text":a.city||""},b.state={"#text":a.state||""},b.zip={"#text":a.zip||""},b.email={"#text":a.email||""},b.gate_keeper={"#text":a.gate_keeper||""},b.extern_id={"#text":a.extern_id||""},b.aux_data1={"#text":a.aux_data1||""},b.aux_data2={"#text":a.aux_data2||""},b.aux_data3={"#text":a.aux_data3||""},b.aux_data4={"#text":a.aux_data4||""},b.aux_data5={"#text":a.aux_data5||""},b};var R=function(a,b){this.username=a,this.password=b};R.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IS","@type":ta.LOGIN,"@message_id":qa.getMessageId(),response_to:"",username:{"#text":this.username},password:{"#text":this.password}}};return JSON.stringify(a)},R.prototype.processResponse=function(a){var b=a.ui_response,c=b.status["#text"],d=pa.getInstance(),e=qa.buildDefaultResponse(a);if("OK"===c){if(!d.isLoggedInIS){d.loginPacket=a,d.applicationSettings.isLoggedInIS=!0,d.applicationSettings.isTcpaSafeMode="1"===qa.getText(b,"tcpa_safe_mode"),d.chatSettings.alias=qa.getText(b,"first_name")+" "+qa.getText(b,"last_name"),d.agentSettings.loginDTS=new Date,d.agentSettings.maxBreakTime=qa.getText(b,"max_break_time"),d.agentSettings.maxLunchTime=qa.getText(b,"max_lunch_time"),d.agentSettings.firstName=qa.getText(b,"first_name"),d.agentSettings.lastName=qa.getText(b,"last_name"),d.agentSettings.email=qa.getText(b,"email"),d.agentSettings.agentId=qa.getText(b,"agent_id"),d.agentSettings.externalAgentId=qa.getText(b,"external_agent_id"),d.agentSettings.agentType=qa.getText(b,"agent_type"),d.agentSettings.realAgentType=qa.getText(b,"real_agent_type"),d.agentSettings.defaultLoginDest=qa.getText(b,"default_login_dest"),d.agentSettings.altDefaultLoginDest=qa.getText(b,"alt_default_login_dest"),d.agentSettings.initLoginState=qa.getText(b,"init_login_state"),d.agentSettings.initLoginStateLabel=qa.getText(b,"init_login_state_label"),d.agentSettings.outboundManualDefaultRingtime=qa.getText(b,"outbound_manual_default_ringtime"),d.agentSettings.isOutboundPrepay="1"===qa.getText(b,"outbound_prepay"),d.agentSettings.phoneLoginPin=qa.getText(b,"phone_login_pin"),d.agentSettings.username=d.loginRequest.username,d.agentPermissions.allowCallControl="1"===qa.getText(b,"allow_call_control"),d.agentPermissions.allowChat="1"===qa.getText(b,"allow_chat"),d.agentPermissions.showLeadHistory="1"===qa.getText(b,"show_lead_history"),d.agentPermissions.allowManualOutboundGates="1"===qa.getText(b,"allow_manual_outbound_gates"),d.agentPermissions.allowOffHook="1"===qa.getText(b,"allow_off_hook"),d.agentPermissions.allowManualCalls="1"===qa.getText(b,"allow_manual_calls"),d.agentPermissions.allowManualPass="1"===qa.getText(b,"allow_manual_pass"),d.agentPermissions.allowManualIntlCalls="1"===qa.getText(b,"allow_manual_intl_calls"),d.agentPermissions.allowLoginUpdates="1"===qa.getText(b,"allow_login_updates"),d.agentPermissions.allowInbound="1"===qa.getText(b,"allow_inbound"),d.agentPermissions.allowOutbound="1"===qa.getText(b,"allow_outbound"),d.agentPermissions.allowBlended="1"===qa.getText(b,"allow_blended"),d.agentPermissions.allowLoginControl="1"===qa.getText(b,"allow_login_control"),d.agentPermissions.allowCrossQueueRequeue="1"===qa.getText(b,"allow_cross_gate_requeue"),d.agentPermissions.disableSupervisorMonitoring="1"===qa.getText(b,"disable_supervisor_monitoring"),d.outboundSettings.defaultDialGroup=qa.getText(b,"phone_login_dial_group"),a.ui_response.allow_lead_inserts&&"undefined"!=typeof b.insert_campaigns&&a.ui_response.insert_campaigns.campaign&&(d.agentPermissions.allowLeadInserts="1"===qa.getText(b,"allow_lead_inserts")),processCampaigns(a),d.chatSettings.availableChatQueues=qa.processResponseCollection(a.ui_response,"login_chat_queues","chat_queue"),d.inboundSettings.availableQueues=qa.processResponseCollection(a.ui_response,"login_gates","gate"),d.inboundSettings.availableSkillProfiles=qa.processResponseCollection(a.ui_response,"skill_profiles","profile"),d.inboundSettings.availableRequeueQueues=qa.processResponseCollection(a.ui_response,"requeue_gates","gate_group"),d.chatSettings.availableChatRooms=qa.processResponseCollection(a.ui_response,"chat_rooms","room"),d.scriptSettings.availableScripts=qa.processResponseCollection(a.ui_response,"scripts","script"),d.agentSettings.callerIds=qa.processResponseCollection(a.ui_response,"caller_ids","caller_id"),d.agentSettings.availableAgentStates=qa.processResponseCollection(a.ui_response,"agent_states","agent_state"),d.applicationSettings.availableCountries=qa.processResponseCollection(a.ui_response,"account_countries","country"),d.outboundSettings.insertCampaigns=qa.processResponseCollection(a.ui_response,"insert_campaigns","campaign");for(var f=qa.processResponseCollection(a.ui_response,"outdial_groups","group"),g=0;g<f.length;g++){var h=f[g];h.allowLeadSearch="YES"===h.allowLeadSearch,h.allowPreviewLeadFilters="1"===h.allowPreviewLeadFilters,h.progressiveEnabled="1"===h.progressiveEnabled,h.requireFetchedLeadsCalled="1"===h.requireFetchedLeadsCalled}d.outboundSettings.availableOutdialGroups=f}e.agentSettings=d.agentSettings,e.agentPermissions=d.agentPermissions,e.applicationSettings=d.applicationSettings,e.chatSettings=d.chatSettings,e.connectionSettings=d.connectionSettings,e.inboundSettings=d.inboundSettings,e.outboundSettings=d.outboundSettings,e.scriptSettings=d.scriptSettings}else"RESTRICTED"===c?(e.message="Invalid IP Address",qa.logMessage(ra.WARN,e.message,a)):(e.message="Invalid Username or password",qa.logMessage(ra.WARN,e.message,a));return e},processCampaigns=function(a){var b=[],c={},d=[],e=[],f=[],g="",h=0,i="",j=0;if("undefined"!=typeof a.ui_response.campaigns.campaign&&(d=a.ui_response.campaigns.campaign),Array.isArray(d))for(var k=0;k<d.length;k++){h=d[k]["@campaign_id"],i=d[k]["@campaign_name"],j=d[k]["@allow_lead_updates"],e=d[k].custom_labels,f=[],g="",pa.getInstance().agentPermissions.allowLeadUpdatesByCampaign[h]=j;for(var l in e){g=l.replace(/@/,"");var m={};m[g]=e[l],f.push(m)}c={allowLeadUpdates:j,campaignId:h,campaignName:i,surveyId:d[k]["@survey_id"],surveyName:d[k]["@survey_name"],customLabels:f},b.push(c)}else if(d){h=d["@campaign_id"],i=d["@campaign_name"],j=d["@allow_lead_updates"],e=d.custom_labels,f=[],g="",pa.getInstance().agentPermissions.allowLeadUpdatesByCampaign[h]=j;for(var n in e){g=n.replace(/@/,"");var m={};m[g]=e[n],f.push(m)}c={allowLeadUpdates:j,campaignId:h,campaignName:i,surveyId:d["@survey_id"],surveyName:d["@survey_name"],customLabels:f},b.push(c)}pa.getInstance().outboundSettings.availableCampaigns=b};var S=function(a,b,c){this.agentId=a,this.message=b||"",this.isSupervisor=c};S.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ta.LOGOUT,"@message_id":qa.getMessageId(),response_to:"",agent_id:{"#text":this.agentId},message:{"#text":this.message}}};return JSON.stringify(a)};var T=function(){};T.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ta.OFFHOOK_INIT,"@message_id":qa.getMessageId(),response_to:"",agent_id:{"#text":pa.getInstance().agentSettings.agentId},dial_dest:{"#text":pa.getInstance().agentSettings.dialDest}}};return JSON.stringify(a)},T.prototype.processResponse=function(a){var b=a.ui_response.status["#text"],c=qa.buildDefaultResponse(a);return"OK"===b?(pa.getInstance().offhookInitPacket=a,pa.getInstance().agentSettings.isOffhook=!0):(""===c.message&&(c.message="Unable to process offhook request"),qa.logMessage(ra.WARN,c.message+" "+c.detail,a)),c};var U=function(){};U.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ta.OFFHOOK_TERM,"@message_id":qa.getMessageId(),response_to:"",agent_id:{"#text":pa.getInstance().agentSettings.agentId}}};return JSON.stringify(a)},U.prototype.processResponse=function(a){var b=a.ui_notification,c="1"===qa.getText(b,"monitoring"),d=pa.getInstance();d.agentSettings.wasMonitoring=c,d.offhookTermPacket=a,d.agentSettings.isOffhook=!1;var e={status:"OK",agentId:qa.getText(b,"agent_id"),startDts:qa.getText(b,"start_dts"),endDts:qa.getText(b,"end_dts"),monitoring:c};return e};var V=function(a,b,c,d,e){this.destination=a,this.callerId=b,this.ringTime=c||"60",this.countryId=d||"USA",this.gateId=e||""};V.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ta.ONE_TO_ONE_OUTDIAL,"@message_id":qa.getMessageId(),response_to:"",agent_id:{"#text":qa.toString(pa.getInstance().agentSettings.agentId)},destination:{"#text":qa.toString(this.destination)},ring_time:{"#text":qa.toString(this.ringTime)},caller_id:{"#text":qa.toString(this.callerId)},country_id:{"#text":qa.toString(this.countryId)},gate_id:{"#text":qa.toString(this.gateId)}}};return JSON.stringify(a)};var W=function(a){this.uii=a};W.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ta.ONE_TO_ONE_OUTDIAL_CANCEL,"@message_id":qa.getMessageId(),response_to:"",agent_id:{"#text":qa.toString(pa.getInstance().agentSettings.agentId)},uii:{"#text":qa.toString(this.uii)}}};return JSON.stringify(a)};var X=function(a){this.record=a};X.prototype.formatJSON=function(){var a=pa.getInstance(),b="10";a.currentCall.agentRecording&&a.currentCall.agentRecording.pause&&(b=a.currentCall.agentRecording.pause);var c={ui_request:{"@destination":"IQ","@type":ta.PAUSE_RECORD,"@message_id":qa.getMessageId(),"@response_to":"",agent_id:{"#text":qa.toString(a.currentCall.agentId)},uii:{"#text":qa.toString(a.currentCall.uii)},record:{"#text":qa.toString(this.record===!0?"TRUE":"FALSE")},pause:{"#text":qa.toString(b)}}};return JSON.stringify(c)},X.prototype.processResponse=function(a){var b=a.ui_response,c=qa.buildDefaultResponse(a),d="";return pa.getInstance().currentCall.uii&&(d=pa.getInstance().currentCall.uii),c.uii=qa.getText(b,"uii"),c.state=qa.getText(b,"state"),c.pause=qa.getText(b,"pause"),"OK"===c.status?c.uii===d?(""===c.message&&(c.message="Broadcasting new record state of "+c.state),qa.logMessage(ra.DEBUG,"Broadcasting new record state of "+c.state,a)):qa.logMessage(ra.DEBUG,"Pause Record Response is for a different call...discarding",a):(""===c.message&&(c.message="Error processing PAUSE-RECORD request."+c.message+"\n"+c.detail),qa.logMessage(ra.WARN,c.message,a)),c};var Y=function(){};Y.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ta.PING_CALL,"@message_id":qa.getMessageId(),"@response_to":"",agent_id:{"#text":pa.getInstance().currentCall.agentId},uii:{"#text":pa.getInstance().currentCall.uii}}};return JSON.stringify(a)};var Z=function(a,b,c){this.agentId=pa.getInstance().agentSettings.agentId,this.searchFields=b||[],this.requestId=c||"",this.action=a||""};Z.prototype.formatJSON=function(){for(var a={},b=0;b<this.searchFields.length;b++){var c=this.searchFields[b];a[c.key]={"#text":qa.toString(c.value)}}var d={ui_request:{"@destination":"IQ","@type":ta.PREVIEW_DIAL,"@message_id":qa.getMessageId(),"@action":this.action,"@response_to":"",agent_id:{"#text":qa.toString(pa.getInstance().agentSettings.agentId)},pending_request_id:{"#text":qa.toString(this.requestId)},search_fields:a}};return JSON.stringify(d)},Z.prototype.processResponse=function(a){var b=a.dialer_request,c=pa.getInstance(),d=qa.processResponseCollection(b,"destinations","lead"),e={action:b["@action"],callbacks:"TRUE"===b["@callbacks"],dialGroupId:qa.getText(b,"dial_group_id"),accountId:qa.getText(b,"account_id"),agentId:qa.getText(b,"agent_id"),leads:d};if("TRUE"===b["@callbacks"]){qa.logMessage(ra.INFO,"New CALLBACK packet request rec'd from dialer",a);for(var f=0;f<d.length;f++){var g=d[f];c.callbacks.push(g)}}else c.outboundSettings.previewDialLeads=d;return e};var $=function(a){this.record=a};$.prototype.formatJSON=function(){var a=pa.getInstance(),b={ui_request:{"@destination":"IQ","@type":ta.RECORD,"@message_id":qa.getMessageId(),"@response_to":"",agent_id:{"#text":qa.toString(a.currentCall.agentId)},uii:{"#text":qa.toString(a.currentCall.uii)},record:{"#text":this.record===!0?"TRUE":"FALSE"}}};return JSON.stringify(b)},$.prototype.processResponse=function(a){var b=a.ui_response,c=qa.buildDefaultResponse(a),d="";return pa.getInstance().currentCall.uii&&(d=pa.getInstance().currentCall.uii),c.uii=qa.getText(b,"uii"),c.state=qa.getText(b,"state"),"OK"===c.status?c.uii===d?(""===c.message&&(c.message="Broadcasting new record state of "+c.state),qa.logMessage(ra.DEBUG,c.message,a)):qa.logMessage(ra.DEBUG,"Record Response is for a different call...discarding",a):(""===c.message&&(c.message="Error processing RECORD request."+c.message+"\n"+c.detail),qa.logMessage(ra.WARN,c.message,a)),c};var _=function(a,b,c){this.queueId=a,this.skillId=b,this.maintain=c};_.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ta.REQUEUE,"@message_id":qa.getMessageId(),response_to:"",agent_id:{"#text":pa.getInstance().agentSettings.agentId},uii:{"#text":pa.getInstance().currentCall.uii},gate_number:{"#text":qa.toString(this.queueId)},skill_id:{"#text":qa.toString(this.skillId)},maintain_agent:{"#text":this.maintain===!0?"TRUE":"FALSE"}}};return JSON.stringify(a)},_.prototype.processResponse=function(a){var b=a.ui_response,c=qa.buildDefaultResponse(a);if(c.agentId=qa.getText(b,"agent_id"),c.uii=qa.getText(b,"uii"),c.queueId=qa.getText(b,"gate_number"),"OK"===c.status);else{var d="There was an error processing the requeue request. "+c.detail;qa.logMessage(ra.WARN,d,a)}return c};var aa=function(a,b){this.scriptId=a,this.version=b||null};aa.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@message_id":qa.getMessageId(),response_to:"","@type":ta.SCRIPT_CONFIG,agent_id:{"#text":qa.toString(pa.getInstance().agentSettings.agentId)},script_id:{"#text":qa.toString(this.scriptId)}}};return JSON.stringify(a)},aa.prototype.processResponse=function(a){var b=a.ui_response,c=qa.buildDefaultResponse(a);return"true"===c.status?(c.status=!0,c.scriptId=qa.getText(b,"script_id"),c.version=qa.getText(b,"version"),c.json=qa.getText(b,"json"),pa.getInstance().scriptSettings.loadedScripts[c.scriptId]=c):c.status=!1,c};var ba=function(a,b,c){this.uii=a,this.scriptId=b,this.jsonResult=c};ba.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@message_id":qa.getMessageId(),response_to:"","@type":ta.SCRIPT_RESULT,agent_id:{"#text":qa.toString(pa.getInstance().agentSettings.agentId)},uii:{"#text":qa.toString(this.uii)},script_id:{"#text":qa.toString(this.scriptId)},json_result:{"#text":JSON.stringify(this.jsonResult)}}};return JSON.stringify(a)};var ca=function(){};ca.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IS","@type":ta.STATS,"@message_id":qa.getMessageId(),"@response_to":""}};return JSON.stringify(a)};var da=function(a,b,c){this.agentId=pa.getInstance().agentSettings.agentId,this.searchFields=b||[],this.requestId=c||"",this.action=a||""};da.prototype.formatJSON=function(){for(var a={},b=0;b<this.searchFields.length;b++){var c=this.searchFields[b];a[c.key]={"#text":qa.toString(c.value)}}var d={ui_request:{"@destination":"IQ","@type":ta.TCPA_SAFE,"@message_id":qa.getMessageId(),"@action":this.action,response_to:"",agent_id:{"#text":qa.toString(pa.getInstance().agentSettings.agentId)},pending_request_id:{"#text":qa.toString(this.requestId)},search_fields:a}};return JSON.stringify(d)},da.prototype.processResponse=function(a){var b=a.dialer_request,c=pa.getInstance(),d=qa.processResponseCollection(b,"destinations","lead"),e={action:b["@action"],callbacks:"TRUE"===b["@callbacks"],dialGroupId:qa.getText(b,"dial_group_id"),accountId:qa.getText(b,"account_id"),agentId:qa.getText(b,"agent_id"),leads:d};if("TRUE"===b["@callbacks"]){var f="New CALLBACK packet request rec'd from dialer";qa.logMessage(ra.INFO,f,a);for(var g=0;g<d.length;g++){var h=d[g];c.callbacks.push(h)}}else c.outboundSettings.tcpaSafeLeads=d;return e};var ea=function(a,b){this.dialDest=a,this.callerId=b||""};ea.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ta.XFER_WARM,"@message_id":qa.getMessageId(),"@response_to":"",agent_id:{"#text":pa.getInstance().agentSettings.agentId},uii:{"#text":pa.getInstance().currentCall.uii},dial_dest:{"#text":qa.toString(this.dialDest)
},caller_id:{"#text":qa.toString(this.callerId)}}};return JSON.stringify(a)},ea.prototype.processResponse=function(a){var b=a.ui_response,c=qa.buildDefaultResponse(a);return c.agentId=qa.getText(b,"agent_id"),c.uii=qa.getText(b,"uii"),c.sessionId=qa.getText(b,"session_id"),c.dialDest=qa.getText(b,"dial_dest"),"OK"===c.status?qa.logMessage(ra.DEBUG,"Warm Xfer to "+c.dialDest+" processed successfully.",a):qa.logMessage(ra.WARN,"There was an error processing the Warm Xfer request. "+c.message+"\n"+c.detail,a),c};var fa=function(a){this.dialDest=a};fa.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ta.XFER_WARM_CANCEL,"@message_id":qa.getMessageId(),"@response_to":"",agent_id:{"#text":pa.getInstance().agentSettings.agentId},uii:{"#text":pa.getInstance().currentCall.uii},dial_dest:{"#text":qa.toString(this.dialDest)}}};return JSON.stringify(a)};var ga=function(a){this.alias=a};ga.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IS","@type":ta.CHAT_ALIAS,"@message_id":qa.getMessageId(),"@response_to":"",alias:{"#text":qa.toString(this.alias)}}};return JSON.stringify(a)};var ha=function(a,b,c,d,e){this.action=a,this.roomType=b,this.roomId=c,this.agentOne=d||"",this.agentTwo=e||""};ha.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IS","@type":ta.CHAT_ROOM,"@message_id":qa.getMessageId(),"@response_to":"",action:{"#text":qa.toString(this.action)}}};return"EXIT"!==this.action&&(a.ui_request["@room_type"]=this.roomType),"PRIVATE"===this.roomType&&"ENTER"===this.action?(a.ui_request.agent_one={"#text":qa.toString(this.agentOne)},a.ui_request.agent_two={"#text":qa.toString(this.agentTwo)}):a.ui_request.room_id={"#text":qa.toString(this.roomId)},JSON.stringify(a)};var ia=function(){};ia.prototype.processResponse=function(a){var b=a.ui_request,c={roomId:qa.getText(b,"room_id"),agentId:qa.getText(b,"agent_id"),chatAlias:qa.getText(b,"chat_alias"),state:qa.getText(b,"state")};return qa.logMessage(ra.DEBUG,"Chat-Room-State update packet received for room #"+c.roomId,a),c};var ja=function(a,b){this.roomId=a,this.message=b};ja.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IS","@type":ta.CHAT_SEND,"@message_id":qa.getMessageId(),"@response_to":"",room_id:{"#text":qa.toString(this.roomId)},message:{"#text":qa.toString(this.message)}}};return JSON.stringify(a)},ja.prototype.processResponse=function(a){var b=a.ui_request,c={roomType:qa.getText(b,"room_type"),roomId:qa.getText(b,"room_id"),message:qa.getText(b,"message"),sender:qa.getText(b,"sender"),senderId:qa.getText(b,"sender_id"),roomName:qa.getText(b,"room_name"),dynamicCreate:"TRUE"===qa.getText(b,"dynamic_create")};return qa.logMessage(ra.DEBUG,"New CHAT packet received from IntelliServices",a),c};var ka=function(){};ka.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IS","@type":ta.SUPERVISOR_LIST,"@message_id":qa.getMessageId(),"@response_to":"",agent_id:{"#text":qa.toString(pa.getInstance().agentSettings.agentId)}}};return JSON.stringify(a)},ka.prototype.processResponse=function(a){for(var b=pa.getInstance(),c=qa.processResponseCollection(a,"ui_response","supervisor"),d=[],e=0;e<c.length;e++){var f=c[e];d.push({agentId:f.id,firstName:f.fname,lastName:f.lname,username:f.uname})}return qa.logMessage(ra.DEBUG,"New supervisor list received ",d),b.supervisors=d,b.supervisors};var la=function(){};la.prototype.processResponse=function(a){var b=a.ui_stats.agent,c=[];if(b&&Array.isArray(b))for(var d=0;d<b.length;d++){var e={agentLoginType:b[d]["@alt"],agentType:b[d]["@atype"],avgTalkTime:b[d]["@avgtt"],calls:b[d]["@calls"],isDequeueAgent:b[d]["@da"],defaultRoute:b[d]["@droute"],firstName:b[d]["@f"],queueDesc:b[d]["@gdesc"],queueName:b[d]["@gname"],agentId:b[d]["@id"],lastName:b[d]["@l"],loginDuration:b[d]["@ldur"],loginType:b[d]["@ltype"],offHook:b[d]["@oh"],pendingDisp:b[d]["@pd"],presented:b[d]["@pres"],rna:b[d]["@rna"],stateDuration:b[d]["@sdur"],skillProfileName:b[d]["@sp"],agentState:b[d]["@state"],totalTalkTime:b[d]["@ttt"],username:b[d]["@u"],uii:b[d]["@uii"],utilization:b[d]["@util"]};c.push(e)}else try{var f={agentLoginType:b["@alt"],agentType:b["@atype"],avgTalkTime:b["@avgtt"],calls:b["@calls"],isDequeueAgent:b["@da"],defaultRoute:b["@droute"],firstName:b["@f"],queueDesc:b["@gdesc"],queueName:b["@gname"],agentId:b["@id"],lastName:b["@l"],loginDuration:b["@ldur"],loginType:b["@ltype"],offHook:b["@oh"],pendingDisp:b["@pd"],presented:b["@pres"],rna:b["@rna"],stateDuration:b["@sdur"],skillProfileName:b["@sp"],agentState:b["@state"],totalTalkTime:b["@ttt"],username:b["@u"],uii:b["@uii"],utilization:b["@util"]};c.push(f)}catch(g){}return pa.getInstance().agentStats=c,c};var ma=function(){};ma.prototype.processResponse=function(a){var b=pa.getInstance(),c=a.ui_stats,d={agentId:qa.getText(c,"agent_id"),totalLoginSessions:qa.getText(c,"total_login_sessions"),totalCallsHandled:qa.getText(c,"total_calls_handled"),totalPreviewDials:qa.getText(c,"total_preview_dials"),totalManualDials:qa.getText(c,"total_manual_dials"),totalRna:qa.getText(c,"total_rna"),totalTalkTime:b.agentDailyStats.totalTalkTime,totalOffhookTime:b.agentDailyStats.totalOffhookTime,totalLoginTime:b.agentDailyStats.totalLoginTime,totalSuccessDispositions:qa.getText(c,"total_success_dispositions"),currCallTime:b.agentDailyStats.currCallTime};return pa.getInstance().agentDailyStats=d,d};var na=function(){};na.prototype.processResponse=function(a){var b=a.ui_stats,c=qa.processResponseCollection(a,"ui_stats","totals")[0],d=[],e={},f={};if(Array.isArray(b.campaign))for(var g=0;g<b.campaign.length;g++)e=b.campaign[g],e&&(f={active:e["@a"],abandon:e["@aba"],answer:e["@an"],available:e["@av"],busy:e["@b"],complete:e["@c"],error:e["@e"],fax:e["@f"],campaignId:e["@id"],intercept:e["@int"],machine:e["@m"],noanswer:e["@na"],campaignName:e["@name"],pending:e["@p"],ready:e["@r"],staffed:e["@s"],totalConnects:e["@tc"],totalTalkTime:e["@ttt"]}),d.push(f);else e=b.campaign,e&&(f={active:e["@a"],abandon:e["@aba"],answer:e["@an"],available:e["@av"],busy:e["@b"],complete:e["@c"],error:e["@e"],fax:e["@f"],campaignId:e["@id"],intercept:e["@int"],machine:e["@m"],noanswer:e["@na"],campaignName:e["@name"],pending:e["@p"],ready:e["@r"],staffed:e["@s"],totalConnects:e["@tc"],totalTalkTime:e["@ttt"]}),d.push(f);var h={type:b["@type"],campaigns:d,totals:c};return pa.getInstance().campaignStats=h,h};var oa=function(){};oa.prototype.processResponse=function(a){var b=a.ui_stats,c=qa.processResponseCollection(a,"ui_stats","totals")[0],d=[],e={},f={};if(Array.isArray(b.gate))for(var g=0;g<b.gate.length;g++)f=b.gate[g],f&&(e={abandon:f["@aba"],active:f["@active"],answer:f["@ans"],asa:f["@asa"],available:f["@avail"],avgAbandon:f["@avga"],avgQueue:f["@avgq"],avgTalk:f["@avgt"],deflected:f["@def"],queueId:f["@id"],inQueue:f["@inq"],longCall:f["@long_c"],longestInQueue:f["@longq"],queueName:f["@name"],presented:f["@pres"],routing:f["@route"],shortAbandon:f["@short_aba"],shortCall:f["@short_c"],sla:f["@sla"],slaPass:f["@sla_p"],slaFail:f["@sla_f"],staffed:f["@staff"],tAbandonTime:f["@t_aba"],tQueueTime:f["@t_q"],tSpeedOfAnswer:f["@t_soa"],utilization:f["@util"]}),d.push(e);else f=b.gate,f&&(e={abandon:f["@aba"],active:f["@active"],answer:f["@ans"],asa:f["@asa"],available:f["@avail"],avgAbandon:f["@avga"],avgQueue:f["@avgq"],avgTalk:f["@avgt"],deflected:f["@def"],queueId:f["@id"],inQueue:f["@inq"],longCall:f["@long_c"],longestInQueue:f["@longq"],queueName:f["@name"],presented:f["@pres"],routing:f["@route"],shortAbandon:f["@short_aba"],shortCall:f["@short_c"],sla:f["@sla"],slaPass:f["@sla_p"],slaFail:f["@sla_f"],staffed:f["@staff"],tAbandonTime:f["@t_aba"],tQueueTime:f["@t_q"],tSpeedOfAnswer:f["@t_soa"],utilization:f["@util"]}),d.push(e);var h={type:b["@type"],queues:d,totals:c};return pa.getInstance().queueStats=h,h};var pa=function(){function a(){return{currentCall:{},callTokens:{},callbacks:[],libraryInstance:null,pingIntervalId:null,statsIntervalId:null,agentDailyIntervalId:null,chatAliasRequest:null,chatRoomRequest:null,chatSendRequest:null,supervisorListRequest:null,chatRoomStateRequest:new ia,agentStateRequest:null,bargeInRequest:null,callNotesRequest:null,callbacksPendingRequest:null,campaignDispositionsRequest:null,configRequest:null,coldXferRequest:null,dispositionRequest:null,dispositionManualPassRequest:null,hangupRequest:null,holdRequest:null,leadHistoryRequest:null,leadInsertRequest:null,leadUpdateRequest:null,logoutRequest:null,loginRequest:null,offhookInitRequest:null,offhookTermRequest:null,oneToOneOutdialRequest:null,oneToOneOutdialCancelRequest:null,pauseRecordRequest:null,pingCallRequest:null,previewDialRequest:null,reconnectRequest:null,recordRequest:null,requeueRequest:null,statsRequest:null,tcpaSafeRequest:null,warmXferRequest:null,warmXferCancelRequest:null,agentStatePacket:null,configPacket:null,currentCallPacket:null,loginPacket:null,offhookInitPacket:null,offhookTermPacket:null,transferSessions:{},addSessionNotification:new p,dialGroupChangeNotification:new q,dialGroupChangePendingNotification:new r,dropSessionNotification:new s,earlyUiiNotification:new t,endCallNotification:new u,gatesChangeNotification:new v,genericNotification:new w,newCallNotification:new x,agentStatsPacket:new la,agentDailyStatsPacket:new ma,queueStatsPacket:new oa,campaignStatsPacket:new na,applicationSettings:{availableCountries:[],isLoggedInIS:!1,socketConnected:!1,socketDest:"",isTcpaSafeMode:!1},agentStats:[],agentDailyStats:{totalLoginTime:0,totalOffhookTime:0,totalTalkTime:0,currCallTime:0},campaignStats:{},queueStats:{},agentSettings:{accountId:null,agentId:0,agentType:"AGENT",altDefaultLoginDest:"",availableAgentStates:[],callerIds:[],callState:null,currentState:"OFFLINE",currentStateLabel:"",defaultLoginDest:"",dialDest:"",email:"",externalAgentId:"",firstName:"",guid:"",isLoggedIn:!1,isOffhook:!1,initLoginState:"AVAILABLE",initLoginStateLabel:"Available",isOutboundPrepay:!1,lastName:"",loginDTS:null,loginType:"NO-SELECTION",maxBreakTime:-1,maxLunchTime:-1,onCall:!1,onManualOutdial:!1,outboundManualDefaultRingtime:"30",pendingCallbacks:[],pendingDialGroupChange:0,phoneLoginPin:"",realAgentType:"AGENT",supervisors:[],totalCalls:0,transferNumber:"",updateDGFromAdminUI:!1,updateLoginMode:!1,username:"",wasMonitoring:!1},agentPermissions:{allowBlended:!0,allowCallControl:!0,allowChat:!1,allowCrossQueueRequeue:!1,allowInbound:!0,allowLeadInserts:!1,allowLeadSearch:!1,allowLoginControl:!0,allowLoginUpdates:!0,allowManualCalls:!0,allowManualPass:!0,allowManualIntlCalls:!1,allowManualOutboundGates:!1,allowOffHook:!0,allowOutbound:!0,allowPreviewLeadFilters:!1,allowLeadUpdatesByCampaign:{},disableSupervisorMonitoring:!0,progressiveEnabled:!1,requireFetchedLeadsCalled:!1,showLeadHistory:!0},chatSettings:{availableChatQueues:[],availableChatRooms:[],chatQueues:[],alias:""},connectionSettings:{hashCode:null,reconnect:!1},inboundSettings:{availableQueues:[],availableSkillProfiles:[],queues:[],skillProfile:{}},outboundSettings:{availableCampaigns:[],availableOutdialGroups:[],insertCampaigns:[],defaultDialGroup:0,outdialGroup:{},previewDialLeads:[],tcpaSafeLeads:[],campaignDispositions:[]},scriptSettings:{availableScripts:[],loadedScripts:{}},incrementTotalCalls:function(){this.agentSettings.totalCalls=this.agentSettings.totalCalls+1}}}var b;return{getInstance:function(){return b||(b=a()),b},resetInstance:function(){b=null}}}(),qa={logMessage:function(a,b,c){var d=pa.getInstance().libraryInstance;if(d._db){var e=d._db.transaction(["logger"],"readwrite"),f=e.objectStore("logger"),g={logLevel:a,message:b,dts:new Date,data:c};f.add(g)}},sendMessage:function(a,b){var c=JSON.parse(b);if(a.socket&&1===a.socket.readyState){var d=c.ui_request["@type"],e=c.ui_request["@destination"],f="Sending "+d+" request message to "+e;a._requests.push({id:c.ui_request["@message_id"],type:c.ui_request["@type"],msg:c.ui_request}),a._requests.length>1e3&&a._requests.pop(),a.socket.send(b),"STATS"===d?qa.logMessage(ra.STATS,f,c):qa.logMessage(ra.INFO,f,c)}else a._queuedMsgs.push({dts:new Date,msg:b}),pa.getInstance().agentSettings.isLoggedIn&&(a._isReconnect=!0,a.openSocket(),console.warn("AgentLibrary: WebSocket is not connected, attempting to reconnect."))},processResponse:function(a,b){var c=b.ui_response["@type"],d=b.ui_response["@message_id"],e=""!==d&&d?d.slice(0,2):"IS",f="Received "+c.toUpperCase()+" response message from "+e;switch(qa.logMessage(ra.INFO,f,b),qa.fireCallback(a,sa.ON_MESSAGE,b),c.toUpperCase()){case ta.AGENT_STATE:null===pa.getInstance().agentStateRequest&&(pa.getInstance().agentStateRequest=new C(b.ui_response.current_state["#text"],b.ui_response.agent_aux_state["#text"]));var g=pa.getInstance().agentStateRequest.processResponse(b);qa.fireCallback(a,sa.AGENT_STATE,g);break;case ta.BARGE_IN:var h=pa.getInstance().bargeInRequest.processResponse(b),i=b.ui_response["@response_to"],j=qa.findRequestById(a,i);if(j){var k=j.msg.audio_state["#text"];"MUTE"===k?qa.fireCallback(a,sa.SILENT_MONITOR,h):"COACHING"===k?qa.fireCallback(a,sa.COACH_CALL,h):qa.fireCallback(a,sa.BARGE_IN,h)}else qa.fireCallback(a,sa.BARGE_IN,h);break;case ta.CAMPAIGN_DISPOSITIONS:var l=pa.getInstance().campaignDispositionsRequest.processResponse(b);qa.fireCallback(a,sa.CAMPAIGN_DISPOSITIONS,l);break;case ta.CALL_NOTES:var m=pa.getInstance().callNotesRequest.processResponse(b);qa.fireCallback(a,sa.CALL_NOTES,m);break;case ta.CALLBACK_PENDING:var n=pa.getInstance().callbacksPendingRequest.processResponse(b);qa.fireCallback(a,sa.CALLBACK_PENDING,n);break;case ta.HOLD:var o=pa.getInstance().holdRequest.processResponse(b);qa.fireCallback(a,sa.HOLD,o);break;case ta.LEAD_HISTORY:var p=pa.getInstance().leadHistoryRequest.processResponse(b);qa.fireCallback(a,sa.LEAD_HISTORY,p);break;case ta.LEAD_INSERT:var q=pa.getInstance().leadInsertRequest.processResponse(b);qa.fireCallback(a,sa.LEAD_INSERT,q);break;case ta.LEAD_UPDATE:var r=pa.getInstance().leadUpdateRequest.processResponse(b);qa.fireCallback(a,sa.LEAD_UPDATE,r);break;case ta.LOGIN:if("IS"===e){var s=pa.getInstance().loginRequest.processResponse(b);qa.fireCallback(a,sa.LOGIN,s)}else if("IQ"===e){var t=pa.getInstance().configRequest.processResponse(b);qa.fireCallback(a,sa.CONFIG,t),"SUCCESS"===t.status&&(pa.getInstance().statsIntervalId=setInterval(qa.sendStatsRequestMessage,5e3))}break;case ta.LOGOUT:qa.fireCallback(a,sa.LOGOUT,b);break;case ta.OFFHOOK_INIT:var u=new T,v=u.processResponse(b);qa.fireCallback(a,sa.OFFHOOK_INIT,v);break;case ta.PAUSE_RECORD:var w=pa.getInstance().pauseRecordRequest.processResponse(b);qa.fireCallback(a,sa.PAUSE_RECORD,w);break;case ta.RECORD:var x=pa.getInstance().recordRequest.processResponse(b);qa.fireCallback(a,sa.RECORD,x);break;case ta.REQUEUE:var y=pa.getInstance().requeueRequest.processResponse(b);qa.fireCallback(a,sa.REQUEUE,y);break;case ta.SUPERVISOR_LIST:var z=pa.getInstance().supervisorListRequest.processResponse(b);qa.fireCallback(a,sa.SUPERVISOR_LIST,z);break;case ta.SCRIPT_CONFIG:var A=pa.getInstance().scriptConfigRequest.processResponse(b);qa.fireCallback(a,sa.SCRIPT_CONFIG,A);break;case ta.XFER_COLD:var B=pa.getInstance().coldXferRequest.processResponse(b);qa.fireCallback(a,sa.XFER_COLD,B);break;case ta.XFER_WARM:var D=pa.getInstance().warmXferRequest.processResponse(b);qa.fireCallback(a,sa.XFER_WARM,D);break;case ta.XFER_WARM_CANCEL:var E=pa.getInstance().warmXferCancelRequest.processResponse(b);qa.fireCallback(a,sa.XFER_WARM_CANCEL,E)}},processNotification:function(a,b){var c=b.ui_notification["@type"],d=b.ui_notification["@message_id"],e=""===d?"IS":d.slice(0,2),f="Received "+c.toUpperCase()+" notification message from "+e;switch(qa.logMessage(ra.INFO,f,b),c.toUpperCase()){case ta.ADD_SESSION:var g=new p,h=g.processResponse(b);qa.fireCallback(a,sa.ADD_SESSION,h);break;case ta.DIAL_GROUP_CHANGE:var i=new q,j=i.processResponse(b);qa.fireCallback(a,sa.DIAL_GROUP_CHANGE,j);break;case ta.DIAL_GROUP_CHANGE_PENDING:var k=new r,l=k.processResponse(b);qa.fireCallback(a,sa.DIAL_GROUP_CHANGE_PENDING,l);break;case ta.DROP_SESSION:var m=new s(a),n=m.processResponse(b);qa.fireCallback(a,sa.DROP_SESSION,n);break;case ta.EARLY_UII:var o=new t(a),C=o.processResponse(b);qa.fireCallback(a,sa.EARLY_UII,C);break;case ta.END_CALL:var D=new u(a),E=D.processResponse(b);qa.fireCallback(a,sa.END_CALL,E);break;case ta.GATES_CHANGE:var F=new v,G=F.processResponse(b);qa.fireCallback(a,sa.GATES_CHANGE,G);break;case ta.GENERIC:var H=new w,I=H.processResponse(b),J=b.ui_notification["@response_to"],K=qa.findRequestById(a,J);if(K){var c=K.type,L=qa.findCallbackBasedOnMessageType(c);L?qa.fireCallback(a,L,I):qa.fireCallback(a,sa.GENERIC_NOTIFICATION,I)}else qa.fireCallback(a,sa.GENERIC_NOTIFICATION,I);break;case ta.NEW_CALL:var M=new x,N=M.processResponse(b);qa.fireCallback(a,sa.NEW_CALL,N);break;case ta.OFFHOOK_TERM:null===pa.getInstance().offhookTermRequest&&(pa.getInstance().offhookTermRequest=new U);var O=pa.getInstance().offhookTermRequest.processResponse(b);qa.fireCallback(a,sa.OFFHOOK_TERM,O);break;case ta.PREVIEW_LEAD_STATE:var P=new z,Q=P.processResponse(b);qa.fireCallback(a,sa.PREVIEW_LEAD_STATE,Q);break;case ta.PENDING_DISP:var R=new y,S=R.processResponse(b);qa.fireCallback(a,sa.PENDING_DISP,S);break;case ta.REVERSE_MATCH:var T=new A,V=T.processResponse(b);qa.fireCallback(a,sa.REVERSE_MATCH,V);break;case ta.TCPA_SAFE_LEAD_STATE:var P=new B,Q=P.processResponse(b);qa.fireCallback(a,sa.TCPA_SAFE_LEAD_STATE,Q)}},processDialerResponse:function(a,b){var c=b.dialer_request["@type"],d=b.dialer_request["@message_id"],e=""===d?"IS":d.slice(0,2),f="Received "+c.toUpperCase()+" dialer response message from "+e;switch(qa.logMessage(ra.INFO,f,b),qa.fireCallback(a,sa.ON_MESSAGE,b),c.toUpperCase()){case ta.PREVIEW_DIAL_ID:var g=new Z,h=g.processResponse(b);"SEARCH"===h.action.toUpperCase()?qa.fireCallback(a,sa.LEAD_SEARCH,h):qa.fireCallback(a,sa.PREVIEW_FETCH,h);break;case ta.TCPA_SAFE_ID:var i=new da,j=i.processResponse(b);"SEARCH"===j.action.toUpperCase()?qa.fireCallback(a,sa.SAFE_MODE_SEARCH,j):qa.fireCallback(a,sa.SAFE_MODE_FETCH,j)}},processRequest:function(a,b){var c=b.ui_request["@type"];switch(c.toUpperCase()){case ta.CHAT_SEND:var d=new ja,e=d.processResponse(b);qa.fireCallback(a,sa.CHAT,e);break;case ta.CHAT_ROOM_STATE:var f=new ia,g=f.processResponse(b);qa.fireCallback(a,sa.CHAT_ROOM_STATE,g)}},processStats:function(a,b){var c=b.ui_stats["@type"],d="Received "+c.toUpperCase()+" response message from IS";switch(qa.logMessage(ra.STATS,d,b),c.toUpperCase()){case ta.STATS_AGENT:var e=pa.getInstance().agentStatsPacket.processResponse(b);qa.fireCallback(a,sa.STATS_AGENT,e);break;case ta.STATS_AGENT_DAILY:var f=pa.getInstance().agentDailyStatsPacket.processResponse(b);qa.fireCallback(a,sa.STATS_AGENT_DAILY,f),null===pa.getInstance().agentDailyIntervalId&&(pa.getInstance().agentDailyIntervalId=setInterval(qa.onAgentDailyStats,1e3));break;case ta.STATS_CAMPAIGN:var g=pa.getInstance().campaignStatsPacket.processResponse(b);qa.fireCallback(a,sa.STATS_CAMPAIGN,g);break;case ta.STATS_QUEUE:var h=pa.getInstance().queueStatsPacket.processResponse(b);qa.fireCallback(a,sa.STATS_QUEUE,h)}},processResponseCollection:function(a,b,c,d){var e=[],f={},g=[],d=d||"text";if(a[b]&&"undefined"!=typeof a[b][c]&&(g=a[b][c]),Array.isArray(g))for(var h=0;h<g.length;h++){var i="";for(var j in g[h])if(j.match(/^#/)?i=d:(i=j.replace(/@/,""),i=i.replace(/_([a-z])/g,function(a){return a[1].toUpperCase()})),"object"==typeof g[h][j])if(1===Object.keys(g[h][j]).length&&g[h][j]["#text"])f[i]=g[h][j]["#text"];else if(0===Object.keys(g[h][j]).length)f[i]="";else if(Array.isArray(g[j])||Object.keys(g[h][j]).length>1){var k=[];k=qa.processResponseCollection(a[b],c,j,d),"s"!==i.substr(i.length-1)?f[i+"s"]=k:f[i]=k}else{var l=Object.keys(g[h][j])[0],m=[];m=qa.processResponseCollection(g[h],j,l),f[i]=m}else"TRUE"===g[h][j].toUpperCase()?f[i]=!0:"FALSE"===g[h][j].toUpperCase()?f[i]=!1:f[i]=g[h][j];e.push(f),f={}}else{var n="";for(var o in g)if(o.match(/^#/)?n=d:(n=o.replace(/@/,""),n=n.replace(/_([a-z])/g,function(a){return a[1].toUpperCase()})),"object"==typeof g[o])if(g[o]["#text"]&&1===Object.keys(g[o]).length)f[n]=g[o]["#text"];else if(0===Object.keys(g[o]).length)f[n]="";else if(Array.isArray(g[o])||Object.keys(g[o]).length>1){var k=[];k=qa.processResponseCollection(a[b],c,o,d),"s"!==n.substr(n.length-1)?f[n+"s"]=k:f[n]=k}else{var p=Object.keys(g[o])[0],q=[];q=qa.processResponseCollection(g,o,p),f[n]=q}else"TRUE"===g[o].toUpperCase()?f[n]=!0:"FALSE"===g[o].toUpperCase()?f[n]=!1:f[n]=g[o];e.push(f)}return e},fireCallback:function(a,b,c){c=c||"","undefined"!=typeof b&&"function"==typeof a.callbacks[b]&&a.callbacks[b].call(a,c)},setCallback:function(a,b,c){"undefined"!=typeof b&&"undefined"!=typeof c&&(a.callbacks[b]=c)},getMessageId:function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},checkExistingIds:function(a,b,c){for(var d=[],e=[],f=0;f<a.length;f++)d.push(parseInt(a[f][c],10));for(var g=0;g<b.length;g++)-1===d.indexOf(parseInt(b[g],10))&&e.push(parseInt(b[g],10));for(var h=b.length-1;h>=0;h--)e.indexOf(parseInt(b[h],10))>-1&&b.splice(h,1);return b},findObjById:function(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];if(e[c]===b)return e}return null},validateDest:function(a){var b=!1,c=/^\d+$/.test(a);return c&&10===a.length?b=!0:"sip:"===a.slice(0,4).toLowerCase()&&-1!==a.indexOf("@")&&(b=!0),b},findCallbackBasedOnMessageType:function(a){var b="";for(key in ta)ta[key]===a&&(b=sa[key]);return b},buildDefaultResponse:function(a){var b="",c="",d="",e="",f="",g="";return a.ui_response?(e=a.ui_response.message,f=a.ui_response.detail,g=a.ui_response.status):a.ui_notification&&(e=a.ui_notification.message,f=a.ui_notification.detail,g=a.ui_notification.status),e&&(b=e["#text"]||""),f&&(c=f["#text"]||""),g&&(d=g["#text"]||""),{message:b,detail:c,status:d}},toString:function(a){return a?a.toString():""},getText:function(a,b){var c=a[b];return c&&c["#text"]?"TRUE"===c["#text"].toUpperCase()?!0:"FALSE"===c["#text"].toUpperCase()?!1:c["#text"]||"":""},getAttribute:function(a,b){var c=a[b];return c&&c[b]?"TRUE"===c[b].toUpperCase()?!0:"FALSE"===c[b].toUpperCase()?!1:c[b]||"":""},parseKeyValuePairsFromString:function(a,b,c){if(!a)return[];for(var d=[],e=a.split(b),f=0;f<e.length;f++){var g=e[f],h=g.split(c),i={};i[h[0]]=h[1],d.push(i)}return d},findRequestById:function(a,b){for(var c=null,d=0;d<a._requests.length;d++)if(a._requests[d].id===b){c=a._requests[d];break}return c},sendPingCallMessage:function(){pa.getInstance().pingCallRequest=new Y;var a=pa.getInstance().pingCallRequest.formatJSON();qa.sendMessage(pa.getInstance().libraryInstance,a)},sendStatsRequestMessage:function(){pa.getInstance().statsRequest=new ca;var a=pa.getInstance().statsRequest.formatJSON();qa.sendMessage(pa.getInstance().libraryInstance,a)},onAgentDailyStats:function(){if(0!==Object.keys(pa.getInstance().agentDailyStats).length){var a=pa.getInstance(),b=a.agentDailyStats.totalLoginTime;if(a.agentDailyStats.totalLoginTime=b+1,a.agentSettings.isOffhook){var c=a.agentDailyStats.totalOffhookTime;a.agentDailyStats.totalOffhookTime=c+1}if("ENGAGED"==a.agentSettings.currentState){var d=a.agentDailyStats.totalTalkTime;a.agentDailyStats.totalTalkTime=d+1;var e=a.agentDailyStats.currCallTime;a.agentDailyStats.currCallTime=e+1}}}};const ra={DEBUG:"debug",STATS:"stats",INFO:"info",WARN:"warn",ERROR:"error"},sa={ADD_SESSION:"addSessionNotification",AGENT_STATE:"agentStateResponse",BARGE_IN:"bargeInResponse",CLOSE_SOCKET:"closeResponse",COACH_CALL:"coachResponse",CONFIG:"configureResponse",CALL_NOTES:"callNotesResponse",CALLBACK_PENDING:"callbacksPendingResponse",CALLBACK_CANCEL:"callbackCancelResponse",CAMPAIGN_DISPOSITIONS:"campaignDispositionsResponse",CHAT:"chatResponse",CHAT_ROOM_STATE:"chatRoomStateResponse",DIAL_GROUP_CHANGE:"dialGroupChangeNotification",DIAL_GROUP_CHANGE_PENDING:"dialGroupChangePendingNotification",DROP_SESSION:"dropSessionNotification",EARLY_UII:"earlyUiiNotification",END_CALL:"endCallNotification",GATES_CHANGE:"gatesChangeNotification",GENERIC_NOTIFICATION:"genericNotification",GENERIC_RESPONSE:"genericResponse",HOLD:"holdResponse",LOG_RESULTS:"logResultsResponse",LOGIN:"loginResponse",LOGOUT:"logoutResponse",NEW_CALL:"newCallNotification",LEAD_HISTORY:"leadHistoryResponse",LEAD_INSERT:"leadInsertResponse",LEAD_SEARCH:"leadSearchResponse",LEAD_UPDATE:"leadUpdateResponse",OFFHOOK_INIT:"offhookInitResponse",OFFHOOK_TERM:"offhookTermNotification",OPEN_SOCKET:"openResponse",PAUSE_RECORD:"pauseRecordResponse",PENDING_DISP:"pendingDispNotification",PREVIEW_FETCH:"previewFetchResponse",PREVIEW_LEAD_STATE:"previewLeadStateNotification",RECORD:"recordResponse",REQUEUE:"requeueResponse",REVERSE_MATCH:"reverseMatchNotification",SAFE_MODE_FETCH:"safeModeFetchResponse",SAFE_MODE_SEARCH:"safeModeSearchResponse",SCRIPT_CONFIG:"scriptConfigResponse",SILENT_MONITOR:"monitorResponse",STATS_AGENT:"agentStats",STATS_AGENT_DAILY:"agentDailyStats",STATS_CAMPAIGN:"campaignStats",STATS_QUEUE:"queueStats",SUPERVISOR_LIST:"supervisorListResponse",TCPA_SAFE_LEAD_STATE:"tcpaSafeLeadStateNotification",XFER_COLD:"coldXferResponse",XFER_WARM:"warmXferResponse"},ta={ADD_SESSION:"ADD-SESSION",BARGE_IN:"BARGE-IN",AGENT_STATE:"AGENT-STATE",CALL_NOTES:"CALL-NOTES",CALLBACK_PENDING:"PENDING-CALLBACKS",CALLBACK_CANCEL:"CANCEL-CALLBACK",CAMPAIGN_DISPOSITIONS:"CAMPAIGN-DISPOSITIONS",CHAT_SEND:"CHAT",CHAT_ALIAS:"CHAT-ALIAS",CHAT_ROOM:"CHAT-ROOM",CHAT_ROOM_STATE:"CHAT-ROOM-STATE",DIAL_GROUP_CHANGE:"DIAL_GROUP_CHANGE",DIAL_GROUP_CHANGE_PENDING:"DIAL_GROUP_CHANGE_PENDING",DROP_SESSION:"DROP-SESSION",EARLY_UII:"EARLY_UII",END_CALL:"END-CALL",GATES_CHANGE:"GATES_CHANGE",GENERIC:"GENERIC",HANGUP:"HANGUP",HOLD:"HOLD",INBOUND_DISPOSITION:"INBOUND-DISPOSITION",LEAD_HISTORY:"LEAD-HISTORY",LEAD_INSERT:"LEAD-INSERT",LEAD_UPDATE:"LEAD-UPDATE",LOGIN:"LOGIN",LOGOUT:"LOGOUT",NEW_CALL:"NEW-CALL",OFFHOOK_INIT:"OFF-HOOK-INIT",OFFHOOK_TERM:"OFF-HOOK-TERM",ON_MESSAGE:"ON-MESSAGE",ONE_TO_ONE_OUTDIAL:"ONE-TO-ONE-OUTDIAL",ONE_TO_ONE_OUTDIAL_CANCEL:"ONE-TO-ONE-OUTDIAL-CANCEL",OUTDIAL_DISPOSITION:"OUTDIAL-DISPOSITION",PAUSE_RECORD:"PAUSE-RECORD",PING_CALL:"PING-CALL",PREVIEW_DIAL:"PREVIEW-DIAL",PENDING_DISP:"PENDING_DISP",PREVIEW_DIAL_ID:"PREVIEW_DIAL",PREVIEW_LEAD_STATE:"PREVIEW-LEAD-STATE",RECORD:"RECORD",REQUEUE:"RE-QUEUE",REVERSE_MATCH:"REVERSE_MATCH",SCRIPT_CONFIG:"SCRIPT-CONFIG",SCRIPT_RESULT:"SCRIPT-RESULT",STATS:"STATS",STATS_AGENT:"AGENT",STATS_AGENT_DAILY:"AGENTDAILY",STATS_CAMPAIGN:"CAMPAIGN",STATS_QUEUE:"GATE",SUPERVISOR_LIST:"SUPERVISOR-LIST",TCPA_SAFE:"TCPA-SAFE",TCPA_SAFE_ID:"TCPA_SAFE",TCPA_SAFE_LEAD_STATE:"TCPA-SAFE-LEAD-STATE",XFER_COLD:"COLD-XFER",XFER_WARM:"WARM-XFER",XFER_WARM_CANCEL:"WARM-XFER-CANCEL"};var ua=function(a){return i(a),j(a),k(a),l(a),m(a),n(a),o(a),a.AgentLibrary};"function"==typeof define&&define.amd?define(function(){return ua({})}):"object"==typeof module&&module.exports?module.exports=ua(this):ua(this)}(this);