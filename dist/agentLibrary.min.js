/*! cf-agent-library - v2.0.0 - 2018-01-16 - Connect First */
!function(global){function buildCallTokenMap(notif,newCall){var model=UIModel.getInstance(),tokens=newCall.baggage||{};if(notif.baggage&&notif.baggage.generic_key_value_pairs){var keyValuePairs=[],keyValuePairsStr=utils.getText(notif.baggage,"generic_key_value_pairs");keyValuePairsStr.length>0&&(keyValuePairs=utils.parseKeyValuePairsFromString(keyValuePairsStr,"|","::"));for(var keyValue in keyValuePairs)tokens[keyValue]=keyValuePairs[keyValue]}tokens.ani=newCall.ani,tokens.dnis=newCall.dnis,tokens.uii=newCall.uii;try{newCall.queue.number?(tokens.sourceId=newCall.number||"",tokens.sourceName=newCall.name||"",tokens.sourceDesc=newCall.description||"","0"===newCall.queue.isCampaign?tokens.sourceType="INBOUND":tokens.sourceType="OUTBOUND"):(tokens.sourceId="0",tokens.sourceType="MANUAL",tokens.sourceName="",tokens.sourceDesc="")}catch(any){console.error("There was an error processing source tokenization",+any)}try{tokens.agentFirstName=model.agentSettings.firstName,tokens.agentLastName=model.agentSettings.lastName,tokens.agentExternalId=model.agentSettings.externalAgentId,tokens.agentType=model.agentSettings.agentType,tokens.agentEmail=model.agentSettings.email,tokens.agentUserName=model.agentSettings.username}catch(any){console.error("There was an error parsing tokens for agent info. ",any)}return tokens}function parseLead(leadRaw){var lead={auxData1:leadRaw["@aux_data1"],auxData2:leadRaw["@aux_data2"],auxData3:leadRaw["@aux_data3"],auxData4:leadRaw["@aux_data4"],auxData5:leadRaw["@aux_data5"],destination:leadRaw["@destination"],dialGroupId:leadRaw["@dial_group_id"],dialGroupName:leadRaw["@dial_group_name"],dialTime:leadRaw["@dial_time"],externId:leadRaw["@extern_id"],leadId:leadRaw["@lead_id"],firstName:utils.getText(leadRaw,"first_name"),midName:utils.getText(leadRaw,"mid_name"),lastName:utils.getText(leadRaw,"last_name"),sufix:utils.getText(leadRaw,"suffix"),title:utils.getText(leadRaw,"title"),address1:utils.getText(leadRaw,"address1"),address2:utils.getText(leadRaw,"address2"),city:utils.getText(leadRaw,"city"),state:utils.getText(leadRaw,"state"),zip:utils.getText(leadRaw,"zip"),gateKeeper:utils.getText(leadRaw,"gate_keeper")};return lead}function setDialGroupSettings(response){var model=UIModel.getInstance(),outdialGroups=model.outboundSettings.availableOutdialGroups;model.outboundSettings.outdialGroup={};for(var g=0;g<outdialGroups.length;g++){var group=outdialGroups[g];group.dialGroupId===response.ui_response.outdial_group_id["#text"]&&(model.agentPermissions.allowLeadSearch=group.allowLeadSearch,model.agentPermissions.allowPreviewLeadFilters=group.allowPreviewLeadFilters,model.agentPermissions.progressiveEnabled=group.progressiveEnabled,model.outboundSettings.outdialGroup=JSON.parse(JSON.stringify(group)),model.agentPermissions.requireFetchedLeadsCalled=group.requireFetchedLeadsCalled)}}function setSkillProfileSettings(response){var model=UIModel.getInstance();model.inboundSettings.skillProfile={};for(var skillProfiles=model.inboundSettings.availableSkillProfiles,s=0;s<skillProfiles.length;s++){var profile=skillProfiles[s],responseId=utils.getText(response.ui_response,"skill_profile_id");profile.profileId===responseId&&(model.inboundSettings.skillProfile=JSON.parse(JSON.stringify(profile)))}}function setGateSettings(response){var model=UIModel.getInstance(),gates=model.inboundSettings.availableQueues,selectedGateIds=[],selectedGates=[],gateIds=response.ui_response.gates.gate_id;if(gateIds)if(Array.isArray(gateIds))for(var s=0;s<gateIds.length;s++){var obj=gateIds[s];selectedGateIds.push(obj["#text"])}else selectedGateIds.push(gateIds["#text"]);for(var gIdx=0;gIdx<gates.length;gIdx++){var gate=gates[gIdx];selectedGateIds.indexOf(gate.gateId)>-1&&selectedGates.push(gate)}model.inboundSettings.queues=JSON.parse(JSON.stringify(selectedGates))}function setChatQueueSettings(response){var model=UIModel.getInstance(),chatQueues=model.chatSettings.availableChatQueues,selectedChatQueueIds=[],selectedChatQueues=[],cQueues=response.ui_response.chat_queues||{},chatQueueIds=cQueues.chat_queue_id;if(chatQueueIds)if(Array.isArray(chatQueueIds))for(var c=0;c<chatQueueIds.length;c++){var obj=chatQueueIds[c];selectedChatQueueIds.push(obj["#text"])}else selectedChatQueueIds.push(chatQueueIds["#text"]);for(var cIdx=0;cIdx<chatQueues.length;cIdx++){var chatQueue=chatQueues[cIdx];selectedChatQueueIds.indexOf(chatQueue.chatQueueId)>-1&&selectedChatQueues.push(chatQueue)}model.chatSettings.chatQueues=JSON.parse(JSON.stringify(selectedChatQueues))}function buildChatTokenMap(notif,newChat){var tokens={},model=UIModel.getInstance();if(newChat.preChatData)for(var prop in newChat.preChatData)newChat.preChatData.hasOwnProperty(prop)&&(tokens[prop]=newChat.preChatData[prop]);try{tokens.chatQueueId=newChat.chatQueueId,tokens.chatQueueName=newChat.chatQueueName,tokens.ani=newChat.ani,tokens.dnis=newChat.dnis,tokens.uii=newChat.uii}catch(any){console.error("There was an error parsing chat tokens for basic chat info. ",any)}try{tokens.agentFirstName=model.agentSettings.firstName,tokens.agentLastName=model.agentSettings.lastName,tokens.agentExternalId=model.agentSettings.externalAgentId,tokens.agentType=model.agentSettings.agentType,tokens.agentEmail=model.agentSettings.email,tokens.agentUserName=model.agentSettings.username}catch(any){console.error("There was an error parsing chat tokens for agent info. ",any)}return tokens}function initAgentLibraryCore(context){"use strict";var AgentLibrary=context.AgentLibrary=function(config){return config=config||{},this.callbacks={},this._requests=[],this._queuedMsgs=[],this._isReconnect=!1,UIModel.resetInstance(),UIModel.getInstance().libraryInstance=this,this.openLogger(),"undefined"!=typeof config.callbacks&&(this.callbacks=config.callbacks),"undefined"!=typeof config.socketDest&&(UIModel.getInstance().applicationSettings.socketDest=config.socketDest,this.openSocket()),this};AgentLibrary.prototype.setCallbacks=function(callbackMap){for(var property in callbackMap)this.callbacks[property]=callbackMap[property]},AgentLibrary.prototype.setCallback=function(type,callback){this.callbacks[type]=callback},AgentLibrary.prototype.getCallbacks=function(){return this.callbacks},AgentLibrary.prototype.getCallback=function(type){return this.callbacks[type]},AgentLibrary.prototype.getSocket=function(type){return this.socket},AgentLibrary.prototype.getLoginRequest=function(){return UIModel.getInstance().loginRequest},AgentLibrary.prototype.getConfigRequest=function(){return UIModel.getInstance().configRequest},AgentLibrary.prototype.getLogoutRequest=function(){return UIModel.getInstance().logoutRequest},AgentLibrary.prototype.getAgentDailyStats=function(){return UIModel.getInstance().agentDailyStats},AgentLibrary.prototype.getCallTokens=function(){return UIModel.getInstance().callTokens},AgentLibrary.prototype.getAgentStateRequest=function(){return UIModel.getInstance().agentStateRequest},AgentLibrary.prototype.getOffhookInitRequest=function(){return UIModel.getInstance().offhookInitRequest},AgentLibrary.prototype.getOffhookTermRequest=function(){return UIModel.getInstance().offhookTermRequest},AgentLibrary.prototype.getHangupRequest=function(){return UIModel.getInstance().hangupRequest},AgentLibrary.prototype.getPreviewDialRequest=function(){return UIModel.getInstance().previewDialRequest},AgentLibrary.prototype.getTcpaSafeRequest=function(){return UIModel.getInstance().tcpaSafeRequest},AgentLibrary.prototype.getManualOutdialRequest=function(){return UIModel.getInstance().oneToOneOutdialRequest},AgentLibrary.prototype.getManualOutdialCancelRequest=function(){return UIModel.getInstance().oneToOneOutdialCancelRequest},AgentLibrary.prototype.getCallNotesRequest=function(){return UIModel.getInstance().callNotesRequest},AgentLibrary.prototype.getCampaignDispositionsRequest=function(){return UIModel.getInstance().campaignDispositionsRequest},AgentLibrary.prototype.getDispositionRequest=function(){return UIModel.getInstance().dispositionRequest},AgentLibrary.prototype.getDispositionManualPassRequest=function(){return UIModel.getInstance().dispositionManualPassRequest},AgentLibrary.prototype.getWarmTransferRequest=function(){return UIModel.getInstance().warmXferRequest},AgentLibrary.prototype.getColdTransferRequest=function(){return UIModel.getInstance().coldXferRequest},AgentLibrary.prototype.getWarmTransferCancelRequest=function(){return UIModel.getInstance().warmXferCancelRequest},AgentLibrary.prototype.getRequeueRequest=function(){return UIModel.getInstance().requeueRequest},AgentLibrary.prototype.getBargeInRequest=function(){return UIModel.getInstance().bargeInRequest},AgentLibrary.prototype.getHoldRequest=function(){return UIModel.getInstance().holdRequest},AgentLibrary.prototype.getPauseRecordRequest=function(){return UIModel.getInstance().pauseRecordRequest},AgentLibrary.prototype.getRecordRequest=function(){return UIModel.getInstance().recordRequest},AgentLibrary.prototype.getChatPresentedRequest=function(){return UIModel.getInstance().chatPresentedRequest},AgentLibrary.prototype.getChatDispositionRequest=function(){return UIModel.getInstance().chatDispositionRequest},AgentLibrary.prototype.getChatMessageRequest=function(){return UIModel.getInstance().chatMessageRequest},AgentLibrary.prototype.getChatRequeueRequest=function(){return UIModel.getInstance().chatRequeueRequest},AgentLibrary.prototype.getChatTypingRequest=function(){return UIModel.getInstance().chatTypingRequest},AgentLibrary.prototype.getAgentStatsPacket=function(){return UIModel.getInstance().agentStatsPacket},AgentLibrary.prototype.getAgentDailyStatsPacket=function(){return UIModel.getInstance().agentDailyStatsPacket},AgentLibrary.prototype.getQueueStatsPacket=function(){return UIModel.getInstance().queueStatsPacket},AgentLibrary.prototype.getChatQueueStatsPacket=function(){return UIModel.getInstance().chatQueueStatsPacket},AgentLibrary.prototype.getCampaignStatsPacket=function(){return UIModel.getInstance().campaignStatsPacket},AgentLibrary.prototype.getLoginPacket=function(){return UIModel.getInstance().loginPacket},AgentLibrary.prototype.getConfigPacket=function(){return UIModel.getInstance().configPacket},AgentLibrary.prototype.getAgentStatePacket=function(){return UIModel.getInstance().agentStatePacket},AgentLibrary.prototype.getCurrentCallPacket=function(){return UIModel.getInstance().currentCallPacket},AgentLibrary.prototype.getOffhookInitPacket=function(){return UIModel.getInstance().offhookInitPacket},AgentLibrary.prototype.getOffhookTermPacket=function(){return UIModel.getInstance().offhookTermPacket},AgentLibrary.prototype.getChatAgentEnd=function(){return UIModel.getInstance().chatAgentEnd},AgentLibrary.prototype.getDialGroupChangeNotification=function(){return UIModel.getInstance().dialGroupChangeNotification},AgentLibrary.prototype.getDialGroupChangePendingNotification=function(){return UIModel.getInstance().dialGroupChangePendingNotification},AgentLibrary.prototype.getEndCallNotification=function(){return UIModel.getInstance().endCallNotification},AgentLibrary.prototype.getGatesChangeNotification=function(){return UIModel.getInstance().gatesChangeNotification},AgentLibrary.prototype.getGenericNotification=function(){return UIModel.getInstance().genericNotification},AgentLibrary.prototype.getNewCallNotification=function(){return UIModel.getInstance().newCallNotification},AgentLibrary.prototype.getCurrentCall=function(){return UIModel.getInstance().currentCall},AgentLibrary.prototype.getAddSessionNotification=function(){return UIModel.getInstance().addSessionNotification},AgentLibrary.prototype.getDropSessionNotification=function(){return UIModel.getInstance().dropSessionNotification},AgentLibrary.prototype.getEarlyUiiNotification=function(){return UIModel.getInstance().earlyUiiNotification},AgentLibrary.prototype.getChatActiveNotification=function(){return UIModel.getInstance().chatActiveNotification},AgentLibrary.prototype.getChatInactiveNotification=function(){return UIModel.getInstance().chatInactiveNotification},AgentLibrary.prototype.getChatPresentedNotification=function(){return UIModel.getInstance().chatPresentedNotification},AgentLibrary.prototype.getChatTypingNotification=function(){return UIModel.getInstance().chatTypingNotification},AgentLibrary.prototype.getNewChatNotification=function(){return UIModel.getInstance().newChatNotification},AgentLibrary.prototype.getApplicationSettings=function(){return UIModel.getInstance().applicationSettings},AgentLibrary.prototype.getChatSettings=function(){return UIModel.getInstance().chatSettings},AgentLibrary.prototype.getConnectionSettings=function(){return UIModel.getInstance().connectionSettings},AgentLibrary.prototype.getInboundSettings=function(){return UIModel.getInstance().inboundSettings},AgentLibrary.prototype.getOutboundSettings=function(){return UIModel.getInstance().outboundSettings},AgentLibrary.prototype.getAgentSettings=function(){return UIModel.getInstance().agentSettings},AgentLibrary.prototype.getTransferSessions=function(){return UIModel.getInstance().transferSessions},AgentLibrary.prototype.getAgentPermissions=function(){return UIModel.getInstance().agentPermissions},AgentLibrary.prototype.getAgentStats=function(){return UIModel.getInstance().agentStats},AgentLibrary.prototype.getAgentDailyStats=function(){return UIModel.getInstance().agentDailyStats},AgentLibrary.prototype.getQueueStats=function(){return UIModel.getInstance().queueStats},AgentLibrary.prototype.getChatQueueStats=function(){return UIModel.getInstance().chatQueueStats},AgentLibrary.prototype.getCampaignStats=function(){return UIModel.getInstance().campaignStats}}function initAgentLibrarySocket(context){"use strict";var AgentLibrary=context.AgentLibrary;AgentLibrary.prototype.openSocket=function(callback){var instance=this;if(utils.setCallback(instance,CALLBACK_TYPES.OPEN_SOCKET,callback),"WebSocket"in context){if(!instance.socket){var socketDest=UIModel.getInstance().applicationSettings.socketDest;utils.logMessage(LOG_LEVELS.DEBUG,"Attempting to open socket connection to "+socketDest,""),instance.socket=new WebSocket(socketDest),instance.socket.onopen=function(){UIModel.getInstance().applicationSettings.socketConnected=!0,utils.fireCallback(instance,CALLBACK_TYPES.OPEN_SOCKET,{reconnect:instance._isReconnect}),instance.socketOpened()},instance.socket.onmessage=function(evt){var data=JSON.parse(evt.data);data.ui_response?utils.processResponse(instance,data):data.ui_notification?utils.processNotification(instance,data):data.dialer_request?utils.processDialerResponse(instance,data):data.ui_stats?utils.processStats(instance,data):data.ui_request&&utils.processRequest(instance,data)},instance.socket.onclose=function(){utils.fireCallback(instance,CALLBACK_TYPES.CLOSE_SOCKET,""),UIModel.getInstance().applicationSettings.socketConnected=!1,instance.socket=null,clearInterval(UIModel.getInstance().agentDailyIntervalId),UIModel.getInstance().agentDailyIntervalId=null,clearInterval(UIModel.getInstance().statsIntervalId),UIModel.getInstance().statsIntervalId=null,UIModel.getInstance().agentSettings.isLoggedIn&&setTimeout(function(){instance.openSocket()},5e3)}}}else utils.logMessage(LOG_LEVELS.WARN,"WebSocket NOT supported by your Browser","")},AgentLibrary.prototype.closeSocket=function(){this.socket.close()},AgentLibrary.prototype.socketOpened=function(){var queuedMsg,instance=this,currDts=new Date,threeMins=18e4;if(instance._isReconnect){instance._isReconnect=!1;var configRequest=JSON.parse(UIModel.getInstance().configRequest.formatJSON()),hashCode=UIModel.getInstance().connectionSettings.hashCode;configRequest.ui_request.hash_code={"#text":hashCode},configRequest.ui_request.update_login={"#text":"FALSE"},configRequest.ui_request.reconnect={"#text":"TRUE"},instance._queuedMsgs.unshift({dts:new Date,msg:JSON.stringify(configRequest)});var loginRequest=JSON.parse(UIModel.getInstance().loginRequest.formatJSON()),agentId=UIModel.getInstance().agentSettings.agentId;loginRequest.ui_request.reconnect={"#text":"TRUE"},loginRequest.ui_request.agent_id={"#text":utils.toString(agentId)},instance._queuedMsgs.unshift({dts:new Date,msg:JSON.stringify(loginRequest)})}for(var idx=0;idx<instance._queuedMsgs.length;idx++)queuedMsg=instance._queuedMsgs[idx],currDts.getTime()-queuedMsg.dts.getTime()<threeMins?(utils.logMessage(LOG_LEVELS.DEBUG,"Sending queued message to IntelliSocket.",queuedMsg.msg),utils.sendMessage(instance,queuedMsg.msg)):utils.logMessage(LOG_LEVELS.DEBUG,"Queued message expired, discarding.",queuedMsg.msg);instance._queuedMsgs=[]}}function initAgentLibraryAgent(context){"use strict";var AgentLibrary=context.AgentLibrary;AgentLibrary.prototype.loginAgent=function(username,password,callback){UIModel.getInstance().loginRequest=new LoginRequest(username,password);var msg=UIModel.getInstance().loginRequest.formatJSON();utils.setCallback(this,CALLBACK_TYPES.LOGIN,callback),utils.sendMessage(this,msg)},AgentLibrary.prototype.loginAgentCaseSensitive=function(username,password,callback){UIModel.getInstance().loginRequest=new LoginRequest(username,password,!0);var msg=UIModel.getInstance().loginRequest.formatJSON();utils.setCallback(this,CALLBACK_TYPES.LOGIN,callback),utils.sendMessage(this,msg)},AgentLibrary.prototype.configureAgent=function(dialDest,queueIds,chatIds,skillProfileId,dialGroupId,updateFromAdminUI,callback){UIModel.getInstance().configRequest=new ConfigRequest(dialDest,queueIds,chatIds,skillProfileId,dialGroupId,updateFromAdminUI);var msg=UIModel.getInstance().configRequest.formatJSON();utils.setCallback(this,CALLBACK_TYPES.CONFIG,callback),utils.sendMessage(this,msg)},AgentLibrary.prototype.logoutAgent=function(agentId,callback){UIModel.getInstance().logoutRequest=new LogoutRequest(agentId),utils.setCallback(this,CALLBACK_TYPES.LOGOUT,callback),UIModel.getInstance().agentSettings.isLoggedIn=!1,utils.fireCallback(this,CALLBACK_TYPES.LOGOUT,""),this.closeSocket()},AgentLibrary.prototype.requestLogoutAgent=function(agentToLogout,requestMessage,callback){var isSupervisor="SUPERVISOR"===UIModel.getInstance().agentSettings.agentType;if(UIModel.getInstance().logoutRequest=new LogoutRequest(agentToLogout,requestMessage,isSupervisor),utils.setCallback(this,CALLBACK_TYPES.LOGOUT,callback),UIModel.getInstance().logoutRequest.isSupervisor){var msg=UIModel.getInstance().logoutRequest.formatJSON();utils.sendMessage(this,msg)}},AgentLibrary.prototype.setAgentState=function(agentState,agentAuxState,callback){UIModel.getInstance().agentStateRequest=new AgentStateRequest(agentState,agentAuxState);var msg=UIModel.getInstance().agentStateRequest.formatJSON();utils.setCallback(this,CALLBACK_TYPES.AGENT_STATE,callback),utils.sendMessage(this,msg)},AgentLibrary.prototype.offhookInit=function(callback){UIModel.getInstance().offhookInitRequest=new OffhookInitRequest;var msg=UIModel.getInstance().offhookInitRequest.formatJSON();utils.setCallback(this,CALLBACK_TYPES.OFFHOOK_INIT,callback),utils.sendMessage(this,msg)},AgentLibrary.prototype.offhookTerm=function(callback){UIModel.getInstance().offhookTermRequest=new OffhookTermRequest;var msg=UIModel.getInstance().offhookTermRequest.formatJSON();utils.setCallback(this,CALLBACK_TYPES.OFFHOOK_TERM,callback),utils.sendMessage(this,msg)},AgentLibrary.prototype.getPendingCallbacks=function(agentId,callback){UIModel.getInstance().callbacksPendingRequest=new CallbacksPendingRequest(agentId);var msg=UIModel.getInstance().callbacksPendingRequest.formatJSON();utils.setCallback(this,CALLBACK_TYPES.CALLBACK_PENDING,callback),utils.sendMessage(this,msg)},AgentLibrary.prototype.cancelCallback=function(leadId,agentId,callback){UIModel.getInstance().callbackCancelRequest=new CallbackCancelRequest(leadId,agentId);var msg=UIModel.getInstance().callbackCancelRequest.formatJSON();utils.setCallback(this,CALLBACK_TYPES.CALLBACK_CANCEL,callback),utils.sendMessage(this,msg)},AgentLibrary.prototype.requestStats=function(){UIModel.getInstance().statsIntervalId=setInterval(utils.sendStatsRequestMessage,5e3)}}function initAgentLibraryCall(context){"use strict";var AgentLibrary=context.AgentLibrary;AgentLibrary.prototype.bargeIn=function(agentId,uii,monitorAgentId,callback){UIModel.getInstance().bargeInRequest=new BargeInRequest("FULL",agentId,uii,monitorAgentId);var msg=UIModel.getInstance().bargeInRequest.formatJSON();utils.setCallback(this,CALLBACK_TYPES.BARGE_IN,callback),utils.sendMessage(this,msg)},AgentLibrary.prototype.coach=function(agentId,uii,monitorAgentId,callback){UIModel.getInstance().bargeInRequest=new BargeInRequest("COACHING",agentId,uii,monitorAgentId);var msg=UIModel.getInstance().bargeInRequest.formatJSON();utils.setCallback(this,CALLBACK_TYPES.COACH_CALL,callback),utils.sendMessage(this,msg)},AgentLibrary.prototype.coldXfer=function(dialDest,callerId,sipHeaders,callback){UIModel.getInstance().coldXferRequest=new XferColdRequest(dialDest,callerId,sipHeaders);var msg=UIModel.getInstance().coldXferRequest.formatJSON();utils.setCallback(this,CALLBACK_TYPES.XFER_COLD,callback),utils.sendMessage(this,msg)},AgentLibrary.prototype.dispositionCall=function(uii,dispId,notes,callback,callbackDTS,contactForwardNumber,survey,externId,leadId){UIModel.getInstance().dispositionRequest=new DispositionRequest(uii,dispId,notes,callback,callbackDTS,contactForwardNumber,survey,externId,leadId);var msg=UIModel.getInstance().dispositionRequest.formatJSON();utils.sendMessage(this,msg),clearInterval(UIModel.getInstance().pingIntervalId),UIModel.getInstance().pingIntervalId=null},AgentLibrary.prototype.dispositionManualPass=function(dispId,notes,callback,callbackDTS,leadId,requestId,externId){UIModel.getInstance().dispositionManualPassRequest=new DispositionManualPassRequest(dispId,notes,callback,callbackDTS,leadId,requestId,externId);var msg=UIModel.getInstance().dispositionManualPassRequest.formatJSON();utils.sendMessage(this,msg)},AgentLibrary.prototype.getCampaignDispositions=function(campaignId,callback){UIModel.getInstance().campaignDispositionsRequest=new CampaignDispositionsRequest(campaignId);var msg=UIModel.getInstance().campaignDispositionsRequest.formatJSON();utils.setCallback(this,CALLBACK_TYPES.CAMPAIGN_DISPOSITIONS,callback),utils.sendMessage(this,msg)},AgentLibrary.prototype.hangup=function(sessionId){UIModel.getInstance().hangupRequest=new HangupRequest(sessionId);var msg=UIModel.getInstance().hangupRequest.formatJSON();utils.sendMessage(this,msg)},AgentLibrary.prototype.hold=function(holdState,callback){UIModel.getInstance().holdRequest=new HoldRequest(holdState);var msg=UIModel.getInstance().holdRequest.formatJSON();utils.setCallback(this,CALLBACK_TYPES.HOLD,callback),utils.sendMessage(this,msg)},AgentLibrary.prototype.manualOutdial=function(destination,callerId,ringTime,countryId,queueId){UIModel.getInstance().oneToOneOutdialRequest=new OneToOneOutdialRequest(destination,callerId,ringTime,countryId,queueId);var msg=UIModel.getInstance().oneToOneOutdialRequest.formatJSON();utils.sendMessage(this,msg)},AgentLibrary.prototype.manualOutdialCancel=function(uii){UIModel.getInstance().oneToOneOutdialCancelRequest=new OneToOneOutdialCancelRequest(uii);var msg=UIModel.getInstance().oneToOneOutdialCancelRequest.formatJSON();utils.sendMessage(this,msg)},AgentLibrary.prototype.pauseRecord=function(record,callback){UIModel.getInstance().pauseRecordRequest=new PauseRecordRequest(record);var msg=UIModel.getInstance().pauseRecordRequest.formatJSON();utils.setCallback(this,CALLBACK_TYPES.PAUSE_RECORD,callback),utils.sendMessage(this,msg)},AgentLibrary.prototype.previewDial=function(requestId){UIModel.getInstance().previewDialRequest=new PreviewDialRequest("",[],requestId);var msg=UIModel.getInstance().previewDialRequest.formatJSON();utils.sendMessage(this,msg)},AgentLibrary.prototype.previewFetch=function(searchFields,callback){UIModel.getInstance().previewDialRequest=new PreviewDialRequest("",searchFields,"");var msg=UIModel.getInstance().previewDialRequest.formatJSON();utils.setCallback(this,CALLBACK_TYPES.PREVIEW_FETCH,callback),utils.sendMessage(this,msg)},AgentLibrary.prototype.searchLeads=function(searchFields,callback){UIModel.getInstance().previewDialRequest=new PreviewDialRequest("search",searchFields,"");var msg=UIModel.getInstance().previewDialRequest.formatJSON();utils.setCallback(this,CALLBACK_TYPES.LEAD_SEARCH,callback),utils.sendMessage(this,msg)},AgentLibrary.prototype.setCallNotes=function(notes,callback){UIModel.getInstance().callNotesRequest=new CallNotesRequest(notes);var msg=UIModel.getInstance().callNotesRequest.formatJSON();utils.setCallback(this,CALLBACK_TYPES.CALL_NOTES,callback),utils.sendMessage(this,msg)},AgentLibrary.prototype.monitor=function(agentId,uii,monitorAgentId,callback){UIModel.getInstance().bargeInRequest=new BargeInRequest("MUTE",agentId,uii,monitorAgentId);var msg=UIModel.getInstance().bargeInRequest.formatJSON();utils.setCallback(this,CALLBACK_TYPES.SILENT_MONITOR,callback),utils.sendMessage(this,msg)},AgentLibrary.prototype.record=function(record,callback){UIModel.getInstance().recordRequest=new RecordRequest(record);var msg=UIModel.getInstance().recordRequest.formatJSON();utils.setCallback(this,CALLBACK_TYPES.RECORD,callback),utils.sendMessage(this,msg)},AgentLibrary.prototype.requeueCall=function(queueId,skillId,maintain,callback){UIModel.getInstance().requeueRequest=new RequeueRequest(queueId,skillId,maintain);var msg=UIModel.getInstance().requeueRequest.formatJSON();utils.setCallback(this,CALLBACK_TYPES.REQUEUE,callback),utils.sendMessage(this,msg)},AgentLibrary.prototype.safeModeCall=function(requestId){UIModel.getInstance().tcpaSafeRequest=new TcpaSafeRequest("",[],requestId);var msg=UIModel.getInstance().tcpaSafeRequest.formatJSON();utils.sendMessage(this,msg)},AgentLibrary.prototype.safeModeFetch=function(searchFields,callback){UIModel.getInstance().tcpaSafeRequest=new TcpaSafeRequest("",searchFields,"");var msg=UIModel.getInstance().tcpaSafeRequest.formatJSON();utils.setCallback(this,CALLBACK_TYPES.SAFE_MODE_FETCH,callback),utils.sendMessage(this,msg)},AgentLibrary.prototype.safeSearchLeads=function(searchFields,callback){UIModel.getInstance().tcpaSafeRequest=new TcpaSafeRequest("search",searchFields,"");var msg=UIModel.getInstance().tcpaSafeRequest.formatJSON();utils.setCallback(this,CALLBACK_TYPES.SAFE_MODE_SEARCH,callback),utils.sendMessage(this,msg)},AgentLibrary.prototype.warmXfer=function(dialDest,callerId,sipHeaders,callback){UIModel.getInstance().warmXferRequest=new XferWarmRequest(dialDest,callerId,sipHeaders);var msg=UIModel.getInstance().warmXferRequest.formatJSON();utils.setCallback(this,CALLBACK_TYPES.XFER_WARM,callback),utils.sendMessage(this,msg)},AgentLibrary.prototype.warmXferCancel=function(dialDest){UIModel.getInstance().warmXferCancelRequest=new XferWarmCancelRequest(dialDest);var msg=UIModel.getInstance().warmXferCancelRequest.formatJSON();utils.sendMessage(this,msg)},AgentLibrary.prototype.getScript=function(scriptId,version,callback){var model=UIModel.getInstance(),script=model.scriptSettings.loadedScripts[scriptId];if(utils.setCallback(this,CALLBACK_TYPES.SCRIPT_CONFIG,callback),script&&script.version===version){var savedScript=UIModel.getInstance().scriptSettings.loadedScripts[scriptId];callback(savedScript)}else{model.scriptConfigRequest=new ScriptConfigRequest(scriptId);var msg=UIModel.getInstance().scriptConfigRequest.formatJSON();utils.sendMessage(this,msg)}},AgentLibrary.prototype.saveScriptResult=function(uii,scriptId,jsonResult){UIModel.getInstance().scriptResultRequest=new ScriptResultRequest(uii,scriptId,jsonResult);var msg=UIModel.getInstance().scriptResultRequest.formatJSON();utils.sendMessage(this,msg)}}function initAgentLibraryLead(context){"use strict";var AgentLibrary=context.AgentLibrary;AgentLibrary.prototype.leadHistory=function(leadId,callback){UIModel.getInstance().leadHistoryRequest=new LeadHistoryRequest(leadId);var msg=UIModel.getInstance().leadHistoryRequest.formatJSON();utils.setCallback(this,CALLBACK_TYPES.LEAD_HISTORY,callback),utils.sendMessage(this,msg)},AgentLibrary.prototype.leadInsert=function(dataObj,callback){UIModel.getInstance().leadInsertRequest=new LeadInsertRequest(dataObj);var msg=UIModel.getInstance().leadInsertRequest.formatJSON();utils.setCallback(this,CALLBACK_TYPES.LEAD_INSERT,callback),utils.sendMessage(this,msg)},AgentLibrary.prototype.leadUpdate=function(leadId,leadPhone,baggage,callback){UIModel.getInstance().leadUpdateRequest=new LeadUpdateRequest(leadId,leadPhone,baggage);var msg=UIModel.getInstance().leadUpdateRequest.formatJSON();utils.setCallback(this,CALLBACK_TYPES.LEAD_UPDATE,callback),utils.sendMessage(this,msg)}}function initAgentLibraryChat(context){"use strict";var AgentLibrary=context.AgentLibrary;AgentLibrary.prototype.setChatAlias=function(alias){UIModel.getInstance().chatAliasRequest=new ChatAliasRequest(alias);var msg=UIModel.getInstance().chatAliasRequest.formatJSON();utils.sendMessage(this,msg)},AgentLibrary.prototype.publicChatRoom=function(action,roomId){UIModel.getInstance().chatRoomRequest=new ChatRoomRequest(action,"PUBLIC",roomId);var msg=UIModel.getInstance().chatRoomRequest.formatJSON();utils.sendMessage(this,msg)},AgentLibrary.prototype.privateChatRoom=function(action,roomId,agentOne,agentTwo){UIModel.getInstance().chatRoomRequest=new ChatRoomRequest(action,"PRIVATE",roomId,agentOne,agentTwo);var msg=UIModel.getInstance().chatRoomRequest.formatJSON();utils.sendMessage(this,msg)},AgentLibrary.prototype.sendChat=function(roomId,message,callback){UIModel.getInstance().chatSendRequest=new ChatSendRequest(roomId,message);var msg=UIModel.getInstance().chatSendRequest.formatJSON();utils.setCallback(this,CALLBACK_TYPES.CHAT,callback),utils.sendMessage(this,msg)},AgentLibrary.prototype.getSupervisors=function(callback){UIModel.getInstance().supervisorListRequest=new SupervisorListRequest;var msg=UIModel.getInstance().supervisorListRequest.formatJSON();utils.setCallback(this,CALLBACK_TYPES.SUPERVISOR_LIST,callback),utils.sendMessage(this,msg)},AgentLibrary.prototype.chatPresentedResponse=function(uii,messageId,response,responseReason){UIModel.getInstance().chatPresentedRequest=new ChatPresentedResponseRequest(uii,messageId,response,responseReason);var msg=UIModel.getInstance().chatPresentedRequest.formatJSON();utils.sendMessage(this,msg)},AgentLibrary.prototype.chatMessage=function(uii,agentId,message){UIModel.getInstance().chatMessageRequest=new ChatMessageRequest(uii,agentId,message,!1);var msg=UIModel.getInstance().chatMessageRequest.formatJSON();utils.sendMessage(this,msg)},AgentLibrary.prototype.chatWhisper=function(uii,agentId,message){UIModel.getInstance().chatMessageRequest=new ChatMessageRequest(uii,agentId,message,!0);var msg=UIModel.getInstance().chatMessageRequest.formatJSON();utils.sendMessage(this,msg)},AgentLibrary.prototype.chatDisposition=function(uii,agentId,dispositionId,notes,sendAcknowlegement,script,sessionId){UIModel.getInstance().chatDispositionRequest=new ChatDispositionRequest(uii,agentId,dispositionId,notes,sendAcknowlegement,script,sessionId);var msg=UIModel.getInstance().chatDispositionRequest.formatJSON();utils.sendMessage(this,msg)},AgentLibrary.prototype.chatRequeue=function(uii,agentId,chatQueueId,skillId,maintainAgent){UIModel.getInstance().chatRequeueRequest=new ChatRequeueRequest(uii,agentId,chatQueueId,skillId,maintainAgent);var msg=UIModel.getInstance().chatRequeueRequest.formatJSON();utils.sendMessage(this,msg)},AgentLibrary.prototype.chatTyping=function(uii){UIModel.getInstance().chatTypingRequest=new ChatTypingRequest(uii);var msg=UIModel.getInstance().chatTypingRequest.formatJSON();utils.sendMessage(this,msg)},AgentLibrary.prototype.monitorChat=function(uii,agentId,monitorAgentId){UIModel.getInstance().monitorChatRequest=new MonitorChatRequest(uii,agentId,monitorAgentId);var msg=UIModel.getInstance().monitorChatRequest.formatJSON();utils.sendMessage(this,msg)},AgentLibrary.prototype.leaveChat=function(uii,agentId,sessionId){UIModel.getInstance().leaveChatRequest=new LeaveChatRequest(uii,agentId,sessionId);
var msg=UIModel.getInstance().leaveChatRequest.formatJSON();utils.sendMessage(this,msg)},AgentLibrary.prototype.chatList=function(agentId,monitorAgentId){UIModel.getInstance().chatList=new ChatListRequest(agentId,monitorAgentId);var msg=UIModel.getInstance().chatList.formatJSON();utils.sendMessage(this,msg)},AgentLibrary.prototype.chatAgentEnd=function(agentId,uii){UIModel.getInstance().chatAgentEnd=new ChatAgentEndRequest(agentId,uii);var msg=UIModel.getInstance().chatAgentEnd.formatJSON();utils.sendMessage(this,msg)}}function initAgentLibraryLogger(context){"use strict";var AgentLibrary=context.AgentLibrary;AgentLibrary.prototype.openLogger=function(){var instance=this;if("indexedDB"in context){var dbRequest=indexedDB.open("AgentLibraryLogging",5);dbRequest.onerror=function(event){console.error("Error requesting DB access")},dbRequest.onsuccess=function(event){instance._db=event.target.result,instance.purgeLog(),instance._db.onerror=function(event){console.error("AgentLibrary: Database error - "+event.target.errorCode)},instance._db.onsuccess=function(event){console.log("AgentLibrary: Successful logging of record")}},dbRequest.onupgradeneeded=function(event){if(instance._db=event.target.result,!instance._db.objectStoreNames.contains("logger")){var objectStore=instance._db.createObjectStore("logger",{autoIncrement:!0});objectStore.createIndex("logLevel","logLevel",{unique:!1}),objectStore.createIndex("dts","dts",{unique:!1});var name="levelAndDate",keyPath=["logLevel","dts"];objectStore.createIndex(name,keyPath,{unique:!1})}}}else console.warn("AgentLibrary: indexedDB NOT supported by your Browser.")},AgentLibrary.prototype.purgeLog=function(){var instance=this;if(instance._db){var transaction=instance._db.transaction(["logger"],"readwrite"),objectStore=transaction.objectStore("logger"),dateIndex=objectStore.index("dts"),endDate=new Date;endDate.setDate(endDate.getDate()-2);var range=IDBKeyRange.upperBound(endDate);dateIndex.openCursor(range).onsuccess=function(event){var cursor=event.target.result;cursor&&(objectStore["delete"](cursor.primaryKey),cursor["continue"]())}}},AgentLibrary.prototype.clearLog=function(){var instance=this,transaction=instance._db.transaction(["logger"],"readwrite"),objectStore=transaction.objectStore("logger"),objectStoreRequest=objectStore.clear();objectStoreRequest.onsuccess=function(event){console.log("AgentLibrary: logger database cleared")}},AgentLibrary.prototype.deleteDB=function(){var DBDeleteRequest=indexedDB.deleteDatabase("AgentLibraryLogging");DBDeleteRequest.onerror=function(event){console.log("Error deleting database.")},DBDeleteRequest.onsuccess=function(event){console.log("Database deleted successfully")}},AgentLibrary.prototype.getLogRecords=function(logLevel,startDate,endDate,maxRows,callback){logLevel=logLevel||"";var instance=this,transaction=instance._db.transaction(["logger"],"readonly"),objStore=transaction.objectStore("logger"),index=null,cursor=null,range=null,limit=maxRows||100;if(utils.setCallback(instance,CALLBACK_TYPES.LOG_RESULTS,callback),""!==logLevel&&"ALL"!==logLevel.toUpperCase()&&"NO-STATS"!==logLevel.toUpperCase()){if(startDate&&endDate){var lowerBound=[logLevel.toLowerCase(),startDate],upperBound=[logLevel.toLowerCase(),endDate];range=IDBKeyRange.bound(lowerBound,upperBound)}else startDate?range=IDBKeyRange.lowerBound([logLevel.toLowerCase(),startDate]):endDate&&(range=IDBKeyRange.upperBound([logLevel.toLowerCase(),endDate]));if(null!==range){var levelAndDateReturn=[],idxLevelAndDate=0;index=objStore.index("levelAndDate"),index.openCursor(range,"prev").onsuccess=function(event){cursor=event.target.result,cursor&&limit>idxLevelAndDate?(levelAndDateReturn.push(cursor.value),idxLevelAndDate+=1,cursor["continue"]()):utils.fireCallback(instance,CALLBACK_TYPES.LOG_RESULTS,levelAndDateReturn)}}else{var logLevelReturn=[],idxLogLevel=0;index=objStore.index("logLevel"),index.openCursor(logLevel,"prev").onsuccess=function(event){cursor=event.target.result,cursor&&limit>idxLogLevel?(logLevelReturn.push(cursor.value),idxLogLevel+=1,cursor["continue"]()):utils.fireCallback(instance,CALLBACK_TYPES.LOG_RESULTS,logLevelReturn)}}}else if("NO-STATS"===logLevel.toUpperCase())if(startDate&&endDate?range=IDBKeyRange.bound(startDate,endDate):startDate?range=IDBKeyRange.lowerBound(startDate):endDate&&(range=IDBKeyRange.upperBound(endDate)),null!==range){var dtsNoStatsReturn=[],idxDTSNoStats=0;index=objStore.index("dts"),index.openCursor(range,"prev").onsuccess=function(event){cursor=event.target.result,cursor&&limit>idxDTSNoStats?("stats"!==cursor.value.logLevel&&(dtsNoStatsReturn.push(cursor.value),idxDTSNoStats+=1),cursor["continue"]()):utils.fireCallback(instance,CALLBACK_TYPES.LOG_RESULTS,dtsNoStatsReturn)}}else{var noStatsReturn=[],idxNoStats=0;objStore.openCursor().onsuccess=function(event){cursor=event.target.result,cursor&&limit>idxNoStats?("stats"!==cursor.value.logLevel&&(noStatsReturn.push(cursor.value),idxNoStats+=1),cursor["continue"]()):utils.fireCallback(instance,CALLBACK_TYPES.LOG_RESULTS,noStatsReturn)}}else if(startDate&&endDate?range=IDBKeyRange.bound(startDate,endDate):startDate?range=IDBKeyRange.lowerBound(startDate):endDate&&(range=IDBKeyRange.upperBound(endDate)),null!==range){var dtsReturn=[],idxDTS=0;index=objStore.index("dts"),index.openCursor(range,"prev").onsuccess=function(event){cursor=event.target.result,cursor&&limit>idxDTS?(dtsReturn.push(cursor.value),idxDTS+=1,cursor["continue"]()):utils.fireCallback(instance,CALLBACK_TYPES.LOG_RESULTS,dtsReturn)}}else{var allValsReturn=[],idxAll=0;objStore.openCursor().onsuccess=function(event){cursor=event.target.result,cursor&&limit>idxAll?(allValsReturn.push(cursor.value),idxAll+=1,cursor["continue"]()):utils.fireCallback(instance,CALLBACK_TYPES.LOG_RESULTS,allValsReturn)}}return null}}var AddSessionNotification=function(){};AddSessionNotification.prototype.processResponse=function(notification){var formattedResponse=utils.buildDefaultResponse(notification),model=UIModel.getInstance(),notif=notification.ui_notification,sessionAgentId=utils.getText(notif,"agent_id");return"AGENT"===utils.getText(notif,"session_type")&&model.incrementTotalCalls(),sessionAgentId===model.agentSettings.agentId?model.currentCall.sessionId=utils.getText(notif,"session_id"):""!=sessionAgentId&&(model.currentCall.monitorAgentId=sessionAgentId),"OUTBOUND"===utils.getText(notif,"session_type")&&""===sessionAgentId&&utils.getText(notif,"allow_control")===!0&&(model.transferSessions[utils.getText(notif,"session_id")]={sessionId:utils.getText(notif,"session_id"),destination:utils.getText(notif,"phone"),uii:utils.getText(notif,"uii")}),"2"===notif.session_id&&(model.agentSettings.onCall=!0),formattedResponse.status="OK",formattedResponse.message="Received ADD-SESSION notification",formattedResponse.sessionId=utils.getText(notif,"session_id"),formattedResponse.uii=utils.getText(notif,"uii"),formattedResponse.phone=utils.getText(notif,"phone"),formattedResponse.sessionType=utils.getText(notif,"session_type"),formattedResponse.sessionLabel=utils.getText(notif,"session_label"),formattedResponse.allowControl=utils.getText(notif,"allow_control"),formattedResponse.monitoring=utils.getText(notif,"monitoring"),formattedResponse.agentId=utils.getText(notif,"agent_id"),formattedResponse.transferSessions=model.transferSessions,formattedResponse};var DialGroupChangeNotification=function(){};DialGroupChangeNotification.prototype.processResponse=function(notification){var model=UIModel.getInstance(),notif=notification.ui_notification,origLoginType=model.configRequest.loginType,newDgId=utils.getText(notif,"dial_group_id");model.dialGroupChangeNotification=notification,!newDgId||""===newDgId||"INBOUND"!==origLoginType&&"BLENDED"!==origLoginType?newDgId&&""!==newDgId?model.configRequest.loginType="OUTBOUND":"INBOUND"===origLoginType?model.configRequest.loginType="INBOUND":model.configRequest.loginType="NO-SELECTION":model.configRequest.loginType="BLENDED",UIModel.getInstance().configRequest.dialGroupId=newDgId;var formattedResponse={message:"Dial Group Updated Successfully.",detail:"Dial Group changed to ["+newDgId+"].",dialGroupId:utils.getText(notif,"dial_group_id"),dialGroupName:utils.getText(notif,"dialGroupName"),dialGroupDesc:utils.getText(notif,"dial_group_desc"),agentId:utils.getText(notif,"agent_id")};return formattedResponse};var DialGroupChangePendingNotification=function(){};DialGroupChangePendingNotification.prototype.processResponse=function(notification){var model=UIModel.getInstance(),notif=notification.ui_notification;model.agentSettings.pendingDialGroupChange=parseInt(utils.getText(notif,"dial_group_id"),10),notif.update_from_adminui?model.agentSettings.updateDGFromAdminUI=utils.getText(notif,"update_from_adminui")===!0:model.agentSettings.updateDGFromAdminUI=!1;var formattedResponse={message:"Dial Group Change Pending notification received.",detail:"DialGroup switch for existing session pending until active call ends.",agentId:utils.getText(notif,"agent_id"),dialGroupId:utils.getText(notif,"dial_group_id"),updateFromAdminUI:utils.getText(notif,"update_from_adminui")};return formattedResponse};var DropSessionNotification=function(){};DropSessionNotification.prototype.processResponse=function(notification){var formattedResponse=utils.buildDefaultResponse(notification),notif=notification.ui_notification,sessionId=utils.getText(notif,"session_id"),transfer=UIModel.getInstance().transferSessions[sessionId];return transfer&&(utils.logMessage(LOG_LEVELS.DEBUG,"Transfer to "+transfer.destination+" has terminated",""),delete UIModel.getInstance().transferSessions[sessionId],formattedResponse.transferEnd=transfer),formattedResponse.message="Received DROP-SESSION Notification",formattedResponse.status="OK",formattedResponse.sessionId=utils.getText(notif,"session_id"),formattedResponse.uii=utils.getText(notif,"uii"),formattedResponse};var EarlyUiiNotification=function(){};EarlyUiiNotification.prototype.processResponse=function(notification){var formattedResponse=utils.buildDefaultResponse(notification),notif=notification.ui_notification;return formattedResponse.message="Received EARLY_UII notification",formattedResponse.status="OK",formattedResponse.agentId=utils.getText(notif,"agent_id"),formattedResponse.uii=utils.getText(notif,"uii"),formattedResponse};var EndCallNotification=function(libInstance){this.libInstance=libInstance};EndCallNotification.prototype.processResponse=function(notification){var model=UIModel.getInstance(),notif=notification.ui_notification;model.endCallNotification=notification,model.currentCall.duration=utils.getText(notif,"call_duration"),model.currentCall.termParty=utils.getText(notif,"term_party"),model.currentCall.termReason=utils.getText(notif,"term_reason"),model.agentSettings.callState="CALL-ENDED",model.agentSettings.onCall=!1,model.agentSettings.onManualOutdial=!1,model.transferSessions={},(model.agentSettings.pendingDialGroupChange>0||-1==model.agentSettings.pendingDialGroupChange)&&(model.configRequest.dialGroupId=model.agentSettings.pendingDialGroupChange,this.libInstance.configureAgent(model.configRequest.queueIds,model.configRequest.chatIds,model.configRequest.skillProfileId,model.configRequest.dialGroupId,model.configRequest.dialDest,model.agentSettings.updateDGFromAdminUI),model.agentSettings.pendingDialGroupChange=0,model.agentSettings.updateDGFromAdminUI=!1);var formattedResponse={message:"End Call Notification Received.",detail:"",uii:utils.getText(notif,"uii"),sessionId:utils.getText(notif,"session_id"),agentId:utils.getText(notif,"agent_id"),callDts:utils.getText(notif,"call_dts"),duration:model.currentCall.duration,termParty:model.currentCall.termParty,termReason:model.currentCall.termReason,recordingUrl:utils.getText(notif,"recording_url"),dispositionTimeout:utils.getText(notif,"disposition_timeout")};return formattedResponse};var GatesChangeNotification=function(){};GatesChangeNotification.prototype.processResponse=function(notification){var model=UIModel.getInstance(),notif=notification.ui_notification,newAssignedGates=[],availableQueues=model.inboundSettings.availableQueues,assignedGateIds=utils.getText(notif,"gate_ids");""!==assignedGateIds&&(assignedGateIds=assignedGateIds.split(","));for(var a=0;a<assignedGateIds.length;a++){var id=assignedGateIds[a],foundGate=utils.findObjById(availableQueues,id,"gateId");if(foundGate)newAssignedGates.push(foundGate);else{var gate={gateId:id,gateName:"",gateDesc:"",defaultDestOverride:"",isAgentSelectable:!1};newAssignedGates.push(gate)}}model.inboundSettings.queues=JSON.parse(JSON.stringify(newAssignedGates));var formattedResponse={agentId:utils.getText(notif,"agent_id"),message:"Gates Change notification received.",queues:newAssignedGates};return formattedResponse};var GenericNotification=function(){};GenericNotification.prototype.processResponse=function(notification){var formattedResponse=utils.buildDefaultResponse(notification);return formattedResponse.messageCode=utils.getText(notification.ui_notification,"message_code"),formattedResponse};var NewCallNotification=function(){};NewCallNotification.prototype.processResponse=function(notification){var model=UIModel.getInstance(),notif=notification.ui_notification,newCall={uii:utils.getText(notif,"uii"),agentId:utils.getText(notif,"agent_id"),dialDest:utils.getText(notif,"dial_dest"),queueDts:utils.getText(notif,"queue_dts"),queueTime:utils.getText(notif,"queue_time"),ani:utils.getText(notif,"ani"),dnis:utils.getText(notif,"dnis"),callType:utils.getText(notif,"call_type"),appUrl:utils.getText(notif,"app_url"),isMonitoring:utils.getText(notif,"is_monitoring"),allowHold:utils.getText(notif,"allow_hold"),allowTransfer:utils.getText(notif,"allow_transfer"),allowHangup:utils.getText(notif,"allow_hangup"),allowRequeue:utils.getText(notif,"allow_requeue"),allowEndCallForEveryone:utils.getText(notif,"allow_endcallforeveryone"),scriptId:utils.getText(notif,"script_id"),scriptVersion:utils.getText(notif,"script_version"),surveyId:utils.getText(notif,"survey_id"),surveyPopType:utils.getText(notif,"survey_pop_type"),requeueType:utils.getText(notif,"requeue_type")};newCall.queue=utils.processResponseCollection(notification,"ui_notification","gate")[0],newCall.agentRecording=utils.processResponseCollection(notification,"ui_notification","agent_recording","agentRecording")[0],newCall.outdialDispositions=utils.processResponseCollection(notification,"ui_notification","outdial_dispositions","disposition")[0],newCall.requeueShortcuts=utils.processResponseCollection(notification,"ui_notification","requeue_shortcuts","requeueShortcut")[0],newCall.baggage=utils.processResponseCollection(notification,"ui_notification","baggage")[0],newCall.surveyResponse=utils.processResponseCollection(notification,"ui_notification","survey_response","detail")[0],newCall.scriptResponse={},newCall.transferPhoneBook=utils.processResponseCollection(notification,"ui_notification","transfer_phone_book")[0];try{for(var savedModel=JSON.parse(notif.script_result["#text"]).model,results={},keys=Object.keys(savedModel),idx=0;idx<keys.length;idx++){var key=keys[idx],value=savedModel[key].value;results[key]=value}newCall.scriptResponse=results}catch(err){}if(newCall.transferPhoneBook&&newCall.transferPhoneBook.entrys&&(newCall.transferPhoneBook=newCall.transferPhoneBook.entrys),newCall.requeueShortcuts&&newCall.requeueShortcuts.requeueShortcuts&&(newCall.requeueShortcuts=newCall.requeueShortcuts.requeueShortcuts),newCall.outdialDispositions&&newCall.outdialDispositions.disposition&&(newCall.outdialDispositions.dispositions=[newCall.outdialDispositions]),newCall.queue.isCampaign="1"===newCall.queue.isCampaign,newCall.outdialDispositions&&newCall.outdialDispositions.dispositions)for(var d=0;d<newCall.outdialDispositions.dispositions.length;d++){var disp=newCall.outdialDispositions.dispositions[d];disp.isComplete="1"===disp.isComplete,disp.requireNote="1"===disp.requireNote,disp.saveSurvey="1"===disp.saveSurvey,disp.xfer="1"===disp.xfer}return model.callTokens=buildCallTokenMap(notif,newCall),newCall.baggage=model.callTokens,newCall.isMonitoring?model.agentSettings.callState="ACTIVE-MONITORING":(model.agentSettings.callState="ACTIVE",newCall.baggage&&""!=newCall.baggage.auxPhone&&(model.transferNumber=newCall.baggage.auxPhone)),model.agentDailyStats.currCallTime=0,model.currentCall=newCall,newCall.outdialDispositions&&newCall.outdialDispositions.dispositions&&newCall.outdialDispositions.dispositions.length>0&&"SUPPRESS"!==newCall.surveyPopType&&(UIModel.getInstance().pingIntervalId=setInterval(utils.sendPingCallMessage,3e4)),newCall};var PendingDispNotification=function(){};PendingDispNotification.prototype.processResponse=function(notification){var formattedResponse={};return formattedResponse.agentId=utils.getText(notification.ui_notification,"agent_id"),formattedResponse.status=utils.getText(notification.ui_notification,"status"),formattedResponse};var PreviewLeadStateNotification=function(){};PreviewLeadStateNotification.prototype.processResponse=function(notification){var notif=notification.ui_notification;UIModel.getInstance().agentSettings.onManualOutdial=!0;var response={callType:notif["@call_type"],messageId:notif["@message_id"],requestId:utils.getText(notif,"request_id"),leadState:utils.getText(notif,"lead_state"),callback:utils.getText(notif,"callback")};return response};var ReverseMatchNotification=function(){};ReverseMatchNotification.prototype.processResponse=function(notification){var notif=notification.ui_notification,model=UIModel.getInstance();return model.tokens.first_name=utils.getText(notif,"first_name"),model.tokens.mid_name=utils.getText(notif,"mid_name"),model.tokens.last_name=utils.getText(notif,"last_name"),model.tokens.address1=utils.getText(notif,"address1"),model.tokens.address2=utils.getText(notif,"address2"),model.tokens.suffix=utils.getText(notif,"suffix"),model.tokens.title=utils.getText(notif,"title"),model.tokens.city=utils.getText(notif,"city"),model.tokens.state=utils.getText(notif,"state"),model.tokens.zip=utils.getText(notif,"zip"),model.tokens.business_name=utils.getText(notif,"business_name"),model.tokens};var TcpaSafeLeadStateNotification=function(){};TcpaSafeLeadStateNotification.prototype.processResponse=function(notification){var notif=notification.ui_notification,response={callType:notif["@call_type"],messageId:notif["@message_id"],requestId:utils.getText(notif,"request_id"),leadState:utils.getText(notif,"lead_state"),callback:utils.getText(notif,"callback")};return response};var AckRequest=function(audioType,agentId,uii,monitorAgentId){this.audioType=audioType||"FULL",this.agentId=agentId,this.uii=uii,this.monitorAgentId=monitorAgentId};AckRequest.prototype.processResponse=function(response){var resp=response.ui_response,formattedResponse=utils.buildDefaultResponse(response);return formattedResponse.type=utils.getText(resp,"type"),"OK"===formattedResponse.status?utils.logMessage(LOG_LEVELS.DEBUG,formattedResponse.message,response):utils.logMessage(LOG_LEVELS.WARN,formattedResponse.message+": "+formattedResponse.detail,response),formattedResponse};var AgentStateRequest=function(agentState,agentAuxState){"ON-BREAK"==agentState.toUpperCase()&&1==UIModel.getInstance().onCall?(this.agentState="BREAK-AFTER-CALL",this.agentAuxState=""):(this.agentState=agentState.toUpperCase()||"",this.agentAuxState=agentAuxState||"")};AgentStateRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.AGENT_STATE,"@message_id":utils.getMessageId(),response_to:"",agent_id:{"#text":UIModel.getInstance().agentSettings.agentId},state:{"#text":this.agentState},agent_aux_state:{"#text":this.agentAuxState}}};return JSON.stringify(msg)},AgentStateRequest.prototype.processResponse=function(response){var resp=response.ui_response,status=utils.getText(resp,"status"),prevState=utils.getText(resp,"prev_state"),currState=utils.getText(resp,"current_state"),prevAuxState=utils.getText(resp,"prev_aux_state"),currAuxState=utils.getText(resp,"agent_aux_state"),model=UIModel.getInstance(),formattedResponse=utils.buildDefaultResponse(response);if(formattedResponse.agentId=response.ui_response.agent_id["#text"]||"",formattedResponse.previousState=prevState,formattedResponse.currentState=currState,formattedResponse.previousAuxState=prevAuxState,formattedResponse.currentAuxState=currAuxState,"OK"==status){var prevStateStr=prevState,currStateStr=currState;prevAuxState.length>0&&(prevStateStr=prevAuxState),currAuxState.length>0&&(currStateStr=currAuxState),model.agentSettings.currentState=currState,model.agentSettings.currentStateLabel=currAuxState,model.agentStatePacket=response}else{""===formattedResponse.message&&(formattedResponse.message="Unable to change agent state");var message="Unable to change agent state. "+formattedResponse.detail;utils.logMessage(LOG_LEVELS.WARN,message,response)}return formattedResponse};var BargeInRequest=function(audioType,agentId,uii,monitorAgentId){this.audioType=audioType||"FULL",this.agentId=agentId,this.uii=uii,this.monitorAgentId=monitorAgentId};BargeInRequest.prototype.formatJSON=function(){var msg=(UIModel.getInstance(),{ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.BARGE_IN,"@message_id":utils.getMessageId(),"@response_to":"",agent_id:{"#text":utils.toString(this.agentId)},uii:{"#text":utils.toString(this.uii)},audio_state:{"#text":utils.toString(this.audioType)},monitor_agent_id:{"#text":utils.toString(this.monitorAgentId)}}});return JSON.stringify(msg)},BargeInRequest.prototype.processResponse=function(response){var resp=response.ui_response,formattedResponse=utils.buildDefaultResponse(response);return formattedResponse.agentId=utils.getText(resp,"agent_id"),formattedResponse.uii=utils.getText(resp,"uii"),"OK"===formattedResponse.status?utils.logMessage(LOG_LEVELS.DEBUG,formattedResponse.message,response):utils.logMessage(LOG_LEVELS.WARN,"There was an error processing the Barge-In request. "+formattedResponse.detail,response),formattedResponse};var CallNotesRequest=function(notes){this.notes=notes};CallNotesRequest.prototype.formatJSON=function(){var model=UIModel.getInstance(),msg={ui_request:{"@destination":"IQ","@message_id":utils.getMessageId(),response_to:"","@type":MESSAGE_TYPES.CALL_NOTES,agent_id:{"#text":utils.toString(model.agentSettings.agentId)},uii:{"#text":utils.toString(model.currentCall.uii)},notes:{"#text":utils.toString(this.notes)}}};return JSON.stringify(msg)},CallNotesRequest.prototype.processResponse=function(response){var formattedResponse=utils.buildDefaultResponse(response);return"OK"===formattedResponse.status?(formattedResponse.message="Call notes have been updated.",formattedResponse.type="INFO_EVENT"):(formattedResponse.type="ERROR_EVENT",formattedResponse.message="Unable to update notes."),formattedResponse};var CallbackCancelRequest=function(leadId,agentId){this.agentId=agentId||UIModel.getInstance().agentSettings.agentId,this.leadId=leadId};CallbackCancelRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.CALLBACK_CANCEL,"@message_id":utils.getMessageId(),response_to:"",agent_id:{"#text":this.agentId},lead_id:{"#text":this.leadId}}};return JSON.stringify(msg)};var CallbacksPendingRequest=function(agentId){this.agentId=agentId||UIModel.getInstance().agentSettings.agentId};CallbacksPendingRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.CALLBACK_PENDING,"@message_id":utils.getMessageId(),response_to:"",agent_id:{"#text":this.agentId}}};return JSON.stringify(msg)},CallbacksPendingRequest.prototype.processResponse=function(response){var leadsRaw=response.ui_response.lead,leads=[];if(Array.isArray(leadsRaw))for(var l=0;l<leadsRaw.length;l++){var leadRaw=leadsRaw[l],lead=parseLead(leadRaw);leads.push(lead)}else leadsRaw&&leads.push(parseLead(leadsRaw));return UIModel.getInstance().agentSettings.pendingCallbacks=JSON.parse(JSON.stringify(leads)),UIModel.getInstance().agentSettings.pendingCallbacks};var CampaignDispositionsRequest=function(campaignId){this.agentId=UIModel.getInstance().agentSettings.agentId,this.campaignId=campaignId};CampaignDispositionsRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.CAMPAIGN_DISPOSITIONS,"@message_id":utils.getMessageId(),response_to:"",agent_id:{"#text":utils.toString(this.agentId)},campaign_id:{"#text":utils.toString(this.campaignId)}}};return JSON.stringify(msg)},CampaignDispositionsRequest.prototype.processResponse=function(response){var resp=response.ui_response,model=UIModel.getInstance(),dispositions=utils.processResponseCollection(resp,"outdial_dispositions","disposition","disposition");return model.outboundSettings.campaignDispositions=dispositions,dispositions};var XferColdRequest=function(dialDest,callerId,sipHeaders){this.dialDest=dialDest,this.callerId=callerId||"",this.sipHeaders=sipHeaders||[]};XferColdRequest.prototype.formatJSON=function(){for(var fields=[],i=0;i<this.sipHeaders.length;i++){var fieldObj=this.sipHeaders[i];fields.push({"@name":utils.toString(fieldObj.name),"@value":utils.toString(fieldObj.value)})}var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.XFER_COLD,"@message_id":utils.getMessageId(),"@response_to":"",agent_id:{"#text":UIModel.getInstance().agentSettings.agentId},uii:{"#text":UIModel.getInstance().currentCall.uii},dial_dest:{"#text":utils.toString(this.dialDest)},caller_id:{"#text":utils.toString(this.callerId)},xfer_header:fields}};return JSON.stringify(msg)},XferColdRequest.prototype.processResponse=function(response){var resp=response.ui_response,formattedResponse=utils.buildDefaultResponse(response);if(formattedResponse.agentId=utils.getText(resp,"agent_id"),formattedResponse.uii=utils.getText(resp,"uii"),formattedResponse.sessionId=utils.getText(resp,"session_id"),formattedResponse.dialDest=utils.getText(resp,"dial_dest"),"OK"===formattedResponse.status);else{var message="There was an error processing the Cold Xfer request. "+formattedResponse.message+" : "+formattedResponse.detail;utils.logMessage(LOG_LEVELS.WARN,message,response)}return formattedResponse};var ConfigRequest=function(dialDest,queueIds,chatIds,skillProfileId,dialGroupId,updateFromAdminUI){this.queueIds=queueIds||[],this.chatIds=chatIds||[],this.skillProfileId=skillProfileId||"",this.dialGroupId=dialGroupId||"",this.dialDest=dialDest||"",this.updateFromAdminUI=updateFromAdminUI||!1,this.loginType="NO-SELECTION",this.updateLogin=!1;var model=UIModel.getInstance();this.queueIds=utils.checkExistingIds(model.inboundSettings.availableQueues,this.queueIds,"gateId"),this.chatIds=utils.checkExistingIds(model.chatSettings.availableChatQueues,this.chatIds,"chatQueueId"),this.skillProfileId=utils.checkExistingIds(model.inboundSettings.availableSkillProfiles,[this.skillProfileId],"profileId")[0]||"",this.dialGroupId=utils.checkExistingIds(model.outboundSettings.availableOutdialGroups,[this.dialGroupId],"dialGroupId")[0]||"",this.queueIds.length>0&&""!==this.dialGroupId?this.loginType="BLENDED":this.queueIds.length>0?this.loginType="INBOUND":""!==this.dialGroupId?this.loginType="OUTBOUND":this.chatIds.length>0?this.loginType="CHAT":this.loginType="NO-SELECTION",model.agentSettings.isLoggedIn&&(this.updateLogin=!0),utils.validateDest(this.dialDest)||utils.logMessage(LOG_LEVELS.WARN,"dialDest ["+this.dialDest+"] must be a valid sip or 10-digit DID","")};ConfigRequest.prototype.formatJSON=function(){for(var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.LOGIN,"@message_id":utils.getMessageId(),response_to:"",agent_id:{"#text":utils.toString(UIModel.getInstance().agentSettings.agentId)},agent_pwd:{"#text":UIModel.getInstance().loginRequest.password},dial_dest:{"#text":utils.toString(this.dialDest)},login_type:{"#text":this.loginType},update_login:{"#text":utils.toString(this.updateLogin)},outdial_group_id:{"#text":utils.toString(this.dialGroupId)},skill_profile_id:{"#text":utils.toString(this.skillProfileId)},update_from_adminui:{"#text":utils.toString(this.updateFromAdminUI)}}},queueIds=[],i=0;i<this.queueIds.length;i++)""!==this.queueIds[i]&&queueIds.push({"#text":utils.toString(this.queueIds[i])});queueIds.length>0?msg.ui_request.gates={gate_id:queueIds}:msg.ui_request.gates={};for(var chatIds=[],i=0;i<this.chatIds.length;i++)""!==this.chatIds[i]&&chatIds.push({"#text":utils.toString(this.chatIds[i])});return chatIds.length>0?msg.ui_request.chat_queues={chat_queue_id:chatIds}:msg.ui_request.chat_queues={},JSON.stringify(msg)},ConfigRequest.prototype.processResponse=function(response){var resp=response.ui_response,status=utils.getText(resp,"status"),detail=utils.getText(resp,"detail"),model=UIModel.getInstance(),message="",formattedResponse=utils.buildDefaultResponse(response);return"Logon Session Configuration Updated!"===detail&&(model.agentSettings.updateLoginMode=!0,message="Logon Session Configuration Updated!",utils.logMessage(LOG_LEVELS.INFO,message,response)),"SUCCESS"===status?(model.agentSettings.isLoggedIn?model.agentSettings.updateLoginMode?(model.agentSettings.dialDest=model.configRequest.dialDest,model.agentSettings.loginType=utils.getText(resp,"login_type"),model.agentSettings.guid=utils.getText(resp,"guid"),model.agentSettings.accountId=utils.getText(resp,"account_id"),model.agentSettings.updateLoginMode=!1,model.agentPermissions.allowLeadSearch=!1,model.agentPermissions.requireFetchedLeadsCalled=!1,model.agentPermissions.allowPreviewLeadFilters=!1,setDialGroupSettings(response),setGateSettings(response),setChatQueueSettings(response),setSkillProfileSettings(response)):(message="Processed a Layer 2 Reconnect Successfully",utils.logMessage(LOG_LEVELS.INFO,message,response)):(model.configPacket=response,model.connectionSettings.hashCode=utils.getText(resp,"hash_code"),model.agentSettings.isLoggedIn=!0,model.agentSettings.loginDTS=new Date,model.connectionSettings.reconnect=!0,model.agentPermissions.allowLeadSearch=!1,model.agentSettings.dialDest=model.configRequest.dialDest,model.agentSettings.loginType=utils.getText(resp,"login_type"),model.agentSettings.guid=utils.getText(resp,"guid"),model.agentSettings.accountId=utils.getText(resp,"account_id"),setDialGroupSettings(response),setGateSettings(response),setChatQueueSettings(response),setSkillProfileSettings(response)),formattedResponse.agentSettings=model.agentSettings,formattedResponse.agentPermissions=model.agentPermissions,formattedResponse.applicationSettings=model.applicationSettings,formattedResponse.chatSettings=model.chatSettings,formattedResponse.connectionSettings=model.connectionSettings,formattedResponse.inboundSettings=model.inboundSettings,formattedResponse.outboundSettings=model.outboundSettings,formattedResponse.scriptSettings=model.scriptSettings):(""===formattedResponse.message&&(formattedResponse.message="Agent configuration attempt failed (2nd layer login)"),utils.logMessage(LOG_LEVELS.WARN,formattedResponse.message,response)),formattedResponse};var DispositionRequest=function(uii,dispId,notes,callback,callbackDTS,contactForwardNumber,survey,externId,leadId){this.uii=uii,this.dispId=dispId,this.notes=notes,this.callback=callback,this.callbackDTS=callbackDTS||"",this.contactForwardNumber=contactForwardNumber||null,this.externId=externId||null,this.leadId=leadId||null,this.survey=survey||null};DispositionRequest.prototype.formatJSON=function(){var model=UIModel.getInstance(),msg={ui_request:{"@destination":"IQ","@message_id":utils.getMessageId(),"@response_to":"","@type":MESSAGE_TYPES.OUTDIAL_DISPOSITION,agent_id:{"#text":utils.toString(model.agentSettings.agentId)},session_id:{"#text":""},uii:{"#text":utils.toString(this.uii)},disposition_id:{"#text":utils.toString(this.dispId)},notes:{"#text":utils.toString(this.notes)},call_back:{"#text":this.callback===!0?"TRUE":"FALSE"},call_back_DTS:{"#text":utils.toString(this.callbackDTS)},contact_forwarding:{"#text":utils.toString(this.contactForwardNumber)},outbound_externid:{
"#text":utils.toString(this.externId)},lead_id:{"#text":utils.toString(this.leadId)}}};if(model.currentCall.outdialDispositions&&"GATE"===model.currentCall.outdialDispositions.type&&(msg.ui_request["@type"]=MESSAGE_TYPES.INBOUND_DISPOSITION),model.currentCall.sessionId&&(msg.ui_request.session_id={"#text":model.currentCall.sessionId}),null!==this.survey){for(var response=[],keys=Object.keys(this.survey),i=0;i<keys.length;i++){var key=keys[i],obj={"@extern_id":key,"@lead_update_column":utils.toString(this.survey[key].leadField),"#text":utils.toString(this.survey[key].value)};response.push(obj)}msg.ui_request.survey={response:response}}return JSON.stringify(msg)};var DispositionManualPassRequest=function(dispId,notes,callback,callbackDTS,leadId,requestId,externId){this.dispId=dispId,this.notes=notes,this.callback=callback,this.callbackDTS=callbackDTS||"",this.leadId=leadId||null,this.requestId=requestId||null,this.externId=externId||null};DispositionManualPassRequest.prototype.formatJSON=function(){var model=UIModel.getInstance(),msg={ui_request:{"@destination":"IQ","@message_id":utils.getMessageId(),"@response_to":"","@type":MESSAGE_TYPES.OUTDIAL_DISPOSITION,manual_disp:{"#text":"TRUE"},agent_id:{"#text":utils.toString(model.agentSettings.agentId)},request_key:{"#text":utils.toString(this.requestId)},disposition_id:{"#text":utils.toString(this.dispId)},notes:{"#text":utils.toString(this.notes)},call_back:{"#text":this.callback===!0?"TRUE":"FALSE"},call_back_DTS:{"#text":utils.toString(this.callbackDTS)},lead_id:{"#text":utils.toString(this.leadId)},extern_id:{"#text":utils.toString(this.externId)},contact_forwarding:{"#text":"null"},session_id:{},uii:{}}};return JSON.stringify(msg)};var HangupRequest=function(sessionId){this.sessionId=sessionId||null};HangupRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.HANGUP,"@message_id":utils.getMessageId(),response_to:"",agent_id:{"#text":utils.toString(UIModel.getInstance().agentSettings.agentId)},uii:{"#text":utils.toString(UIModel.getInstance().currentCall.uii)},session_id:{"#text":utils.toString(null===this.sessionId?UIModel.getInstance().currentCall.sessionId:this.sessionId)}}};return JSON.stringify(msg)};var HoldRequest=function(holdState){this.holdState=holdState};HoldRequest.prototype.formatJSON=function(){var model=UIModel.getInstance(),msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.HOLD,"@message_id":utils.getMessageId(),"@response_to":"",agent_id:{"#text":utils.toString(model.currentCall.agentId)},uii:{"#text":utils.toString(model.currentCall.uii)},session_id:{"#text":"1"},hold_state:{"#text":this.holdState===!0||"true"===this.holdState?"ON":"OFF"}}};return JSON.stringify(msg)},HoldRequest.prototype.processResponse=function(response){var resp=response.ui_response,formattedResponse=utils.buildDefaultResponse(response),currUII="";return UIModel.getInstance().currentCall.uii&&(currUII=UIModel.getInstance().currentCall.uii),formattedResponse.holdState="ON"===utils.getText(resp,"hold_state"),formattedResponse.sessionId=utils.getText(resp,"session_id"),formattedResponse.uii=utils.getText(resp,"uii"),"OK"===formattedResponse.status?formattedResponse.uii===currUII?(""===formattedResponse.message&&(formattedResponse.message="Broadcasting new hold state of "+formattedResponse.holdState),utils.logMessage(LOG_LEVELS.DEBUG,"Broadcasting new hold state of "+formattedResponse.holdState,response)):utils.logMessage(LOG_LEVELS.DEBUG,"Hold Response is for a different call...discarding",response):(""===formattedResponse.message&&(formattedResponse.message="Error processing HOLD request. "+ +formattedResponse.message+"\n"+formattedResponse.detail),utils.logMessage(LOG_LEVELS.WARN,"Error processing HOLD request. "+formattedResponse.detail,response)),formattedResponse};var LeadHistoryRequest=function(leadId){this.leadId=leadId};LeadHistoryRequest.prototype.formatJSON=function(){var model=UIModel.getInstance(),msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.LEAD_HISTORY,"@message_id":utils.getMessageId(),"@response_to":"",agent_id:{"#text":utils.toString(model.agentSettings.agentId)},lead_id:{"#text":utils.toString(this.leadId)}}};return JSON.stringify(msg)},LeadHistoryRequest.prototype.processResponse=function(response){var resp=response.ui_response,histResponse={leadId:resp["@lead_id"]},history=utils.processResponseCollection(response,"ui_response","previous_dial");return Array.isArray(history)||(history=[history]),histResponse.leadHistory=history,histResponse};var LeadInsertRequest=function(dataObj){dataObj.agent_reserved&&dataObj.agent_reserved===!0?dataObj.agent_reserved="1":dataObj.agent_reserved="0",dataObj.dialable&&dataObj.dialable===!0?dataObj.dialable="1":dataObj.dialable="0",this.dataObj=dataObj};LeadInsertRequest.prototype.formatJSON=function(){var msg=(UIModel.getInstance(),{ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.LEAD_INSERT,"@message_id":utils.getMessageId(),"@response_to":"",agent_id:{"#text":utils.toString(this.dataObj.agent_id)},campaign_id:{"#text":utils.toString(this.dataObj.campaign_id)},lead_phone:{"#text":utils.toString(this.dataObj.lead_phone)},dialable:{"#text":utils.toString(this.dataObj.dialable)},agent_reserved:{"#text":utils.toString(this.dataObj.agent_reserved)},call_back_dts:{"#text":utils.toString(this.dataObj.callback_dts)},first_name:{"#text":utils.toString(this.dataObj.first_name)},mid_name:{"#text":utils.toString(this.dataObj.mid_name)},last_name:{"#text":utils.toString(this.dataObj.last_name)},suffix:{"#text":utils.toString(this.dataObj.suffix)},title:{"#text":utils.toString(this.dataObj.title)},address1:{"#text":utils.toString(this.dataObj.address1)},address2:{"#text":utils.toString(this.dataObj.address2)},city:{"#text":utils.toString(this.dataObj.city)},state:{"#text":utils.toString(this.dataObj.state)},zip:{"#text":utils.toString(this.dataObj.zip)},email:{"#text":utils.toString(this.dataObj.email)},gate_keeper:{"#text":utils.toString(this.dataObj.gate_keeper)},aux_data1:{"#text":utils.toString(this.dataObj.aux_data1)},aux_data2:{"#text":utils.toString(this.dataObj.aux_data2)},aux_data3:{"#text":utils.toString(this.dataObj.aux_data3)},aux_data4:{"#text":utils.toString(this.dataObj.aux_data4)},aux_data5:{"#text":utils.toString(this.dataObj.aux_data5)}}});return JSON.stringify(msg)},LeadInsertRequest.prototype.processResponse=function(response){var resp=response.ui_response,formattedResponse=utils.buildDefaultResponse(response);return formattedResponse.message=resp.msg["#text"],formattedResponse};var LeadUpdateRequest=function(leadId,leadPhone,baggage){this.leadId=leadId,this.leadPhone=leadPhone,this.baggage=baggage,this.agentId=utils.toString(UIModel.getInstance().agentSettings.agentId)};LeadUpdateRequest.prototype.formatJSON=function(){this.baggage=_formatBaggage(this.baggage);var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.LEAD_UPDATE,"@message_id":utils.getMessageId(),"@response_to":"",agent_id:{"#text":this.agentId},lead_id:{"#text":utils.toString(this.leadId)},lead_phone:{"#text":utils.toString(this.leadPhone)},baggage:this.baggage}};return JSON.stringify(msg)},LeadUpdateRequest.prototype.processResponse=function(response){var resp=response.ui_response,formattedResponse=utils.buildDefaultResponse(response);return formattedResponse.message=resp.msg["#text"],formattedResponse},_formatBaggage=function(baggage){var bag={};return bag.first_name={"#text":baggage.first_name||""},bag.mid_name={"#text":baggage.mid_name||""},bag.last_name={"#text":baggage.last_name||""},bag.suffix={"#text":baggage.suffix||""},bag.title={"#text":baggage.title||""},bag.address1={"#text":baggage.address1||""},bag.address2={"#text":baggage.address2||""},bag.city={"#text":baggage.city||""},bag.state={"#text":baggage.state||""},bag.zip={"#text":baggage.zip||""},bag.email={"#text":baggage.email||""},bag.gate_keeper={"#text":baggage.gate_keeper||""},bag.extern_id={"#text":baggage.extern_id||""},bag.aux_data1={"#text":baggage.aux_data1||""},bag.aux_data2={"#text":baggage.aux_data2||""},bag.aux_data3={"#text":baggage.aux_data3||""},bag.aux_data4={"#text":baggage.aux_data4||""},bag.aux_data5={"#text":baggage.aux_data5||""},bag};var LoginRequest=function(username,password,isCaseSensitive){this.username=username,this.password=password,this.isCaseSensitive=isCaseSensitive||!1};LoginRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IS","@type":MESSAGE_TYPES.LOGIN,"@message_id":utils.getMessageId(),response_to:"",username:{"#text":this.username},password:{"#text":this.password},is_case_sensitive:{"#text":utils.toString(this.isCaseSensitive===!0?"TRUE":"FALSE")}}};return JSON.stringify(msg)},LoginRequest.prototype.processResponse=function(response){var resp=response.ui_response,status=resp.status["#text"],model=UIModel.getInstance(),formattedResponse=utils.buildDefaultResponse(response);if("OK"===status){if(!model.isLoggedInIS){model.loginPacket=response,model.applicationSettings.isLoggedInIS=!0,model.applicationSettings.isTcpaSafeMode="1"===utils.getText(resp,"tcpa_safe_mode"),model.applicationSettings.pciEnabled="1"===utils.getText(resp,"pci_enabled"),model.chatSettings.alias=utils.getText(resp,"first_name")+" "+utils.getText(resp,"last_name"),model.agentSettings.loginDTS=new Date,model.agentSettings.maxBreakTime=utils.getText(resp,"max_break_time"),model.agentSettings.maxLunchTime=utils.getText(resp,"max_lunch_time"),model.agentSettings.firstName=utils.getText(resp,"first_name"),model.agentSettings.lastName=utils.getText(resp,"last_name"),model.agentSettings.email=utils.getText(resp,"email"),model.agentSettings.agentId=utils.getText(resp,"agent_id"),model.agentSettings.externalAgentId=utils.getText(resp,"external_agent_id"),model.agentSettings.agentType=utils.getText(resp,"agent_type"),model.agentSettings.realAgentType=utils.getText(resp,"real_agent_type"),model.agentSettings.defaultLoginDest=utils.getText(resp,"default_login_dest"),model.agentSettings.altDefaultLoginDest=utils.getText(resp,"alt_default_login_dest"),model.agentSettings.initLoginState=utils.getText(resp,"init_login_state"),model.agentSettings.initLoginStateLabel=utils.getText(resp,"init_login_state_label"),model.agentSettings.outboundManualDefaultRingtime=utils.getText(resp,"outbound_manual_default_ringtime"),model.agentSettings.isOutboundPrepay="1"===utils.getText(resp,"outbound_prepay"),model.agentSettings.phoneLoginPin=utils.getText(resp,"phone_login_pin"),model.agentSettings.username=model.loginRequest.username,model.agentPermissions.allowCallControl="1"===utils.getText(resp,"allow_call_control"),model.agentPermissions.allowChat="1"===utils.getText(resp,"allow_chat"),model.agentPermissions.showLeadHistory="1"===utils.getText(resp,"show_lead_history"),model.agentPermissions.allowManualOutboundGates="1"===utils.getText(resp,"allow_manual_outbound_gates"),model.agentPermissions.allowOffHook="1"===utils.getText(resp,"allow_off_hook"),model.agentPermissions.allowManualCalls="1"===utils.getText(resp,"allow_manual_calls"),model.agentPermissions.allowManualPass="1"===utils.getText(resp,"allow_manual_pass"),model.agentPermissions.allowManualIntlCalls="1"===utils.getText(resp,"allow_manual_intl_calls"),model.agentPermissions.allowLoginUpdates="1"===utils.getText(resp,"allow_login_updates"),model.agentPermissions.allowInbound="1"===utils.getText(resp,"allow_inbound"),model.agentPermissions.allowOutbound="1"===utils.getText(resp,"allow_outbound"),model.agentPermissions.allowBlended="1"===utils.getText(resp,"allow_blended"),model.agentPermissions.allowLoginControl="1"===utils.getText(resp,"allow_login_control"),model.agentPermissions.allowCrossQueueRequeue="1"===utils.getText(resp,"allow_cross_gate_requeue"),model.agentPermissions.disableSupervisorMonitoring="1"===utils.getText(resp,"disable_supervisor_monitoring"),model.agentPermissions.allowAutoAnswer="1"===utils.getText(resp,"allow_auto_answer"),model.outboundSettings.defaultDialGroup=utils.getText(resp,"phone_login_dial_group"),response.ui_response.allow_lead_inserts&&"undefined"!=typeof resp.insert_campaigns&&response.ui_response.insert_campaigns.campaign&&(model.agentPermissions.allowLeadInserts="1"===utils.getText(resp,"allow_lead_inserts")),processCampaigns(response),model.chatSettings.availableChatQueues=utils.processResponseCollection(response.ui_response,"login_chat_queues","chat_queue"),model.chatSettings.availableChatRequeueQueues=utils.processResponseCollection(response.ui_response,"chat_requeue_queues","chat_group"),model.inboundSettings.availableQueues=utils.processResponseCollection(response.ui_response,"login_gates","gate"),model.inboundSettings.availableSkillProfiles=utils.processResponseCollection(response.ui_response,"skill_profiles","profile"),model.inboundSettings.availableRequeueQueues=utils.processResponseCollection(response.ui_response,"requeue_gates","gate_group"),model.chatSettings.availableChatRooms=utils.processResponseCollection(response.ui_response,"chat_rooms","room"),model.scriptSettings.availableScripts=utils.processResponseCollection(response.ui_response,"scripts","script"),model.agentSettings.callerIds=utils.processResponseCollection(response.ui_response,"caller_ids","caller_id"),model.agentSettings.availableAgentStates=utils.processResponseCollection(response.ui_response,"agent_states","agent_state"),model.applicationSettings.availableCountries=utils.processResponseCollection(response.ui_response,"account_countries","country"),model.outboundSettings.insertCampaigns=utils.processResponseCollection(response.ui_response,"insert_campaigns","campaign");for(var dialGroups=utils.processResponseCollection(response.ui_response,"outdial_groups","group"),dg=0;dg<dialGroups.length;dg++){var group=dialGroups[dg];group.allowLeadSearch="YES"===group.allowLeadSearch,group.allowPreviewLeadFilters="1"===group.allowPreviewLeadFilters,group.progressiveEnabled="1"===group.progressiveEnabled,group.requireFetchedLeadsCalled="1"===group.requireFetchedLeadsCalled}model.outboundSettings.availableOutdialGroups=dialGroups}formattedResponse.agentSettings=model.agentSettings,formattedResponse.agentPermissions=model.agentPermissions,formattedResponse.applicationSettings=model.applicationSettings,formattedResponse.chatSettings=model.chatSettings,formattedResponse.connectionSettings=model.connectionSettings,formattedResponse.inboundSettings=model.inboundSettings,formattedResponse.outboundSettings=model.outboundSettings,formattedResponse.scriptSettings=model.scriptSettings}else"RESTRICTED"===status?(formattedResponse.message="Invalid IP Address",utils.logMessage(LOG_LEVELS.WARN,formattedResponse.message,response)):(formattedResponse.message="Invalid Username or password",utils.logMessage(LOG_LEVELS.WARN,formattedResponse.message,response));return formattedResponse},processCampaigns=function(response){var campaigns=[],campaign={},campaignsRaw=[],customLabels=[],labelArray=[],label="",campaignId=0,campaignName="",allowLeadUpdates=0;if("undefined"!=typeof response.ui_response.campaigns.campaign&&(campaignsRaw=response.ui_response.campaigns.campaign),Array.isArray(campaignsRaw))for(var c=0;c<campaignsRaw.length;c++){campaignId=campaignsRaw[c]["@campaign_id"],campaignName=campaignsRaw[c]["@campaign_name"],allowLeadUpdates=campaignsRaw[c]["@allow_lead_updates"],customLabels=campaignsRaw[c].custom_labels,labelArray=[],label="",UIModel.getInstance().agentPermissions.allowLeadUpdatesByCampaign[campaignId]=allowLeadUpdates;for(var prop in customLabels){label=prop.replace(/@/,"");var obj={};obj[label]=customLabels[prop],labelArray.push(obj)}campaign={allowLeadUpdates:allowLeadUpdates,campaignId:campaignId,campaignName:campaignName,surveyId:campaignsRaw[c]["@survey_id"],surveyName:campaignsRaw[c]["@survey_name"],customLabels:labelArray},campaigns.push(campaign)}else if(campaignsRaw){campaignId=campaignsRaw["@campaign_id"],campaignName=campaignsRaw["@campaign_name"],allowLeadUpdates=campaignsRaw["@allow_lead_updates"],customLabels=campaignsRaw.custom_labels,labelArray=[],label="",UIModel.getInstance().agentPermissions.allowLeadUpdatesByCampaign[campaignId]=allowLeadUpdates;for(var p in customLabels){label=p.replace(/@/,"");var obj={};obj[label]=customLabels[p],labelArray.push(obj)}campaign={allowLeadUpdates:allowLeadUpdates,campaignId:campaignId,campaignName:campaignName,surveyId:campaignsRaw["@survey_id"],surveyName:campaignsRaw["@survey_name"],customLabels:labelArray},campaigns.push(campaign)}UIModel.getInstance().outboundSettings.availableCampaigns=campaigns};var LogoutRequest=function(agentId,message,isSupervisor){this.agentId=agentId,this.message=message||"",this.isSupervisor=isSupervisor};LogoutRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.LOGOUT,"@message_id":utils.getMessageId(),response_to:"",agent_id:{"#text":this.agentId},message:{"#text":this.message}}};return JSON.stringify(msg)};var OffhookInitRequest=function(){};OffhookInitRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.OFFHOOK_INIT,"@message_id":utils.getMessageId(),response_to:"",agent_id:{"#text":UIModel.getInstance().agentSettings.agentId},dial_dest:{"#text":UIModel.getInstance().agentSettings.dialDest}}};return JSON.stringify(msg)},OffhookInitRequest.prototype.processResponse=function(response){var status=response.ui_response.status["#text"],formattedResponse=utils.buildDefaultResponse(response);if("OK"===status){var isMonitoring=utils.getText(response.ui_response,"monitoring");UIModel.getInstance().offhookInitPacket=response,UIModel.getInstance().agentSettings.isOffhook=!0,UIModel.getInstance().agentSettings.isMonitoring=isMonitoring,formattedResponse.monitoring=isMonitoring}else""===formattedResponse.message&&(formattedResponse.message="Unable to process offhook request"),utils.logMessage(LOG_LEVELS.WARN,formattedResponse.message+" "+formattedResponse.detail,response);return formattedResponse};var OffhookTermRequest=function(){};OffhookTermRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.OFFHOOK_TERM,"@message_id":utils.getMessageId(),response_to:"",agent_id:{"#text":UIModel.getInstance().agentSettings.agentId}}};return JSON.stringify(msg)},OffhookTermRequest.prototype.processResponse=function(data){var notif=data.ui_notification,monitoring="1"===utils.getText(notif,"monitoring"),model=UIModel.getInstance();model.agentSettings.wasMonitoring=monitoring,model.offhookTermPacket=data,model.agentSettings.isOffhook=!1,model.agentSettings.isMonitoring=!1;var formattedResponse={status:"OK",agentId:utils.getText(notif,"agent_id"),startDts:utils.getText(notif,"start_dts"),endDts:utils.getText(notif,"end_dts"),monitoring:monitoring};return formattedResponse};var OneToOneOutdialRequest=function(destination,callerId,ringTime,countryId,gateId){this.destination=destination,this.callerId=callerId,this.ringTime=ringTime||"60",this.countryId=countryId||"USA",this.gateId=gateId||""};OneToOneOutdialRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.ONE_TO_ONE_OUTDIAL,"@message_id":utils.getMessageId(),response_to:"",agent_id:{"#text":utils.toString(UIModel.getInstance().agentSettings.agentId)},destination:{"#text":utils.toString(this.destination)},ring_time:{"#text":utils.toString(this.ringTime)},caller_id:{"#text":utils.toString(this.callerId)},country_id:{"#text":utils.toString(this.countryId)},gate_id:{"#text":utils.toString(this.gateId)}}};return JSON.stringify(msg)};var OneToOneOutdialCancelRequest=function(uii){this.uii=uii};OneToOneOutdialCancelRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.ONE_TO_ONE_OUTDIAL_CANCEL,"@message_id":utils.getMessageId(),response_to:"",agent_id:{"#text":utils.toString(UIModel.getInstance().agentSettings.agentId)},uii:{"#text":utils.toString(this.uii)}}};return JSON.stringify(msg)};var PauseRecordRequest=function(record){this.record=record};PauseRecordRequest.prototype.formatJSON=function(){var model=UIModel.getInstance(),pauseTime="10";model.currentCall.agentRecording&&model.currentCall.agentRecording.pause&&(pauseTime=model.currentCall.agentRecording.pause);var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.PAUSE_RECORD,"@message_id":utils.getMessageId(),"@response_to":"",agent_id:{"#text":utils.toString(model.currentCall.agentId)},uii:{"#text":utils.toString(model.currentCall.uii)},record:{"#text":utils.toString(this.record===!0?"TRUE":"FALSE")},pause:{"#text":utils.toString(pauseTime)}}};return JSON.stringify(msg)},PauseRecordRequest.prototype.processResponse=function(response){var resp=response.ui_response,formattedResponse=utils.buildDefaultResponse(response),currUII="";return UIModel.getInstance().currentCall.uii&&(currUII=UIModel.getInstance().currentCall.uii),formattedResponse.uii=utils.getText(resp,"uii"),formattedResponse.state=utils.getText(resp,"state"),formattedResponse.pause=utils.getText(resp,"pause"),"OK"===formattedResponse.status?formattedResponse.uii===currUII?(""===formattedResponse.message&&(formattedResponse.message="Broadcasting new record state of "+formattedResponse.state),utils.logMessage(LOG_LEVELS.DEBUG,"Broadcasting new record state of "+formattedResponse.state,response)):utils.logMessage(LOG_LEVELS.DEBUG,"Pause Record Response is for a different call...discarding",response):(""===formattedResponse.message&&(formattedResponse.message="Error processing PAUSE-RECORD request."+formattedResponse.message+"\n"+formattedResponse.detail),utils.logMessage(LOG_LEVELS.WARN,formattedResponse.message,response)),formattedResponse};var PingCallRequest=function(){};PingCallRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.PING_CALL,"@message_id":utils.getMessageId(),"@response_to":"",agent_id:{"#text":UIModel.getInstance().currentCall.agentId},uii:{"#text":UIModel.getInstance().currentCall.uii}}};return JSON.stringify(msg)};var PreviewDialRequest=function(action,searchFields,requestId){this.agentId=UIModel.getInstance().agentSettings.agentId,this.searchFields=searchFields||[],this.requestId=requestId||"",this.action=action||""};PreviewDialRequest.prototype.formatJSON=function(){for(var fields={},i=0;i<this.searchFields.length;i++){var fieldObj=this.searchFields[i];fields[fieldObj.key]={"#text":utils.toString(fieldObj.value)}}var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.PREVIEW_DIAL,"@message_id":utils.getMessageId(),"@action":this.action,"@response_to":"",agent_id:{"#text":utils.toString(UIModel.getInstance().agentSettings.agentId)},pending_request_id:{"#text":utils.toString(this.requestId)},search_fields:fields}};return JSON.stringify(msg)},PreviewDialRequest.prototype.processResponse=function(notification){for(var notif=notification.dialer_request,model=UIModel.getInstance(),leads=utils.processResponseCollection(notif,"destinations","lead"),l=0;l<leads.length;l++)leads[l].requestId=leads[l].requestKey;var formattedResponse={action:notif["@action"],callbacks:"TRUE"===notif["@callbacks"],dialGroupId:utils.getText(notif,"dial_group_id"),accountId:utils.getText(notif,"account_id"),agentId:utils.getText(notif,"agent_id"),isInsert:utils.getText(notif,"is_insert"),leads:leads};if("TRUE"===notif["@callbacks"]){utils.logMessage(LOG_LEVELS.INFO,"New CALLBACK packet request rec'd from dialer",notification);for(var l=0;l<leads.length;l++){var lead=leads[l];model.callbacks.push(lead)}}else model.outboundSettings.previewDialLeads=leads;return formattedResponse};var RecordRequest=function(record){this.record=record};RecordRequest.prototype.formatJSON=function(){var model=UIModel.getInstance(),msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.RECORD,"@message_id":utils.getMessageId(),"@response_to":"",agent_id:{"#text":utils.toString(model.currentCall.agentId)},uii:{"#text":utils.toString(model.currentCall.uii)},record:{"#text":this.record===!0?"TRUE":"FALSE"}}};return JSON.stringify(msg)},RecordRequest.prototype.processResponse=function(response){var resp=response.ui_response,formattedResponse=utils.buildDefaultResponse(response),currUII="";return UIModel.getInstance().currentCall.uii&&(currUII=UIModel.getInstance().currentCall.uii),formattedResponse.uii=utils.getText(resp,"uii"),formattedResponse.state=utils.getText(resp,"state"),"OK"===formattedResponse.status?formattedResponse.uii===currUII?(""===formattedResponse.message&&(formattedResponse.message="Broadcasting new record state of "+formattedResponse.state),utils.logMessage(LOG_LEVELS.DEBUG,formattedResponse.message,response)):utils.logMessage(LOG_LEVELS.DEBUG,"Record Response is for a different call...discarding",response):(""===formattedResponse.message&&(formattedResponse.message="Error processing RECORD request."+formattedResponse.message+"\n"+formattedResponse.detail),utils.logMessage(LOG_LEVELS.WARN,formattedResponse.message,response)),formattedResponse};var RequeueRequest=function(queueId,skillId,maintain){this.queueId=queueId,this.skillId=skillId,this.maintain=maintain};RequeueRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.REQUEUE,"@message_id":utils.getMessageId(),response_to:"",agent_id:{"#text":UIModel.getInstance().agentSettings.agentId},uii:{"#text":UIModel.getInstance().currentCall.uii},gate_number:{"#text":utils.toString(this.queueId)},skill_id:{"#text":utils.toString(this.skillId)},maintain_agent:{"#text":this.maintain===!0?"TRUE":"FALSE"}}};return JSON.stringify(msg)},RequeueRequest.prototype.processResponse=function(response){var resp=response.ui_response,formattedResponse=utils.buildDefaultResponse(response);if(formattedResponse.agentId=utils.getText(resp,"agent_id"),formattedResponse.uii=utils.getText(resp,"uii"),formattedResponse.queueId=utils.getText(resp,"gate_number"),"OK"===formattedResponse.status);else{var message="There was an error processing the requeue request. "+formattedResponse.detail;utils.logMessage(LOG_LEVELS.WARN,message,response)}return formattedResponse};var ScriptConfigRequest=function(scriptId,version){this.scriptId=scriptId,this.version=version||null};ScriptConfigRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IQ","@message_id":utils.getMessageId(),response_to:"","@type":MESSAGE_TYPES.SCRIPT_CONFIG,agent_id:{"#text":utils.toString(UIModel.getInstance().agentSettings.agentId)},script_id:{"#text":utils.toString(this.scriptId)}}};return JSON.stringify(msg)},ScriptConfigRequest.prototype.processResponse=function(response){var resp=response.ui_response,formattedResponse=utils.buildDefaultResponse(response);return"true"===formattedResponse.status?(formattedResponse.status=!0,formattedResponse.scriptId=utils.getText(resp,"script_id"),formattedResponse.version=utils.getText(resp,"version"),formattedResponse.json=utils.getText(resp,"json"),UIModel.getInstance().scriptSettings.loadedScripts[formattedResponse.scriptId]=formattedResponse):formattedResponse.status=!1,formattedResponse};var ScriptResultRequest=function(uii,scriptId,jsonResult){this.uii=uii,this.scriptId=scriptId,this.jsonResult=jsonResult};ScriptResultRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IQ","@message_id":utils.getMessageId(),response_to:"","@type":MESSAGE_TYPES.SCRIPT_RESULT,agent_id:{"#text":utils.toString(UIModel.getInstance().agentSettings.agentId)},uii:{"#text":utils.toString(this.uii)},script_id:{"#text":utils.toString(this.scriptId)},json_result:{"#text":JSON.stringify(this.jsonResult)}}};return JSON.stringify(msg)};var StatsRequest=function(){};StatsRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IS","@type":MESSAGE_TYPES.STATS,"@message_id":utils.getMessageId(),"@response_to":""}};return JSON.stringify(msg)};var TcpaSafeRequest=function(action,searchFields,requestId){this.agentId=UIModel.getInstance().agentSettings.agentId,this.searchFields=searchFields||[],this.requestId=requestId||"",this.action=action||""};TcpaSafeRequest.prototype.formatJSON=function(){for(var fields={},i=0;i<this.searchFields.length;i++){var fieldObj=this.searchFields[i];fields[fieldObj.key]={"#text":utils.toString(fieldObj.value)}}var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.TCPA_SAFE,"@message_id":utils.getMessageId(),"@action":this.action,response_to:"",agent_id:{"#text":utils.toString(UIModel.getInstance().agentSettings.agentId)},pending_request_id:{"#text":utils.toString(this.requestId)},search_fields:fields}};return JSON.stringify(msg)},TcpaSafeRequest.prototype.processResponse=function(notification){for(var notif=notification.dialer_request,model=UIModel.getInstance(),leads=utils.processResponseCollection(notif,"destinations","lead"),l=0;l<leads.length;l++)leads[l].requestId=leads[l].requestKey;var formattedResponse={action:notif["@action"],callbacks:"TRUE"===notif["@callbacks"],dialGroupId:utils.getText(notif,"dial_group_id"),accountId:utils.getText(notif,"account_id"),agentId:utils.getText(notif,"agent_id"),isInsert:utils.getText(notif,"is_insert"),leads:leads};if("TRUE"===notif["@callbacks"]){var message="New CALLBACK packet request rec'd from dialer";utils.logMessage(LOG_LEVELS.INFO,message,notification);for(var l=0;l<leads.length;l++){var lead=leads[l];model.callbacks.push(lead)}}else model.outboundSettings.tcpaSafeLeads=leads;return formattedResponse};var XferWarmRequest=function(dialDest,callerId,sipHeaders){this.dialDest=dialDest,this.callerId=callerId||"",this.sipHeaders=sipHeaders||[]};XferWarmRequest.prototype.formatJSON=function(){for(var fields=[],i=0;i<this.sipHeaders.length;i++){var fieldObj=this.sipHeaders[i];fields.push({"@name":utils.toString(fieldObj.name),"@value":utils.toString(fieldObj.value)})}var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.XFER_WARM,"@message_id":utils.getMessageId(),"@response_to":"",agent_id:{"#text":UIModel.getInstance().agentSettings.agentId},uii:{"#text":UIModel.getInstance().currentCall.uii},dial_dest:{"#text":utils.toString(this.dialDest)},caller_id:{"#text":utils.toString(this.callerId)},xfer_header:fields}};return JSON.stringify(msg)},XferWarmRequest.prototype.processResponse=function(response){var resp=response.ui_response,formattedResponse=utils.buildDefaultResponse(response);return formattedResponse.agentId=utils.getText(resp,"agent_id"),formattedResponse.uii=utils.getText(resp,"uii"),formattedResponse.sessionId=utils.getText(resp,"session_id"),formattedResponse.dialDest=utils.getText(resp,"dial_dest"),"OK"===formattedResponse.status?utils.logMessage(LOG_LEVELS.DEBUG,"Warm Xfer to "+formattedResponse.dialDest+" processed successfully.",response):utils.logMessage(LOG_LEVELS.WARN,"There was an error processing the Warm Xfer request. "+formattedResponse.message+"\n"+formattedResponse.detail,response),formattedResponse};var XferWarmCancelRequest=function(dialDest){this.dialDest=dialDest};XferWarmCancelRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.XFER_WARM_CANCEL,"@message_id":utils.getMessageId(),"@response_to":"",agent_id:{"#text":UIModel.getInstance().agentSettings.agentId},uii:{"#text":UIModel.getInstance().currentCall.uii},dial_dest:{"#text":utils.toString(this.dialDest)}}};return JSON.stringify(msg)};var ChatAgentEndRequest=function(agentId,uii){this.uii=uii,this.agentId=agentId};ChatAgentEndRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.CHAT_AGENT_END,uii:{"#text":utils.toString(this.uii)},agent_id:{"#text":utils.toString(this.agentId)}}};return JSON.stringify(msg)};var ChatAliasRequest=function(alias){this.alias=alias};ChatAliasRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IS","@type":MESSAGE_TYPES.CHAT_ALIAS,"@message_id":utils.getMessageId(),"@response_to":"",alias:{"#text":utils.toString(this.alias)}}};return JSON.stringify(msg)};var ChatDispositionRequest=function(uii,agentId,dispositionId,notes,sendAcknowlegement,survey,sessionId){
this.uii=uii,this.agentId=agentId,this.dispositionId=dispositionId,this.notes=notes||"",this.sendAcknowlegement=sendAcknowlegement||!1,this.sessionId=sessionId,this.survey=survey||null};ChatDispositionRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.CHAT_DISPOSITION,"@message_id":utils.getMessageId(),"@response_to":"",uii:{"#text":utils.toString(this.uii)},agent_id:{"#text":utils.toString(this.agentId)},session_id:{"#text":utils.toString(this.sessionId)},disposition_id:{"#text":utils.toString(this.dispositionId)},notes:{"#text":utils.toString(this.notes)},do_ack:{"#text":this.sendAcknowlegement===!0?"TRUE":"FALSE"}}};if(null!==this.survey){for(var response=[],keys=Object.keys(this.survey),i=0;i<keys.length;i++){var key=keys[i],obj={"@extern_id":key,"#text":utils.toString(this.survey[key].value)};response.push(obj)}msg.ui_request.survey={response:response}}return JSON.stringify(msg)};var ChatListRequest=function(agentId,monitorAgentId){this.agentId=agentId,this.monitorAgentId=monitorAgentId};ChatListRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.CHAT_LIST,"@message_id":utils.getMessageId(),"@response_to":"",agent_id:{"#text":UIModel.getInstance().agentSettings.agentId},monitor_agent_id:{"#text":utils.toString(this.monitorAgentId)}}};return JSON.stringify(msg)};var ChatMessageRequest=function(uii,agentId,message,whisper){this.uii=uii,this.agentId=agentId,this.message=message,this.whisper=whisper};ChatMessageRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.CHAT_MESSAGE,"@message_id":utils.getMessageId(),"@response_to":"",uii:{"#text":utils.toString(this.uii)},agent_id:{"#text":utils.toString(this.agentId)},message:{"#text":utils.toString(this.message)},whisper:{"#text":utils.toString(this.whisper)}}};return JSON.stringify(msg)},ChatMessageRequest.prototype.processResponse=function(response){var resp=response.ui_notification,dts=utils.getText(resp,"dts").trim(),dtsDate=new Date(dts.replace(" ","T")),formattedResponse={uii:utils.getText(resp,"uii"),accountId:utils.getText(resp,"account_id"),from:utils.getText(resp,"from"),type:utils.getText(resp,"type"),message:utils.getText(resp,"message"),whisper:utils.getText(resp,"whisper"),dts:dtsDate};return utils.logMessage(LOG_LEVELS.DEBUG,"New CHAT-MESSAGE packet received from IntelliQueue",response),formattedResponse};var ChatPresentedResponseRequest=function(uii,messageId,response,responseReason){this.uii=uii,this.messageId=messageId,this.response=response,this.responseReason=responseReason||""};ChatPresentedResponseRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.CHAT_PRESENTED_RESPONSE,"@message_id":utils.getMessageId(),"@response_to":this.messageId,uii:{"#text":utils.toString(this.uii)},agent_id:{"#text":UIModel.getInstance().agentSettings.agentId},response:{"#text":utils.toString(this.response)},response_reason:{"#text":utils.toString(this.responseReason)}}};return JSON.stringify(msg)};var ChatRequeueRequest=function(uii,agentId,chatQueueId,skillId,maintainAgent){this.uii=uii,this.agentId=agentId,this.chatQueueId=chatQueueId,this.skillId=skillId||"",this.maintainAgent=maintainAgent||!1};ChatRequeueRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.CHAT_REQUEUE,"@message_id":utils.getMessageId(),"@response_to":"",uii:{"#text":utils.toString(this.uii)},agent_id:{"#text":utils.toString(this.agentId)},chat_queue_id:{"#text":utils.toString(this.chatQueueId)},skill_id:{"#text":utils.toString(this.skillId)},maintain_agent:{"#text":utils.toString(this.maintainAgent)}}};return JSON.stringify(msg)};var ChatRoomRequest=function(action,roomType,roomId,agentOne,agentTwo){this.action=action,this.roomType=roomType,this.roomId=roomId,this.agentOne=agentOne||"",this.agentTwo=agentTwo||""};ChatRoomRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IS","@type":MESSAGE_TYPES.CHAT_ROOM,"@message_id":utils.getMessageId(),"@response_to":"",action:{"#text":utils.toString(this.action)}}};return"EXIT"!==this.action&&(msg.ui_request["@room_type"]=this.roomType),"PRIVATE"===this.roomType&&"ENTER"===this.action?(msg.ui_request.agent_one={"#text":utils.toString(this.agentOne)},msg.ui_request.agent_two={"#text":utils.toString(this.agentTwo)}):msg.ui_request.room_id={"#text":utils.toString(this.roomId)},JSON.stringify(msg)};var ChatRoomStateRequest=function(){};ChatRoomStateRequest.prototype.processResponse=function(response){var resp=response.ui_request,formattedResponse={roomId:utils.getText(resp,"room_id"),agentId:utils.getText(resp,"agent_id"),chatAlias:utils.getText(resp,"chat_alias"),state:utils.getText(resp,"state")};return utils.logMessage(LOG_LEVELS.DEBUG,"Chat-Room-State update packet received for room #"+formattedResponse.roomId,response),formattedResponse};var ChatSendRequest=function(roomId,message){this.roomId=roomId,this.message=message};ChatSendRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IS","@type":MESSAGE_TYPES.CHAT_SEND,"@message_id":utils.getMessageId(),"@response_to":"",room_id:{"#text":utils.toString(this.roomId)},message:{"#text":utils.toString(this.message)}}};return JSON.stringify(msg)},ChatSendRequest.prototype.processResponse=function(response){var resp=response.ui_request,formattedResponse={roomType:utils.getText(resp,"room_type"),roomId:utils.getText(resp,"room_id"),message:utils.getText(resp,"message"),sender:utils.getText(resp,"sender"),senderId:utils.getText(resp,"sender_id"),roomName:utils.getText(resp,"room_name"),dynamicCreate:"TRUE"===utils.getText(resp,"dynamic_create")};return utils.logMessage(LOG_LEVELS.DEBUG,"New CHAT packet received from IntelliServices",response),formattedResponse};var ChatTypingRequest=function(uii){this.uii=uii};ChatTypingRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.CHAT_TYPING,"@message_id":utils.getMessageId(),"@response_to":"",uii:{"#text":utils.toString(this.uii)},agent_id:{"#text":UIModel.getInstance().agentSettings.agentId}}};return JSON.stringify(msg)};var LeaveChatRequest=function(uii,agentId,sessionId){this.uii=uii,this.agentId=agentId,this.sessionId=sessionId};LeaveChatRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.LEAVE_CHAT,"@message_id":utils.getMessageId(),"@response_to":"",uii:{"#text":utils.toString(this.uii)},agent_id:{"#text":UIModel.getInstance().agentSettings.agentId},session_id:{"#text":utils.toString(this.sessionId)}}};return JSON.stringify(msg)};var MonitorChatRequest=function(uii,agentId,monitorAgentId){this.uii=uii,this.agentId=agentId,this.monitorAgentId=monitorAgentId};MonitorChatRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IQ","@type":MESSAGE_TYPES.MONITOR_CHAT,"@message_id":utils.getMessageId(),"@response_to":"",uii:{"#text":utils.toString(this.uii)},agent_id:{"#text":UIModel.getInstance().agentSettings.agentId},monitor_agent_id:{"#text":utils.toString(this.monitorAgentId)}}};return JSON.stringify(msg)};var SupervisorListRequest=function(){};SupervisorListRequest.prototype.formatJSON=function(){var msg={ui_request:{"@destination":"IS","@type":MESSAGE_TYPES.SUPERVISOR_LIST,"@message_id":utils.getMessageId(),"@response_to":"",agent_id:{"#text":utils.toString(UIModel.getInstance().agentSettings.agentId)}}};return JSON.stringify(msg)},SupervisorListRequest.prototype.processResponse=function(response){for(var model=UIModel.getInstance(),tempList=utils.processResponseCollection(response,"ui_response","supervisor"),supervisors=[],i=0;i<tempList.length;i++){var sup=tempList[i];supervisors.push({agentId:sup.id,firstName:sup.fname,lastName:sup.lname,username:sup.uname})}return utils.logMessage(LOG_LEVELS.DEBUG,"New supervisor list received ",supervisors),model.supervisors=supervisors,model.supervisors};var ChatActiveNotification=function(){};ChatActiveNotification.prototype.processResponse=function(notification){var notif=notification.ui_notification;return{message:"Received CHAT-ACTIVE notification",status:"OK",accountId:utils.getText(notif,"account_id"),uii:utils.getText(notif,"uii")}};var ChatCancelledNotification=function(){};ChatCancelledNotification.prototype.processResponse=function(notification){var notif=notification.ui_notification;return{message:"Received CHAT-CANCELLED notification",status:"OK",messageId:notif["@message_id"],accountId:utils.getText(notif,"account_id"),uii:utils.getText(notif,"uii")}};var ChatInactiveNotification=function(){};ChatInactiveNotification.prototype.processResponse=function(notification){var notif=notification.ui_notification;return{message:"Received CHAT-INACTIVE notification",status:"OK",accountId:utils.getText(notif,"account_id"),uii:utils.getText(notif,"uii")}};var ChatPresentedNotification=function(){};ChatPresentedNotification.prototype.processResponse=function(notification){var notif=notification.ui_notification;return{message:"Received CHAT-PRESENTED notification",status:"OK",messageId:notif["@message_id"],accountId:utils.getText(notif,"account_id"),uii:utils.getText(notif,"uii"),channelType:utils.getText(notif,"channel_type"),chatQueueId:utils.getText(notif,"chat_queue_id"),chatQueueName:utils.getText(notif,"chat_queue_name")}};var ChatTypingNotification=function(){};ChatTypingNotification.prototype.processResponse=function(notification){var notif=notification.ui_notification;return{message:"Received CHAT-TYPING notification",status:"OK",accountId:utils.getText(notif,"account_id"),uii:utils.getText(notif,"uii"),from:utils.getText(notif,"from"),type:utils.getText(notif,"type"),pendingMessage:utils.getText(notif,"message")}};var NewChatNotification=function(){};NewChatNotification.prototype.processResponse=function(notification){var notif=notification.ui_notification,dts=utils.getText(notif,"queue_dts");dts=new Date(dts.replace(" ","T"));var newChat={uii:utils.getText(notif,"uii"),accountId:utils.getText(notif,"account_id"),sessionId:utils.getText(notif,"session_id"),agentId:utils.getText(notif,"agent_id"),queueDts:dts,queueTime:utils.getText(notif,"queue_time"),chatQueueId:utils.getText(notif,"chat_queue_id"),chatQueueName:utils.getText(notif,"chat_queue_name"),chatRequeueType:utils.getText(notif,"chat_requeue_type"),appUrl:utils.getText(notif,"app_url"),channelType:utils.getText(notif,"channel_type"),ani:utils.getText(notif,"ani"),dnis:utils.getText(notif,"dnis"),surveyPopType:utils.getText(notif,"survey_pop_type"),scriptId:utils.getText(notif,"script_id"),scriptVersion:utils.getText(notif,"script_version"),preChatData:utils.getText(notif,"json_baggage")};if(newChat.requeueShortcuts=utils.processResponseCollection(notification,"ui_notification","chat_requeue_shortcuts","shortcut")[0],newChat.chatDispositions=utils.processResponseCollection(notification,"ui_notification","chat_dispositions","disposition")[0],newChat.transcript=utils.processResponseCollection(notification,"ui_notification","transcript","message")[0],newChat.chatDispositions&&newChat.chatDispositions.disposition?newChat.chatDispositions.dispositions=[newChat.chatDispositions]:newChat.chatDispositions=newChat.chatDispositions.dispositions,newChat.transcript&&newChat.transcript.message?newChat.transcript=[newChat.transcript]:newChat.transcript=newChat.transcript.messages,newChat.preChatData)try{newChat.preChatData=JSON.parse(newChat.preChatData)}catch(err){utils.logMessage(LOG_LEVELS.ERROR,"Error parsing the pre-form chat data.",notif)}if(newChat.chatDispositions)for(var d=0;d<newChat.chatDispositions.length;d++){var disp=newChat.chatDispositions[d];disp.isComplete="1"===disp.isComplete,disp.isSuccess="1"===disp.isSuccess}if(newChat.transcript)for(var t=0;t<newChat.transcript.length;t++){var msg=newChat.transcript[t];msg.dts&&(msg.dts=new Date(msg.dts.replace(" ","T")))}return newChat.baggage=buildChatTokenMap(notif,newChat),newChat};var AgentStats=function(){};AgentStats.prototype.processResponse=function(stats){var resp=stats.ui_stats.agent,agentStats=[];if(resp&&Array.isArray(resp))for(var i=0;i<resp.length;i++){var a={agentLoginType:resp[i]["@alt"],agentType:resp[i]["@atype"],avgTalkTime:resp[i]["@avgtt"],calls:resp[i]["@calls"],isDequeueAgent:resp[i]["@da"],defaultRoute:resp[i]["@droute"],firstName:resp[i]["@f"],queueDesc:resp[i]["@gdesc"],queueName:resp[i]["@gname"],agentId:resp[i]["@id"],lastName:resp[i]["@l"],loginDuration:resp[i]["@ldur"],loginType:resp[i]["@ltype"],offHook:resp[i]["@oh"],pendingDisp:resp[i]["@pd"],presented:resp[i]["@pres"],rna:resp[i]["@rna"],stateDuration:resp[i]["@sdur"],skillProfileName:resp[i]["@sp"],agentState:resp[i]["@state"],totalTalkTime:resp[i]["@ttt"],username:resp[i]["@u"],uii:resp[i]["@uii"],utilization:resp[i]["@util"]};agentStats.push(a)}else try{var agent={agentLoginType:resp["@alt"],agentType:resp["@atype"],avgTalkTime:resp["@avgtt"],calls:resp["@calls"],isDequeueAgent:resp["@da"],defaultRoute:resp["@droute"],firstName:resp["@f"],queueDesc:resp["@gdesc"],queueName:resp["@gname"],agentId:resp["@id"],lastName:resp["@l"],loginDuration:resp["@ldur"],loginType:resp["@ltype"],offHook:resp["@oh"],pendingDisp:resp["@pd"],presented:resp["@pres"],rna:resp["@rna"],stateDuration:resp["@sdur"],skillProfileName:resp["@sp"],agentState:resp["@state"],totalTalkTime:resp["@ttt"],username:resp["@u"],uii:resp["@uii"],utilization:resp["@util"]};agentStats.push(agent)}catch(e){}return UIModel.getInstance().agentStats=agentStats,agentStats};var AgentDailyStats=function(){};AgentDailyStats.prototype.processResponse=function(stats){var model=UIModel.getInstance().agentDailyStats,resp=stats.ui_stats;return model.agentId=utils.getText(resp,"agent_id"),model.totalLoginSessions=utils.getText(resp,"total_login_sessions"),model.totalChatsHandled=utils.getText(resp,"total_chats_handled"),model.totalCallsHandled=utils.getText(resp,"total_calls_handled"),model.totalPreviewDials=utils.getText(resp,"total_preview_dials"),model.totalManualDials=utils.getText(resp,"total_manual_dials"),model.totalRna=utils.getText(resp,"total_rna"),model.totalSuccessDispositions=utils.getText(resp,"total_success_dispositions"),model.totalTalkTime||(model.totalLoginTime=utils.getText(resp,"total_login_time"),model.totalOffhookTime=utils.getText(resp,"total_offhook_time"),model.totalTalkTime=utils.getText(resp,"total_talk_time"),model.currCallTime="0"),model};var CampaignStats=function(){};CampaignStats.prototype.processResponse=function(stats){var resp=stats.ui_stats,totals=utils.processResponseCollection(stats,"ui_stats","totals")[0],campaigns=[],campRaw={},camp={};if(Array.isArray(resp.campaign))for(var c=0;c<resp.campaign.length;c++)campRaw=resp.campaign[c],campRaw&&(camp={active:campRaw["@a"],abandon:campRaw["@aba"],answer:campRaw["@an"],available:campRaw["@av"],busy:campRaw["@b"],complete:campRaw["@c"],error:campRaw["@e"],fax:campRaw["@f"],campaignId:campRaw["@id"],intercept:campRaw["@int"],machine:campRaw["@m"],noanswer:campRaw["@na"],campaignName:campRaw["@name"],pending:campRaw["@p"],ready:campRaw["@r"],staffed:campRaw["@s"],totalConnects:campRaw["@tc"],totalTalkTime:campRaw["@ttt"]}),campaigns.push(camp);else campRaw=resp.campaign,campRaw&&(camp={active:campRaw["@a"],abandon:campRaw["@aba"],answer:campRaw["@an"],available:campRaw["@av"],busy:campRaw["@b"],complete:campRaw["@c"],error:campRaw["@e"],fax:campRaw["@f"],campaignId:campRaw["@id"],intercept:campRaw["@int"],machine:campRaw["@m"],noanswer:campRaw["@na"],campaignName:campRaw["@name"],pending:campRaw["@p"],ready:campRaw["@r"],staffed:campRaw["@s"],totalConnects:campRaw["@tc"],totalTalkTime:campRaw["@ttt"]}),campaigns.push(camp);var campaignStats={type:resp["@type"],campaigns:campaigns,totals:totals};return UIModel.getInstance().campaignStats=campaignStats,campaignStats};var ChatQueueStats=function(){};ChatQueueStats.prototype.processResponse=function(stats){var resp=stats.ui_stats,totals=utils.processResponseCollection(stats,"ui_stats","totals")[0],chatQueues=utils.processResponseCollection(stats,"ui_stats","chatQueue"),chatQueueStats={type:resp["@type"],chatQueues:chatQueues,totals:totals};return UIModel.getInstance().chatQueueStats=chatQueueStats,chatQueueStats};var QueueStats=function(){};QueueStats.prototype.processResponse=function(stats){var resp=stats.ui_stats,totals=utils.processResponseCollection(stats,"ui_stats","totals")[0],queues=[],gate={},gateRaw={};if(Array.isArray(resp.gate))for(var c=0;c<resp.gate.length;c++)gateRaw=resp.gate[c],gateRaw&&(gate={abandon:gateRaw["@aba"],active:gateRaw["@active"],answer:gateRaw["@ans"],asa:gateRaw["@asa"],available:gateRaw["@avail"],avgAbandon:gateRaw["@avga"],avgQueue:gateRaw["@avgq"],avgTalk:gateRaw["@avgt"],deflected:gateRaw["@def"],queueId:gateRaw["@id"],inQueue:gateRaw["@inq"],longCall:gateRaw["@long_c"],longestInQueue:gateRaw["@longq"],queueName:gateRaw["@name"],presented:gateRaw["@pres"],routing:gateRaw["@route"],shortAbandon:gateRaw["@short_aba"],shortCall:gateRaw["@short_c"],sla:gateRaw["@sla"],slaPass:gateRaw["@sla_p"],slaFail:gateRaw["@sla_f"],staffed:gateRaw["@staff"],tAbandonTime:gateRaw["@t_aba"],tQueueTime:gateRaw["@t_q"],tSpeedOfAnswer:gateRaw["@t_soa"],utilization:gateRaw["@util"]}),queues.push(gate);else gateRaw=resp.gate,gateRaw&&(gate={abandon:gateRaw["@aba"],active:gateRaw["@active"],answer:gateRaw["@ans"],asa:gateRaw["@asa"],available:gateRaw["@avail"],avgAbandon:gateRaw["@avga"],avgQueue:gateRaw["@avgq"],avgTalk:gateRaw["@avgt"],deflected:gateRaw["@def"],queueId:gateRaw["@id"],inQueue:gateRaw["@inq"],longCall:gateRaw["@long_c"],longestInQueue:gateRaw["@longq"],queueName:gateRaw["@name"],presented:gateRaw["@pres"],routing:gateRaw["@route"],shortAbandon:gateRaw["@short_aba"],shortCall:gateRaw["@short_c"],sla:gateRaw["@sla"],slaPass:gateRaw["@sla_p"],slaFail:gateRaw["@sla_f"],staffed:gateRaw["@staff"],tAbandonTime:gateRaw["@t_aba"],tQueueTime:gateRaw["@t_q"],tSpeedOfAnswer:gateRaw["@t_soa"],utilization:gateRaw["@util"]}),queues.push(gate);var queueStats={type:resp["@type"],queues:queues,totals:totals};return UIModel.getInstance().queueStats=queueStats,queueStats};var UIModel=function(){function init(){return{currentCall:{},callTokens:{},callbacks:[],libraryInstance:null,pingIntervalId:null,statsIntervalId:null,agentDailyIntervalId:null,chatAliasRequest:null,chatRoomRequest:null,chatSendRequest:null,supervisorListRequest:null,chatRoomStateRequest:new ChatRoomStateRequest,chatActiveNotification:new ChatActiveNotification,chatInactiveNotification:new ChatInactiveNotification,chatDispositionRequest:null,chatMessageRequest:new ChatMessageRequest,chatPresentedNotification:new ChatPresentedNotification,chatPresentedRequest:null,chatRequeueRequest:null,chatTypingNotification:new ChatTypingNotification,chatTypingRequest:null,newChatNotification:new NewChatNotification,agentStateRequest:null,ackRequest:new AckRequest,bargeInRequest:null,callNotesRequest:null,callbacksPendingRequest:null,campaignDispositionsRequest:null,configRequest:null,coldXferRequest:null,dispositionRequest:null,dispositionManualPassRequest:null,hangupRequest:null,holdRequest:null,leadHistoryRequest:null,leadInsertRequest:null,leadUpdateRequest:null,logoutRequest:null,loginRequest:null,offhookInitRequest:null,offhookTermRequest:null,oneToOneOutdialRequest:null,oneToOneOutdialCancelRequest:null,pauseRecordRequest:null,pingCallRequest:null,previewDialRequest:null,reconnectRequest:null,recordRequest:null,requeueRequest:null,statsRequest:null,tcpaSafeRequest:null,warmXferRequest:null,warmXferCancelRequest:null,agentStatePacket:null,configPacket:null,currentCallPacket:null,loginPacket:null,offhookInitPacket:null,offhookTermPacket:null,transferSessions:{},addSessionNotification:new AddSessionNotification,dialGroupChangeNotification:new DialGroupChangeNotification,dialGroupChangePendingNotification:new DialGroupChangePendingNotification,dropSessionNotification:new DropSessionNotification,earlyUiiNotification:new EarlyUiiNotification,endCallNotification:new EndCallNotification,gatesChangeNotification:new GatesChangeNotification,genericNotification:new GenericNotification,newCallNotification:new NewCallNotification,agentStatsPacket:new AgentStats,agentDailyStatsPacket:new AgentDailyStats,queueStatsPacket:new QueueStats,campaignStatsPacket:new CampaignStats,chatQueueStatsPacket:new ChatQueueStats,applicationSettings:{availableCountries:[],isLoggedInIS:!1,socketConnected:!1,socketDest:"",isTcpaSafeMode:!1},agentStats:[],agentDailyStats:{},campaignStats:{},queueStats:{},chatQueueStats:{},agentSettings:{accountId:null,agentId:0,agentType:"AGENT",altDefaultLoginDest:"",availableAgentStates:[],callerIds:[],callState:null,currentState:"OFFLINE",currentStateLabel:"",defaultLoginDest:"",dialDest:"",email:"",externalAgentId:"",firstName:"",guid:"",isLoggedIn:!1,isOffhook:!1,isMonitoring:!1,initLoginState:"AVAILABLE",initLoginStateLabel:"Available",isOutboundPrepay:!1,lastName:"",loginDTS:null,loginType:"NO-SELECTION",maxBreakTime:-1,maxLunchTime:-1,onCall:!1,onManualOutdial:!1,outboundManualDefaultRingtime:"30",pendingCallbacks:[],pendingDialGroupChange:0,phoneLoginPin:"",realAgentType:"AGENT",supervisors:[],totalCalls:0,transferNumber:"",updateDGFromAdminUI:!1,updateLoginMode:!1,username:"",wasMonitoring:!1},agentPermissions:{allowBlended:!0,allowCallControl:!0,allowChat:!1,allowCrossQueueRequeue:!1,allowInbound:!0,allowLeadInserts:!1,allowLeadSearch:!1,allowLoginControl:!0,allowLoginUpdates:!0,allowManualCalls:!0,allowManualPass:!0,allowManualIntlCalls:!1,allowManualOutboundGates:!1,allowOffHook:!0,allowOutbound:!0,allowPreviewLeadFilters:!1,allowLeadUpdatesByCampaign:{},disableSupervisorMonitoring:!0,progressiveEnabled:!1,requireFetchedLeadsCalled:!1,showLeadHistory:!0},chatSettings:{availableChatQueues:[],availableChatRooms:[],chatQueues:[],alias:""},connectionSettings:{hashCode:null,reconnect:!1},inboundSettings:{availableQueues:[],availableSkillProfiles:[],queues:[],skillProfile:{}},outboundSettings:{availableCampaigns:[],availableOutdialGroups:[],insertCampaigns:[],defaultDialGroup:0,outdialGroup:{},previewDialLeads:[],tcpaSafeLeads:[],campaignDispositions:[]},scriptSettings:{availableScripts:[],loadedScripts:{}},incrementTotalCalls:function(){this.agentSettings.totalCalls=this.agentSettings.totalCalls+1}}}var instance;return{getInstance:function(){return instance||(instance=init()),instance},resetInstance:function(){instance=null}}}(),utils={logMessage:function(logLevel,message,data){var instance=UIModel.getInstance().libraryInstance;if(instance._db){var transaction=instance._db.transaction(["logger"],"readwrite"),store=transaction.objectStore("logger"),record={logLevel:logLevel,message:message,dts:new Date,data:data};store.add(record)}},sendMessage:function(instance,msg){var msgObj=JSON.parse(msg);if(instance.socket&&1===instance.socket.readyState){var type=msgObj.ui_request["@type"],destination=msgObj.ui_request["@destination"],message="Sending "+type+" request message to "+destination;instance._requests.push({id:msgObj.ui_request["@message_id"],type:msgObj.ui_request["@type"],msg:msgObj.ui_request}),instance._requests.length>1e3&&instance._requests.shift(),instance.socket.send(msg),"STATS"===type?utils.logMessage(LOG_LEVELS.STATS,message,msgObj):utils.logMessage(LOG_LEVELS.INFO,message,msgObj)}else instance._queuedMsgs.push({dts:new Date,msg:msg}),UIModel.getInstance().agentSettings.isLoggedIn&&(instance._isReconnect=!0,instance.openSocket(),console.warn("AgentLibrary: WebSocket is not connected, attempting to reconnect."))},processResponse:function(instance,response){var type=response.ui_response["@type"],messageId=response.ui_response["@message_id"],dest=""!==messageId&&messageId?messageId.slice(0,2):"IS",message="Received "+type.toUpperCase()+" response message from "+dest;switch(utils.logMessage(LOG_LEVELS.INFO,message,response),utils.fireCallback(instance,CALLBACK_TYPES.ON_MESSAGE,response),type.toUpperCase()){case MESSAGE_TYPES.AGENT_STATE:null===UIModel.getInstance().agentStateRequest&&(UIModel.getInstance().agentStateRequest=new AgentStateRequest(response.ui_response.current_state["#text"],response.ui_response.agent_aux_state["#text"]));var stateChangeResponse=UIModel.getInstance().agentStateRequest.processResponse(response);utils.fireCallback(instance,CALLBACK_TYPES.AGENT_STATE,stateChangeResponse);break;case MESSAGE_TYPES.BARGE_IN:var resp=UIModel.getInstance().bargeInRequest.processResponse(response),responseTo=response.ui_response["@response_to"],request=utils.findRequestById(instance,responseTo);if(request){var audioState=request.msg.audio_state["#text"];"MUTE"===audioState?utils.fireCallback(instance,CALLBACK_TYPES.SILENT_MONITOR,resp):"COACHING"===audioState?utils.fireCallback(instance,CALLBACK_TYPES.COACH_CALL,resp):utils.fireCallback(instance,CALLBACK_TYPES.BARGE_IN,resp)}else utils.fireCallback(instance,CALLBACK_TYPES.BARGE_IN,resp);break;case MESSAGE_TYPES.CAMPAIGN_DISPOSITIONS:var campaignDispsResposne=UIModel.getInstance().campaignDispositionsRequest.processResponse(response);utils.fireCallback(instance,CALLBACK_TYPES.CAMPAIGN_DISPOSITIONS,campaignDispsResposne);break;case MESSAGE_TYPES.CALL_NOTES:var callNotes=UIModel.getInstance().callNotesRequest.processResponse(response);utils.fireCallback(instance,CALLBACK_TYPES.CALL_NOTES,callNotes);break;case MESSAGE_TYPES.CALLBACK_PENDING:var pendingCallbacks=UIModel.getInstance().callbacksPendingRequest.processResponse(response);utils.fireCallback(instance,CALLBACK_TYPES.CALLBACK_PENDING,pendingCallbacks);break;case MESSAGE_TYPES.HOLD:var holdRequest;holdRequest=null===UIModel.getInstance().holdRequest?new HoldRequest:UIModel.getInstance().holdRequest;var hold=holdRequest.processResponse(response);utils.fireCallback(instance,CALLBACK_TYPES.HOLD,hold);break;case MESSAGE_TYPES.LEAD_HISTORY:var history=UIModel.getInstance().leadHistoryRequest.processResponse(response);utils.fireCallback(instance,CALLBACK_TYPES.LEAD_HISTORY,history);break;case MESSAGE_TYPES.LEAD_INSERT:var insert=UIModel.getInstance().leadInsertRequest.processResponse(response);utils.fireCallback(instance,CALLBACK_TYPES.LEAD_INSERT,insert);break;case MESSAGE_TYPES.LEAD_UPDATE:var update=UIModel.getInstance().leadUpdateRequest.processResponse(response);utils.fireCallback(instance,CALLBACK_TYPES.LEAD_UPDATE,update);break;case MESSAGE_TYPES.LOGIN:if("IS"===dest){var loginResponse=UIModel.getInstance().loginRequest.processResponse(response);utils.fireCallback(instance,CALLBACK_TYPES.LOGIN,loginResponse)}else if("IQ"===dest){var configResponse=UIModel.getInstance().configRequest.processResponse(response);utils.fireCallback(instance,CALLBACK_TYPES.CONFIG,configResponse),"SUCCESS"===configResponse.status&&(UIModel.getInstance().statsIntervalId=setInterval(utils.sendStatsRequestMessage,5e3))}break;case MESSAGE_TYPES.LOGOUT:utils.fireCallback(instance,CALLBACK_TYPES.LOGOUT,response);break;case MESSAGE_TYPES.OFFHOOK_INIT:var offhook=new OffhookInitRequest,initResponse=offhook.processResponse(response);utils.fireCallback(instance,CALLBACK_TYPES.OFFHOOK_INIT,initResponse);break;case MESSAGE_TYPES.PAUSE_RECORD:var pauseRequest;pauseRequest=null===UIModel.getInstance().pauseRecordRequest?new PauseRecordRequest:UIModel.getInstance().pauseRecordRequest;var pauseRec=pauseRequest.processResponse(response);utils.fireCallback(instance,CALLBACK_TYPES.PAUSE_RECORD,pauseRec);break;case MESSAGE_TYPES.RECORD:var record=UIModel.getInstance().recordRequest.processResponse(response);utils.fireCallback(instance,CALLBACK_TYPES.RECORD,record);break;case MESSAGE_TYPES.REQUEUE:var requeue=UIModel.getInstance().requeueRequest.processResponse(response);utils.fireCallback(instance,CALLBACK_TYPES.REQUEUE,requeue);break;case MESSAGE_TYPES.SUPERVISOR_LIST:var supervisorList=UIModel.getInstance().supervisorListRequest.processResponse(response);utils.fireCallback(instance,CALLBACK_TYPES.SUPERVISOR_LIST,supervisorList);break;case MESSAGE_TYPES.SCRIPT_CONFIG:var script=UIModel.getInstance().scriptConfigRequest.processResponse(response);utils.fireCallback(instance,CALLBACK_TYPES.SCRIPT_CONFIG,script);break;case MESSAGE_TYPES.XFER_COLD:var coldXfer=UIModel.getInstance().coldXferRequest.processResponse(response);utils.fireCallback(instance,CALLBACK_TYPES.XFER_COLD,coldXfer);break;case MESSAGE_TYPES.XFER_WARM:var warmXfer=UIModel.getInstance().warmXferRequest.processResponse(response);utils.fireCallback(instance,CALLBACK_TYPES.XFER_WARM,warmXfer);break;case MESSAGE_TYPES.XFER_WARM_CANCEL:var warmXferCancel=UIModel.getInstance().warmXferCancelRequest.processResponse(response);utils.fireCallback(instance,CALLBACK_TYPES.XFER_WARM_CANCEL,warmXferCancel);break;case MESSAGE_TYPES.ACK:var ack=UIModel.getInstance().ackRequest.processResponse(response),responseTo=response.ui_response["@response_to"],request=utils.findRequestById(instance,responseTo);ack.uii=request.msg.uii["#text"],utils.fireCallback(instance,CALLBACK_TYPES.ACK,ack)}},processNotification:function(instance,data){var type=data.ui_notification["@type"],messageId=data.ui_notification["@message_id"],dest=""===messageId?"IS":messageId.slice(0,2),message="Received "+type.toUpperCase()+" notification message from "+dest;switch(utils.logMessage(LOG_LEVELS.INFO,message,data),type.toUpperCase()){case MESSAGE_TYPES.ADD_SESSION:var addSesNotif=new AddSessionNotification,addResponse=addSesNotif.processResponse(data);utils.fireCallback(instance,CALLBACK_TYPES.ADD_SESSION,addResponse);break;case MESSAGE_TYPES.DIAL_GROUP_CHANGE:var dgChangeNotif=new DialGroupChangeNotification,changeResponse=dgChangeNotif.processResponse(data);utils.fireCallback(instance,CALLBACK_TYPES.DIAL_GROUP_CHANGE,changeResponse);break;case MESSAGE_TYPES.DIAL_GROUP_CHANGE_PENDING:var dgChangePendNotif=new DialGroupChangePendingNotification,pendResponse=dgChangePendNotif.processResponse(data);utils.fireCallback(instance,CALLBACK_TYPES.DIAL_GROUP_CHANGE_PENDING,pendResponse);break;case MESSAGE_TYPES.DROP_SESSION:var dropSesNotif=new DropSessionNotification(instance),dropSesResponse=dropSesNotif.processResponse(data);utils.fireCallback(instance,CALLBACK_TYPES.DROP_SESSION,dropSesResponse);break;case MESSAGE_TYPES.EARLY_UII:var earlyUiiNotif=new EarlyUiiNotification(instance),earlyUiiResponse=earlyUiiNotif.processResponse(data);utils.fireCallback(instance,CALLBACK_TYPES.EARLY_UII,earlyUiiResponse);break;case MESSAGE_TYPES.END_CALL:var endCallNotif=new EndCallNotification(instance),endCallResponse=endCallNotif.processResponse(data);utils.fireCallback(instance,CALLBACK_TYPES.END_CALL,endCallResponse);break;case MESSAGE_TYPES.GATES_CHANGE:var gateChangeNotif=new GatesChangeNotification,gateChangeResponse=gateChangeNotif.processResponse(data);utils.fireCallback(instance,CALLBACK_TYPES.GATES_CHANGE,gateChangeResponse);break;case MESSAGE_TYPES.GENERIC:var genericNotif=new GenericNotification,generic=genericNotif.processResponse(data),responseTo=data.ui_notification["@response_to"],request=utils.findRequestById(instance,responseTo);if(request){var type=request.type,callbackFnName=utils.findCallbackBasedOnMessageType(type);callbackFnName?(type===MESSAGE_TYPES.CALLBACK_CANCEL&&(generic.leadId=request.msg.lead_id["#text"]),utils.fireCallback(instance,callbackFnName,generic)):utils.fireCallback(instance,CALLBACK_TYPES.GENERIC_NOTIFICATION,generic)}else utils.fireCallback(instance,CALLBACK_TYPES.GENERIC_NOTIFICATION,generic);break;case MESSAGE_TYPES.NEW_CALL:var newCallNotif=new NewCallNotification,newCallResponse=newCallNotif.processResponse(data);utils.fireCallback(instance,CALLBACK_TYPES.NEW_CALL,newCallResponse);break;case MESSAGE_TYPES.OFFHOOK_TERM:null===UIModel.getInstance().offhookTermRequest&&(UIModel.getInstance().offhookTermRequest=new OffhookTermRequest);var termResponse=UIModel.getInstance().offhookTermRequest.processResponse(data);utils.fireCallback(instance,CALLBACK_TYPES.OFFHOOK_TERM,termResponse);break;case MESSAGE_TYPES.PREVIEW_LEAD_STATE:var leadStateNotif=new PreviewLeadStateNotification,leadStateResponse=leadStateNotif.processResponse(data);
utils.fireCallback(instance,CALLBACK_TYPES.PREVIEW_LEAD_STATE,leadStateResponse);break;case MESSAGE_TYPES.PENDING_DISP:var pendingDispNotif=new PendingDispNotification,pendingDispResponse=pendingDispNotif.processResponse(data);utils.fireCallback(instance,CALLBACK_TYPES.PENDING_DISP,pendingDispResponse);break;case MESSAGE_TYPES.REVERSE_MATCH:var reverseMatchNotif=new ReverseMatchNotification,reverseMatchResponse=reverseMatchNotif.processResponse(data);utils.fireCallback(instance,CALLBACK_TYPES.REVERSE_MATCH,reverseMatchResponse);break;case MESSAGE_TYPES.TCPA_SAFE_LEAD_STATE:var leadStateTcpaNotif=new TcpaSafeLeadStateNotification,leadStateTcpaResponse=leadStateTcpaNotif.processResponse(data);utils.fireCallback(instance,CALLBACK_TYPES.TCPA_SAFE_LEAD_STATE,leadStateTcpaResponse);break;case MESSAGE_TYPES.CHAT_ACTIVE:var activeNotif=new ChatActiveNotification,activeResponse=activeNotif.processResponse(data);utils.fireCallback(instance,CALLBACK_TYPES.CHAT_ACTIVE,activeResponse);break;case MESSAGE_TYPES.CHAT_INACTIVE:var inactiveNotif=new ChatInactiveNotification,inactiveResponse=inactiveNotif.processResponse(data);utils.fireCallback(instance,CALLBACK_TYPES.CHAT_INACTIVE,inactiveResponse);break;case MESSAGE_TYPES.CHAT_PRESENTED:var presentedNotif=new ChatPresentedNotification,presentedResponse=presentedNotif.processResponse(data);utils.fireCallback(instance,CALLBACK_TYPES.CHAT_PRESENTED,presentedResponse);break;case MESSAGE_TYPES.CHAT_TYPING:var typingNotif=new ChatTypingNotification,typingResponse=typingNotif.processResponse(data);utils.fireCallback(instance,CALLBACK_TYPES.CHAT_TYPING,typingResponse);break;case MESSAGE_TYPES.CHAT_NEW:var newChatNotif=new NewChatNotification,newChatResponse=newChatNotif.processResponse(data);utils.fireCallback(instance,CALLBACK_TYPES.CHAT_NEW,newChatResponse);break;case MESSAGE_TYPES.CHAT_MESSAGE:var chatMessage=new ChatMessageRequest,chatMessageResponse=chatMessage.processResponse(data);utils.fireCallback(instance,CALLBACK_TYPES.CHAT_MESSAGE,chatMessageResponse);break;case MESSAGE_TYPES.CHAT_CANCELLED:var chatCancelled=new ChatCancelledNotification,chatCancelledResponse=chatCancelled.processResponse(data);utils.fireCallback(instance,CALLBACK_TYPES.CHAT_CANCELLED,chatCancelledResponse);break;case MESSAGE_TYPES.MONITOR_CHAT:break;case MESSAGE_TYPES.LEAVE_CHAT:break;case MESSAGE_TYPES.CHAT_LIST:}},processDialerResponse:function(instance,response){var type=response.dialer_request["@type"],messageId=response.dialer_request["@message_id"],dest=""===messageId?"IS":messageId.slice(0,2),message="Received "+type.toUpperCase()+" dialer response message from "+dest;switch(utils.logMessage(LOG_LEVELS.INFO,message,response),utils.fireCallback(instance,CALLBACK_TYPES.ON_MESSAGE,response),type.toUpperCase()){case MESSAGE_TYPES.PREVIEW_DIAL_ID:var pdRequest=new PreviewDialRequest,dialResponse=pdRequest.processResponse(response);"SEARCH"===dialResponse.action.toUpperCase()?utils.fireCallback(instance,CALLBACK_TYPES.LEAD_SEARCH,dialResponse):utils.fireCallback(instance,CALLBACK_TYPES.PREVIEW_FETCH,dialResponse);break;case MESSAGE_TYPES.TCPA_SAFE_ID:var tcpaRequest=new TcpaSafeRequest,tcpaResponse=tcpaRequest.processResponse(response);"SEARCH"===tcpaResponse.action.toUpperCase()?utils.fireCallback(instance,CALLBACK_TYPES.SAFE_MODE_SEARCH,tcpaResponse):utils.fireCallback(instance,CALLBACK_TYPES.SAFE_MODE_FETCH,tcpaResponse)}},processRequest:function(instance,message){var type=message.ui_request["@type"];switch(type.toUpperCase()){case MESSAGE_TYPES.CHAT_SEND:var chatSendRequest=new ChatSendRequest,chatSendResponse=chatSendRequest.processResponse(message);utils.fireCallback(instance,CALLBACK_TYPES.CHAT,chatSendResponse);break;case MESSAGE_TYPES.CHAT_ROOM_STATE:var chatRoomStateRequest=new ChatRoomStateRequest,chatRoomStateResponse=chatRoomStateRequest.processResponse(message);utils.fireCallback(instance,CALLBACK_TYPES.CHAT_ROOM_STATE,chatRoomStateResponse)}},processStats:function(instance,data){var type=data.ui_stats["@type"],message="Received "+type.toUpperCase()+" response message from IS";switch(utils.logMessage(LOG_LEVELS.STATS,message,data),type.toUpperCase()){case MESSAGE_TYPES.STATS_AGENT:var agentStats=UIModel.getInstance().agentStatsPacket.processResponse(data);utils.fireCallback(instance,CALLBACK_TYPES.STATS_AGENT,agentStats);break;case MESSAGE_TYPES.STATS_AGENT_DAILY:var agentDailyStats=UIModel.getInstance().agentDailyStatsPacket.processResponse(data);utils.fireCallback(instance,CALLBACK_TYPES.STATS_AGENT_DAILY,agentDailyStats),null===UIModel.getInstance().agentDailyIntervalId&&(UIModel.getInstance().agentDailyIntervalId=setInterval(utils.onAgentDailyStats,1e3));break;case MESSAGE_TYPES.STATS_CAMPAIGN:var campaignStats=UIModel.getInstance().campaignStatsPacket.processResponse(data);utils.fireCallback(instance,CALLBACK_TYPES.STATS_CAMPAIGN,campaignStats);break;case MESSAGE_TYPES.STATS_QUEUE:var queueStats=UIModel.getInstance().queueStatsPacket.processResponse(data);utils.fireCallback(instance,CALLBACK_TYPES.STATS_QUEUE,queueStats);break;case MESSAGE_TYPES.STATS_CHAT:var chatStats=UIModel.getInstance().chatQueueStatsPacket.processResponse(data);utils.fireCallback(instance,CALLBACK_TYPES.STATS_CHAT_QUEUE,chatStats)}},processResponseCollection:function(response,groupProp,itemProp,textName){var items=[],item={},itemsRaw=[],textName=textName||"text";if(response[groupProp]&&"undefined"!=typeof response[groupProp][itemProp]&&(itemsRaw=response[groupProp][itemProp]),Array.isArray(itemsRaw))for(var i=0;i<itemsRaw.length;i++){var formattedKey="";for(var key in itemsRaw[i])if(key.match(/^#/)?formattedKey=textName:(formattedKey=key.replace(/@/,""),formattedKey=formattedKey.replace(/_([a-z])/g,function(g){return g[1].toUpperCase()})),"object"==typeof itemsRaw[i][key])if(1===Object.keys(itemsRaw[i][key]).length&&itemsRaw[i][key]["#text"])item[formattedKey]=itemsRaw[i][key]["#text"];else if(0===Object.keys(itemsRaw[i][key]).length)item[formattedKey]="";else if(Array.isArray(itemsRaw[key])||Object.keys(itemsRaw[i][key]).length>1){var newIt=[];newIt=utils.processResponseCollection(response[groupProp],itemProp,key,textName),"s"!==formattedKey.substr(formattedKey.length-1)?item[formattedKey+"s"]=newIt:item[formattedKey]=newIt}else{var newItemProp=Object.keys(itemsRaw[i][key])[0],newItems=[];newItems=utils.processResponseCollection(itemsRaw[i],key,newItemProp),item[formattedKey]=newItems}else"TRUE"===itemsRaw[i][key].toUpperCase()?item[formattedKey]=!0:"FALSE"===itemsRaw[i][key].toUpperCase()?item[formattedKey]=!1:item[formattedKey]=itemsRaw[i][key];items.push(item),item={}}else{var formattedProp="";for(var prop in itemsRaw)if(prop.match(/^#/)?formattedProp=textName:(formattedProp=prop.replace(/@/,""),formattedProp=formattedProp.replace(/_([a-z])/g,function(g){return g[1].toUpperCase()})),"object"==typeof itemsRaw[prop])if(itemsRaw[prop]["#text"]&&1===Object.keys(itemsRaw[prop]).length)item[formattedProp]=itemsRaw[prop]["#text"];else if(0===Object.keys(itemsRaw[prop]).length)item[formattedProp]="";else if(Array.isArray(itemsRaw[prop])||Object.keys(itemsRaw[prop]).length>1){var newIt=[];newIt=utils.processResponseCollection(response[groupProp],itemProp,prop,textName),"s"!==formattedProp.substr(formattedProp.length-1)?item[formattedProp+"s"]=newIt:item[formattedProp]=newIt}else{var newProp=Object.keys(itemsRaw[prop])[0],newItms=[];newItms=utils.processResponseCollection(itemsRaw,prop,newProp),item[formattedProp]=newItms}else"TRUE"===itemsRaw[prop].toUpperCase()?item[formattedProp]=!0:"FALSE"===itemsRaw[prop].toUpperCase()?item[formattedProp]=!1:item[formattedProp]=itemsRaw[prop];items.push(item)}return items},fireCallback:function(instance,type,response){response=response||"","undefined"!=typeof type&&"function"==typeof instance.callbacks[type]&&instance.callbacks[type].call(instance,response)},setCallback:function(instance,type,callback){"undefined"!=typeof type&&"undefined"!=typeof callback&&(instance.callbacks[type]=callback)},getMessageId:function(){function s4(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return s4()+s4()+"-"+s4()+"-"+s4()+"-"+s4()+"-"+s4()+s4()+s4()},checkExistingIds:function(objArray,idArray,idProperty){for(var availIds=[],removeIds=[],o=0;o<objArray.length;o++)availIds.push(parseInt(objArray[o][idProperty],10));for(var i=0;i<idArray.length;i++)-1===availIds.indexOf(parseInt(idArray[i],10))&&removeIds.push(parseInt(idArray[i],10));for(var r=idArray.length-1;r>=0;r--)removeIds.indexOf(parseInt(idArray[r],10))>-1&&idArray.splice(r,1);return idArray},findObjById:function(objArray,id,propName){for(var o=0;o<objArray.length;o++){var obj=objArray[o];if(obj[propName]===id)return obj}return null},validateDest:function(dialDest){var isValid=!1,isNum=/^\d+$/.test(dialDest);return isNum&&10===dialDest.length?isValid=!0:"sip:"===dialDest.slice(0,4).toLowerCase()&&-1!==dialDest.indexOf("@")&&(isValid=!0),isValid},findCallbackBasedOnMessageType:function(messageType){var callbackFnName="";for(var key in MESSAGE_TYPES)MESSAGE_TYPES[key]===messageType&&(callbackFnName=CALLBACK_TYPES[key]);return callbackFnName},buildDefaultResponse:function(response){var message="",detail="",status="",msg="",det="",stat="";return response.ui_response?(msg=response.ui_response.message,det=response.ui_response.detail,stat=response.ui_response.status):response.ui_notification&&(msg=response.ui_notification.message,det=response.ui_notification.detail,stat=response.ui_notification.status),msg&&(message=msg["#text"]||""),det&&(detail=det["#text"]||""),stat&&(status=stat["#text"]||""),{message:message,detail:detail,status:status}},toString:function(val){return val?val.toString():""},getText:function(obj,prop){var o=obj[prop];return o&&o["#text"]?"TRUE"===o["#text"].toUpperCase()?!0:"FALSE"===o["#text"].toUpperCase()?!1:o["#text"]||"":""},getAttribute:function(obj,prop){var o=obj[prop];return o&&o[prop]?"TRUE"===o[prop].toUpperCase()?!0:"FALSE"===o[prop].toUpperCase()?!1:o[prop]||"":""},parseKeyValuePairsFromString:function(str,outerDelimiter,innerDelimiter){if(!str)return[];var arr=str.split(outerDelimiter).reduce(function(dict,pair){var keyValue=pair.split(innerDelimiter);return dict[keyValue[0]]=keyValue[1],dict},{});return arr},findRequestById:function(instance,id){for(var request=null,i=0;i<instance._requests.length;i++)if(instance._requests[i].id===id){request=instance._requests[i];break}return request},sendPingCallMessage:function(){UIModel.getInstance().pingCallRequest=new PingCallRequest;var msg=UIModel.getInstance().pingCallRequest.formatJSON(),msgObj=JSON.parse(msg),agentId=utils.getText(msgObj.ui_request,"agent_id"),uii=utils.getText(msgObj.ui_request,"uii");""===agentId||""===uii?utils.logMessage(LOG_LEVELS.WARN,"PING-CALL message failed, agentId or UII is empty",msgObj):utils.sendMessage(UIModel.getInstance().libraryInstance,msg)},sendStatsRequestMessage:function(){UIModel.getInstance().statsRequest=new StatsRequest;var msg=UIModel.getInstance().statsRequest.formatJSON();utils.sendMessage(UIModel.getInstance().libraryInstance,msg)},onAgentDailyStats:function(){if(0!==Object.keys(UIModel.getInstance().agentDailyStats).length){var agentSettings=UIModel.getInstance().agentSettings,stats=UIModel.getInstance().agentDailyStats,curLoginTime=stats.totalLoginTime;if(stats.totalLoginTime=Number(curLoginTime)+1,agentSettings.isOffhook){var curOffhookTime=stats.totalOffhookTime;stats.totalOffhookTime=Number(curOffhookTime)+1}if("ENGAGED"==agentSettings.currentState){var curTalkTime=stats.totalTalkTime;stats.totalTalkTime=Number(curTalkTime)+1;var curCallTime=stats.currCallTime;stats.currCallTime=Number(curCallTime)+1}}}};const LOG_LEVELS={DEBUG:"debug",STATS:"stats",INFO:"info",WARN:"warn",ERROR:"error"},CALLBACK_TYPES={ADD_SESSION:"addSessionNotification",AGENT_STATE:"agentStateResponse",ACK:"acknowledgeResponse",BARGE_IN:"bargeInResponse",CLOSE_SOCKET:"closeResponse",COACH_CALL:"coachResponse",CONFIG:"configureResponse",CALL_NOTES:"callNotesResponse",CALLBACK_PENDING:"callbacksPendingResponse",CALLBACK_CANCEL:"callbackCancelResponse",CAMPAIGN_DISPOSITIONS:"campaignDispositionsResponse",CHAT:"chatResponse",CHAT_ACTIVE:"chatActiveNotification",CHAT_CANCELLED:"chatCancelledNotification",CHAT_INACTIVE:"chatInactiveNotification",CHAT_PRESENTED:"chatPresentedNotification",CHAT_TYPING:"chatTypingNotification",CHAT_MESSAGE:"chatMessageNotification",CHAT_NEW:"chatNewNotification",CHAT_ROOM_STATE:"chatRoomStateResponse",DIAL_GROUP_CHANGE:"dialGroupChangeNotification",DIAL_GROUP_CHANGE_PENDING:"dialGroupChangePendingNotification",DROP_SESSION:"dropSessionNotification",EARLY_UII:"earlyUiiNotification",END_CALL:"endCallNotification",GATES_CHANGE:"gatesChangeNotification",GENERIC_NOTIFICATION:"genericNotification",GENERIC_RESPONSE:"genericResponse",HOLD:"holdResponse",LOG_RESULTS:"logResultsResponse",LOGIN:"loginResponse",LOGOUT:"logoutResponse",NEW_CALL:"newCallNotification",LEAD_HISTORY:"leadHistoryResponse",LEAD_INSERT:"leadInsertResponse",LEAD_SEARCH:"leadSearchResponse",LEAD_UPDATE:"leadUpdateResponse",OFFHOOK_INIT:"offhookInitResponse",OFFHOOK_TERM:"offhookTermNotification",OPEN_SOCKET:"openResponse",PAUSE_RECORD:"pauseRecordResponse",PENDING_DISP:"pendingDispNotification",PREVIEW_FETCH:"previewFetchResponse",PREVIEW_LEAD_STATE:"previewLeadStateNotification",RECORD:"recordResponse",REQUEUE:"requeueResponse",REVERSE_MATCH:"reverseMatchNotification",SAFE_MODE_FETCH:"safeModeFetchResponse",SAFE_MODE_SEARCH:"safeModeSearchResponse",SCRIPT_CONFIG:"scriptConfigResponse",SILENT_MONITOR:"monitorResponse",STATS_AGENT:"agentStats",STATS_AGENT_DAILY:"agentDailyStats",STATS_CAMPAIGN:"campaignStats",STATS_QUEUE:"queueStats",STATS_CHAT_QUEUE:"chatQueueStats",SUPERVISOR_LIST:"supervisorListResponse",TCPA_SAFE_LEAD_STATE:"tcpaSafeLeadStateNotification",XFER_COLD:"coldXferResponse",XFER_WARM:"warmXferResponse"},MESSAGE_TYPES={ACK:"ACK",ADD_SESSION:"ADD-SESSION",BARGE_IN:"BARGE-IN",AGENT_STATE:"AGENT-STATE",CALL_NOTES:"CALL-NOTES",CALLBACK_PENDING:"PENDING-CALLBACKS",CALLBACK_CANCEL:"CANCEL-CALLBACK",CAMPAIGN_DISPOSITIONS:"CAMPAIGN-DISPOSITIONS",CHAT_SEND:"CHAT",CHAT_ALIAS:"CHAT-ALIAS",CHAT_ROOM:"CHAT-ROOM",CHAT_ROOM_STATE:"CHAT-ROOM-STATE",CHAT_ACTIVE:"CHAT-ACTIVE",CHAT_CANCELLED:"CHAT-CANCELLED",CHAT_INACTIVE:"CHAT-INACTIVE",CHAT_DISPOSITION:"CHAT-DISPOSITION",CHAT_MESSAGE:"CHAT-MESSAGE",CHAT_NEW:"NEW-CHAT",CHAT_PRESENTED:"CHAT-PRESENTED",CHAT_PRESENTED_RESPONSE:"CHAT-PRESENTED-RESPONSE",CHAT_REQUEUE:"CHAT-REQUEUE",CHAT_TYPING:"CHAT-TYPING",MONITOR_CHAT:"CHAT-MONITOR",LEAVE_CHAT:"CHAT-DROP-SESSION",CHAT_LIST:"CHAT-LIST",CHAT_AGENT_END:"CHAT-END",DIAL_GROUP_CHANGE:"DIAL_GROUP_CHANGE",DIAL_GROUP_CHANGE_PENDING:"DIAL_GROUP_CHANGE_PENDING",DROP_SESSION:"DROP-SESSION",EARLY_UII:"EARLY_UII",END_CALL:"END-CALL",GATES_CHANGE:"GATES_CHANGE",GENERIC:"GENERIC",HANGUP:"HANGUP",HOLD:"HOLD",INBOUND_DISPOSITION:"INBOUND-DISPOSITION",LEAD_HISTORY:"LEAD-HISTORY",LEAD_INSERT:"LEAD-INSERT",LEAD_UPDATE:"LEAD-UPDATE",LOGIN:"LOGIN",LOGOUT:"LOGOUT",NEW_CALL:"NEW-CALL",OFFHOOK_INIT:"OFF-HOOK-INIT",OFFHOOK_TERM:"OFF-HOOK-TERM",ON_MESSAGE:"ON-MESSAGE",ONE_TO_ONE_OUTDIAL:"ONE-TO-ONE-OUTDIAL",ONE_TO_ONE_OUTDIAL_CANCEL:"ONE-TO-ONE-OUTDIAL-CANCEL",OUTDIAL_DISPOSITION:"OUTDIAL-DISPOSITION",PAUSE_RECORD:"PAUSE-RECORD",PING_CALL:"PING-CALL",PREVIEW_DIAL:"PREVIEW-DIAL",PENDING_DISP:"PENDING_DISP",PREVIEW_DIAL_ID:"PREVIEW_DIAL",PREVIEW_LEAD_STATE:"PREVIEW-LEAD-STATE",RECORD:"RECORD",REQUEUE:"RE-QUEUE",REVERSE_MATCH:"REVERSE_MATCH",SCRIPT_CONFIG:"SCRIPT-CONFIG",SCRIPT_RESULT:"SCRIPT-RESULT",STATS:"STATS",STATS_AGENT:"AGENT",STATS_AGENT_DAILY:"AGENTDAILY",STATS_CAMPAIGN:"CAMPAIGN",STATS_QUEUE:"GATE",STATS_CHAT:"CHAT",SUPERVISOR_LIST:"SUPERVISOR-LIST",TCPA_SAFE:"TCPA-SAFE",TCPA_SAFE_ID:"TCPA_SAFE",TCPA_SAFE_LEAD_STATE:"TCPA-SAFE-LEAD-STATE",XFER_COLD:"COLD-XFER",XFER_WARM:"WARM-XFER",XFER_WARM_CANCEL:"WARM-XFER-CANCEL"};var initAgentLibrary=function(context){return initAgentLibraryCore(context),initAgentLibrarySocket(context),initAgentLibraryAgent(context),initAgentLibraryCall(context),initAgentLibraryLead(context),initAgentLibraryChat(context),initAgentLibraryLogger(context),context.AgentLibrary};"function"==typeof define&&define.amd?define(function(){return initAgentLibrary({})}):"object"==typeof module&&module.exports?module.exports=initAgentLibrary(this):initAgentLibrary(this)}(this);