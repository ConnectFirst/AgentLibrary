/*! cf-agent-library - v0.0.0 - 2016-09-13 - Connect First */
!function(a){function b(a,b){var d=_.getInstance(),e={};if(c(b.queue)){var f=[];if(a.generic_key_value_pairs){var g=aa.getText(a,"generic_key_value_pairs");g.length>0&&(f=util.parseKeyValuePairsFromString(g,"|","::"))}for(var h in f)e[h]=f[h]}e.ani=b.ani,e.dnis=b.dnis,e.uii=b.uii;try{b.queue.number?(e.source_id=b.number||"",e.source_name=b.name||"",e.source_desc=b.description||"","0"===b.queue.isCampaign?e.source_type="INBOUND":e.source_type="OUTBOUND"):(e.source_id="0",e.source_type="MANUAL",e.source_name="",e.source_desc="")}catch(i){console.error("There was an error processing source tokenization",+i)}try{e.agent_first_name=d.agentSettings.firstName,e.agent_last_name=d.agentSettings.lastName,e.agent_external_id=d.agentSettings.externalAgentId,e.agent_extern_id=d.agentSettings.externalAgentId,e.agent_type=d.agentSettings.agentType}catch(i){console.error("There was an error parsing tokens for agent info. ",i)}if(a.baggage)try{e.lead_id=b.baggage.leadId||"",e.extern_id=b.baggage.externId||"",e.first_name=b.baggage.firstName||"",e.mid_name=b.baggage.midName||"",e.last_name=b.baggage.lastName||"",e.address1=b.baggage.address1||"",e.address2=b.baggage.address2||"",e.suffix=b.baggage.suffix||"",e.title=b.baggage.title||"",e.city=b.baggage.city||"",e.state=b.baggage.state||"",e.zip=b.baggage.zip||"",e.aux_data1=b.baggage.auxData1||"",e.aux_data2=b.baggage.auxData2||"",e.aux_data3=b.baggage.auxData3||"",e.aux_data4=b.baggage.auxData4||"",e.aux_data5=b.baggage.auxData5||"",e.aux_phone=b.baggage.auxPhone||"",e.email=b.baggage.email||"",e.gate_keeper=b.baggage.gateKeeper||""}catch(i){console.error("There was an error parsing baggage tokens. ",i)}else e.lead_id="",e.extern_id="",e.first_name="",e.mid_name="",e.last_name="",e.address1="",e.address2="",e.suffix="",e.title="",e.city="",e.state="",e.zip="",e.aux_data1="",e.aux_data2="",e.aux_data3="",e.aux_data4="",e.aux_data5="",e.aux_phone="",e.email="",e.gate_keeper="";return e}function c(a){return a&&a.isCampaign?"1"===a.isCampaign:!1}function d(a){var b={auxData1:a["@aux_data1"],auxData2:a["@aux_data2"],auxData3:a["@aux_data3"],auxData4:a["@aux_data4"],auxData5:a["@aux_data5"],destination:a["@destination"],dialGroupId:a["@dial_group_id"],dialGroupName:a["@dial_group_name"],dialTime:a["@dial_time"],externId:a["@extern_id"],leadId:a["@lead_id"],firstName:aa.getText(a,"first_name"),midName:aa.getText(a,"mid_name"),lastName:aa.getText(a,"last_name"),sufix:aa.getText(a,"suffix"),title:aa.getText(a,"title"),address1:aa.getText(a,"address1"),address2:aa.getText(a,"address2"),city:aa.getText(a,"city"),state:aa.getText(a,"state"),zip:aa.getText(a,"zip"),gateKeeper:aa.getText(a,"gate_keeper")};return b}function e(a){for(var b=_.getInstance(),c=b.outboundSettings.availableOutdialGroups,d=0;d<c.length;d++){var e=c[d];e.dialGroupId===a.ui_response.outdial_group_id["#text"]&&(b.agentPermissions.allowLeadSearch=e.allowLeadSearch,b.agentPermissions.allowPreviewLeadFilters=e.allowPreviewLeadFilters,b.outboundSettings.outdialGroup=JSON.parse(JSON.stringify(e)),b.agentPermissions.requireFetchedLeadsCalled=e.requireFetchedLeadsCalled)}}function f(a){for(var b=_.getInstance(),c=b.inboundSettings.availableSkillProfiles,d=0;d<c.length;d++){var e=c[d];e.skillProfileId===a.ui_response.skill_profile_id&&(b.inboundSettings.skillProfile=JSON.parse(JSON.stringify(e)))}}function g(a){var b=_.getInstance(),c=b.inboundSettings.availableQueues,d=[],e=[];if(a.ui_response.gates.gate_id)for(var f=0;f<a.ui_response.gates.gate_id.length;f++){var g=a.ui_response.gates.gate_id[f];d.push(g["#text"])}for(var h=0;h<c.length;h++){var i=c[h];d.indexOf(i.gateId)>-1&&e.push(i)}b.inboundSettings.queues=JSON.parse(JSON.stringify(e))}function h(a){var b=_.getInstance(),c=b.chatSettings.availableChatQueues,d=[],e=[];if(a.ui_response.chat_queues.chat_queue_id)for(var f=0;f<a.ui_response.chat_queues.chat_queue_id.length;f++){var g=a.ui_response.chat_queues.chat_queue_id[f];d.push(g["#text"])}for(var h=0;h<c.length;h++){var i=c[h];d.indexOf(i.chatQueueId)>-1&&e.push(i)}b.chatSettings.chatQueues=JSON.parse(JSON.stringify(e))}function i(a){"use strict";var b=a.AgentLibrary=function(a){return a=a||{},this.callbacks={},this._requests={},"undefined"!=typeof a.callbacks&&(this.callbacks=a.callbacks),"undefined"!=typeof a.socketDest&&(_.getInstance().applicationSettings.socketDest=a.socketDest,this.openSocket()),_.getInstance().libraryInstance=this,this};b.prototype.setCallbacks=function(a){for(var b in a)this.callbacks[b]=a[b]},b.prototype.setCallback=function(a,b){this.callbacks[a]=b},b.prototype.getCallbacks=function(){return this.callbacks},b.prototype.getCallback=function(a){return this.callbacks[a]},b.prototype.getLoginRequest=function(){return _.getInstance().loginRequest},b.prototype.getConfigRequest=function(){return _.getInstance().configRequest},b.prototype.getLogoutRequest=function(){return _.getInstance().logoutRequest},b.prototype.getAgentDailyStats=function(){return _.getInstance().agentDailyStats},b.prototype.getCallTokens=function(){return _.getInstance().callTokens},b.prototype.getAgentStateRequest=function(){return _.getInstance().agentStateRequest},b.prototype.getOffhookInitRequest=function(){return _.getInstance().offhookInitRequest},b.prototype.getOffhookTermRequest=function(){return _.getInstance().offhookTermRequest},b.prototype.getHangupRequest=function(){return _.getInstance().hangupRequest},b.prototype.getPreviewDialRequest=function(){return _.getInstance().previewDialRequest},b.prototype.getTcpaSafeRequest=function(){return _.getInstance().tcpaSafeRequest},b.prototype.getManualOutdialRequest=function(){return _.getInstance().oneToOneOutdialRequest},b.prototype.getManualOutdialCancelRequest=function(){return _.getInstance().oneToOneOutdialCancelRequest},b.prototype.getCallNotesRequest=function(){return _.getInstance().callNotesRequest},b.prototype.getCampaignDispositionsRequest=function(){return _.getInstance().campaignDispositionsRequest},b.prototype.getDispositionRequest=function(){return _.getInstance().dispositionRequest},b.prototype.getDispositionManualPassRequest=function(){return _.getInstance().dispositionManualPassRequest},b.prototype.getWarmTransferRequest=function(){return _.getInstance().warmXferRequest},b.prototype.getColdTransferRequest=function(){return _.getInstance().coldXferRequest},b.prototype.getWarmTransferCancelRequest=function(){return _.getInstance().warmXferCancelRequest},b.prototype.getRequeueRequest=function(){return _.getInstance().requeueRequest},b.prototype.getBargeInRequest=function(){return _.getInstance().bargeInRequest},b.prototype.getHoldRequest=function(){return _.getInstance().holdRequest},b.prototype.getPauseRecordRequest=function(){return _.getInstance().pauseRecordRequest},b.prototype.getRecordRequest=function(){return _.getInstance().recordRequest},b.prototype.getAgentStatsPacket=function(){return _.getInstance().agentStatsPacket},b.prototype.getAgentDailyStatsPacket=function(){return _.getInstance().agentDailyStatsPacket},b.prototype.getQueueStatsPacket=function(){return _.getInstance().queueStatsPacket},b.prototype.getCampaignStatsPacket=function(){return _.getInstance().campaignStatsPacket},b.prototype.getLoginPacket=function(){return _.getInstance().loginPacket},b.prototype.getConfigPacket=function(){return _.getInstance().configPacket},b.prototype.getAgentStatePacket=function(){return _.getInstance().agentStatePacket},b.prototype.getCurrentCallPacket=function(){return _.getInstance().currentCallPacket},b.prototype.getOffhookInitPacket=function(){return _.getInstance().offhookInitPacket},b.prototype.getOffhookTermPacket=function(){return _.getInstance().offhookTermPacket},b.prototype.getDialGroupChangeNotification=function(){return _.getInstance().dialGroupChangeNotification},b.prototype.getDialGroupChangePendingNotification=function(){return _.getInstance().dialGroupChangePendingNotification},b.prototype.getEndCallNotification=function(){return _.getInstance().endCallNotification},b.prototype.getGatesChangeNotification=function(){return _.getInstance().gatesChangeNotification},b.prototype.getGenericNotification=function(){return _.getInstance().genericNotification},b.prototype.getNewCallNotification=function(){return _.getInstance().newCallNotification},b.prototype.getCurrentCall=function(){return _.getInstance().currentCall},b.prototype.getAddSessionNotification=function(){return _.getInstance().addSessionNotification},b.prototype.getDropSessionNotification=function(){return _.getInstance().dropSessionNotification},b.prototype.getEarlyUiiNotification=function(){return _.getInstance().earlyUiiNotification},b.prototype.getApplicationSettings=function(){return _.getInstance().applicationSettings},b.prototype.getChatSettings=function(){return _.getInstance().chatSettings},b.prototype.getConnectionSettings=function(){return _.getInstance().connectionSettings},b.prototype.getInboundSettings=function(){return _.getInstance().inboundSettings},b.prototype.getOutboundSettings=function(){return _.getInstance().outboundSettings},b.prototype.getAgentSettings=function(){return _.getInstance().agentSettings},b.prototype.getAgentPermissions=function(){return _.getInstance().agentPermissions},b.prototype.getAgentStats=function(){return _.getInstance().agentStats},b.prototype.getAgentDailyStats=function(){return _.getInstance().agentDailyStats},b.prototype.getQueueStats=function(){return _.getInstance().queueStats},b.prototype.getCampaignStats=function(){return _.getInstance().campaignStats}}function j(a){"use strict";var b=a.AgentLibrary;b.prototype.openSocket=function(b){var c=this;aa.setCallback(c,ba.OPEN_SOCKET,b),"WebSocket"in a?(console.log("AgentLibrary: attempting to open socket connection..."),c.socket=new WebSocket(_.getInstance().applicationSettings.socketDest),c.socket.onopen=function(){_.getInstance().applicationSettings.socketConnected=!0,aa.fireCallback(c,ba.OPEN_SOCKET,"")},c.socket.onmessage=function(a){var b=JSON.parse(a.data);b.ui_response?aa.processResponse(c,b):b.ui_notification?aa.processNotification(c,b):b.dialer_request?aa.processDialerResponse(c,b):b.ui_stats&&aa.processStats(c,b)},c.socket.onclose=function(){aa.fireCallback(c,ba.CLOSE_SOCKET,""),_.getInstance().applicationSettings.socketConnected=!1,clearInterval(_.getInstance().statsIntervalId),_.getInstance().statsIntervalId=null}):console.warn("AgentLibrary: WebSocket NOT supported by your Browser.")},b.prototype.closeSocket=function(){this.socket.close()}}function k(a){"use strict";var b=a.AgentLibrary;b.prototype.loginAgent=function(a,b,c){_.getInstance().loginRequest=new H(a,b);var d=_.getInstance().loginRequest.formatJSON();aa.setCallback(this,ba.LOGIN,c),aa.sendMessage(this,d)},b.prototype.configureAgent=function(a,b,c,d,e,f,g){_.getInstance().configRequest=new C(a,b,c,d,e,f);var h=_.getInstance().configRequest.formatJSON();aa.setCallback(this,ba.CONFIG,g),aa.sendMessage(this,h)},b.prototype.logoutAgent=function(a,b){if(_.getInstance().logoutRequest=new I(a),aa.setCallback(this,ba.LOGOUT,b),_.getInstance().logoutRequest.isSupervisor){var c=_.getInstance().logoutRequest.formatJSON();aa.sendMessage(this,c)}else aa.fireCallback(this,ba.LOGOUT,""),this.closeSocket()},b.prototype.setAgentState=function(a,b,c){_.getInstance().agentStateRequest=new v(a,b);var d=_.getInstance().agentStateRequest.formatJSON();aa.setCallback(this,ba.AGENT_STATE,c),aa.sendMessage(this,d)},b.prototype.offhookInit=function(a){_.getInstance().offhookInitRequest=new J;var b=_.getInstance().offhookInitRequest.formatJSON();aa.setCallback(this,ba.OFFHOOK_INIT,a),aa.sendMessage(this,b)},b.prototype.offhookTerm=function(a){_.getInstance().offhookTermRequest=new K;var b=_.getInstance().offhookTermRequest.formatJSON();aa.setCallback(this,ba.OFFHOOK_TERM,a),aa.sendMessage(this,b)},b.prototype.getPendingCallbacks=function(a,b){_.getInstance().callbacksPendingRequest=new z(a);var c=_.getInstance().callbacksPendingRequest.formatJSON();aa.setCallback(this,ba.CALLBACK_PENDING,b),aa.sendMessage(this,c)},b.prototype.cancelCallback=function(a,b,c){_.getInstance().callbackCancelRequest=new y(a,b);var d=_.getInstance().callbackCancelRequest.formatJSON();aa.setCallback(this,ba.CALLBACK_CANCEL,c),aa.sendMessage(this,d)},b.prototype.requestStats=function(){_.getInstance().statsIntervalId=setInterval(aa.sendStatsRequestMessage,5e3)},b.prototype.reconnect=function(){_.getInstance().reconnectRequest=new Q;_.getInstance().reconnectRequest.formatJSON();_.getInstance().statsIntervalId=setInterval(aa.sendStatsRequestMessage,5e3)}}function l(a){"use strict";var b=a.AgentLibrary;b.prototype.bargeIn=function(a){_.getInstance().bargeInRequest=new w("FULL");var b=_.getInstance().bargeInRequest.formatJSON();aa.setCallback(this,ba.BARGE_IN,a),aa.sendMessage(this,b)},b.prototype.coach=function(a){_.getInstance().bargeInRequest=new w("COACHING");var b=_.getInstance().bargeInRequest.formatJSON();aa.setCallback(this,ba.COACH_CALL,a),aa.sendMessage(this,b)},b.prototype.coldXfer=function(a,b,c){_.getInstance().coldXferRequest=new B(a,b);var d=_.getInstance().coldXferRequest.formatJSON();aa.setCallback(this,ba.XFER_COLD,c),aa.sendMessage(this,d)},b.prototype.dispositionCall=function(a,b,c,d,e,f,g){_.getInstance().dispositionRequest=new D(a,b,c,d,e,f,g);var h=_.getInstance().dispositionRequest.formatJSON();aa.sendMessage(this,h),clearInterval(_.getInstance().pingIntervalId),_.getInstance().pingIntervalId=null},b.prototype.dispositionManualPass=function(a,b,c,d,e,f,g){_.getInstance().dispositionManualPassRequest=new E(a,b,c,d,e,f,g);var h=_.getInstance().dispositionManualPassRequest.formatJSON();aa.sendMessage(this,h)},b.prototype.getCampaignDispositions=function(a,b){_.getInstance().campaignDispositionsRequest=new A(a);var c=_.getInstance().campaignDispositionsRequest.formatJSON();aa.setCallback(this,ba.CAMPAIGN_DISPOSITIONS,b),aa.sendMessage(this,c)},b.prototype.hangup=function(a){_.getInstance().hangupRequest=new F(a);var b=_.getInstance().hangupRequest.formatJSON();aa.sendMessage(this,b)},b.prototype.hold=function(a,b){_.getInstance().holdRequest=new G(a);var c=_.getInstance().holdRequest.formatJSON();aa.setCallback(this,ba.HOLD,b),aa.sendMessage(this,c)},b.prototype.manualOutdial=function(a,b,c,d,e){_.getInstance().oneToOneOutdialRequest=new L(a,b,c,d,e);var f=_.getInstance().oneToOneOutdialRequest.formatJSON();aa.sendMessage(this,f)},b.prototype.manualOutdialCancel=function(a){_.getInstance().oneToOneOutdialCancelRequest=new M(a);var b=_.getInstance().oneToOneOutdialCancelRequest.formatJSON();aa.sendMessage(this,b)},b.prototype.pauseRecord=function(a,b){_.getInstance().pauseRecordRequest=new N(a);var c=_.getInstance().pauseRecordRequest.formatJSON();aa.setCallback(this,ba.PAUSE_RECORD,b),aa.sendMessage(this,c)},b.prototype.previewDial=function(a,b,c){_.getInstance().previewDialRequest=new P(a,b,c);var d=_.getInstance().previewDialRequest.formatJSON();aa.sendMessage(this,d)},b.prototype.setCallNotes=function(a,b){_.getInstance().callNotesRequest=new x(a);var c=_.getInstance().callNotesRequest.formatJSON();aa.setCallback(this,ba.CALL_NOTES,b),aa.sendMessage(this,c)},b.prototype.monitor=function(a){_.getInstance().bargeInRequest=new w("MUTE");var b=_.getInstance().bargeInRequest.formatJSON();aa.setCallback(this,ba.SILENT_MONITOR,a),aa.sendMessage(this,b)},b.prototype.record=function(a,b){_.getInstance().recordRequest=new R(a);var c=_.getInstance().recordRequest.formatJSON();aa.setCallback(this,ba.RECORD,b),aa.sendMessage(this,c)},b.prototype.requeueCall=function(a,b,c,d){_.getInstance().requeueRequest=new S(a,b,c);var e=_.getInstance().requeueRequest.formatJSON();aa.setCallback(this,ba.REQUEUE,d),aa.sendMessage(this,e)},b.prototype.tcpaSafeCall=function(a,b,c){_.getInstance().tcpaSafeRequest=new U(a,b,c);var d=_.getInstance().tcpaSafeRequest.formatJSON();aa.sendMessage(this,d)},b.prototype.warmXfer=function(a,b,c){_.getInstance().warmXferRequest=new V(a,b);var d=_.getInstance().warmXferRequest.formatJSON();aa.setCallback(this,ba.XFER_WARM,c),aa.sendMessage(this,d)},b.prototype.warmXferCancel=function(a){_.getInstance().warmXferCancelRequest=new W(a);var b=_.getInstance().warmXferCancelRequest.formatJSON();aa.sendMessage(this,b)}}var m=function(){};m.prototype.processResponse=function(a){var b=aa.buildDefaultResponse(a),c=_.getInstance(),d=a.ui_notification,e=aa.getText(d,"agent_id");return"AGENT"===aa.getText(d,"session_type")&&c.incrementTotalCalls(),e===c.agentSettings.agentId?c.currentCall.sessionId=aa.getText(d,"session_id"):""!=e&&(c.currentCall.monitorAgentId=e),"OUTBOUND"===aa.getText(d,"session_type")&&""===e&&aa.getText(d,"allow_control")===!0&&(c.transferSessions[aa.getText(d,"session_id")]={sessionId:aa.getText(d,"session_id"),destination:aa.getText(d,"phone"),uii:aa.getText(d,"uii")}),b.status="OK",b.message="Received ADD-SESSION notification",b.sessionId=aa.getText(d,"session_id"),b.uii=aa.getText(d,"uii"),b.phone=aa.getText(d,"phone"),b.sessionType=aa.getText(d,"session_type"),b.sessionLabel=aa.getText(d,"session_label"),b.allowControl=aa.getText(d,"allow_control"),b.monitoring=aa.getText(d,"monitoring"),b.agentId=aa.getText(d,"agent_id"),b};var n=function(){};n.prototype.processResponse=function(a){var b=_.getInstance(),c=a.ui_notification,d=b.configRequest.loginType,e=aa.getText(c,"dial_group_id");b.dialGroupChangeNotification=a,!e||""===e||"INBOUND"!==d&&"BLENDED"!==d?e&&""!==e?b.configRequest.loginType="OUTBOUND":"INBOUND"===d?b.configRequest.loginType="INBOUND":b.configRequest.loginType="NO-SELECTION":b.configRequest.loginType="BLENDED",_.getInstance().configRequest.dialGroupId=e;var f={message:"Dial Group Updated Successfully.",detail:"Dial Group changed to ["+e+"].",dialGroupId:aa.getText(c,"dial_group_id"),dialGroupName:aa.getText(c,"dialGroupName"),dialGroupDesc:aa.getText(c,"dial_group_desc"),agentId:aa.getText(c,"agent_id")};return f};var o=function(){};o.prototype.processResponse=function(a){var b=_.getInstance(),c=a.ui_notification;b.agentSettings.pendingDialGroupChange=parseInt(aa.getText(c,"dial_group_id"),10),c.update_from_adminui?b.agentSettings.updateDGFromAdminUI=aa.getText(c,"update_from_adminui")===!0:b.agentSettings.updateDGFromAdminUI=!1;var d={message:"Dial Group Change Pending notification received.",detail:"DialGroup switch for existing session pending until active call ends.",agentId:aa.getText(c,"agent_id"),dialGroupId:aa.getText(c,"dial_group_id"),updateFromAdminUI:aa.getText(c,"update_from_adminui")};return d};var p=function(){};p.prototype.processResponse=function(a){var b=aa.buildDefaultResponse(a),c=a.ui_notification;return b.message="Received DROP-SESSION Notification",b.status="OK",b.sessionId=aa.getText(c,"session_id"),b.uii=aa.getText(c,"uii"),b};var q=function(){};q.prototype.processResponse=function(a){var b=aa.buildDefaultResponse(a),c=a.ui_notification;return b.message="Received EARLY_UII notification",b.status="OK",b.agentId=aa.getText(c,"agent_id"),b.uii=aa.getText(c,"uii"),b};var r=function(a){this.libInstance=a};r.prototype.processResponse=function(a){var b=_.getInstance(),c=a.ui_notification;b.endCallNotification=a,b.currentCall.duration=aa.getText(c,"call_duration"),b.currentCall.termParty=aa.getText(c,"term_party"),b.currentCall.termReason=aa.getText(c,"term_reason"),b.agentSettings.callState="CALL-ENDED",b.transferSessions={},(b.agentSettings.pendingDialGroupChange>0||-1==b.agentSettings.pendingDialGroupChange)&&(b.configRequest.dialGroupId=b.agentSettings.pendingDialGroupChange,this.libInstance.configureAgent(b.configRequest.queueIds,b.configRequest.chatIds,b.configRequest.skillProfileId,b.configRequest.dialGroupId,b.configRequest.dialDest,b.agentSettings.updateDGFromAdminUI),b.agentSettings.pendingDialGroupChange=0,b.agentSettings.updateDGFromAdminUI=!1);var d={message:"End Call Notification Received.",detail:"",uii:aa.getText(c,"uii"),sessionId:aa.getText(c,"session_id"),agentId:aa.getText(c,"agent_id"),callDts:aa.getText(c,"call_dts"),duration:b.currentCall.duration,termParty:b.currentCall.termParty,termReason:b.currentCall.termReason,recordingUrl:aa.getText(c,"recording_url"),dispositionTimeout:aa.getText(c,"disposition_timeout")};return d};var s=function(){};s.prototype.processResponse=function(a){var b=_.getInstance(),c=a.ui_notification,d=[],e=b.inboundSettings.availableQueues,f=aa.getText(c,"gate_ids");""!==f&&(f=f.split(","));for(var g=0;g<f.length;g++){var h=f[g],i=aa.findObjById(e,h,"gateId");if(i)d.push(i);else{var j={gateId:h,gateName:"",gateDesc:"",defaultDestOverride:"",isAgentSelectable:!1};d.push(j)}}b.inboundSettings.queues=JSON.parse(JSON.stringify(d));var k={agentId:aa.getText(c,"agent_id"),message:"Gates Change notification received.",queues:d};return k};var t=function(){};t.prototype.processResponse=function(a){var b=aa.buildDefaultResponse(a);return b.messageCode=aa.getText(a.ui_notification,"message_code"),b};var u=function(){};u.prototype.processResponse=function(a){var c=_.getInstance(),d=a.ui_notification,e={uii:aa.getText(d,"uii"),agentId:aa.getText(d,"agent_id"),dialDest:aa.getText(d,"dial_dest"),queueDts:aa.getText(d,"queue_dts"),queueTime:aa.getText(d,"queue_time"),ani:aa.getText(d,"ani"),dnis:aa.getText(d,"dnis"),callType:aa.getText(d,"call_type"),appUrl:aa.getText(d,"app_url"),isMonitoring:aa.getText(d,"is_monitoring"),allowHold:aa.getText(d,"allow_hold"),allowTransfer:aa.getText(d,"allow_transfer"),allowHangup:aa.getText(d,"allow_hangup"),allowRequeue:aa.getText(d,"allow_requeue"),allowEndCallForEveryone:aa.getText(d,"allow_endcallforeveryone"),surveyId:aa.getText(d,"survey_id"),surveyPopType:aa.getText(d,"survey_pop_type"),requeueType:aa.getText(d,"requeue_type")};if(e.queue=aa.processResponseCollection(a,"ui_notification","gate")[0],e.agentRecording=aa.processResponseCollection(a,"ui_notification","agent_recording","agentRecording")[0],e.outdialDispositions=aa.processResponseCollection(a,"ui_notification","outdial_dispositions","disposition")[0],e.baggage=aa.processResponseCollection(a,"ui_notification","baggage")[0],e.surveyResponse=aa.processResponseCollection(a,"ui_notification","survey_response","detail")[0],e.transferPhoneBook=aa.processResponseCollection(a,"ui_notification","transfer_phone_book")[0],e.queue.isCampaign="1"===e.queue.isCampaign,e.outdialDispositions&&e.outdialDispositions.type&&"GATE"===e.outdialDispositions.type.toUpperCase())for(var f=0;f<e.outdialDispositions.dispositions.length;f++){var g=e.outdialDispositions.dispositions[f];g.isComplete="1"===g.isComplete,g.requireNote="1"===g.requireNote,g.saveSurvey="1"===g.saveSurvey,g.xfer="1"===g.xfer}return c.callTokens=b(d,e),e.isMonitoring?c.agentSettings.callState="ACTIVE-MONITORING":(c.agentSettings.callState="ACTIVE",e.baggage&&""!=e.baggage.auxPhone&&(c.transferNumber=e.baggage.auxPhone)),c.agentDailyStats.currCallTime=0,c.currentCall=e,e};var v=function(a,b){"ON-BREAK"==a.toUpperCase()&&1==_.getInstance().onCall?(this.agentState="BREAK-AFTER-CALL",this.agentAuxState=""):(this.agentState=a.toUpperCase()||"",this.agentAuxState=b||"")};v.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ca.AGENT_STATE,"@message_id":aa.getMessageId(),response_to:"",agent_id:{"#text":_.getInstance().agentSettings.agentId},state:{"#text":this.agentState},agent_aux_state:{"#text":this.agentAuxState}}};return JSON.stringify(a)},v.prototype.processResponse=function(a){var b=a.ui_response,c=aa.getText(b,"status"),d=aa.getText(b,"prev_state"),e=aa.getText(b,"current_state"),f=aa.getText(b,"prev_aux_state"),g=aa.getText(b,"agent_aux_state"),h=_.getInstance(),i=aa.buildDefaultResponse(a);if(i.agentId=a.ui_response.agent_id["#text"]||"",i.previousState=d,i.currentState=e,i.previousAuxState=f,i.currentAuxState=g,"OK"==c){var j=d,k=e;f.length>0&&(j=f),g.length>0&&(k=g),console.log("AgentLibrary: Agent state changed from ["+j+"] to ["+k+"]"),h.agentSettings.currentState=e,h.agentSettings.currentStateLabel=g,h.agentStatePacket=a}else""===i.message&&(i.message="Unable to change agent state"),console.warn("AgentLibrary: Unable to change agent state "+i.detail);return i};var w=function(a){this.audioType=a||"FULL"};w.prototype.formatJSON=function(){var a=_.getInstance(),b={ui_request:{"@destination":"IQ","@type":ca.BARGE_IN,"@message_id":aa.getMessageId(),"@response_to":"",agent_id:{"#text":aa.toString(a.agentSettings.agentId)},uii:{"#text":aa.toString(a.currentCall.uii)},audio_state:{"#text":aa.toString(this.audioType)},monitor_agent_id:{"#text":aa.toString(a.currentCall.monitorAgentId)}}};return JSON.stringify(b)},w.prototype.processResponse=function(a){var b=a.ui_response,c=aa.buildDefaultResponse(a);return c.agentId=aa.getText(b,"agent_id"),c.uii=aa.getText(b,"uii"),"OK"===c.status?console.log("AgentLibrary: Barge-in successful.",c.message):console.warn("AgentLibrary: There was an error processing the Barge-In request. "+c.message+"\n"+c.detail),c};var x=function(a){this.notes=a};x.prototype.formatJSON=function(){var a=_.getInstance(),b={ui_request:{"@destination":"IQ","@message_id":aa.getMessageId(),response_to:"","@type":ca.CALL_NOTES,agent_id:{"#text":aa.toString(a.agentSettings.agentId)},uii:{"#text":aa.toString(a.currentCall.uii)},notes:{"#text":aa.toString(this.notes)}}};return JSON.stringify(b)},x.prototype.processResponse=function(a){var b=aa.buildDefaultResponse(a);return"OK"===b.status?(b.message="Call notes have been updated.",b.type="INFO_EVENT"):(b.type="ERROR_EVENT",b.message="Unable to update notes."),b};var y=function(a,b){this.agentId=b||_.getInstance().agentSettings.agentId,this.leadId=a};y.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ca.CALLBACK_CANCEL,"@message_id":aa.getMessageId(),response_to:"",agent_id:{"#text":this.agentId},lead_id:{"#text":this.leadId}}};return JSON.stringify(a)};var z=function(a){this.agentId=a||_.getInstance().agentSettings.agentId};z.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ca.CALLBACK_PENDING,"@message_id":aa.getMessageId(),response_to:"",agent_id:{"#text":this.agentId}}};return JSON.stringify(a)},z.prototype.processResponse=function(a){var b=a.ui_response.lead,c=[];if(Array.isArray(b))for(var e=0;e<b.length;e++){var f=b[e],g=d(f);c.push(g)}else b&&c.push(d(b));return _.getInstance().agentSettings.pendingCallbacks=JSON.parse(JSON.stringify(c)),_.getInstance().agentSettings.pendingCallbacks};var A=function(a){this.agentId=_.getInstance().agentSettings.agentId,this.campaignId=a};A.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ca.CAMPAIGN_DISPOSITIONS,"@message_id":aa.getMessageId(),response_to:"",agent_id:{"#text":aa.toString(this.agentId)},campaign_id:{"#text":aa.toString(this.campaignId)}}};return JSON.stringify(a)},A.prototype.processResponse=function(a){var b=a.ui_response,c=_.getInstance(),d=aa.processResponseCollection(b,"outdial_dispositions","disposition","disposition");return c.outboundSettings.campaignDispositions=d,d};var B=function(a,b){this.dialDest=a,this.callerId=b||""};B.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ca.XFER_COLD,"@message_id":aa.getMessageId(),"@response_to":"",agent_id:{"#text":_.getInstance().agentSettings.agentId},uii:{"#text":_.getInstance().currentCall.uii},dial_dest:{"#text":aa.toString(this.dialDest)},caller_id:{"#text":aa.toString(this.callerId)}}};return JSON.stringify(a)},B.prototype.processResponse=function(a){var b=a.ui_response,c=aa.buildDefaultResponse(a);return c.agentId=aa.getText(b,"agent_id"),c.uii=aa.getText(b,"uii"),c.sessionId=aa.getText(b,"session_id"),c.dialDest=aa.getText(b,"dial_dest"),"OK"===c.status?console.log("AgentLibrary: Cold Xfer to "+c.dialDest+" processed successfully."):console.warn("AgentLibrary: There was an error processing the Cold Xfer request. "+c.message+"\n"+c.detail),c};var C=function(a,b,c,d,e,f){this.queueIds=a||[],this.chatIds=b||[],this.skillPofileId=c||"",this.dialGroupId=d||"",this.dialDest=e||"",this.updateFromAdminUI=f||!1,this.loginType="NO-SELECTION",this.updateLogin=!1;var g=_.getInstance();this.queueIds=aa.checkExistingIds(g.inboundSettings.availableQueues,this.queueIds,"gateId"),this.chatIds=aa.checkExistingIds(g.chatSettings.availableChatQueues,this.chatIds,"chatQueueId"),this.skillPofileId=aa.checkExistingIds(g.inboundSettings.availableSkillProfiles,[this.skillPofileId],"profileId")[0]||"",this.dialGroupId=aa.checkExistingIds(g.outboundSettings.availableOutdialGroups,[this.dialGroupId],"dialGroupId")[0]||"",this.queueIds.length>0&&""!==this.dialGroupId?this.loginType="BLENDED":this.queueIds.length>0?this.loginType="INBOUND":""!==this.dialGroupId?this.loginType="OUTBOUND":this.loginType="NO-SELECTION",g.agentSettings.isLoggedIn&&(this.updateLogin=!0),aa.validateDest(this.dialDest)||console.error("AgentLibrary: dialDest must be a valid sip or 10-digit DID")};C.prototype.formatJSON=function(){for(var a={ui_request:{"@destination":"IQ","@type":ca.LOGIN,"@message_id":aa.getMessageId(),response_to:"",agent_id:{"#text":aa.toString(_.getInstance().agentSettings.agentId)},agent_pwd:{"#text":_.getInstance().loginRequest.password},dial_dest:{"#text":aa.toString(this.dialDest)},login_type:{"#text":this.loginType},update_login:{"#text":aa.toString(this.updateLogin)},outdial_group_id:{"#text":aa.toString(this.dialGroupId)},skill_profile_id:{"#text":aa.toString(this.skillPofileId)},update_from_adminui:{"#text":aa.toString(this.updateFromAdminUI)}}},b=[],c=0;c<this.queueIds.length;c++)""!==this.queueIds[c]&&b.push({"#text":aa.toString(this.queueIds[c])});b.length>0?a.ui_request.gates={gate_id:b}:a.ui_request.gates={};for(var d=[],c=0;c<this.chatIds.length;c++)""!==this.chatIds[c]&&d.push({"#text":aa.toString(this.chatIds[c])});return d.length>0?a.ui_request.chat_queues={chat_queue_id:d}:a.ui_request.chat_queues={},JSON.stringify(a)},C.prototype.processResponse=function(a){var b=a.ui_response,c=aa.getText(b,"status"),d=aa.getText(b,"detail"),i=_.getInstance(),j=aa.buildDefaultResponse(a);return"Logon Session Configuration Updated!"===d&&(i.agentSettings.updateLoginMode=!0),"SUCCESS"===c?(i.agentSettings.isLoggedIn?i.agentSettings.updateLoginMode?(i.agentSettings.dialDest=i.configRequest.dialDest,i.agentSettings.loginType=aa.getText(b,"login_type"),i.agentSettings.updateLoginMode=!1,i.agentPermissions.allowLeadSearch=!1,i.agentPermissions.requireFetchedLeadsCalled=!1,i.agentPermissions.allowPreviewLeadFilters=!1,e(a),g(a),h(a),f(a)):console.log("AgentLibrary: Processed a Layer 2 Reconnect Successfully"):(i.configPacket=a,i.connectionSettings.hashCode=aa.getText(b,"hash_code"),i.agentSettings.isLoggedIn=!0,i.agentSettings.loginDTS=new Date,i.connectionSettings.reconnect=!0,i.agentPermissions.allowLeadSearch=!1,i.agentSettings.dialDest=i.configRequest.dialDest,i.agentSettings.loginType=aa.getText(b,"login_type"),e(a),g(a),h(a),f(a)),j.agentSettings=i.agentSettings,j.agentPermissions=i.agentPermissions,j.applicationSettings=i.applicationSettings,j.chatSettings=i.chatSettings,j.connectionSettings=i.connectionSettings,j.inboundSettings=i.inboundSettings,j.outboundSettings=i.outboundSettings,j.surveySettings=i.surveySettings):(""===j.message&&(j.message="Agent configuration attempt failed (2nd layer login)"),console.warn("AgentLibrary: Layer 2 login failed!")),j};var D=function(a,b,c,d,e,f,g){this.uii=a,this.dispId=b,this.notes=c,this.callback=d,this.callbackDTS=e||"",this.contactForwardNumber=f||null,this.survey=g||null};D.prototype.formatJSON=function(){var a=_.getInstance(),b={ui_request:{"@destination":"IQ","@message_id":aa.getMessageId(),"@response_to":"","@type":ca.OUTDIAL_DISPOSITION,agent_id:{"#text":aa.toString(a.agentSettings.agentId)},session_id:{"#text":""},uii:{"#text":aa.toString(this.uii)},disposition_id:{"#text":aa.toString(this.dispId)},notes:{"#text":aa.toString(this.notes)},call_back:{"#text":this.callback===!0?"TRUE":"FALSE"},call_back_DTS:{"#text":aa.toString(this.callbackDTS)},contact_forwarding:{"#text":aa.toString(this.contactForwardNumber)}}};if(a.currentCall.outdialDispositions&&"GATE"===a.currentCall.outdialDispositions.type&&(b.ui_request["@type"]=ca.INBOUND_DISPOSITION),
a.currentCall.sessionId&&(b.ui_request.session_id={"#text":a.currentCall.sessionId}),null!==this.survey){for(var c=[],d=0;d<this.survey.length;d++){var e={"@extern_id":aa.toString(this.survey[d].externId),"@lead_update_column":aa.toString(this.survey[d].leadUpdateColumn),"#text":this.survey[d].label};c.push(e)}b.ui_request.survey={response:c}}return JSON.stringify(b)};var E=function(a,b,c,d,e,f,g){this.dispId=a,this.notes=b,this.callback=c,this.callbackDTS=d||"",this.leadId=e||null,this.requestKey=f||null,this.externId=g||null};E.prototype.formatJSON=function(){var a=_.getInstance(),b={ui_request:{"@destination":"IQ","@message_id":aa.getMessageId(),"@response_to":"","@type":ca.OUTDIAL_DISPOSITION,manual_disp:{"#text":"TRUE"},agent_id:{"#text":aa.toString(a.agentSettings.agentId)},request_key:{"#text":aa.toString(this.requestKey)},disposition_id:{"#text":aa.toString(this.dispId)},notes:{"#text":aa.toString(this.notes)},call_back:{"#text":this.callback===!0?"TRUE":"FALSE"},call_back_DTS:{"#text":aa.toString(this.callbackDTS)},lead_id:{"#text":aa.toString(this.leadId)},extern_id:{"#text":aa.toString(this.externId)},contact_forwarding:{"#text":"null"},session_id:{},uii:{}}};return JSON.stringify(b)};var F=function(a){this.sessionId=a||null};F.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ca.HANGUP,"@message_id":aa.getMessageId(),response_to:"",agent_id:{"#text":aa.toString(_.getInstance().agentSettings.agentId)},uii:{"#text":aa.toString(_.getInstance().currentCall.uii)},session_id:{"#text":aa.toString(null===this.sessionId?_.getInstance().currentCall.sessionId:this.sessionId)}}};return JSON.stringify(a)};var G=function(a){this.holdState=a};G.prototype.formatJSON=function(){var a=_.getInstance(),b={ui_request:{"@destination":"IQ","@type":ca.HOLD,"@message_id":aa.getMessageId(),"@response_to":"",agent_id:{"#text":aa.toString(a.currentCall.agentId)},uii:{"#text":aa.toString(a.currentCall.uii)},session_id:{"#text":"1"},hold_state:{"#text":this.holdState===!0?"ON":"OFF"}}};return JSON.stringify(b)},G.prototype.processResponse=function(a){var b=a.ui_response,c=aa.buildDefaultResponse(a),d="";return _.getInstance().currentCall.uii&&(d=_.getInstance().currentCall.uii),c.holdState="ON"===aa.getText(b,"hold_state"),c.sessionId=aa.getText(b,"session_id"),c.uii=aa.getText(b,"uii"),"OK"===c.status?c.uii===d?(""===c.message&&(c.message="Broadcasting new hold state of "+c.holdState),console.log("AgentLibrary: Broadcasting new hold state of "+c.holdState)):console.log("AgentLibrary: Hold Response is for a different call...discarding"):(""===c.message&&(c.message="Error processing HOLD request. "+ +c.message+"\n"+c.detail),console.warn("AgentLibrary: Error processing HOLD request. "+c.message+"\n"+c.detail)),c};var H=function(a,b){this.username=a,this.password=b};H.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IS","@type":ca.LOGIN,"@message_id":aa.getMessageId(),response_to:"",username:{"#text":this.username},password:{"#text":this.password}}};return JSON.stringify(a)},H.prototype.processResponse=function(a){var b=a.ui_response,c=b.status["#text"],d=_.getInstance(),e=aa.buildDefaultResponse(a);if("OK"===c){if(!d.isLoggedInIS){d.loginPacket=a,d.applicationSettings.isLoggedInIS=!0,d.applicationSettings.isTcpaSafeMode="1"===aa.getText(b,"tcpa_safe_mode"),d.chatSettings.alias=aa.getText(b,"first_name")+" "+aa.getText(b,"last_name"),d.agentSettings.loginDTS=new Date,d.agentSettings.maxBreakTime=aa.getText(b,"max_break_time"),d.agentSettings.maxLunchTime=aa.getText(b,"max_lunch_time"),d.agentSettings.firstName=aa.getText(b,"first_name"),d.agentSettings.lastName=aa.getText(b,"last_name"),d.agentSettings.email=aa.getText(b,"email"),d.agentSettings.agentId=aa.getText(b,"agent_id"),d.agentSettings.externalAgentId=aa.getText(b,"external_agent_id"),d.agentSettings.agentType=aa.getText(b,"agent_type"),d.agentSettings.realAgentType=aa.getText(b,"real_agent_type"),d.agentSettings.defaultLoginDest=aa.getText(b,"default_login_dest"),d.agentSettings.altDefaultLoginDest=aa.getText(b,"alt_default_login_dest"),d.agentSettings.disableSupervisorMonitoring=aa.getText(b,"disable_supervisor_monitoring"),d.agentSettings.initLoginState=aa.getText(b,"init_login_state"),d.agentSettings.initLoginStateLabel=aa.getText(b,"init_login_state_label"),d.agentSettings.outboundManualDefaultRingtime=aa.getText(b,"outbound_manual_default_ringtime"),d.agentSettings.isOutboundPrepay="1"===aa.getText(b,"outbound_prepay"),d.agentPermissions.allowCallControl="1"===aa.getText(b,"allow_call_control"),d.agentPermissions.allowChat="1"===aa.getText(b,"allow_chat"),d.agentPermissions.showLeadHistory="1"===aa.getText(b,"show_lead_history"),d.agentPermissions.allowManualOutboundGates="1"===aa.getText(b,"allow_manual_outbound_gates"),d.agentPermissions.allowOffHook="1"===aa.getText(b,"allow_off_hook"),d.agentPermissions.allowManualCalls="1"===aa.getText(b,"allow_manual_calls"),d.agentPermissions.allowManualPass="1"===aa.getText(b,"allow_manual_pass"),d.agentPermissions.allowManualIntlCalls="1"===aa.getText(b,"allow_manual_intl_calls"),d.agentPermissions.allowLoginUpdates="1"===aa.getText(b,"allow_login_updates"),d.agentPermissions.allowInbound="1"===aa.getText(b,"allow_inbound"),d.agentPermissions.allowOutbound="1"===aa.getText(b,"allow_outbound"),d.agentPermissions.allowBlended="1"===aa.getText(b,"allow_blended"),d.agentPermissions.allowLoginControl="1"===aa.getText(b,"allow_login_control"),d.agentPermissions.allowCrossQueueRequeue="1"===aa.getText(b,"allow_cross_gate_requeue");var f="undefined"==typeof b.insert_campaigns?!1:a.ui_response.insert_campaigns.campaign;f&&f.length>0&&(d.agentPermissions.allowLeadInserts=!0),processCampaigns(a),d.chatSettings.availableChatQueues=aa.processResponseCollection(a.ui_response,"login_chat_queues","chat_queue"),d.inboundSettings.availableQueues=aa.processResponseCollection(a.ui_response,"login_gates","gate"),d.inboundSettings.availableSkillProfiles=aa.processResponseCollection(a.ui_response,"skill_profiles","profile"),d.inboundSettings.availableRequeueQueues=aa.processResponseCollection(a.ui_response,"requeue_gates","gate_group"),d.chatSettings.availableChatRooms=aa.processResponseCollection(a.ui_response,"chat_rooms","room"),d.surveySettings.availableSurveys=aa.processResponseCollection(a.ui_response,"surveys","survey"),d.agentSettings.callerIds=aa.processResponseCollection(a.ui_response,"caller_ids","caller_id"),d.agentSettings.availableAgentStates=aa.processResponseCollection(a.ui_response,"agent_states","agent_state"),d.applicationSettings.availableCountries=aa.processResponseCollection(a.ui_response,"account_countries","country"),d.outboundSettings.insertCampaigns=aa.processResponseCollection(a.ui_response,"insert_campaigns","campaign");for(var g=aa.processResponseCollection(a.ui_response,"outdial_groups","group"),h=0;h<g.length;h++){var i=g[h];i.allowLeadSearch="YES"===i.allowLeadSearch,i.allowPreviewLeadFilters="1"===i.allowPreviewLeadFilters,i.progressiveEnabled="1"===i.progressiveEnabled,i.requireFetchedLeadsCalled="1"===i.requireFetchedLeadsCalled}d.outboundSettings.availableOutdialGroups=g}e.agentSettings=d.agentSettings,e.agentPermissions=d.agentPermissions,e.applicationSettings=d.applicationSettings,e.chatSettings=d.chatSettings,e.connectionSettings=d.connectionSettings,e.inboundSettings=d.inboundSettings,e.outboundSettings=d.outboundSettings,e.surveySettings=d.surveySettings}else"RESTRICTED"===c?(e.message="Invalid IP Address",console.log("AgentLibrary: Invalid IP Address")):(e.message="Invalid Username or password",console.log("AgentLibrary: Invalid Username or password"));return e},processCampaigns=function(a){var b=[],c={},d=[],e=[],f=[],g="",h=0,i="",j=!1;if("undefined"!=typeof a.ui_response.campaigns.campaign&&(d=a.ui_response.campaigns.campaign),Array.isArray(d))for(var k=0;k<d.length;k++){h=d[k]["@campaign_id"],i=d[k]["@campaign_name"],j="1"==d[k]["@allow_lead_updates"],e=d[k].custom_labels,f=[],g="",_.getInstance().agentPermissions.allowLeadUpdatesByCampaign[h]=j;for(var l in e){g=l.replace(/@/,"");var m={};m[g]=e[l],f.push(m)}c={allowLeadUpdates:j,campaignId:h,campaignName:i,surveyId:d[k]["@survey_id"],surveyName:d[k]["@survey_name"],customLabels:f},b.push(c)}else if(d){h=d["@campaign_id"],i=d["@campaign_name"],j="1"==d["@allow_lead_updates"],e=d.custom_labels,f=[],g="",_.getInstance().agentPermissions.allowLeadUpdatesByCampaign[h]=j;for(var n in e){g=n.replace(/@/,"");var m={};m[g]=e[n],f.push(m)}c={allowLeadUpdates:j,campaignId:h,campaignName:i,surveyId:d["@survey_id"],surveyName:d["@survey_name"],customLabels:f},b.push(c)}_.getInstance().outboundSettings.availableCampaigns=b};var I=function(a,b,c){this.agentId=a,this.message=b,this.isSupervisor=c};I.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ca.LOGOUT,"@message_id":aa.getMessageId(),response_to:"",agent_id:{"#text":this.agentId},message:{"#text":this.message}}};return JSON.stringify(a)};var J=function(){};J.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ca.OFFHOOK_INIT,"@message_id":aa.getMessageId(),response_to:"",agent_id:{"#text":_.getInstance().agentSettings.agentId},dial_dest:{"#text":_.getInstance().agentSettings.dialDest}}};return JSON.stringify(a)},J.prototype.processResponse=function(a){var b=a.ui_response.status["#text"],c=aa.buildDefaultResponse(a);return"OK"===b?(_.getInstance().offhookInitPacket=a,_.getInstance().agentSettings.isOffhook=!0):(""===c.message&&(c.message="Unable to process offhook request"),console.log("AgentLibrary: Unable to process offhook request ",c.detail)),c};var K=function(a){};K.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ca.OFFHOOK_TERM,"@message_id":aa.getMessageId(),response_to:"",agent_id:{"#text":_.getInstance().agentSettings.agentId}}};return JSON.stringify(a)},K.prototype.processResponse=function(a){var b=a.ui_notification,c="1"===aa.getText(b,"monitoring"),d=_.getInstance();d.agentSettings.wasMonitoring=c,d.offhookTermPacket=a,d.agentSettings.isOffhook=!1;var e={status:"OK",agentId:aa.getText(b,"agent_id"),startDts:aa.getText(b,"start_dts"),endDts:aa.getText(b,"end_dts"),monitoring:c};return e};var L=function(a,b,c,d,e){this.destination=a,this.ringTime=b||"60",this.callerId=c,this.countryId=d||"USA",this.gateId=e||""};L.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ca.ONE_TO_ONE_OUTDIAL,"@message_id":aa.getMessageId(),response_to:"",agent_id:{"#text":aa.toString(_.getInstance().agentSettings.agentId)},destination:{"#text":aa.toString(this.destination)},ring_time:{"#text":aa.toString(this.ringTime)},caller_id:{"#text":aa.toString(this.callerId)},country_id:{"#text":aa.toString(this.countryId)},gate_id:{"#text":aa.toString(this.gateId)}}};return JSON.stringify(a)};var M=function(a){this.uii=a};M.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ca.ONE_TO_ONE_OUTDIAL_CANCEL,"@message_id":aa.getMessageId(),response_to:"",agent_id:{"#text":aa.toString(_.getInstance().agentSettings.agentId)},uii:{"#text":aa.toString(this.uii)}}};return JSON.stringify(a)};var N=function(a){this.record=a};N.prototype.formatJSON=function(){var a=_.getInstance(),b="10";a.currentCall.agentRecording&&a.currentCall.agentRecording.pause&&(b=a.currentCall.agentRecording.pause);var c={ui_request:{"@destination":"IQ","@type":ca.PAUSE_RECORD,"@message_id":aa.getMessageId(),"@response_to":"",agent_id:{"#text":aa.toString(a.currentCall.agentId)},uii:{"#text":aa.toString(a.currentCall.uii)},record:{"#text":aa.toString(this.record===!0?"TRUE":"FALSE")},pause:{"#text":aa.toString(b)}}};return JSON.stringify(c)},N.prototype.processResponse=function(a){var b=a.ui_response,c=aa.buildDefaultResponse(a),d="";return _.getInstance().currentCall.uii&&(d=_.getInstance().currentCall.uii),c.uii=aa.getText(b,"uii"),c.state=aa.getText(b,"state"),c.pause=aa.getText(b,"pause"),"OK"===c.status?c.uii===d?(""===c.message&&(c.message="Broadcasting new record state of "+c.state),console.log("AgentLibrary: Broadcasting new record state of "+c.state)):console.log("AgentLibrary: Pause Record Response is for a different call...discarding"):(""===c.message&&(c.message="Error processing PAUSE-RECORD request."+c.message+"\n"+c.detail),console.warn("AgentLibrary: Error processing PAUSE-RECORD request. "+c.message+"\n"+c.detail)),c};var O=function(){};O.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ca.PING_CALL,"@message_id":aa.getMessageId(),"@response_to":"",agent_id:{"#text":_.getInstance().currentCall.agentId},uii:{"#text":_.getInstance().currentCall.uii}}};return JSON.stringify(a)};var P=function(a,b,c){this.agentId=_.getInstance().agentSettings.agentId,this.searchFields=b||[],this.requestId=c||"",this.action=a||""};P.prototype.formatJSON=function(){for(var a={},b=0;b<this.searchFields.length;b++){var c=this.searchFields[b];a[c.key]={"#text":aa.toString(c.value)}}var d={ui_request:{"@destination":"IQ","@type":ca.PREVIEW_DIAL,"@message_id":aa.getMessageId(),"@action":this.action,response_to:"",agent_id:{"#text":aa.toString(_.getInstance().agentSettings.agentId)},pending_request_id:{"#text":aa.toString(this.requestId)},search_fields:a}};return JSON.stringify(d)},P.prototype.processResponse=function(a){var b=a.dialer_request,c=_.getInstance(),d=aa.processResponseCollection(b,"destinations","lead"),e={dialGroupId:aa.getText(b,"dial_group_id"),accountId:aa.getText(b,"account_id"),agentId:aa.getText(b,"agent_id"),leads:d};if("TRUE"===b["@callbacks"]){console.log("AgentLibrary: New CALLBACK packet request rec'd from dialer");for(var f=0;f<d.length;f++){var g=d[f];c.callbacks.push(g)}}else console.log("AgentLibrary: New PREVIEW-DIAL packet rec'd from dialer"),c.outboundSettings.previewDialLeads=d;return e};var Q=function(){};Q.prototype.formatJSON=function(){var a=_.getInstance(),b=JSON.parse(a.loginRequest.formatJSON());return b.hash_code={"#text":a.hashCode},b.update_login={"#text":"FALSE"},b.reconnect={"#text":"TRUE"},JSON.stringify(b)};var R=function(a){this.record=a};R.prototype.formatJSON=function(){var a=_.getInstance(),b={ui_request:{"@destination":"IQ","@type":ca.RECORD,"@message_id":aa.getMessageId(),"@response_to":"",agent_id:{"#text":aa.toString(a.currentCall.agentId)},uii:{"#text":aa.toString(a.currentCall.uii)},record:{"#text":this.record===!0?"TRUE":"FALSE"}}};return JSON.stringify(b)},R.prototype.processResponse=function(a){var b=a.ui_response,c=aa.buildDefaultResponse(a),d="";return _.getInstance().currentCall.uii&&(d=_.getInstance().currentCall.uii),c.uii=aa.getText(b,"uii"),c.state=aa.getText(b,"state"),"OK"===c.status?c.uii===d?(""===c.message&&(c.message="Broadcasting new record state of "+c.state),console.log("AgentLibrary: Broadcasting new record state of "+c.state)):console.log("AgentLibrary: Record Response is for a different call...discarding"):(""===c.message&&(c.message="Error processing RECORD request."+c.message+"\n"+c.detail),console.warn("AgentLibrary: Error processing RECORD request. "+c.message+"\n"+c.detail)),c};var S=function(a,b,c){this.queueId=a,this.skillId=b,this.maintain=c};S.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ca.REQUEUE,"@message_id":aa.getMessageId(),response_to:"",agent_id:{"#text":_.getInstance().agentSettings.agentId},uii:{"#text":_.getInstance().currentCall.uii},gate_number:{"#text":aa.toString(this.queueId)},skill_id:{"#text":aa.toString(this.skillId)},maintain_agent:{"#text":this.maintain===!0?"TRUE":"FALSE"}}};return JSON.stringify(a)},S.prototype.processResponse=function(a){var b=a.ui_response,c=aa.buildDefaultResponse(a);return c.agentId=aa.getText(b,"agent_id"),c.uii=aa.getText(b,"uii"),c.queueId=aa.getText(b,"gate_number"),"OK"===c.status?console.log("AgentLibrary: Requeue successfull."):console.warn("AgentLibrary: There was an error processing the requeue request. "+c.message+"\n"+c.detail),c};var T=function(){};T.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IS","@type":ca.STATS,"@message_id":aa.getMessageId(),"@response_to":""}};return JSON.stringify(a)};var U=function(a,b,c){this.agentId=_.getInstance().agentSettings.agentId,this.searchFields=b||[],this.requestId=c||"",this.action=a||""};U.prototype.formatJSON=function(){for(var a={},b=0;b<this.searchFields.length;b++){var c=this.searchFields[b];a[c.key]={"#text":aa.toString(c.value)}}var d={ui_request:{"@destination":"IQ","@type":ca.TCPA_SAFE,"@message_id":aa.getMessageId(),"@action":this.action,response_to:"",agent_id:{"#text":aa.toString(_.getInstance().agentSettings.agentId)},pending_request_id:{"#text":aa.toString(this.requestId)},search_fields:a}};return JSON.stringify(d)},U.prototype.processResponse=function(a){var b=a.dialer_request,c=_.getInstance(),d=aa.processResponseCollection(b,"destinations","lead"),e={dialGroupId:aa.getText(b,"dial_group_id"),accountId:aa.getText(b,"account_id"),agentId:aa.getText(b,"agent_id"),leads:d};if("TRUE"===b["@callbacks"]){console.log("AgentLibrary: New CALLBACK packet request rec'd from dialer");for(var f=0;f<d.length;f++){var g=d[f];c.callbacks.push(g)}}else console.log("AgentLibrary: New TCPA_SAFE packet rec'd from dialer"),c.outboundSettings.tcpaSafeLeads=d;return e};var V=function(a,b){this.dialDest=a,this.callerId=b||""};V.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ca.XFER_WARM,"@message_id":aa.getMessageId(),"@response_to":"",agent_id:{"#text":_.getInstance().agentSettings.agentId},uii:{"#text":_.getInstance().currentCall.uii},dial_dest:{"#text":aa.toString(this.dialDest)},caller_id:{"#text":aa.toString(this.callerId)}}};return JSON.stringify(a)},V.prototype.processResponse=function(a){var b=a.ui_response,c=aa.buildDefaultResponse(a);return c.agentId=aa.getText(b,"agent_id"),c.uii=aa.getText(b,"uii"),c.sessionId=aa.getText(b,"session_id"),c.dialDest=aa.getText(b,"dial_dest"),"OK"===c.status?console.log("AgentLibrary: Warm Xfer to "+c.dialDest+" processed successfully."):console.warn("AgentLibrary: There was an error processing the Warm Xfer request. "+c.message+"\n"+c.detail),c};var W=function(a){this.dialDest=a};W.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":ca.XFER_WARM_CANCEL,"@message_id":aa.getMessageId(),"@response_to":"",agent_id:{"#text":_.getInstance().agentSettings.agentId},uii:{"#text":_.getInstance().currentCall.uii},dial_dest:{"#text":aa.toString(this.dialDest)}}};return JSON.stringify(a)};var X=function(){};X.prototype.processResponse=function(a){var b=a.ui_stats.agent,c={};return b&&(c={agentLoginType:b["@alt"],agentType:b["@atype"],avgTalkTime:b["@avgtt"],calls:b["@calls"],isDequeueAgent:b["@da"],defaultRoute:b["@droute"],firstName:b["@f"],queueDesc:b["@gdesc"],queueName:b["@gname"],agentId:b["@id"],lastName:b["@l"],loginDuration:b["@ldur"],loginType:b["@ltype"],offHook:b["@oh"],pendingDisp:b["@pd"],presented:b["@pres"],rna:b["@rna"],stateDuration:b["@sdur"],skillProfileName:b["@sp"],agentState:b["@state"],totalTalkTime:b["@ttt"],username:b["@u"],uii:b["@uii"],utilization:b["@util"]}),_.getInstance().agentStats=c,c};var Y=function(){};Y.prototype.processResponse=function(a){var b=a.ui_stats,c={agentId:aa.getText(b,"agent_id"),totalLoginSessions:aa.getText(b,"total_login_sessions"),totalCallsHandled:aa.getText(b,"total_calls_handled"),totalPreviewDials:aa.getText(b,"total_preview_dials"),totalManualDials:aa.getText(b,"total_manual_dials"),totalRna:aa.getText(b,"total_rna"),totalTalkTime:aa.getText(b,"total_talk_time"),totalOffhookTime:aa.getText(b,"total_offhook_time"),totalLoginTime:aa.getText(b,"total_login_time"),totalSuccessDispositions:aa.getText(b,"total_success_dispositions"),currCallTime:_.getInstance().agentDailyStats.currCallTime};return _.getInstance().agentDailyStats=c,c};var Z=function(){};Z.prototype.processResponse=function(a){var b=a.ui_stats,c=aa.processResponseCollection(a,"ui_stats","totals")[0],d=[];if(Array.isArray(b.campaign))for(var e=0;e<b.campaign.length;e++){var f=b.campaign[e],g={active:f["@a"],abandon:f["@aba"],answer:f["@an"],available:f["@av"],busy:f["@b"],complete:f["@c"],error:f["@e"],fax:f["@f"],campaignId:f["@id"],intercept:f["@int"],machine:f["@m"],noanswer:f["@na"],campaignName:f["@name"],pending:f["@p"],ready:f["@r"],staffed:f["@s"],totalConnects:f["@tc"],totalTalkTime:f["@ttt"]};d.push(g)}else{var f=b.campaign,g={active:f["@a"],abandon:f["@aba"],answer:f["@an"],available:f["@av"],busy:f["@b"],complete:f["@c"],error:f["@e"],fax:f["@f"],campaignId:f["@id"],intercept:f["@int"],machine:f["@m"],noanswer:f["@na"],campaignName:f["@name"],pending:f["@p"],ready:f["@r"],staffed:f["@s"],totalConnects:f["@tc"],totalTalkTime:f["@ttt"]};d.push(g)}var h={type:b["@type"],campaigns:d,totals:c};return _.getInstance().campaignStats=h,h};var $=function(){};$.prototype.processResponse=function(a){var b=a.ui_stats,c=aa.processResponseCollection(a,"ui_stats","totals")[0],d=[];if(Array.isArray(b.gate))for(var e=0;e<b.gate.length;e++){var f=b.gate[e],g={abandon:f["@aba"],active:f["@active"],answer:f["@ans"],asa:f["@asa"],available:f["@avail"],avgAbandon:f["@avga"],avgQueue:f["@avgq"],avgTalk:f["@avgt"],deflected:f["@def"],queueId:f["@id"],inQueue:f["@inq"],longCall:f["@long_c"],longestInQueue:f["@longq"],queueName:f["@name"],presented:f["@pres"],routing:f["@route"],shortAbandon:f["@short_aba"],shortCall:f["@short_c"],sla:f["@sla"],slaPass:f["@sla_p"],slaFail:f["@sla_f"],staffed:f["@staff"],tAbandonTime:f["@t_aba"],tQueueTime:f["@t_q"],tSpeedOfAnswer:f["@t_soa"],utilization:f["@util"]};d.push(g)}else{var f=b.gate,g={abandon:f["@aba"],active:f["@active"],answer:f["@ans"],asa:f["@asa"],available:f["@avail"],avgAbandon:f["@avga"],avgQueue:f["@avgq"],avgTalk:f["@avgt"],deflected:f["@def"],queueId:f["@id"],inQueue:f["@inq"],longCall:f["@long_c"],longestInQueue:f["@longq"],queueName:f["@name"],presented:f["@pres"],routing:f["@route"],shortAbandon:f["@short_aba"],shortCall:f["@short_c"],sla:f["@sla"],slaPass:f["@sla_p"],slaFail:f["@sla_f"],staffed:f["@staff"],tAbandonTime:f["@t_aba"],tQueueTime:f["@t_q"],tSpeedOfAnswer:f["@t_soa"],utilization:f["@util"]};d.push(g)}var h={type:b["@type"],queues:d,totals:c};return _.getInstance().queueStats=h,h};var _=function(){function a(){return{currentCall:{},callTokens:{},callbacks:[],libraryInstance:null,pingIntervalId:null,statsIntervalId:null,agentStateRequest:null,bargeInRequest:null,callNotesRequest:null,callbacksPendingRequest:null,campaignDispositionsRequest:null,configRequest:null,coldXferRequest:null,dispositionRequest:null,dispositionManualPassRequest:null,hangupRequest:null,holdRequest:null,logoutRequest:null,loginRequest:null,offhookInitRequest:null,offhookTermRequest:null,oneToOneOutdialRequest:null,oneToOneOutdialCancelRequest:null,pauseRecordRequest:null,pingCallRequest:null,previewDialRequest:null,reconnectRequest:null,recordRequest:null,requeueRequest:null,statsRequest:null,tcpaSafeRequest:null,warmXferRequest:null,warmXferCancelRequest:null,agentStatePacket:null,configPacket:null,currentCallPacket:null,loginPacket:null,offhookInitPacket:null,offhookTermPacket:null,transferSessions:{},addSessionNotification:new m,dialGroupChangeNotification:new n,dialGroupChangePendingNotification:new o,dropSessionNotification:new p,earlyUiiNotification:new q,endCallNotification:new r,gatesChangeNotification:new s,genericNotification:new t,newCallNotification:new u,agentStatsPacket:new X,agentDailyStatsPacket:new Y,queueStatsPacket:new $,campaignStatsPacket:new Z,applicationSettings:{availableCountries:[],isLoggedInIS:!1,socketConnected:!1,socketDest:"",isTcpaSafeMode:!1},agentStats:{},agentDailyStats:{totalLoginTime:0,totalOffhookTime:0,totalTalkTime:0,currCallTime:0},campaignStats:{},queueStats:{},agentSettings:{agentId:0,agentType:"AGENT",altDefaultLoginDest:"",availableAgentStates:[],callerIds:[],callState:null,currentState:"OFFLINE",currentStateLabel:"",defaultLoginDest:"",dialDest:"",email:"",externalAgentId:"",firstName:"",isLoggedIn:!1,isOffhook:!1,initLoginState:"AVAILABLE",initLoginStateLabel:"Available",isOutboundPrepay:!1,lastName:"",loginDTS:null,loginType:"NO-SELECTION",maxBreakTime:-1,maxLunchTime:-1,onCall:!1,outboundManualDefaultRingtime:"30",pendingCallbacks:[],pendingDialGroupChange:0,realAgentType:"AGENT",totalCalls:0,transferNumber:"",updateDGFromAdminUI:!1,updateLoginMode:!1,wasMonitoring:!1},agentPermissions:{allowBlended:!0,allowCallControl:!0,allowChat:!1,allowCrossQueueRequeue:!1,allowInbound:!0,allowLeadInserts:!1,allowLeadSearch:!1,allowLoginControl:!0,allowLoginUpdates:!0,allowManualCalls:!0,allowManualPass:!0,allowManualIntlCalls:!1,allowManualOutboundGates:!1,allowOffHook:!0,allowOutbound:!0,allowPreviewLeadFilters:!1,allowLeadUpdatesByCampaign:{},disableSupervisorMonitoring:!0,requireFetchedLeadsCalled:!1,showLeadHistory:!0},chatSettings:{availableChatQueues:[],availableChatRooms:[],chatQueues:[],alias:""},connectionSettings:{hashCode:null,reconnect:!1},inboundSettings:{availableQueues:[],availableSkillProfiles:[],queues:[],skillProfile:{}},outboundSettings:{availableCampaigns:[],availableOutdialGroups:[],insertCampaigns:[],outdialGroup:{},previewDialLeads:[],tcpaSafeLeads:[],campaignDispositions:[]},surveySettings:{availableSurveys:[]},incrementTotalCalls:function(){this.agentSettings.totalCalls=this.agentSettings.totalCalls+1}}}var b;return{getInstance:function(){return b||(b=a()),b}}}(),aa={sendMessage:function(a,b){if(1===a.socket.readyState){var c=JSON.parse(b);a._requests[c.ui_request["@message_id"]]={type:c.ui_request["@type"],msg:c.ui_request},a.socket.send(b)}else console.warn("AgentLibrary: WebSocket is not connected, cannot send message.")},processResponse:function(a,b){var c=b.ui_response["@type"],d=b.ui_response["@message_id"],e=""===d?"IS":d.slice(0,2);switch(console.log("AgentLibrary: received response: ("+e+") "+c.toUpperCase()),aa.fireCallback(a,ba.ON_MESSAGE,b),c.toUpperCase()){case ca.AGENT_STATE:null===_.getInstance().agentStateRequest&&(_.getInstance().agentStateRequest=new v(b.ui_response.current_state["#text"],b.ui_response.agent_aux_state["#text"]));var f=_.getInstance().agentStateRequest.processResponse(b);aa.fireCallback(a,ba.AGENT_STATE,f);break;case ca.BARGE_IN:var g=_.getInstance().bargeInRequest.processResponse(b),h=data.ui_response["@response_to"];if(a._requests[h]){var i=a._requests[h].msg.audioState;"MUTE"===i?aa.fireCallback(a,ba.SILENT_MONITOR,g):"COACHING"===i?aa.fireCallback(a,ba.COACH_CALL,g):aa.fireCallback(a,ba.BARGE_IN,g)}else aa.fireCallback(a,ba.BARGE_IN,g);break;case ca.CAMPAIGN_DISPOSITIONS:var j=_.getInstance().campaignDispositionsRequest.processResponse(b);aa.fireCallback(a,ba.CAMPAIGN_DISPOSITIONS,j);break;case ca.CALL_NOTES:var k=_.getInstance().callNotesRequest.processResponse(b);aa.fireCallback(a,ba.CALL_NOTES,k);break;case ca.CALLBACK_PENDING:var l=_.getInstance().callbacksPendingRequest.processResponse(b);aa.fireCallback(a,ba.CALLBACK_PENDING,l);break;case ca.HOLD:var m=_.getInstance().holdRequest.processResponse(b);aa.fireCallback(a,ba.HOLD,m);break;case ca.LOGIN:if("IS"===e){var n=_.getInstance().loginRequest.processResponse(b);aa.fireCallback(a,ba.LOGIN,n)}else if("IQ"===e){var o=_.getInstance().configRequest.processResponse(b);aa.fireCallback(a,ba.CONFIG,o),"SUCCESS"===o.status&&(_.getInstance().statsIntervalId=setInterval(aa.sendStatsRequestMessage,5e3))}break;case ca.LOGOUT:aa.fireCallback(a,ba.LOGOUT,b);break;case ca.OFFHOOK_INIT:var p=_.getInstance().offhookInitRequest.processResponse(b);aa.fireCallback(a,ba.OFFHOOK_INIT,p);break;case ca.PAUSE_RECORD:var q=_.getInstance().pauseRecordRequest.processResponse(b);aa.fireCallback(a,ba.PAUSE_RECORD,q);break;case ca.RECORD:var r=_.getInstance().recordRequest.processResponse(b);aa.fireCallback(a,ba.RECORD,r);break;case ca.REQUEUE:var s=_.getInstance().requeueRequest.processResponse(b);aa.fireCallback(a,ba.REQUEUE,s);break;case ca.XFER_COLD:var t=_.getInstance().coldXferRequest.processResponse(b);aa.fireCallback(a,ba.XFER_COLD,t);break;case ca.XFER_WARM:var u=_.getInstance().warmXferRequest.processResponse(b);aa.fireCallback(a,ba.XFER_WARM,u);break;case ca.XFER_WARM_CANCEL:var w=_.getInstance().warmXferCancelRequest.processResponse(b);aa.fireCallback(a,ba.XFER_WARM_CANCEL,w)}},processNotification:function(a,b){var c=b.ui_notification["@type"],d=b.ui_notification["@message_id"],e=""===d?"IS":d.slice(0,2);switch(console.log("AgentLibrary: received notification: ("+e+") "+c.toUpperCase()),c.toUpperCase()){case ca.ADD_SESSION:var f=new m,g=f.processResponse(b);aa.fireCallback(a,ba.ADD_SESSION,g);break;case ca.DIAL_GROUP_CHANGE:var h=new n,i=h.processResponse(b);aa.fireCallback(a,ba.DIAL_GROUP_CHANGE,i);break;case ca.DIAL_GROUP_CHANGE_PENDING:var j=new o,k=j.processResponse(b);aa.fireCallback(a,ba.DIAL_GROUP_CHANGE_PENDING,k);break;case ca.DROP_SESSION:var l=new p(a),v=l.processResponse(b);aa.fireCallback(a,ba.DROP_SESSION,v);break;case ca.EARLY_UII:var w=new q(a),x=w.processResponse(b);aa.fireCallback(a,ba.EARLY_UII,x);break;case ca.END_CALL:var y=new r(a),z=y.processResponse(b);aa.fireCallback(a,ba.END_CALL,z);break;case ca.GATES_CHANGE:var A=new s,B=A.processResponse(b);aa.fireCallback(a,ba.GATES_CHANGE,B);break;case ca.GENERIC:var C=new t,D=C.processResponse(b),E=b.ui_notification["@response_to"];if(a._requests[E]){var c=a._requests[E].type,F=aa.findCallbackBasedOnMessageType(c);aa.fireCallback(a,F,D)}else aa.fireCallback(a,ba.GENERIC_NOTIFICATION,D);break;case ca.NEW_CALL:var G=new u,H=G.processResponse(b);aa.fireCallback(a,ba.NEW_CALL,H),_.getInstance().pingIntervalId=setInterval(aa.sendPingCallMessage,3e4);break;case ca.OFFHOOK_TERM:null===_.getInstance().offhookTermRequest&&(_.getInstance().offhookTermRequest=new K);var I=_.getInstance().offhookTermRequest.processResponse(b);aa.fireCallback(a,ba.OFFHOOK_TERM,I)}},processDialerResponse:function(a,b){var c=b.dialer_request["@type"],d=b.dialer_request["@message_id"],e=""===d?"IS":d.slice(0,2);switch(console.log("AgentLibrary: received response: ("+e+") "+c.toUpperCase()),aa.fireCallback(a,ba.ON_MESSAGE,b),c.toUpperCase()){case ca.PREVIEW_DIAL_ID:var f=_.getInstance().previewDialRequest.processResponse(b);aa.fireCallback(a,ba.PREVIEW_DIAL,f);break;case ca.TCPA_SAFE_ID:var g=_.getInstance().tcpaSafeRequest.processResponse(b);aa.fireCallback(a,ba.TCPA_SAFE,g)}},processStats:function(a,b){var c=b.ui_stats["@type"];switch(c.toUpperCase()){case ca.STATS_AGENT:var d=_.getInstance().agentStatsPacket.processResponse(b);aa.fireCallback(a,ba.STATS_AGENT,d);break;case ca.STATS_AGENT_DAILY:var e=_.getInstance().agentDailyStatsPacket.processResponse(b);aa.fireCallback(a,ba.STATS_AGENT_DAILY,e);break;case ca.STATS_CAMPAIGN:var f=_.getInstance().campaignStatsPacket.processResponse(b);aa.fireCallback(a,ba.STATS_CAMPAIGN,f);break;case ca.STATS_QUEUE:var g=_.getInstance().queueStatsPacket.processResponse(b);aa.fireCallback(a,ba.STATS_QUEUE,g)}},processResponseCollection:function(a,b,c,d){var e=[],f={},g=[],d=d||"text";if(a[b]&&"undefined"!=typeof a[b][c]&&(g=a[b][c]),Array.isArray(g))for(var h=0;h<g.length;h++){var i="";for(var j in g[h])if(j.match(/^#/)?i=d:(i=j.replace(/@/,""),i=i.replace(/_([a-z])/g,function(a){return a[1].toUpperCase()})),"object"==typeof g[h][j])if(g[h][j]["#text"])f[i]=g[h][j]["#text"];else if(0===Object.keys(g[h][j]).length)f[i]="";else if(Array.isArray(g[j])){var k=[];k=aa.processResponseCollection(a[b],c,j,d),f[i+"s"]=k}else{var l=Object.keys(g[h][j])[0],m=[];m=aa.processResponseCollection(g[h],j,l),f[i]=m}else"TRUE"===g[h][j].toUpperCase()?f[i]=!0:"FALSE"===g[h][j].toUpperCase()?f[i]=!1:f[i]=g[h][j];e.push(f),f={}}else{var n="";for(var o in g)if(o.match(/^#/)?n=d:(n=o.replace(/@/,""),n=n.replace(/_([a-z])/g,function(a){return a[1].toUpperCase()})),"object"==typeof g[o])if(g[o]["#text"])f[n]=g[o]["#text"];else if(0===Object.keys(g[o]).length)f[n]="";else if(Array.isArray(g[o])){var k=[];k=aa.processResponseCollection(a[b],c,o,d),f[n+"s"]=k}else{var p=Object.keys(g[o])[0],q=[];q=aa.processResponseCollection(g,o,p),
f[n]=q}else"TRUE"===g[o].toUpperCase()?f[n]=!0:"FALSE"===g[o].toUpperCase()?f[n]=!1:f[n]=g[o];e.push(f)}return e},fireCallback:function(a,b,c){c=c||"","function"==typeof a.callbacks[b]&&a.callbacks[b].call(a,c)},setCallback:function(a,b,c){"undefined"!=typeof c&&(a.callbacks[b]=c)},getMessageId:function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},checkExistingIds:function(a,b,c){for(var d=[],e=[],f=0;f<a.length;f++)d.push(parseInt(a[f][c],10));for(var g=0;g<b.length;g++)-1===d.indexOf(parseInt(b[g],10))&&e.push(parseInt(b[g],10));for(var h=b.length-1;h>=0;h--)e.indexOf(parseInt(b[h],10))>-1&&b.splice(h,1);return b},findObjById:function(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];if(e[c]===b)return e}return null},validateDest:function(a){var b=!1,c=/^\d+$/.test(a);return c&&10===a.length?b=!0:"sip:"===a.slice(0,4).toLowerCase()&&-1!==a.indexOf("@")&&(b=!0),b},findCallbackBasedOnMessageType:function(a){var b="";for(key in ca)ca[key]===a&&(b=ba[key]);return b},buildDefaultResponse:function(a){var b="",c="",d="",e="",f="",g="";return a.ui_response?(e=a.ui_response.message,f=a.ui_response.detail,g=a.ui_response.status):a.ui_notification&&(e=a.ui_notification.message,f=a.ui_notification.detail,g=a.ui_notification.status),e&&(b=e["#text"]||""),f&&(c=f["#text"]||""),g&&(d=g["#text"]||""),{message:b,detail:c,status:d}},toString:function(a){return a?a.toString():""},getText:function(a,b){var c=a[b];return c&&c["#text"]?"TRUE"===c["#text"].toUpperCase()?!0:"FALSE"===c["#text"].toUpperCase()?!1:c["#text"]||"":""},getAttribute:function(a,b){var c=a[b];return c&&c[b]?"TRUE"===c[b].toUpperCase()?!0:"FALSE"===c[b].toUpperCase()?!1:c[b]||"":""},parseKeyValuePairsFromString:function(a,b,c){if(!a)return[];for(var d=[],e=a.split(b),f=0;f<e.length;f++){var g=e[f],h=g.split(c),i={};i[h[0]]=h[1],d.push(i)}return d},sendPingCallMessage:function(){_.getInstance().pingCallRequest=new O;var a=_.getInstance().pingCallRequest.formatJSON();aa.sendMessage(_.getInstance().libraryInstance,a)},sendStatsRequestMessage:function(){_.getInstance().statsRequest=new T;var a=_.getInstance().statsRequest.formatJSON();aa.sendMessage(_.getInstance().libraryInstance,a)}};const ba={ADD_SESSION:"addSessionNotification",AGENT_STATE:"agentStateResponse",BARGE_IN:"bargeInResponse",CLOSE_SOCKET:"closeResponse",COACH_CALL:"coachResponse",CONFIG:"configureResponse",CALL_NOTES:"callNotesResponse",CALLBACK_PENDING:"callbacksPendingResponse",CALLBACK_CANCEL:"callbackCancelResponse",CAMPAIGN_DISPOSITIONS:"campaignDispositionsResponse",DIAL_GROUP_CHANGE:"dialGroupChangeNotification",DIAL_GROUP_CHANGE_PENDING:"dialGroupChangePendingNotification",DROP_SESSION:"dropSessionNotification",EARLY_UII:"earlyUiiNotification",END_CALL:"endCallNotification",GATES_CHANGE:"gatesChangeNotification",GENERIC_NOTIFICATION:"genericNotification",GENERIC_RESPONSE:"genericResponse",HOLD:"holdResponse",LOGIN:"loginResponse",SILENT_MONITOR:"monitorResponse",NEW_CALL:"newCallNotification",OFFHOOK_INIT:"offhookInitResponse",OFFHOOK_TERM:"offhookTermResponse",OPEN_SOCKET:"openResponse",PAUSE_RECORD:"pauseRecordResponse",PREVIEW_DIAL:"previewDialResponse",REQUEUE:"requeueResponse",STATS_AGENT:"agentStats",STATS_AGENT_DAILY:"agentDailyStats",STATS_CAMPAIGN:"campaignStats",STATS_QUEUE:"queueStats",TCPA_SAFE:"tcpaSafeResponse",XFER_COLD:"coldXferResponse",XFER_WARM:"warmXferResponse"},ca={ADD_SESSION:"ADD-SESSION",BARGE_IN:"BARGE-IN",LOGIN:"LOGIN",LOGOUT:"LOGOUT",AGENT_STATE:"AGENT-STATE",CALL_NOTES:"CALL-NOTES",CALLBACK_PENDING:"PENDING-CALLBACKS",CALLBACK_CANCEL:"CANCEL-CALLBACK",CAMPAIGN_DISPOSITIONS:"CAMPAIGN-DISPOSITIONS",DIAL_GROUP_CHANGE:"DIAL_GROUP_CHANGE",DIAL_GROUP_CHANGE_PENDING:"DIAL_GROUP_CHANGE_PENDING",DROP_SESSION:"DROP-SESSION",EARLY_UII:"EARLY_UII",END_CALL:"END-CALL",GATES_CHANGE:"GATES_CHANGE",GENERIC:"GENERIC",HANGUP:"HANGUP",HOLD:"HOLD",INBOUND_DISPOSITION:"INBOUND-DISPOSITION",NEW_CALL:"NEW-CALL",OFFHOOK_INIT:"OFF-HOOK-INIT",OFFHOOK_TERM:"OFF-HOOK-TERM",ON_MESSAGE:"ON-MESSAGE",ONE_TO_ONE_OUTDIAL:"ONE-TO-ONE-OUTDIAL",ONE_TO_ONE_OUTDIAL_CANCEL:"ONE-TO-ONE-OUTDIAL-CANCEL",OUTDIAL_DISPOSITION:"OUTDIAL-DISPOSITION",PAUSE_RECORD:"PAUSE-RECORD",PING_CALL:"PING-CALL",PREVIEW_DIAL:"PREVIEW-DIAL",PREVIEW_DIAL_ID:"PREVIEW_DIAL",RECORD:"RECORD",REQUEUE:"RE-QUEUE",STATS:"STATS",STATS_AGENT:"AGENT",STATS_AGENT_DAILY:"AGENTDAILY",STATS_CAMPAIGN:"CAMPAIGN",STATS_QUEUE:"GATE",TCPA_SAFE:"TCPA-SAFE",TCPA_SAFE_ID:"TCPA_SAFE",XFER_COLD:"COLD-XFER",XFER_WARM:"WARM-XFER",XFER_WARM_CANCEL:"WARM-XFER-CANCEL"};var da=function(a){return i(a),j(a),k(a),l(a),a.AgentLibrary};"function"==typeof define&&define.amd?(console.log("AgentLibrary: using AMD"),define(function(){return da({})})):"object"==typeof module&&module.exports?(console.log("AgentLibrary: Using Node"),module.exports=da(this)):(console.log("AgentLibrary: Not using AMD"),da(this))}(this);