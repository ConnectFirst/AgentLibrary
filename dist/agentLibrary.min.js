/*! cf-agent-library - v0.0.0 - 2016-08-04 - Connect First */
!function(a){function b(a){var b={auxData1:a["@aux_data1"],auxData2:a["@aux_data2"],auxData3:a["@aux_data3"],auxData4:a["@aux_data4"],auxData5:a["@aux_data5"],destination:a["@destination"],dialGroupId:a["@dial_group_id"],dialGroupName:a["@dial_group_name"],dialTime:a["@dial_time"],externId:a["@extern_id"],leadId:a["@lead_id"],firstName:a.first_name["#text"]||"",midName:a.mid_name["#text"]||"",lastName:a.last_name["#text"]||"",sufix:a.suffix["#text"]||"",title:a.title["#text"]||"",address1:a.address1["#text"]||"",address2:a.address2["#text"]||"",city:a.city["#text"]||"",state:a.state["#text"]||"",zip:a.zip["#text"]||"",gateKeeper:a.gate_keeper["#text"]||""};return b}function c(a){for(var b=t.getInstance().outboundSettings.availableOutdialGroups,c=0;c<b.length;c++){var d=b[c];d.dialGroupId===a.ui_response.outdial_group_id["#text"]&&(t.getInstance().agentPermissions.allowLeadSearch=d.allowLeadSearch,t.getInstance().agentPermissions.allowPreviewLeadFilters=d.allowPreviewLeadFilters,t.getInstance().outboundSettings.outdialGroup=JSON.parse(JSON.stringify(d)),t.getInstance().agentPermissions.requireFetchedLeadsCalled=d.requireFetchedLeadsCalled)}}function d(){for(var a=t.getInstance().inboundSettings.availableQueues,b=t.getInstance().configRequest.queueIds,c=[],d=0;d<a.length;d++){var e=a[d];b.indexOf(e.gateId)>-1&&c.push(e)}t.getInstance().inboundSettings.queues=JSON.parse(JSON.stringify(c))}function e(){for(var a=t.getInstance().chatSettings.availableChatQueues,b=t.getInstance().configRequest.chatIds,c=[],d=0;d<a.length;d++){var e=a[d];b.indexOf(e.chatQueueId)>-1&&c.push(e)}t.getInstance().chatSettings.chatQueues=JSON.parse(JSON.stringify(c))}function f(){for(var a=t.getInstance().inboundSettings.availableSkillProfiles,b=0;b<a.length;b++){var c=a[b];c.skillProfileId===t.getInstance().configRequest.skillProfileId&&(t.getInstance().inboundSettings.skillProfile=JSON.parse(JSON.stringify(c)))}}function g(a){"use strict";var b=a.AgentLibrary=function(a){return a=a||{},this.callbacks={},this._requests={},"undefined"!=typeof a.callbacks&&(this.callbacks=a.callbacks),"undefined"!=typeof a.socketDest&&(t.getInstance().applicationSettings.socketDest=a.socketDest,this.openSocket()),this};b.prototype.setCallbacks=function(a){for(var b in a)this.callbacks[b]=a[b]},b.prototype.setCallback=function(a,b){this.callbacks[a]=b},b.prototype.getCallbacks=function(){return this.callbacks},b.prototype.getCallback=function(a){return this.callbacks[a]},b.prototype.getLoginRequest=function(){return t.getInstance().loginRequest},b.prototype.getConfigRequest=function(){return t.getInstance().configRequest},b.prototype.getLogoutRequest=function(){return t.getInstance().logoutRequest},b.prototype.getAgentStateRequest=function(){return t.getInstance().agentStateRequest},b.prototype.getLoginPacket=function(){return t.getInstance().loginPacket},b.prototype.getConfigPacket=function(){return t.getInstance().configPacket},b.prototype.getAgentStatePacket=function(){return t.getInstance().agentStatePacket},b.prototype.getCurrentCallPacket=function(){return t.getInstance().currentCallPacket},b.prototype.getDialGroupChangeNotification=function(){return t.getInstance().dialGroupChangeNotification},b.prototype.getApplicationSettings=function(){return t.getInstance().applicationSettings},b.prototype.getChatSettings=function(){return t.getInstance().chatSettings},b.prototype.getInboundSettings=function(){return t.getInstance().inboundSettings},b.prototype.getOutboundSettings=function(){return t.getInstance().outboundSettings},b.prototype.getAgentSettings=function(){return t.getInstance().agentSettings},b.prototype.getAgentPermissions=function(){return t.getInstance().agentPermissions}}function h(a){"use strict";var b=a.AgentLibrary;b.prototype.openSocket=function(b){var c=this;u.setCallback(c,v.OPEN_SOCKET,b),"WebSocket"in a?(console.log("AgentLibrary: attempting to open socket connection..."),c.socket=new WebSocket(t.getInstance().applicationSettings.socketDest),c.socket.onopen=function(){t.getInstance().applicationSettings.socketConnected=!0,u.fireCallback(c,v.OPEN_SOCKET,"")},c.socket.onmessage=function(a){var b=JSON.parse(a.data);b.ui_response?u.processResponse(c,b):b.ui_notification&&u.processNotification(c,b)},c.socket.onclose=function(){u.fireCallback(c,v.CLOSE_SOCKET,""),t.getInstance().applicationSettings.socketConnected=!1}):console.warn("AgentLibrary: WebSocket NOT supported by your Browser.")},b.prototype.closeSocket=function(){this.socket.close()}}function i(a){"use strict";var b=a.AgentLibrary;b.prototype.loginAgent=function(a,b,c){t.getInstance().loginRequest=new n(a,b);var d=t.getInstance().loginRequest.formatJSON();u.setCallback(this,v.LOGIN,c),u.sendMessage(this,d)},b.prototype.configureAgent=function(a,b,c,d,e,f){t.getInstance().configRequest=new m(a,b,c,d,e);var g=t.getInstance().configRequest.formatJSON();u.setCallback(this,v.CONFIG,f),u.sendMessage(this,g)},b.prototype.logoutAgent=function(a,b){if(t.getInstance().logoutRequest=new o(a),u.setCallback(this,v.LOGOUT,b),t.getInstance().logoutRequest.isSupervisor){var c=t.getInstance().logoutRequest.formatJSON();u.sendMessage(this,c)}else u.fireCallback(this,v.LOGOUT,""),this.closeSocket()},b.prototype.setAgentState=function(a,b,c){t.getInstance().agentStateRequest=new j(a,b);var d=t.getInstance().agentStateRequest.formatJSON();u.setCallback(this,v.AGENT_STATE,c),u.sendMessage(this,d)},b.prototype.offhookInit=function(a){t.getInstance().offhookInitRequest=new p;var b=t.getInstance().offhookInitRequest.formatJSON();u.setCallback(this,v.OFFHOOK_INIT,a),u.sendMessage(this,b)},b.prototype.offhookTerm=function(a){t.getInstance().offhookTermRequest=new q;var b=t.getInstance().offhookTermRequest.formatJSON();u.setCallback(this,v.OFFHOOK_TERM,a),u.sendMessage(this,b)},b.prototype.getPendingCallbacks=function(a,b){t.getInstance().callbacksPendingRequest=new l(a);var c=t.getInstance().callbacksPendingRequest.formatJSON();u.setCallback(this,v.CALLBACK_PENDING,b),u.sendMessage(this,c)},b.prototype.cancelCallback=function(a,b,c){t.getInstance().callbackCancelRequest=new k(a,b);var d=t.getInstance().callbackCancelRequest.formatJSON();u.setCallback(this,v.CALLBACK_CANCEL,c),u.sendMessage(this,d)}}var j=function(a,b){"ON-BREAK"==a.toUpperCase()&&1==t.getInstance().onCall?(this.agentState="BREAK-AFTER-CALL",this.agentAuxState=""):(this.agentState=a.toUpperCase()||"",this.agentAuxState=b||"")};j.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":w.AGENT_STATE,"@message_id":u.getMessageId(),response_to:"",agent_id:{"#text":t.getInstance().agentSettings.agentId},state:{"#text":this.agentState},agent_aux_state:{"#text":this.agentAuxState}}};return JSON.stringify(a)},j.prototype.processResponse=function(a){var b=a.ui_response.status["#text"],c=a.ui_response.prev_state["#text"],d=a.ui_response.current_state["#text"],e=a.ui_response.prev_aux_state["#text"]||"",f=a.ui_response.agent_aux_state["#text"]||"",g=a.ui_response.message,h=a.ui_response.detail,i="",j="";g&&(i=g["#text"]||""),h&&(j=h["#text"]||"");var k={status:b,message:i,detail:j,agentId:a.ui_response.agent_id["#text"]||"",previousState:c,currentState:d,previousAuxState:e,currentAuxState:f};if("OK"==b){var l=c,m=d;e.length>0&&(l=e),f.length>0&&(m=f),console.log("AgentLibrary: Agent state changed from ["+l+"] to ["+m+"]"),t.getInstance().agentSettings.currentState=d,t.getInstance().agentSettings.currentStateLabel=f,t.getInstance().agentStatePacket=a}else""===k.message&&(k.message="Unable to change agent state"),console.warn("AgentLibrary: Unable to change agent state "+j);return k};var k=function(a,b){this.agentId=b||t.getInstance().agentSettings.agentId,this.leadId=a};k.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":w.CALLBACK_CANCEL,"@message_id":u.getMessageId(),response_to:"",agent_id:{"#text":this.agentId},lead_id:{"#text":this.leadId}}};return JSON.stringify(a)};var l=function(a){this.agentId=a||t.getInstance().agentSettings.agentId};l.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":w.CALLBACK_PENDING,"@message_id":u.getMessageId(),response_to:"",agent_id:{"#text":this.agentId}}};return JSON.stringify(a)},l.prototype.processResponse=function(a){var c=a.ui_response.lead,d=[];if(Array.isArray(c))for(var e=0;e<c.length;e++){var f=c[e],g=b(f);d.push(g)}else c&&d.push(b(c));return t.getInstance().agentSettings.pendingCallbacks=JSON.parse(JSON.stringify(d)),t.getInstance().agentSettings.pendingCallbacks};var m=function(a,b,c,d,e){this.queueIds=a||[],this.chatIds=b||[],this.skillPofileId=c||"",this.dialGroupId=d||"",this.dialDest=e||"",this.updateFromAdminUI=!1,this.loginType="NO-SELECTION",this.updateLogin=!1,this.queueIds=u.checkExistingIds(t.getInstance().inboundSettings.availableQueues,this.queueIds,"gateId"),this.chatIds=u.checkExistingIds(t.getInstance().chatSettings.availableChatQueues,this.chatIds,"chatQueueId"),this.skillPofileId=u.checkExistingIds(t.getInstance().inboundSettings.availableSkillProfiles,[this.skillPofileId],"profileId")[0]||"",this.dialGroupId=u.checkExistingIds(t.getInstance().outboundSettings.availableOutdialGroups,[this.dialGroupId],"dialGroupId")[0]||"",this.queueIds.length>0&&""!==this.dialGroupId?this.loginType="BLENDED":this.queueIds.length>0?this.loginType="INBOUND":""!==this.dialGroupId?this.loginType="OUTBOUND":this.loginType="NO-SELECTION",t.getInstance().isLoggedIn&&(this.updateLogin=!0),u.validateDest(this.dialDest)||console.error("AgentLibrary: dialDest must be a valid sip or 10-digit DID")};m.prototype.formatJSON=function(){for(var a={ui_request:{"@destination":"IQ","@type":w.LOGIN,"@message_id":u.getMessageId(),response_to:"",agent_id:{"#text":t.getInstance().agentSettings.agentId},agent_pwd:{"#text":t.getInstance().loginRequest.password},dial_dest:{"#text":this.dialDest},login_type:{"#text":this.loginType},update_login:{"#text":this.updateLogin.toString()},outdial_group_id:{"#text":this.dialGroupId},skill_profile_id:{"#text":this.skillPofileId},update_from_adminui:{"#text":this.updateFromAdminUI.toString()}}},b=[],c=0;c<this.queueIds.length;c++)""!==this.queueIds[c]&&b.push({"#text":this.queueIds[c]});b.length>0?a.ui_request.gates={gate_id:b}:a.ui_request.gates={};for(var d=[],c=0;c<this.chatIds.length;c++)""!==this.chatIds[c]&&d.push({"#text":this.chatIds[c]});return d.length>0?a.ui_request.chat_queues={chat_queue_id:d}:a.ui_request.chat_queues={},JSON.stringify(a)},m.prototype.processResponse=function(a){var b=a.ui_response.status["#text"],g=a.ui_response.message,h=a.ui_response.detail,i="",j="";g&&(i=g["#text"]||""),h&&(j=h["#text"]||"");var k={status:b,message:i,detail:j};return"SUCCESS"===b?(t.getInstance().agentSettings.isLoggedIn?t.getInstance().agentSettings.updateLoginMode?(t.getInstance().agentSettings.updateLoginMode=!1,t.getInstance().agentPermissions.allowLeadSearch=!1,t.getInstance().agentPermissions.requireFetchedLeadsCalled=!1,t.getInstance().agentPermissions.allowPreviewLeadFilters=!1,c(a),d(),e(),f()):console.log("AgentLibrary: Processed a Layer 2 Reconnect Successfully"):(t.getInstance().configPacket=a,t.getInstance().connectionSettings.hashCode=a.ui_response.hash_code["#text"],t.getInstance().agentSettings.isLoggedIn=!0,t.getInstance().agentSettings.loginDTS=new Date,t.getInstance().connectionSettings.reconnect=!0,t.getInstance().agentPermissions.allowLeadSearch=!1,t.getInstance().agentSettings.dialDest=t.getInstance().configRequest.dialDest,t.getInstance().agentSettings.loginType=a.ui_response.login_type["#text"],c(a),d(),e(),f()),k.agentSettings=t.getInstance().agentSettings,k.agentPermissions=t.getInstance().agentPermissions,k.applicationSettings=t.getInstance().applicationSettings,k.chatSettings=t.getInstance().chatSettings,k.connectionSettings=t.getInstance().connectionSettings,k.inboundSettings=t.getInstance().inboundSettings,k.outboundSettings=t.getInstance().outboundSettings,k.surveySettings=t.getInstance().surveySettings):(""===k.message&&(k.message="Agent configuration attempt failed (2nd layer login)"),console.warn("AgentLibrary: Layer 2 login failed!")),k};var n=function(a,b){this.username=a,this.password=b};n.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IS","@type":w.LOGIN,"@message_id":u.getMessageId(),response_to:"",username:{"#text":this.username},password:{"#text":this.password}}};return JSON.stringify(a)},n.prototype.processResponse=function(a){var b=a.ui_response.status["#text"],c=a.ui_response.message,d=a.ui_response.detail,e="",f="";c&&(e=c["#text"]||""),d&&(f=d["#text"]||"");var g={status:b,message:e,detail:f};if("OK"===b){if(!t.getInstance().isLoggedInIS){t.getInstance().loginPacket=a,t.getInstance().applicationSettings.isLoggedInIS=!0,t.getInstance().agentSettings.loginDTS=new Date,t.getInstance().chatSettings.alias=a.ui_response.first_name["#text"]+" "+a.ui_response.last_name["#text"],t.getInstance().agentSettings.maxBreakTime=a.ui_response.max_break_time["#text"],t.getInstance().agentSettings.maxLunchTime=a.ui_response.max_lunch_time["#text"],t.getInstance().agentSettings.firstName=a.ui_response.first_name["#text"],t.getInstance().agentSettings.lastName=a.ui_response.last_name["#text"],t.getInstance().agentSettings.email=a.ui_response.email["#text"],t.getInstance().agentSettings.agentId=a.ui_response.agent_id["#text"],t.getInstance().agentSettings.externalAgentId=a.ui_response.external_agent_id["#text"]||"",t.getInstance().agentSettings.agentType=a.ui_response.agent_type["#text"],t.getInstance().agentSettings.realAgentType=a.ui_response.real_agent_type["#text"],t.getInstance().agentSettings.defaultLoginDest=a.ui_response.default_login_dest["#text"],t.getInstance().agentSettings.altDefaultLoginDest=a.ui_response.alt_default_login_dest["#text"]||"",t.getInstance().agentSettings.disableSupervisorMonitoring=a.ui_response.disable_supervisor_monitoring["#text"],t.getInstance().agentSettings.initLoginState=a.ui_response.init_login_state["#text"],t.getInstance().agentSettings.initLoginStateLabel=a.ui_response.init_login_state_label["#text"],t.getInstance().agentSettings.outboundManualDefaultRingtime=a.ui_response.outbound_manual_default_ringtime["#text"];var h="undefined"==typeof a.ui_response.allow_call_control?!1:a.ui_response.allow_call_control["#text"],i="undefined"==typeof a.ui_response.allow_chat?!1:a.ui_response.allow_chat["#text"],j="undefined"==typeof a.ui_response.show_lead_history?!1:a.ui_response.show_lead_history["#text"],k="undefined"==typeof a.ui_response.allow_manual_outbound_gates?!1:a.ui_response.allow_manual_outbound_gates["#text"],l="undefined"==typeof a.ui_response.tcpa_safe_mode?!1:a.ui_response.tcpa_safe_mode["#text"],m="undefined"==typeof a.ui_response.insert_campaigns?!1:a.ui_response.insert_campaigns.campaign,n="undefined"==typeof a.ui_response.outbound_prepay?!1:a.ui_response.outbound_prepay["#text"];"0"==h&&(t.getInstance().agentPermissions.allowCallControl=!1),"1"==i&&(t.getInstance().agentPermissions.allowChat=!0),"0"==j&&(t.getInstance().agentPermissions.showLeadHistory=!1),"1"==k&&(t.getInstance().agentPermissions.allowManualOutboundGates=!0),"1"==l&&(t.getInstance().applicationSettings.isTcpaSafeMode=!0),m&&m.length>0&&(t.getInstance().agentPermissions.allowLeadInserts=!0),"1"==n&&(t.getInstance().agentSettings.isOutboundPrepay=!0),"0"==a.ui_response.allow_off_hook["#text"]&&(t.getInstance().agentPermissions.allowOffHook=!1),"0"==a.ui_response.allow_manual_calls["#text"]&&(t.getInstance().agentPermissions.allowManualCalls=!1),"0"==a.ui_response.allow_manual_pass["#text"]&&(t.getInstance().agentPermissions.allowManualPass=!1),"1"==a.ui_response.allow_manual_intl_calls["#text"]&&(t.getInstance().agentPermissions.allowManualIntlCalls=!0),"0"==a.ui_response.allow_login_updates["#text"]&&(t.getInstance().agentPermissions.allowLoginUpdates=!1),"0"==a.ui_response.allow_inbound["#text"]&&(t.getInstance().agentPermissions.allowInbound=!1),"0"==a.ui_response.allow_outbound["#text"]&&(t.getInstance().agentPermissions.allowOutbound=!1),"0"==a.ui_response.allow_blended["#text"]&&(t.getInstance().agentPermissions.allowBlended=!1),"0"==a.ui_response.allow_login_control["#text"]&&(t.getInstance().agentPermissions.allowLoginControl=!1),"1"==a.ui_response.allow_cross_gate_requeue["#text"]&&(t.getInstance().agentPermissions.allowCrossQueueRequeue=!0),processCampaigns(a),t.getInstance().chatSettings.availableChatQueues=u.processResponseCollection(a.ui_response,"login_chat_queues","chat_queue"),t.getInstance().inboundSettings.availableQueues=u.processResponseCollection(a.ui_response,"login_gates","gate"),t.getInstance().inboundSettings.availableSkillProfiles=u.processResponseCollection(a.ui_response,"skill_profiles","profile"),t.getInstance().inboundSettings.availableRequeueQueues=u.processResponseCollection(a.ui_response,"requeue_gates","gate_group"),t.getInstance().chatSettings.availableChatRooms=u.processResponseCollection(a.ui_response,"chat_rooms","room"),t.getInstance().surveySettings.availableSurveys=u.processResponseCollection(a.ui_response,"surveys","survey"),t.getInstance().agentSettings.callerIds=u.processResponseCollection(a.ui_response,"caller_ids","caller_id"),t.getInstance().agentSettings.availableAgentStates=u.processResponseCollection(a.ui_response,"agent_states","agent_state"),t.getInstance().applicationSettings.availableCountries=u.processResponseCollection(a.ui_response,"account_countries","country"),t.getInstance().outboundSettings.insertCampaigns=u.processResponseCollection(a.ui_response,"insert_campaigns","campaign");for(var o=u.processResponseCollection(a.ui_response,"outdial_groups","group"),p=0;p<o.length;p++){var q=o[p];q.allowLeadSearch="YES"===q.allowLeadSearch,q.allowPreviewLeadFilters="1"===q.allowPreviewLeadFilters,q.progressiveEnabled="1"===q.progressiveEnabled,q.requireFetchedLeadsCalled="1"===q.requireFetchedLeadsCalled}t.getInstance().outboundSettings.availableOutdialGroups=o}g.agentSettings=t.getInstance().agentSettings,g.agentPermissions=t.getInstance().agentPermissions,g.applicationSettings=t.getInstance().applicationSettings,g.chatSettings=t.getInstance().chatSettings,g.connectionSettings=t.getInstance().connectionSettings,g.inboundSettings=t.getInstance().inboundSettings,g.outboundSettings=t.getInstance().outboundSettings,g.surveySettings=t.getInstance().surveySettings}else"RESTRICTED"===b?(g.message="Invalid IP Address",console.log("AgentLibrary: Invalid IP Address")):(g.message="Invalid Username or password",console.log("AgentLibrary: Invalid Username or password"));return g},processCampaigns=function(a){var b=[],c={},d=[],e=[],f=[],g="",h=0,i=!1;if("undefined"!=typeof a.ui_response.campaigns.campaign&&(d=a.ui_response.campaigns.campaign),Array.isArray(d))for(var j=0;j<d.length;j++){h=d[j]["@campaign_id"],i="1"==d[j]["@allow_lead_updates"],e=d[j].custom_labels,f=[],g="",t.getInstance().agentPermissions.allowLeadUpdatesByCampaign[h]=i;for(var k in e){g=k.replace(/@/,"");var l={};l[g]=e[k],f.push(l)}c={allowLeadUpdates:i,campaignId:h,surveyId:d[j]["@survey_id"],surveyName:d[j]["@survey_name"],customLabels:f},b.push(c)}else if(d){h=d["@campaign_id"],i="1"==d["@allow_lead_updates"],e=d.custom_labels,f=[],g="",t.getInstance().agentPermissions.allowLeadUpdatesByCampaign[h]=i;for(var m in e){g=m.replace(/@/,"");var l={};l[g]=e[m],f.push(l)}c={allowLeadUpdates:i,campaignId:h,surveyId:d["@survey_id"],surveyName:d["@survey_name"],customLabels:f},b.push(c)}t.getInstance().outboundSettings.availableCampaigns=b};var o=function(a,b,c){this.agentId=a,this.message=b,this.isSupervisor=c};o.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":w.LOGOUT,"@message_id":u.getMessageId(),response_to:"",agent_id:{"#text":this.agentId},message:{"#text":this.message}}};return JSON.stringify(a)};var p=function(){};p.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":w.OFFHOOK_INIT,"@message_id":u.getMessageId(),response_to:"",agent_id:{"#text":t.getInstance().agentSettings.agentId},dial_dest:{"#text":t.getInstance().agentSettings.dialDest}}};return JSON.stringify(a)},p.prototype.processResponse=function(a){var b=a.ui_response.status["#text"],c=a.ui_response.message,d=a.ui_response.detail,e="",f="";c&&(e=c["#text"]||""),d&&(f=d["#text"]||"");var g={status:b,message:e,detail:f};return"OK"===b?(t.getInstance().offhookInitPacket=a,t.getInstance().agentSettings.isOffhook=!0):(""===g.message&&(g.message="Unable to process offhook request"),console.log("AgentLibrary: Unable to process offhook request ",f)),g};var q=function(a){};q.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":w.OFFHOOK_TERM,"@message_id":u.getMessageId(),response_to:"",agent_id:{"#text":t.getInstance().agentSettings.agentId}}};return JSON.stringify(a)},q.prototype.processResponse=function(a){var b="1"===a.ui_notification.monitoring["#text"];t.getInstance().agentSettings.wasMonitoring=b,t.getInstance().offhookTermPacket=a,t.getInstance().agentSettings.isOffhook=!1;var c={agentId:a.ui_notification.agent_id["#text"],startDts:a.ui_notification.start_dts["#text"],endDts:a.ui_notification.end_dts["#text"],monitoring:b};return c};var r=function(){};r.prototype.processResponse=function(a){var b=t.getInstance().configRequest.loginType,c=t.getInstance().configRequest.dialGroupId,d=a.ui_notification.dial_group_id["#text"]||"";!d||""===d||"INBOUND"!==b&&"BLENDED"!==b?d&&""!==d?t.getInstance().configRequest.loginType="OUTBOUND":"INBOUND"===b?t.getInstance().configRequest.loginType="INBOUND":t.getInstance().configRequest.loginType="NO-SELECTION":t.getInstance().configRequest.loginType="BLENDED",t.getInstance().configRequest.dialGroupId=d;var e={message:"Dial Group Updated Successfully.",detail:"Dial Group changed from ["+c+"] to ["+d+"].",dialGroupId:a.ui_notification.dial_group_id["#text"],dialGroupName:a.ui_notification.dialGroupName["#text"],dialGroupDesc:a.ui_notification.dial_group_desc["#text"],agentId:a.ui_notification.agent_id["#text"]};return e};var s=function(){};s.prototype.processResponse=function(a){var b=a.ui_notification.message_code,c=a.ui_notification.message,d=a.ui_notification.detail,e="",f="",g="";c&&(f=c["#text"]||""),d&&(g=d["#text"]||""),b&&(e=b["#text"]||"");var h={messageCode:e,message:f,detail:g};return h};var t=function(){function a(){return{agentStateRequest:null,callbacksPendingRequest:null,configRequest:null,logoutRequest:null,loginRequest:null,offhookInitRequest:null,offhookTermRequest:null,agentStatePacket:null,configPacket:null,currentCallPacket:null,loginPacket:null,offhookInitPacket:null,offhookTermPacket:null,dialGroupChangeNotification:new r,applicationSettings:{availableCountries:[],isLoggedInIS:!1,socketConnected:!1,socketDest:"",isTcpaSafeMode:!1},agentSettings:{agentId:0,agentType:"AGENT",altDefaultLoginDest:"",availableAgentStates:[],callerIds:[],currentState:"OFFLINE",currentStateLabel:"",defaultLoginDest:"",dialDest:"",email:"",externalAgentId:"",firstName:"",isLoggedIn:!1,isOffhook:!1,initLoginState:"AVAILABLE",initLoginStateLabel:"Available",isOutboundPrepay:!1,lastName:"",loginDTS:null,loginType:"NO-SELECTION",maxBreakTime:-1,maxLunchTime:-1,onCall:!1,outboundManualDefaultRingtime:"30",pendingCallbacks:[],realAgentType:"AGENT",updateLoginMode:!1,wasMonitoring:!1},agentPermissions:{allowBlended:!0,allowCallControl:!0,allowChat:!1,allowCrossQueueRequeue:!1,allowInbound:!0,allowLeadInserts:!1,allowLeadSearch:!1,allowLoginControl:!0,allowLoginUpdates:!0,allowManualCalls:!0,allowManualPass:!0,allowManualIntlCalls:!1,allowManualOutboundGates:!1,allowOffHook:!0,allowOutbound:!0,allowPreviewLeadFilters:!1,allowLeadUpdatesByCampaign:{},disableSupervisorMonitoring:!0,requireFetchedLeadsCalled:!1,showLeadHistory:!0},chatSettings:{availableChatQueues:[],availableChatRooms:[],chatQueues:[],alias:""},connectionSettings:{hashCode:null,reconnect:!1},inboundSettings:{availableQueues:[],availableSkillProfiles:[],queues:[],skillProfile:{}},outboundSettings:{availableCampaigns:[],availableOutdialGroups:[],insertCampaigns:[],outdialGroup:{}},surveySettings:{availableSurveys:[]}}}var b;return{getInstance:function(){return b||(b=a()),b}}}(),u={sendMessage:function(a,b){if(1===a.socket.readyState){var c=JSON.parse(b);a._requests[c.ui_request["@message_id"]]={type:c.ui_request["@type"],msg:c.ui_request},a.socket.send(b)}else console.warn("AgentLibrary: WebSocket is not connected, cannot send message.")},processResponse:function(a,b){var c=b.ui_response["@type"],d=b.ui_response["@message_id"],e=""===d?"IS":d.slice(0,2);switch(console.log("AgentLibrary: received response: ("+e+") "+c.toUpperCase()),u.fireCallback(a,v.ON_MESSAGE,b),c.toUpperCase()){case w.LOGIN:if("IS"===e){var f=t.getInstance().loginRequest.processResponse(b);u.fireCallback(a,v.LOGIN,f)}else if("IQ"===e){var g=b.ui_response.detail["#text"];"Logon Session Configuration Updated!"===g&&(t.getInstance().agentSettings.updateLoginMode=!0);var h=t.getInstance().configRequest.processResponse(b);u.fireCallback(a,v.CONFIG,h)}break;case w.LOGOUT:u.fireCallback(a,v.LOGOUT,b);break;case w.AGENT_STATE:null===t.getInstance().agentStateRequest&&(t.getInstance().agentStateRequest=new j(b.ui_response.current_state["#text"],b.ui_response.agent_aux_state["#text"]));var i=t.getInstance().agentStateRequest.processResponse(b);u.fireCallback(a,v.AGENT_STATE,i);break;case w.OFFHOOK_INIT:var k=t.getInstance().offhookInitRequest.processResponse(b);u.fireCallback(a,v.OFFHOOK_INIT,k);break;case w.CALLBACK_PENDING:var l=t.getInstance().callbacksPendingRequest.processResponse(b);u.fireCallback(a,v.CALLBACK_PENDING,l)}},processNotification:function(a,b){var c=b.ui_notification["@type"],d=b.ui_notification["@message_id"],e=""===d?"IS":d.slice(0,2);switch(console.log("AgentLibrary: received notification: ("+e+") "+c.toUpperCase()),c.toUpperCase()){case w.OFFHOOK_TERM:null===t.getInstance().offhookTermRequest&&(t.getInstance().offhookTermRequest=new q);var f=t.getInstance().offhookTermRequest.processResponse(b);u.fireCallback(a,v.OFFHOOK_TERM,f);break;case w.DIAL_GROUP_CHANGE:var g=new r,h=g.processResponse(b);u.fireCallback(a,v.DIAL_GROUP_CHANGE,h);break;case w.GENERIC:var i=new s,j=i.processResponse(b),k=b.ui_notification["@response_to"];if(a._requests[k]){var c=a._requests[k].type,l=u.findCallbackBasedOnMessageType(c);u.fireCallback(a,l,j)}else u.fireCallback(a,v.GENERIC_NOTIFICATION,j)}},processResponseCollection:function(a,b,c){var d=[],e={},f=[];if(a[b]&&"undefined"!=typeof a[b][c]&&(f=a[b][c]),Array.isArray(f))for(var g=0;g<f.length;g++){var h="";for(var i in f[g])if(h=i.replace(/@/,""),h=h.replace(/_([a-z])/g,function(a){return a[1].toUpperCase()}),"object"==typeof f[g][i]){var j=Object.keys(f[g][i])[0],k=[];k=u.processResponseCollection(f[g],i,j),e[h]=k}else e[h]=f[g][i];d.push(e),e={}}else{var l="";for(var m in f)if(l=m.replace(/@/,""),l=l.replace(/_([a-z])/g,function(a){return a[1].toUpperCase()}),"object"==typeof f[m]){var n=Object.keys(f[m])[0],o=[];o=u.processResponseCollection(f,m,n),e[l]=f[m]}else e[l]=f[m];d.push(e)}return d},fireCallback:function(a,b,c){c=c||"","function"==typeof a.callbacks[b]&&a.callbacks[b].call(a,c)},setCallback:function(a,b,c){"undefined"!=typeof c&&(a.callbacks[b]=c)},getMessageId:function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},checkExistingIds:function(a,b,c){for(var d=[],e=[],f=0;f<a.length;f++)d.push(a[f][c]);for(var g=0;g<b.length;g++)-1===d.indexOf(b[g])&&e.push(b[g]);for(var h=b.length-1;h>=0;h--)e.indexOf(b[h])>-1&&b.splice(h,1);return b},validateDest:function(a){var b=!1,c=/^\d+$/.test(a);return c&&10===a.length?b=!0:"sip:"===a.slice(0,4).toLowerCase()&&-1!==a.indexOf("@")&&(b=!0),b},findCallbackBasedOnMessageType:function(a){var b="";for(key in w)w[key]===a&&(b=v[key]);return b}};const v={AGENT_STATE:"agentStateResponse",CLOSE_SOCKET:"closeResponse",CONFIG:"configureResponse",CALLBACK_PENDING:"callbacksPendingResponse",CALLBACK_CANCEL:"callbackCancelResponse",DIAL_GROUP_CHANGE:"dialGroupChangeNotification",GENERIC_NOTIFICATION:"genericNotification",GENERIC_RESPONSE:"genericResponse",LOGIN:"loginResponse",OFFHOOK_INIT:"offhookInitResponse",OFFHOOK_TERM:"offhookTermResponse",OPEN_SOCKET:"openResponse"},w={LOGIN:"LOGIN",LOGOUT:"LOGOUT",AGENT_STATE:"AGENT-STATE",CALLBACK_PENDING:"PENDING-CALLBACKS",CALLBACK_CANCEL:"CANCEL-CALLBACK",DIAL_GROUP_CHANGE:"DIAL_GROUP_CHANGE",ON_MESSAGE:"ON-MESSAGE",GENERIC:"GENERIC",OFFHOOK_INIT:"OFF-HOOK-INIT",OFFHOOK_TERM:"OFF-HOOK-TERM"};var x=function(a){return g(a),h(a),i(a),a.AgentLibrary};"function"==typeof define&&define.amd?(console.log("AgentLibrary: using AMD"),define(function(){return x({})})):"object"==typeof module&&module.exports?(console.log("AgentLibrary: Using Node"),module.exports=x(this)):(console.log("AgentLibrary: Not using AMD"),x(this))}(this);