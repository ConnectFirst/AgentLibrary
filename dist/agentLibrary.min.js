/*! cf-agent-library - v0.0.0 - 2016-08-09 - Connect First */
!function(a){function b(a){var b={auxData1:a["@aux_data1"],auxData2:a["@aux_data2"],auxData3:a["@aux_data3"],auxData4:a["@aux_data4"],auxData5:a["@aux_data5"],destination:a["@destination"],dialGroupId:a["@dial_group_id"],dialGroupName:a["@dial_group_name"],dialTime:a["@dial_time"],externId:a["@extern_id"],leadId:a["@lead_id"],firstName:a.first_name["#text"]||"",midName:a.mid_name["#text"]||"",lastName:a.last_name["#text"]||"",sufix:a.suffix["#text"]||"",title:a.title["#text"]||"",address1:a.address1["#text"]||"",address2:a.address2["#text"]||"",city:a.city["#text"]||"",state:a.state["#text"]||"",zip:a.zip["#text"]||"",gateKeeper:a.gate_keeper["#text"]||""};return b}function c(a){for(var b=w.getInstance(),c=b.outboundSettings.availableOutdialGroups,d=0;d<c.length;d++){var e=c[d];e.dialGroupId===a.ui_response.outdial_group_id["#text"]&&(b.agentPermissions.allowLeadSearch=e.allowLeadSearch,b.agentPermissions.allowPreviewLeadFilters=e.allowPreviewLeadFilters,b.outboundSettings.outdialGroup=JSON.parse(JSON.stringify(e)),b.agentPermissions.requireFetchedLeadsCalled=e.requireFetchedLeadsCalled)}}function d(){for(var a=w.getInstance(),b=a.inboundSettings.availableQueues,c=a.configRequest.queueIds,d=[],e=0;e<b.length;e++){var f=b[e];c.indexOf(f.gateId)>-1&&d.push(f)}a.inboundSettings.queues=JSON.parse(JSON.stringify(d))}function e(){for(var a=w.getInstance(),b=a.chatSettings.availableChatQueues,c=a.configRequest.chatIds,d=[],e=0;e<b.length;e++){var f=b[e];c.indexOf(f.chatQueueId)>-1&&d.push(f)}a.chatSettings.chatQueues=JSON.parse(JSON.stringify(d))}function f(){for(var a=w.getInstance(),b=a.inboundSettings.availableSkillProfiles,c=0;c<b.length;c++){var d=b[c];d.skillProfileId===a.configRequest.skillProfileId&&(a.inboundSettings.skillProfile=JSON.parse(JSON.stringify(d)))}}function g(a){"use strict";var b=a.AgentLibrary=function(a){return a=a||{},this.callbacks={},this._requests={},"undefined"!=typeof a.callbacks&&(this.callbacks=a.callbacks),"undefined"!=typeof a.socketDest&&(w.getInstance().applicationSettings.socketDest=a.socketDest,this.openSocket()),this};b.prototype.setCallbacks=function(a){for(var b in a)this.callbacks[b]=a[b]},b.prototype.setCallback=function(a,b){this.callbacks[a]=b},b.prototype.getCallbacks=function(){return this.callbacks},b.prototype.getCallback=function(a){return this.callbacks[a]},b.prototype.getLoginRequest=function(){return w.getInstance().loginRequest},b.prototype.getConfigRequest=function(){return w.getInstance().configRequest},b.prototype.getLogoutRequest=function(){return w.getInstance().logoutRequest},b.prototype.getAgentStateRequest=function(){return w.getInstance().agentStateRequest},b.prototype.getOffhookInitRequest=function(){return w.getInstance().offhookInitRequest},b.prototype.getOffhookTermRequest=function(){return w.getInstance().offhookTermRequest},b.prototype.getLoginPacket=function(){return w.getInstance().loginPacket},b.prototype.getConfigPacket=function(){return w.getInstance().configPacket},b.prototype.getAgentStatePacket=function(){return w.getInstance().agentStatePacket},b.prototype.getCurrentCallPacket=function(){return w.getInstance().currentCallPacket},b.prototype.getOffhookInitPacket=function(){return w.getInstance().offhookInitPacket},b.prototype.getOffhookTermPacket=function(){return w.getInstance().offhookTermPacket},b.prototype.getDialGroupChangeNotification=function(){return w.getInstance().dialGroupChangeNotification},b.prototype.getDialGroupChangePendingNotification=function(){return w.getInstance().dialGroupChangePendingNotification},b.prototype.getEndCallNotification=function(){return w.getInstance().endCallNotification},b.prototype.getGatesChangeNotification=function(){return w.getInstance().gatesChangeNotification},b.prototype.getGenericNotification=function(){return w.getInstance().genericNotification},b.prototype.getCurrentCall=function(){return w.getInstance().currentCall},b.prototype.getApplicationSettings=function(){return w.getInstance().applicationSettings},b.prototype.getChatSettings=function(){return w.getInstance().chatSettings},b.prototype.getConnectionSettings=function(){return w.getInstance().connectionSettings},b.prototype.getInboundSettings=function(){return w.getInstance().inboundSettings},b.prototype.getOutboundSettings=function(){return w.getInstance().outboundSettings},b.prototype.getAgentSettings=function(){return w.getInstance().agentSettings},b.prototype.getAgentPermissions=function(){return w.getInstance().agentPermissions}}function h(a){"use strict";var b=a.AgentLibrary;b.prototype.openSocket=function(b){var c=this;x.setCallback(c,y.OPEN_SOCKET,b),"WebSocket"in a?(console.log("AgentLibrary: attempting to open socket connection..."),c.socket=new WebSocket(w.getInstance().applicationSettings.socketDest),c.socket.onopen=function(){w.getInstance().applicationSettings.socketConnected=!0,x.fireCallback(c,y.OPEN_SOCKET,"")},c.socket.onmessage=function(a){var b=JSON.parse(a.data);b.ui_response?x.processResponse(c,b):b.ui_notification&&x.processNotification(c,b)},c.socket.onclose=function(){x.fireCallback(c,y.CLOSE_SOCKET,""),w.getInstance().applicationSettings.socketConnected=!1}):console.warn("AgentLibrary: WebSocket NOT supported by your Browser.")},b.prototype.closeSocket=function(){this.socket.close()}}function i(a){"use strict";var b=a.AgentLibrary;b.prototype.loginAgent=function(a,b,c){w.getInstance().loginRequest=new n(a,b);var d=w.getInstance().loginRequest.formatJSON();x.setCallback(this,y.LOGIN,c),x.sendMessage(this,d)},b.prototype.configureAgent=function(a,b,c,d,e,f,g){w.getInstance().configRequest=new m(a,b,c,d,e,f);var h=w.getInstance().configRequest.formatJSON();x.setCallback(this,y.CONFIG,g),x.sendMessage(this,h)},b.prototype.logoutAgent=function(a,b){if(w.getInstance().logoutRequest=new o(a),x.setCallback(this,y.LOGOUT,b),w.getInstance().logoutRequest.isSupervisor){var c=w.getInstance().logoutRequest.formatJSON();x.sendMessage(this,c)}else x.fireCallback(this,y.LOGOUT,""),this.closeSocket()},b.prototype.setAgentState=function(a,b,c){w.getInstance().agentStateRequest=new j(a,b);var d=w.getInstance().agentStateRequest.formatJSON();x.setCallback(this,y.AGENT_STATE,c),x.sendMessage(this,d)},b.prototype.offhookInit=function(a){w.getInstance().offhookInitRequest=new p;var b=w.getInstance().offhookInitRequest.formatJSON();x.setCallback(this,y.OFFHOOK_INIT,a),x.sendMessage(this,b)},b.prototype.offhookTerm=function(a){w.getInstance().offhookTermRequest=new q;var b=w.getInstance().offhookTermRequest.formatJSON();x.setCallback(this,y.OFFHOOK_TERM,a),x.sendMessage(this,b)},b.prototype.getPendingCallbacks=function(a,b){w.getInstance().callbacksPendingRequest=new l(a);var c=w.getInstance().callbacksPendingRequest.formatJSON();x.setCallback(this,y.CALLBACK_PENDING,b),x.sendMessage(this,c)},b.prototype.cancelCallback=function(a,b,c){w.getInstance().callbackCancelRequest=new k(a,b);var d=w.getInstance().callbackCancelRequest.formatJSON();x.setCallback(this,y.CALLBACK_CANCEL,c),x.sendMessage(this,d)}}var j=function(a,b){"ON-BREAK"==a.toUpperCase()&&1==w.getInstance().onCall?(this.agentState="BREAK-AFTER-CALL",this.agentAuxState=""):(this.agentState=a.toUpperCase()||"",this.agentAuxState=b||"")};j.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":z.AGENT_STATE,"@message_id":x.getMessageId(),response_to:"",agent_id:{"#text":w.getInstance().agentSettings.agentId},state:{"#text":this.agentState},agent_aux_state:{"#text":this.agentAuxState}}};return JSON.stringify(a)},j.prototype.processResponse=function(a){var b=a.ui_response.status["#text"],c=a.ui_response.prev_state["#text"],d=a.ui_response.current_state["#text"],e=a.ui_response.prev_aux_state["#text"]||"",f=a.ui_response.agent_aux_state["#text"]||"",g=w.getInstance(),h=x.buildDefaultResponse(a);if(h.agentId=a.ui_response.agent_id["#text"]||"",h.previousState=c,h.currentState=d,h.previousAuxState=e,h.currentAuxState=f,"OK"==b){var i=c,j=d;e.length>0&&(i=e),f.length>0&&(j=f),console.log("AgentLibrary: Agent state changed from ["+i+"] to ["+j+"]"),g.agentSettings.currentState=d,g.agentSettings.currentStateLabel=f,g.agentStatePacket=a}else""===h.message&&(h.message="Unable to change agent state"),console.warn("AgentLibrary: Unable to change agent state "+detail);return h};var k=function(a,b){this.agentId=b||w.getInstance().agentSettings.agentId,this.leadId=a};k.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":z.CALLBACK_CANCEL,"@message_id":x.getMessageId(),response_to:"",agent_id:{"#text":this.agentId},lead_id:{"#text":this.leadId}}};return JSON.stringify(a)};var l=function(a){this.agentId=a||w.getInstance().agentSettings.agentId};l.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":z.CALLBACK_PENDING,"@message_id":x.getMessageId(),response_to:"",agent_id:{"#text":this.agentId}}};return JSON.stringify(a)},l.prototype.processResponse=function(a){var c=a.ui_response.lead,d=[];if(Array.isArray(c))for(var e=0;e<c.length;e++){var f=c[e],g=b(f);d.push(g)}else c&&d.push(b(c));return w.getInstance().agentSettings.pendingCallbacks=JSON.parse(JSON.stringify(d)),w.getInstance().agentSettings.pendingCallbacks};var m=function(a,b,c,d,e,f){this.queueIds=a||[],this.chatIds=b||[],this.skillPofileId=c||"",this.dialGroupId=d||"",this.dialDest=e||"",this.updateFromAdminUI=f||!1,this.loginType="NO-SELECTION",this.updateLogin=!1;var g=w.getInstance();this.queueIds=x.checkExistingIds(g.inboundSettings.availableQueues,this.queueIds,"gateId"),this.chatIds=x.checkExistingIds(g.chatSettings.availableChatQueues,this.chatIds,"chatQueueId"),this.skillPofileId=x.checkExistingIds(g.inboundSettings.availableSkillProfiles,[this.skillPofileId],"profileId")[0]||"",this.dialGroupId=x.checkExistingIds(g.outboundSettings.availableOutdialGroups,[this.dialGroupId],"dialGroupId")[0]||"",this.queueIds.length>0&&""!==this.dialGroupId?this.loginType="BLENDED":this.queueIds.length>0?this.loginType="INBOUND":""!==this.dialGroupId?this.loginType="OUTBOUND":this.loginType="NO-SELECTION",g.agentSettings.isLoggedIn&&(this.updateLogin=!0),x.validateDest(this.dialDest)||console.error("AgentLibrary: dialDest must be a valid sip or 10-digit DID")};m.prototype.formatJSON=function(){for(var a={ui_request:{"@destination":"IQ","@type":z.LOGIN,"@message_id":x.getMessageId(),response_to:"",agent_id:{"#text":x.toString(w.getInstance().agentSettings.agentId)},agent_pwd:{"#text":w.getInstance().loginRequest.password},dial_dest:{"#text":x.toString(this.dialDest)},login_type:{"#text":this.loginType},update_login:{"#text":x.toString(this.updateLogin)},outdial_group_id:{"#text":x.toString(this.dialGroupId)},skill_profile_id:{"#text":x.toString(this.skillPofileId)},update_from_adminui:{"#text":x.toString(this.updateFromAdminUI)}}},b=[],c=0;c<this.queueIds.length;c++)""!==this.queueIds[c]&&b.push({"#text":x.toString(this.queueIds[c])});b.length>0?a.ui_request.gates={gate_id:b}:a.ui_request.gates={};for(var d=[],c=0;c<this.chatIds.length;c++)""!==this.chatIds[c]&&d.push({"#text":x.toString(this.chatIds[c])});return d.length>0?a.ui_request.chat_queues={chat_queue_id:d}:a.ui_request.chat_queues={},JSON.stringify(a)},m.prototype.processResponse=function(a){var b=a.ui_response.status["#text"],g=a.ui_response.detail["#text"],h=w.getInstance(),i=x.buildDefaultResponse(a);return"Logon Session Configuration Updated!"===g&&(h.agentSettings.updateLoginMode=!0),"SUCCESS"===b?(h.agentSettings.isLoggedIn?h.agentSettings.updateLoginMode?(h.agentSettings.updateLoginMode=!1,h.agentPermissions.allowLeadSearch=!1,h.agentPermissions.requireFetchedLeadsCalled=!1,h.agentPermissions.allowPreviewLeadFilters=!1,c(a),d(),e(),f()):console.log("AgentLibrary: Processed a Layer 2 Reconnect Successfully"):(h.configPacket=a,h.connectionSettings.hashCode=a.ui_response.hash_code["#text"],h.agentSettings.isLoggedIn=!0,h.agentSettings.loginDTS=new Date,h.connectionSettings.reconnect=!0,h.agentPermissions.allowLeadSearch=!1,h.agentSettings.dialDest=h.configRequest.dialDest,h.agentSettings.loginType=a.ui_response.login_type["#text"],c(a),d(),e(),f()),i.agentSettings=h.agentSettings,i.agentPermissions=h.agentPermissions,i.applicationSettings=h.applicationSettings,i.chatSettings=h.chatSettings,i.connectionSettings=h.connectionSettings,i.inboundSettings=h.inboundSettings,i.outboundSettings=h.outboundSettings,i.surveySettings=h.surveySettings):(""===i.message&&(i.message="Agent configuration attempt failed (2nd layer login)"),console.warn("AgentLibrary: Layer 2 login failed!")),i};var n=function(a,b){this.username=a,this.password=b};n.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IS","@type":z.LOGIN,"@message_id":x.getMessageId(),response_to:"",username:{"#text":this.username},password:{"#text":this.password}}};return JSON.stringify(a)},n.prototype.processResponse=function(a){var b=a.ui_response.status["#text"],c=w.getInstance(),d=x.buildDefaultResponse(a);if("OK"===b){if(!c.isLoggedInIS){c.loginPacket=a,c.applicationSettings.isLoggedInIS=!0,c.agentSettings.loginDTS=new Date,c.chatSettings.alias=a.ui_response.first_name["#text"]+" "+a.ui_response.last_name["#text"],c.agentSettings.maxBreakTime=a.ui_response.max_break_time["#text"],c.agentSettings.maxLunchTime=a.ui_response.max_lunch_time["#text"],c.agentSettings.firstName=a.ui_response.first_name["#text"],c.agentSettings.lastName=a.ui_response.last_name["#text"],c.agentSettings.email=a.ui_response.email["#text"],c.agentSettings.agentId=a.ui_response.agent_id["#text"],c.agentSettings.externalAgentId=a.ui_response.external_agent_id["#text"]||"",c.agentSettings.agentType=a.ui_response.agent_type["#text"],c.agentSettings.realAgentType=a.ui_response.real_agent_type["#text"],c.agentSettings.defaultLoginDest=a.ui_response.default_login_dest["#text"],c.agentSettings.altDefaultLoginDest=a.ui_response.alt_default_login_dest["#text"]||"",c.agentSettings.disableSupervisorMonitoring=a.ui_response.disable_supervisor_monitoring["#text"],c.agentSettings.initLoginState=a.ui_response.init_login_state["#text"],c.agentSettings.initLoginStateLabel=a.ui_response.init_login_state_label["#text"],c.agentSettings.outboundManualDefaultRingtime=a.ui_response.outbound_manual_default_ringtime["#text"];var e="undefined"==typeof a.ui_response.allow_call_control?!1:a.ui_response.allow_call_control["#text"],f="undefined"==typeof a.ui_response.allow_chat?!1:a.ui_response.allow_chat["#text"],g="undefined"==typeof a.ui_response.show_lead_history?!1:a.ui_response.show_lead_history["#text"],h="undefined"==typeof a.ui_response.allow_manual_outbound_gates?!1:a.ui_response.allow_manual_outbound_gates["#text"],i="undefined"==typeof a.ui_response.tcpa_safe_mode?!1:a.ui_response.tcpa_safe_mode["#text"],j="undefined"==typeof a.ui_response.insert_campaigns?!1:a.ui_response.insert_campaigns.campaign,k="undefined"==typeof a.ui_response.outbound_prepay?!1:a.ui_response.outbound_prepay["#text"];"0"==e&&(c.agentPermissions.allowCallControl=!1),"1"==f&&(c.agentPermissions.allowChat=!0),"0"==g&&(c.agentPermissions.showLeadHistory=!1),"1"==h&&(c.agentPermissions.allowManualOutboundGates=!0),"1"==i&&(c.applicationSettings.isTcpaSafeMode=!0),j&&j.length>0&&(c.agentPermissions.allowLeadInserts=!0),"1"==k&&(c.agentSettings.isOutboundPrepay=!0),"0"==a.ui_response.allow_off_hook["#text"]&&(c.agentPermissions.allowOffHook=!1),"0"==a.ui_response.allow_manual_calls["#text"]&&(c.agentPermissions.allowManualCalls=!1),"0"==a.ui_response.allow_manual_pass["#text"]&&(c.agentPermissions.allowManualPass=!1),"1"==a.ui_response.allow_manual_intl_calls["#text"]&&(c.agentPermissions.allowManualIntlCalls=!0),"0"==a.ui_response.allow_login_updates["#text"]&&(c.agentPermissions.allowLoginUpdates=!1),"0"==a.ui_response.allow_inbound["#text"]&&(c.agentPermissions.allowInbound=!1),"0"==a.ui_response.allow_outbound["#text"]&&(c.agentPermissions.allowOutbound=!1),"0"==a.ui_response.allow_blended["#text"]&&(c.agentPermissions.allowBlended=!1),"0"==a.ui_response.allow_login_control["#text"]&&(c.agentPermissions.allowLoginControl=!1),"1"==a.ui_response.allow_cross_gate_requeue["#text"]&&(c.agentPermissions.allowCrossQueueRequeue=!0),processCampaigns(a),c.chatSettings.availableChatQueues=x.processResponseCollection(a.ui_response,"login_chat_queues","chat_queue"),c.inboundSettings.availableQueues=x.processResponseCollection(a.ui_response,"login_gates","gate"),c.inboundSettings.availableSkillProfiles=x.processResponseCollection(a.ui_response,"skill_profiles","profile"),c.inboundSettings.availableRequeueQueues=x.processResponseCollection(a.ui_response,"requeue_gates","gate_group"),c.chatSettings.availableChatRooms=x.processResponseCollection(a.ui_response,"chat_rooms","room"),c.surveySettings.availableSurveys=x.processResponseCollection(a.ui_response,"surveys","survey"),c.agentSettings.callerIds=x.processResponseCollection(a.ui_response,"caller_ids","caller_id"),c.agentSettings.availableAgentStates=x.processResponseCollection(a.ui_response,"agent_states","agent_state"),c.applicationSettings.availableCountries=x.processResponseCollection(a.ui_response,"account_countries","country"),c.outboundSettings.insertCampaigns=x.processResponseCollection(a.ui_response,"insert_campaigns","campaign");for(var l=x.processResponseCollection(a.ui_response,"outdial_groups","group"),m=0;m<l.length;m++){var n=l[m];n.allowLeadSearch="YES"===n.allowLeadSearch,n.allowPreviewLeadFilters="1"===n.allowPreviewLeadFilters,n.progressiveEnabled="1"===n.progressiveEnabled,n.requireFetchedLeadsCalled="1"===n.requireFetchedLeadsCalled}c.outboundSettings.availableOutdialGroups=l}d.agentSettings=c.agentSettings,d.agentPermissions=c.agentPermissions,d.applicationSettings=c.applicationSettings,d.chatSettings=c.chatSettings,d.connectionSettings=c.connectionSettings,d.inboundSettings=c.inboundSettings,d.outboundSettings=c.outboundSettings,d.surveySettings=c.surveySettings}else"RESTRICTED"===b?(d.message="Invalid IP Address",console.log("AgentLibrary: Invalid IP Address")):(d.message="Invalid Username or password",console.log("AgentLibrary: Invalid Username or password"));return d},processCampaigns=function(a){var b=[],c={},d=[],e=[],f=[],g="",h=0,i="",j=!1;if("undefined"!=typeof a.ui_response.campaigns.campaign&&(d=a.ui_response.campaigns.campaign),Array.isArray(d))for(var k=0;k<d.length;k++){h=d[k]["@campaign_id"],i=d[k]["@campaign_name"],j="1"==d[k]["@allow_lead_updates"],e=d[k].custom_labels,f=[],g="",w.getInstance().agentPermissions.allowLeadUpdatesByCampaign[h]=j;for(var l in e){g=l.replace(/@/,"");var m={};m[g]=e[l],f.push(m)}c={allowLeadUpdates:j,campaignId:h,campaignName:i,surveyId:d[k]["@survey_id"],surveyName:d[k]["@survey_name"],customLabels:f},b.push(c)}else if(d){h=d["@campaign_id"],i=d["@campaign_name"],j="1"==d["@allow_lead_updates"],e=d.custom_labels,f=[],g="",w.getInstance().agentPermissions.allowLeadUpdatesByCampaign[h]=j;for(var n in e){g=n.replace(/@/,"");var m={};m[g]=e[n],f.push(m)}c={allowLeadUpdates:j,campaignId:h,campaignName:i,surveyId:d["@survey_id"],surveyName:d["@survey_name"],customLabels:f},b.push(c)}w.getInstance().outboundSettings.availableCampaigns=b};var o=function(a,b,c){this.agentId=a,this.message=b,this.isSupervisor=c};o.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":z.LOGOUT,"@message_id":x.getMessageId(),response_to:"",agent_id:{"#text":this.agentId},message:{"#text":this.message}}};return JSON.stringify(a)};var p=function(){};p.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":z.OFFHOOK_INIT,"@message_id":x.getMessageId(),response_to:"",agent_id:{"#text":w.getInstance().agentSettings.agentId},dial_dest:{"#text":w.getInstance().agentSettings.dialDest}}};return JSON.stringify(a)},p.prototype.processResponse=function(a){var b=a.ui_response.status["#text"],c=x.buildDefaultResponse(a);return"OK"===b?(w.getInstance().offhookInitPacket=a,w.getInstance().agentSettings.isOffhook=!0):(""===c.message&&(c.message="Unable to process offhook request"),console.log("AgentLibrary: Unable to process offhook request ",detail)),c};var q=function(a){};q.prototype.formatJSON=function(){var a={ui_request:{"@destination":"IQ","@type":z.OFFHOOK_TERM,"@message_id":x.getMessageId(),response_to:"",agent_id:{"#text":w.getInstance().agentSettings.agentId}}};return JSON.stringify(a)},q.prototype.processResponse=function(a){var b="1"===a.ui_notification.monitoring["#text"],c=w.getInstance();c.agentSettings.wasMonitoring=b,c.offhookTermPacket=a,c.agentSettings.isOffhook=!1;var d={agentId:a.ui_notification.agent_id["#text"],startDts:a.ui_notification.start_dts["#text"],endDts:a.ui_notification.end_dts["#text"],monitoring:b};return d};var r=function(){};r.prototype.processResponse=function(a){var b=w.getInstance(),c=b.configRequest.loginType,d=a.ui_notification.dial_group_id["#text"]||"";b.dialGroupChangeNotification=a,!d||""===d||"INBOUND"!==c&&"BLENDED"!==c?d&&""!==d?b.configRequest.loginType="OUTBOUND":"INBOUND"===c?b.configRequest.loginType="INBOUND":b.configRequest.loginType="NO-SELECTION":b.configRequest.loginType="BLENDED",w.getInstance().configRequest.dialGroupId=d;var e={message:"Dial Group Updated Successfully.",detail:"Dial Group changed to ["+d+"].",dialGroupId:a.ui_notification.dial_group_id["#text"],dialGroupName:a.ui_notification.dialGroupName["#text"],dialGroupDesc:a.ui_notification.dial_group_desc["#text"],agentId:a.ui_notification.agent_id["#text"]};return e};var s=function(){};s.prototype.processResponse=function(a){var b=w.getInstance();b.agentSettings.pendingDialGroupChange=parseInt(a.ui_notification.dial_group_id["#text"],10),a.ui_notification.update_from_adminui?b.agentSettings.updateDGFromAdminUI="TRUE"===a.ui_notification.update_from_adminui["#text"].toUpperCase():b.agentSettings.updateDGFromAdminUI=!1;var c={message:"Dial Group Change Pending notification received.",detail:"DialGroup switch for existing session pending until active call ends.",agentId:a.ui_notification.agent_id["#text"],dialGroupId:a.ui_notification.dial_group_id["#text"],updateFromAdminUI:a.ui_notification.update_from_adminui["#text"]};return c};var t=function(a){this.libInstance=a};t.prototype.processResponse=function(a){var b=0,c="",d="",e=w.getInstance();e.endCallNotification=a,a.ui_notification.call_duration&&(b=a.ui_notification.call_duration["#text"]),a.ui_notification.term_party&&(c=a.ui_notification.term_party["#text"]),a.ui_notification.term_reason&&(d=a.ui_notification.term_reason["#text"]),e.currentCall.duration=b,e.currentCall.termParty=c,e.currentCall.termReason=d,e.agentSettings.callState="CALL-ENDED",e.transferSessions={},(e.agentSettings.pendingDialGroupChange>0||-1==e.agentSettings.pendingDialGroupChange)&&(e.configRequest.dialGroupId=e.agentSettings.pendingDialGroupChange,this.libInstance.configureAgent(e.configRequest.queueIds,e.configRequest.chatIds,e.configRequest.skillProfileId,e.configRequest.dialGroupId,e.configRequest.dialDest,e.agentSettings.updateDGFromAdminUI),e.agentSettings.pendingDialGroupChange=0,e.agentSettings.updateDGFromAdminUI=!1);var f={message:"End Call Notification Received.",detail:"",uii:a.ui_notification.uii["#text"],sessionId:a.ui_notification.session_id["#text"],agentId:a.ui_notification.agent_id["#text"],callDts:a.ui_notification.call_dts["#text"],duration:b,termParty:c,termReason:d,recordingUrl:a.ui_notification.recording_url["#text"],dispositionTimeout:a.ui_notification.disposition_timeout["#text"]};return f};var u=function(){};u.prototype.processResponse=function(a){var b=w.getInstance(),c=[],d=b.inboundSettings.availableQueues,e=a.ui_notification.gate_ids["#text"]||"";""!==e&&(e=e.split(","));for(var f=0;f<e.length;f++){var g=e[f],h=x.findObjById(d,g,"gateId");if(h)c.push(h);else{var i={gateId:g,gateName:"",gateDesc:"",defaultDestOverride:"",isAgentSelectable:!1};c.push(i)}}b.inboundSettings.queues=JSON.parse(JSON.stringify(c));var j={agentId:a.ui_notification.agent_id["#text"],message:"Gates Change notification received.",queues:c};return j};var v=function(){};v.prototype.processResponse=function(a){var b=x.buildDefaultResponse(a),c=a.ui_notification.message_code,d="";return c&&(d=c["#text"]||""),b.messageCode=d,b};var w=function(){function a(){return{agentStateRequest:null,callbacksPendingRequest:null,configRequest:null,logoutRequest:null,loginRequest:null,offhookInitRequest:null,offhookTermRequest:null,agentStatePacket:null,configPacket:null,currentCallPacket:null,loginPacket:null,offhookInitPacket:null,offhookTermPacket:null,transferSessions:null,dialGroupChangeNotification:new r,dialGroupChangePendingNotification:new s,endCallNotification:new t,gatesChangeNotification:new u,genericNotification:new v,currentCall:{},applicationSettings:{availableCountries:[],isLoggedInIS:!1,socketConnected:!1,socketDest:"",isTcpaSafeMode:!1},agentSettings:{agentId:0,agentType:"AGENT",altDefaultLoginDest:"",availableAgentStates:[],callerIds:[],callState:null,currentState:"OFFLINE",currentStateLabel:"",defaultLoginDest:"",dialDest:"",email:"",externalAgentId:"",firstName:"",isLoggedIn:!1,isOffhook:!1,initLoginState:"AVAILABLE",initLoginStateLabel:"Available",isOutboundPrepay:!1,lastName:"",loginDTS:null,loginType:"NO-SELECTION",maxBreakTime:-1,maxLunchTime:-1,onCall:!1,outboundManualDefaultRingtime:"30",pendingCallbacks:[],pendingDialGroupChange:0,realAgentType:"AGENT",updateDGFromAdminUI:!1,updateLoginMode:!1,wasMonitoring:!1},agentPermissions:{allowBlended:!0,allowCallControl:!0,allowChat:!1,allowCrossQueueRequeue:!1,allowInbound:!0,allowLeadInserts:!1,allowLeadSearch:!1,allowLoginControl:!0,allowLoginUpdates:!0,allowManualCalls:!0,allowManualPass:!0,allowManualIntlCalls:!1,allowManualOutboundGates:!1,allowOffHook:!0,allowOutbound:!0,allowPreviewLeadFilters:!1,allowLeadUpdatesByCampaign:{},disableSupervisorMonitoring:!0,requireFetchedLeadsCalled:!1,showLeadHistory:!0},chatSettings:{availableChatQueues:[],availableChatRooms:[],chatQueues:[],alias:""},connectionSettings:{hashCode:null,reconnect:!1},inboundSettings:{availableQueues:[],availableSkillProfiles:[],queues:[],skillProfile:{}},outboundSettings:{availableCampaigns:[],availableOutdialGroups:[],insertCampaigns:[],outdialGroup:{}},surveySettings:{availableSurveys:[]}}}var b;return{getInstance:function(){return b||(b=a()),b}}}(),x={sendMessage:function(a,b){if(1===a.socket.readyState){var c=JSON.parse(b);a._requests[c.ui_request["@message_id"]]={type:c.ui_request["@type"],msg:c.ui_request},a.socket.send(b)}else console.warn("AgentLibrary: WebSocket is not connected, cannot send message.")},processResponse:function(a,b){var c=b.ui_response["@type"],d=b.ui_response["@message_id"],e=""===d?"IS":d.slice(0,2);switch(console.log("AgentLibrary: received response: ("+e+") "+c.toUpperCase()),x.fireCallback(a,y.ON_MESSAGE,b),c.toUpperCase()){case z.LOGIN:if("IS"===e){var f=w.getInstance().loginRequest.processResponse(b);x.fireCallback(a,y.LOGIN,f)}else if("IQ"===e){var g=w.getInstance().configRequest.processResponse(b);x.fireCallback(a,y.CONFIG,g)}break;case z.LOGOUT:x.fireCallback(a,y.LOGOUT,b);break;case z.AGENT_STATE:null===w.getInstance().agentStateRequest&&(w.getInstance().agentStateRequest=new j(b.ui_response.current_state["#text"],b.ui_response.agent_aux_state["#text"]));var h=w.getInstance().agentStateRequest.processResponse(b);x.fireCallback(a,y.AGENT_STATE,h);break;case z.OFFHOOK_INIT:var i=w.getInstance().offhookInitRequest.processResponse(b);x.fireCallback(a,y.OFFHOOK_INIT,i);break;case z.CALLBACK_PENDING:var k=w.getInstance().callbacksPendingRequest.processResponse(b);x.fireCallback(a,y.CALLBACK_PENDING,k)}},processNotification:function(a,b){var c=b.ui_notification["@type"],d=b.ui_notification["@message_id"],e=""===d?"IS":d.slice(0,2);switch(console.log("AgentLibrary: received notification: ("+e+") "+c.toUpperCase()),c.toUpperCase()){case z.GATES_CHANGE:var f=new u,g=f.processResponse(b);x.fireCallback(a,y.GATES_CHANGE,g);break;case z.DIAL_GROUP_CHANGE:var h=new r,i=h.processResponse(b);x.fireCallback(a,y.DIAL_GROUP_CHANGE,i);break;case z.DIAL_GROUP_CHANGE_PENDING:var j=new s,k=j.processResponse(b);x.fireCallback(a,y.DIAL_GROUP_CHANGE_PENDING,k);break;case z.END_CALL:var l=new t(a),m=l.processResponse(b);x.fireCallback(a,y.END_CALL,m);break;case z.GENERIC:var n=new v,o=n.processResponse(b),p=b.ui_notification["@response_to"];if(a._requests[p]){var c=a._requests[p].type,A=x.findCallbackBasedOnMessageType(c);x.fireCallback(a,A,o)}else x.fireCallback(a,y.GENERIC_NOTIFICATION,o);break;case z.OFFHOOK_TERM:null===w.getInstance().offhookTermRequest&&(w.getInstance().offhookTermRequest=new q);var B=w.getInstance().offhookTermRequest.processResponse(b);x.fireCallback(a,y.OFFHOOK_TERM,B)}},processResponseCollection:function(a,b,c){var d=[],e={},f=[];if(a[b]&&"undefined"!=typeof a[b][c]&&(f=a[b][c]),Array.isArray(f))for(var g=0;g<f.length;g++){var h="";for(var i in f[g])if(h=i.replace(/@/,""),h=h.replace(/_([a-z])/g,function(a){return a[1].toUpperCase()}),"object"==typeof f[g][i]){var j=Object.keys(f[g][i])[0],k=[];k=x.processResponseCollection(f[g],i,j),e[h]=k}else e[h]=f[g][i];d.push(e),e={}}else{var l="";for(var m in f)if(l=m.replace(/@/,""),l=l.replace(/_([a-z])/g,function(a){return a[1].toUpperCase()}),"object"==typeof f[m]){var n=Object.keys(f[m])[0],o=[];o=x.processResponseCollection(f,m,n),e[l]=f[m]}else e[l]=f[m];d.push(e)}return d},fireCallback:function(a,b,c){c=c||"","function"==typeof a.callbacks[b]&&a.callbacks[b].call(a,c)},setCallback:function(a,b,c){"undefined"!=typeof c&&(a.callbacks[b]=c)},getMessageId:function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},checkExistingIds:function(a,b,c){for(var d=[],e=[],f=0;f<a.length;f++)d.push(parseInt(a[f][c],10));for(var g=0;g<b.length;g++)-1===d.indexOf(parseInt(b[g],10))&&e.push(parseInt(b[g],10));for(var h=b.length-1;h>=0;h--)e.indexOf(parseInt(b[h],10))>-1&&b.splice(h,1);return b},findObjById:function(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];if(e[c]===b)return e}return null},validateDest:function(a){var b=!1,c=/^\d+$/.test(a);return c&&10===a.length?b=!0:"sip:"===a.slice(0,4).toLowerCase()&&-1!==a.indexOf("@")&&(b=!0),b},findCallbackBasedOnMessageType:function(a){var b="";for(key in z)z[key]===a&&(b=y[key]);return b},buildDefaultResponse:function(a){var b="",c="",d="",e="",f="",g="";return a.ui_response?(e=a.ui_response.message,f=a.ui_response.detail,g=a.ui_response.status):a.ui_notification&&(e=a.ui_notification.message,f=a.ui_notification.detail,g=a.ui_notification.status),e&&(b=e["#text"]||""),f&&(c=f["#text"]||""),g&&(d=g["#text"]||""),{message:b,detail:c,status:d}},toString:function(a){return a?a.toString():""}};const y={AGENT_STATE:"agentStateResponse",CLOSE_SOCKET:"closeResponse",CONFIG:"configureResponse",CALLBACK_PENDING:"callbacksPendingResponse",CALLBACK_CANCEL:"callbackCancelResponse",DIAL_GROUP_CHANGE:"dialGroupChangeNotification",DIAL_GROUP_CHANGE_PENDING:"dialGroupChangePendingNotification",END_CALL:"endCallNotification",GATES_CHANGE:"gatesChangeNotification",GENERIC_NOTIFICATION:"genericNotification",GENERIC_RESPONSE:"genericResponse",LOGIN:"loginResponse",OFFHOOK_INIT:"offhookInitResponse",OFFHOOK_TERM:"offhookTermResponse",OPEN_SOCKET:"openResponse"},z={LOGIN:"LOGIN",LOGOUT:"LOGOUT",AGENT_STATE:"AGENT-STATE",CALLBACK_PENDING:"PENDING-CALLBACKS",CALLBACK_CANCEL:"CANCEL-CALLBACK",END_CALL:"END-CALL",DIAL_GROUP_CHANGE:"DIAL_GROUP_CHANGE",DIAL_GROUP_CHANGE_PENDING:"DIAL_GROUP_CHANGE_PENDING",GATES_CHANGE:"GATES_CHANGE",ON_MESSAGE:"ON-MESSAGE",GENERIC:"GENERIC",OFFHOOK_INIT:"OFF-HOOK-INIT",OFFHOOK_TERM:"OFF-HOOK-TERM"};var A=function(a){return g(a),h(a),i(a),a.AgentLibrary};"function"==typeof define&&define.amd?(console.log("AgentLibrary: using AMD"),define(function(){return A({})})):"object"==typeof module&&module.exports?(console.log("AgentLibrary: Using Node"),module.exports=A(this)):(console.log("AgentLibrary: Not using AMD"),A(this))}(this);